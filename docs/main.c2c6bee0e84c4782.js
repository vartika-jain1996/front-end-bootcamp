(self.webpackChunkvng_polymers_project=self.webpackChunkvng_polymers_project||[]).push([[179],{741:(sp,Zl,Wl)=>{"use strict";function Rn(e){return"function"==typeof e}function au(e){const n=e(a=>{Error.call(a),a.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const ap=au(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((a,c)=>`${c+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Vn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const d of n)d.remove(this);else n.remove(this);const{initialTeardown:a}=this;if(Rn(a))try{a()}catch(d){t=d instanceof ap?d.errors:[d]}const{_teardowns:c}=this;if(c){this._teardowns=null;for(const d of c)try{ze(d)}catch(y){t=null!=t?t:[],y instanceof ap?t=[...t,...y.errors]:t.push(y)}}if(t)throw new ap(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ze(t);else{if(t instanceof Vn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_teardowns:n}=this;n&&p(n,t),t instanceof Vn&&t._removeParent(this)}}Vn.EMPTY=(()=>{const e=new Vn;return e.closed=!0,e})();const yo=Vn.EMPTY;function Jr(e){return e instanceof Vn||e&&"closed"in e&&Rn(e.remove)&&Rn(e.add)&&Rn(e.unsubscribe)}function ze(e){Rn(e)?e():e.unsubscribe()}const Fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},at={setTimeout(...e){const{delegate:t}=at;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=at;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ni(e){at.setTimeout(()=>{const{onUnhandledError:t}=Fe;if(!t)throw e;t(e)})}function $o(){}const ra=ia("C",void 0,void 0);function ia(e,t,n){return{kind:e,value:t,error:n}}let Ti=null;function Ui(e){if(Fe.useDeprecatedSynchronousErrorHandling){const t=!Ti;if(t&&(Ti={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:a}=Ti;if(Ti=null,n)throw a}}else e()}class Kt extends Vn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Jr(t)&&t.add(this)):this.destination=lu}static create(t,n,a){return new xo(t,n,a)}next(t){this.isStopped?zn(function ei(e){return ia("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?zn(function vn(e){return ia("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?zn(ra,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class xo extends Kt{constructor(t,n,a){let c;if(super(),Rn(t))c=t;else if(t){let d;({next:c,error:n,complete:a}=t),this&&Fe.useDeprecatedNextContext?(d=Object.create(t),d.unsubscribe=()=>this.unsubscribe()):d=t,c=null==c?void 0:c.bind(d),n=null==n?void 0:n.bind(d),a=null==a?void 0:a.bind(d)}this.destination={next:c?Go(c):$o,error:Go(null!=n?n:bs),complete:a?Go(a):$o}}}function Go(e,t){return(...n)=>{try{e(...n)}catch(a){Fe.useDeprecatedSynchronousErrorHandling?function vo(e){Fe.useDeprecatedSynchronousErrorHandling&&Ti&&(Ti.errorThrown=!0,Ti.error=e)}(a):Ni(a)}}}function bs(e){throw e}function zn(e,t){const{onStoppedNotification:n}=Fe;n&&at.setTimeout(()=>n(e,t))}const lu={closed:!0,next:$o,error:bs,complete:$o},bo="function"==typeof Symbol&&Symbol.observable||"@@observable";function Vi(e){return e}let xn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const a=new e;return a.source=this,a.operator=n,a}subscribe(n,a,c){const d=function co(e){return e&&e instanceof Kt||function wo(e){return e&&Rn(e.next)&&Rn(e.error)&&Rn(e.complete)}(e)&&Jr(e)}(n)?n:new xo(n,a,c);return Ui(()=>{const{operator:y,source:w}=this;d.add(y?y.call(d,w):w?this._subscribe(d):this._trySubscribe(d))}),d}_trySubscribe(n){try{return this._subscribe(n)}catch(a){n.error(a)}}forEach(n,a){return new(a=qo(a))((c,d)=>{let y;y=this.subscribe(w=>{try{n(w)}catch(T){d(T),null==y||y.unsubscribe()}},d,c)})}_subscribe(n){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(n)}[bo](){return this}pipe(...n){return function oa(e){return 0===e.length?Vi:1===e.length?e[0]:function(n){return e.reduce((a,c)=>c(a),n)}}(n)(this)}toPromise(n){return new(n=qo(n))((a,c)=>{let d;this.subscribe(y=>d=y,y=>c(y),()=>a(d))})}}return e.create=t=>new e(t),e})();function qo(e){var t;return null!==(t=null!=e?e:Fe.Promise)&&void 0!==t?t:Promise}const dr=au(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ti=(()=>{class e extends xn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const a=new Pn(this,this);return a.operator=n,a}_throwIfClosed(){if(this.closed)throw new dr}next(n){Ui(()=>{if(this._throwIfClosed(),!this.isStopped){const a=this.observers.slice();for(const c of a)c.next(n)}})}error(n){Ui(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:a}=this;for(;a.length;)a.shift().error(n)}})}complete(){Ui(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:a,isStopped:c,observers:d}=this;return a||c?yo:(d.push(n),new Vn(()=>p(d,n)))}_checkFinalizedStatuses(n){const{hasError:a,thrownError:c,isStopped:d}=this;a?n.error(c):d&&n.complete()}asObservable(){const n=new xn;return n.source=this,n}}return e.create=(t,n)=>new Pn(t,n),e})();class Pn extends ti{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,a;null===(a=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===a||a.call(n,t)}error(t){var n,a;null===(a=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===a||a.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,a;return null!==(a=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==a?a:yo}}function di(e){return Rn(null==e?void 0:e.lift)}function er(e){return t=>{if(di(t))return t.lift(function(n){try{return e(n,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}class En extends Kt{constructor(t,n,a,c,d){super(t),this.onFinalize=d,this._next=n?function(y){try{n(y)}catch(w){t.error(w)}}:super._next,this._error=c?function(y){try{c(y)}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function an(e,t){return er((n,a)=>{let c=0;n.subscribe(new En(a,d=>{a.next(e.call(t,d,c++))}))})}function Ii(e){return this instanceof Ii?(this.v=e,this):new Ii(e)}function Mi(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,a=n.apply(e,t||[]),d=[];return c={},y("next"),y("throw"),y("return"),c[Symbol.asyncIterator]=function(){return this},c;function y(Q){a[Q]&&(c[Q]=function(ae){return new Promise(function(ve,Oe){d.push([Q,ae,ve,Oe])>1||w(Q,ae)})})}function w(Q,ae){try{!function T(Q){Q.value instanceof Ii?Promise.resolve(Q.value.v).then(P,O):V(d[0][2],Q)}(a[Q](ae))}catch(ve){V(d[0][3],ve)}}function P(Q){w("next",Q)}function O(Q){w("throw",Q)}function V(Q,ae){Q(ae),d.shift(),d.length&&w(d[0][0],d[0][1])}}function Kl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ji(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n);function a(d){n[d]=e[d]&&function(y){return new Promise(function(w,T){!function c(d,y,w,T){Promise.resolve(T).then(function(P){d({value:P,done:w})},y)}(w,T,(y=e[d](y)).done,y.value)})}}}const Ts=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ec(e){return Rn(null==e?void 0:e.then)}function tl(e){return Rn(e[bo])}function nl(e){return Symbol.asyncIterator&&Rn(null==e?void 0:e[Symbol.asyncIterator])}function Eo(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const pi=function rl(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Wo(e){return Rn(null==e?void 0:e[pi])}function il(e){return Mi(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:a,done:c}=yield Ii(n.read());if(c)return yield Ii(void 0);yield yield Ii(a)}}finally{n.releaseLock()}})}function Xo(e){return Rn(null==e?void 0:e.getReader)}function br(e){if(e instanceof xn)return e;if(null!=e){if(tl(e))return function la(e){return new xn(t=>{const n=e[bo]();if(Rn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ts(e))return function ol(e){return new xn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(ec(e))return function Ss(e){return new xn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Ni)})}(e);if(nl(e))return Y(e);if(Wo(e))return function Is(e){return new xn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Xo(e))return function z(e){return Y(il(e))}(e)}throw Eo(e)}function Y(e){return new xn(t=>{(function U(e,t){var n,a,c,d;return function aa(e,t,n,a){return new(n||(n=Promise))(function(d,y){function w(O){try{P(a.next(O))}catch(V){y(V)}}function T(O){try{P(a.throw(O))}catch(V){y(V)}}function P(O){O.done?d(O.value):function c(d){return d instanceof n?d:new n(function(y){y(d)})}(O.value).then(w,T)}P((a=a.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Kl(e);!(a=yield n.next()).done;)if(t.next(a.value),t.closed)return}catch(y){c={error:y}}finally{try{a&&!a.done&&(d=n.return)&&(yield d.call(n))}finally{if(c)throw c.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function W(e,t,n,a=0,c=!1){const d=t.schedule(function(){n(),c?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(d),!c)return d}function se(e,t,n=1/0){return Rn(t)?se((a,c)=>an((d,y)=>t(a,d,c,y))(br(e(a,c))),n):("number"==typeof t&&(n=t),er((a,c)=>function ne(e,t,n,a,c,d,y,w){const T=[];let P=0,O=0,V=!1;const Q=()=>{V&&!T.length&&!P&&t.complete()},ae=Oe=>P<a?ve(Oe):T.push(Oe),ve=Oe=>{d&&t.next(Oe),P++;let Ge=!1;br(n(Oe,O++)).subscribe(new En(t,Ye=>{null==c||c(Ye),d?ae(Ye):t.next(Ye)},()=>{Ge=!0},void 0,()=>{if(Ge)try{for(P--;T.length&&P<a;){const Ye=T.shift();y?W(t,y,()=>ve(Ye)):ve(Ye)}Q()}catch(Ye){t.error(Ye)}}))};return e.subscribe(new En(t,ae,()=>{V=!0,Q()})),()=>{null==w||w()}}(a,c,e,n)))}function me(e=1/0){return se(Vi,e)}const fe=new xn(e=>e.complete());function We(e){return e[e.length-1]}function ot(e){return function Pe(e){return e&&Rn(e.schedule)}(We(e))?e.pop():void 0}function de(e,t=0){return er((n,a)=>{n.subscribe(new En(a,c=>W(a,e,()=>a.next(c),t),()=>W(a,e,()=>a.complete(),t),c=>W(a,e,()=>a.error(c),t)))})}function De(e,t=0){return er((n,a)=>{a.add(e.schedule(()=>n.subscribe(a),t))})}function $t(e,t){if(!e)throw new Error("Iterable cannot be null");return new xn(n=>{W(n,t,()=>{const a=e[Symbol.asyncIterator]();W(n,t,()=>{a.next().then(c=>{c.done?n.complete():n.next(c.value)})},0,!0)})})}function je(e,t){return t?function uo(e,t){if(null!=e){if(tl(e))return function Ft(e,t){return br(e).pipe(De(t),de(t))}(e,t);if(Ts(e))return function _t(e,t){return new xn(n=>{let a=0;return t.schedule(function(){a===e.length?n.complete():(n.next(e[a++]),n.closed||this.schedule())})})}(e,t);if(ec(e))return function nn(e,t){return br(e).pipe(De(t),de(t))}(e,t);if(nl(e))return $t(e,t);if(Wo(e))return function Bt(e,t){return new xn(n=>{let a;return W(n,t,()=>{a=e[pi](),W(n,t,()=>{let c,d;try{({value:c,done:d}=a.next())}catch(y){return void n.error(y)}d?n.complete():n.next(c)},0,!0)}),()=>Rn(null==a?void 0:a.return)&&a.return()})}(e,t);if(Xo(e))return function Ms(e,t){return $t(il(e),t)}(e,t)}throw Eo(e)}(e,t):br(e)}function Dt(e){return e<=0?()=>fe:er((t,n)=>{let a=0;t.subscribe(new En(n,c=>{++a<=e&&(n.next(c),e<=a&&n.complete())}))})}function Do(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(Dt(1)).subscribe(()=>e())}function rt(e){for(let t in e)if(e[t]===rt)return t;throw Error("Could not find renamed property on target object.")}function Qt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Qt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Yo(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const fi=rt({__forward_ref__:rt});function Dn(e){return e.__forward_ref__=Dn,e.toString=function(){return Qt(this())},e}function Mt(e){return function Co(e){return"function"==typeof e&&e.hasOwnProperty(fi)&&e.__forward_ref__===Dn}(e)?e():e}class kt extends Error{constructor(t,n){super(function ua(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function yt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function ht(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function Ur(e,t){const n=t?` in ${t}`:"";throw new kt(-201,`No provider for ${yt(e)} found${n}`)}function jr(e,t){null==e&&function Lt(e,t,n,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${n} ${a} ${t} <=Actual]`))}(t,e,null,"!=")}function Gt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Qo(e){return{providers:e.providers||[],imports:e.imports||[]}}function pa(e){return sl(e,ic)||sl(e,oc)}function sl(e,t){return e.hasOwnProperty(t)?e[t]:null}function du(e){return e&&(e.hasOwnProperty(ri)||e.hasOwnProperty(pu))?e[ri]:null}const ic=rt({\u0275prov:rt}),ri=rt({\u0275inj:rt}),oc=rt({ngInjectableDef:rt}),pu=rt({ngInjectorDef:rt});var bt=(()=>((bt=bt||{})[bt.Default=0]="Default",bt[bt.Host=1]="Host",bt[bt.Self=2]="Self",bt[bt.SkipSelf=4]="SkipSelf",bt[bt.Optional=8]="Optional",bt))();let Jo;function mi(e){const t=Jo;return Jo=e,t}function al(e,t,n){const a=pa(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:n&bt.Optional?null:void 0!==t?t:void Ur(Qt(e),"Injector")}function Gi(e){return{toString:e}.toString()}var ii=(()=>((ii=ii||{})[ii.OnPush=0]="OnPush",ii[ii.Default=1]="Default",ii))(),oi=(()=>{return(e=oi||(oi={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",oi;var e})();const Jt="undefined"!=typeof globalThis&&globalThis,ll="undefined"!=typeof window&&window,ac="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,gn=Jt||"undefined"!=typeof global&&global||ll||ac,fa={},bn=[],ma=rt({\u0275cmp:rt}),ga=rt({\u0275dir:rt}),_a=rt({\u0275pipe:rt}),cl=rt({\u0275mod:rt}),qi=rt({\u0275fac:rt}),ya=rt({__NG_ELEMENT_ID__:rt});let Ih=0;function pr(e){return Gi(()=>{const n={},a={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===ii.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||bn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||oi.Emulated,id:"c",styles:e.styles||bn,_:null,setInput:null,schemas:e.schemas||null,tView:null},c=e.directives,d=e.features,y=e.pipes;return a.id+=Ih++,a.inputs=uc(e.inputs,n),a.outputs=uc(e.outputs),d&&d.forEach(w=>w(a)),a.directiveDefs=c?()=>("function"==typeof c?c():c).map(fu):null,a.pipeDefs=y?()=>("function"==typeof y?y():y).map(si):null,a})}function fu(e){return ar(e)||function Hi(e){return e[ga]||null}(e)}function si(e){return function fo(e){return e[_a]||null}(e)}const cc={};function po(e){return Gi(()=>{const t={type:e.type,bootstrap:e.bootstrap||bn,declarations:e.declarations||bn,imports:e.imports||bn,exports:e.exports||bn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(cc[e.id]=e.type),t})}function uc(e,t){if(null==e)return fa;const n={};for(const a in e)if(e.hasOwnProperty(a)){let c=e[a],d=c;Array.isArray(c)&&(d=c[1],c=c[0]),n[c]=a,t&&(t[c]=d)}return n}const fr=pr;function ar(e){return e[ma]||null}function ai(e,t){const n=e[cl]||null;if(!n&&!0===t)throw new Error(`Type ${Qt(e)} does not have '\u0275mod' property.`);return n}function nr(e){return Array.isArray(e)&&"object"==typeof e[1]}function Mr(e){return Array.isArray(e)&&!0===e[1]}function go(e){return 0!=(8&e.flags)}function Rs(e){return 2==(2&e.flags)}function fl(e){return 1==(1&e.flags)}function Ar(e){return null!==e.template}function rs(e){return 0!=(512&e[2])}function Xi(e,t){return e.hasOwnProperty(qi)?e[qi]:null}class _l{constructor(t,n,a){this.previousValue=t,this.currentValue=n,this.firstChange=a}isFirstChange(){return this.firstChange}}function Ca(e){return e.type.prototype.ngOnChanges&&(e.setInput=Fh),Ta}function Ta(){const e=Eu(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===fa)e.previous=t;else for(let a in t)n[a]=t[a];e.current=null,this.ngOnChanges(t)}}function Fh(e,t,n,a){const c=Eu(e)||function fc(e,t){return e[wu]=t}(e,{previous:fa,current:null}),d=c.current||(c.current={}),y=c.previous,w=this.declaredInputs[n],T=y[w];d[w]=new _l(T&&T.currentValue,t,y===fa),e[a]=t}const wu="__ngSimpleChanges__";function Eu(e){return e[wu]||null}let _c;function Fn(e){return!!e.listen}const yl={createRenderer:(e,t)=>function So(){return void 0!==_c?_c:"undefined"!=typeof document?document:void 0}()};function Xn(e){for(;Array.isArray(e);)e=e[0];return e}function _i(e,t){return Xn(t[e.index])}function Gr(e,t){const n=t[e];return nr(n)?n:n[0]}function zs(e){return 128==(128&e[2])}function Mo(e,t){return null==t?null:e[t]}function Du(e){e[18]=0}function yc(e,t){e[5]+=t;let n=e,a=e[3];for(;null!==a&&(1===t&&1===n[5]||-1===t&&0===n[5]);)a[5]+=t,n=a,a=a[3]}const wt={lFrame:x(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function xl(){return wt.bindingsEnabled}function Ue(){return wt.lFrame.lView}function Ht(){return wt.lFrame.tView}function Yn(){let e=bl();for(;null!==e&&64===e.type;)e=e.parent;return e}function bl(){return wt.lFrame.currentTNode}function Yi(e,t){const n=wt.lFrame;n.currentTNode=e,n.isParent=t}function bc(){return wt.lFrame.isParent}function wl(){return wt.isInCheckNoChangesMode}function os(e){wt.isInCheckNoChangesMode=e}function Su(e,t){const n=wt.lFrame;n.bindingIndex=n.bindingRootIndex=e,Iu(t)}function Iu(e){wt.lFrame.currentDirectiveIndex=e}function f(e){wt.lFrame.currentQueryIndex=e}function i(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function u(e,t,n){if(n&bt.SkipSelf){let c=t,d=e;for(;!(c=c.parent,null!==c||n&bt.Host||(c=i(d),null===c||(d=d[15],10&c.type))););if(null===c)return!1;t=c,e=d}const a=wt.lFrame=v();return a.currentTNode=t,a.lView=e,!0}function g(e){const t=v(),n=e[1];wt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function v(){const e=wt.lFrame,t=null===e?null:e.child;return null===t?x(e):t}function x(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function D(){const e=wt.lFrame;return wt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const S=D;function A(){const e=D();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function j(e){wt.lFrame.selectedIndex=e}function Z(e,t){for(let n=t.directiveStart,a=t.directiveEnd;n<a;n++){const d=e.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:T,ngAfterViewChecked:P,ngOnDestroy:O}=d;y&&(e.contentHooks||(e.contentHooks=[])).push(-n,y),w&&((e.contentHooks||(e.contentHooks=[])).push(n,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,w)),T&&(e.viewHooks||(e.viewHooks=[])).push(-n,T),P&&((e.viewHooks||(e.viewHooks=[])).push(n,P),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,P)),null!=O&&(e.destroyHooks||(e.destroyHooks=[])).push(n,O)}}function ie(e,t,n){xe(e,t,3,n)}function le(e,t,n,a){(3&e[2])===n&&xe(e,t,n,a)}function be(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function xe(e,t,n,a){const d=null!=a?a:-1,y=t.length-1;let w=0;for(let T=void 0!==a?65535&e[18]:0;T<y;T++)if("number"==typeof t[T+1]){if(w=t[T],null!=a&&w>=a)break}else t[T]<0&&(e[18]+=65536),(w<d||-1==d)&&(Te(e,n,t,T),e[18]=(4294901760&e[18])+T+2),T++}function Te(e,t,n,a){const c=n[a]<0,d=n[a+1],w=e[c?-n[a]:n[a]];if(c){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{d.call(w)}finally{}}}else try{d.call(w)}finally{}}class Ve{constructor(t,n,a){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=a}}function dt(e,t,n){const a=Fn(e);let c=0;for(;c<n.length;){const d=n[c];if("number"==typeof d){if(0!==d)break;c++;const y=n[c++],w=n[c++],T=n[c++];a?e.setAttribute(t,w,T,y):t.setAttributeNS(y,w,T)}else{const y=d,w=n[++c];vt(y)?a&&e.setProperty(t,y,w):a?e.setAttribute(t,y,w):t.setAttribute(y,w),c++}}return c}function lt(e){return 3===e||4===e||6===e}function vt(e){return 64===e.charCodeAt(0)}function Zt(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let a=0;a<t.length;a++){const c=t[a];"number"==typeof c?n=c:0===n||Kn(e,n,c,null,-1===n||2===n?t[++a]:null)}}return e}function Kn(e,t,n,a,c){let d=0,y=e.length;if(-1===t)y=-1;else for(;d<e.length;){const w=e[d++];if("number"==typeof w){if(w===t){y=-1;break}if(w>t){y=d-1;break}}}for(;d<e.length;){const w=e[d];if("number"==typeof w)break;if(w===n){if(null===a)return void(null!==c&&(e[d+1]=c));if(a===e[d+1])return void(e[d+2]=c)}d++,null!==a&&d++,null!==c&&d++}-1!==y&&(e.splice(y,0,t),d=y+1),e.splice(d++,0,n),null!==a&&e.splice(d++,0,a),null!==c&&e.splice(d++,0,c)}function mr(e){return-1!==e}function Qn(e){return 32767&e}function kn(e,t){let n=function qr(e){return e>>16}(e),a=t;for(;n>0;)a=a[15],n--;return a}let Qi=!0;function vi(e){const t=Qi;return Qi=e,t}let In=0;function ln(e,t){const n=Us(e,t);if(-1!==n)return n;const a=t[1];a.firstCreatePass&&(e.injectorIndex=t.length,Hr(a.data,e),Hr(t,null),Hr(a.blueprint,null));const c=Dr(e,t),d=e.injectorIndex;if(mr(c)){const y=Qn(c),w=kn(c,t),T=w[1].data;for(let P=0;P<8;P++)t[d+P]=w[y+P]|T[y+P]}return t[d+8]=c,d}function Hr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Us(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Dr(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,a=null,c=t;for(;null!==c;){const d=c[1],y=d.type;if(a=2===y?d.declTNode:1===y?c[6]:null,null===a)return-1;if(n++,c=c[15],-1!==a.injectorIndex)return a.injectorIndex|n<<16}return-1}function Ji(e,t,n){!function Er(e,t,n){let a;"string"==typeof n?a=n.charCodeAt(0)||0:n.hasOwnProperty(ya)&&(a=n[ya]),null==a&&(a=n[ya]=In++);const c=255&a;t.data[e+(c>>5)]|=1<<c}(e,t,n)}function Dl(e,t,n){if(n&bt.Optional)return e;Ur(t,"NodeInjector")}function Vs(e,t,n,a){if(n&bt.Optional&&void 0===a&&(a=null),0==(n&(bt.Self|bt.Host))){const c=e[9],d=mi(void 0);try{return c?c.get(t,a,n&bt.Optional):al(t,a,n&bt.Optional)}finally{mi(d)}}return Dl(a,t,n)}function Au(e,t,n,a=bt.Default,c){if(null!==e){const d=function __(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ya)?e[ya]:void 0;return"number"==typeof t?t>=0?255&t:Dc:t}(n);if("function"==typeof d){if(!u(t,e,a))return a&bt.Host?Dl(c,n,a):Vs(t,n,a,c);try{const y=d(a);if(null!=y||a&bt.Optional)return y;Ur(n)}finally{S()}}else if("number"==typeof d){let y=null,w=Us(e,t),T=-1,P=a&bt.Host?t[16][6]:null;for((-1===w||a&bt.SkipSelf)&&(T=-1===w?Dr(e,t):t[w+8],-1!==T&&fp(a,!1)?(y=t[1],w=Qn(T),t=kn(T,t)):w=-1);-1!==w;){const O=t[1];if(hm(d,w,O.data)){const V=um(w,t,n,y,a,P);if(V!==Pa)return V}T=t[w+8],-1!==T&&fp(a,t[1].data[w+8]===P)&&hm(d,w,t)?(y=O,w=Qn(T),t=kn(T,t)):w=-1}}}return Vs(t,n,a,c)}const Pa={};function Dc(){return new Tc(Yn(),Ue())}function um(e,t,n,a,c,d){const y=t[1],w=y.data[e+8],O=function Pu(e,t,n,a,c){const d=e.providerIndexes,y=t.data,w=1048575&d,T=e.directiveStart,O=d>>20,Q=c?w+O:e.directiveEnd;for(let ae=a?w:w+O;ae<Q;ae++){const ve=y[ae];if(ae<T&&n===ve||ae>=T&&ve.type===n)return ae}if(c){const ae=y[T];if(ae&&Ar(ae)&&ae.type===n)return T}return null}(w,y,n,null==a?Rs(w)&&Qi:a!=y&&0!=(3&w.type),c&bt.Host&&d===w);return null!==O?Cc(t,y,O,w):Pa}function Cc(e,t,n,a){let c=e[n];const d=t.data;if(function Ce(e){return e instanceof Ve}(c)){const y=c;y.resolving&&function tc(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new kt(-200,`Circular dependency in DI detected for ${e}${n}`)}(yt(d[n]));const w=vi(y.canSeeViewProviders);y.resolving=!0;const T=y.injectImpl?mi(y.injectImpl):null;u(e,a,bt.Default);try{c=e[n]=y.factory(void 0,d,e,a),t.firstCreatePass&&n>=a.directiveStart&&function re(e,t,n){const{ngOnChanges:a,ngOnInit:c,ngDoCheck:d}=t.type.prototype;if(a){const y=Ca(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,y)}c&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,c),d&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d))}(n,d[n],t)}finally{null!==T&&mi(T),vi(w),y.resolving=!1,S()}}return c}function hm(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function fp(e,t){return!(e&bt.Self||e&bt.Host&&t)}class Tc{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,a){return Au(this._tNode,this._lView,t,a,n)}}const Ra="__parameters__";function Tl(e,t,n){return Gi(()=>{const a=function Sc(e){return function(...n){if(e){const a=e(...n);for(const c in a)this[c]=a[c]}}}(t);function c(...d){if(this instanceof c)return a.apply(this,d),this;const y=new c(...d);return w.annotation=y,w;function w(T,P,O){const V=T.hasOwnProperty(Ra)?T[Ra]:Object.defineProperty(T,Ra,{value:[]})[Ra];for(;V.length<=O;)V.push(null);return(V[O]=V[O]||[]).push(y),T}}return n&&(c.prototype=Object.create(n.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}class cn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Gt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const x_=new cn("AnalyzeForEntryComponents");function gr(e,t){e.forEach(n=>Array.isArray(n)?gr(n,t):t(n))}function fm(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function jh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const ko={},Ac="__NG_DI_FLAG__",Pc="ngTempTokenPath",E_=/\n/gm,ym="__source",xp=rt({provide:String,useValue:rt});let Ou;function Zh(e){const t=Ou;return Ou=e,t}function vm(e,t=bt.Default){if(void 0===Ou)throw new kt(203,"");return null===Ou?al(e,void 0,t):Ou.get(e,t&bt.Optional?null:void 0,t)}function Ct(e,t=bt.Default){return(function es(){return Jo}()||vm)(Mt(e),t)}function bp(e){const t=[];for(let n=0;n<e.length;n++){const a=Mt(e[n]);if(Array.isArray(a)){if(0===a.length)throw new kt(900,"");let c,d=bt.Default;for(let y=0;y<a.length;y++){const w=a[y],T=Wh(w);"number"==typeof T?-1===T?c=w.token:d|=T:c=w}t.push(Ct(c,d))}else t.push(Ct(a))}return t}function ls(e,t){return e[Ac]=t,e.prototype[Ac]=t,e}function Wh(e){return e[Ac]}const zu=ls(Tl("Inject",e=>({token:e})),-1),cs=ls(Tl("Optional"),8),Al=ls(Tl("SkipSelf"),4),Up="__ngContext__";function kr(e,t){e[Up]=t}function Vp(e){const t=function Gu(e){return e[Up]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function od(e){return e.ngOriginalError}function Bm(e,...t){e.error(...t)}class Uc{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),a=function zm(e){return e&&e.ngErrorLogger||Bm}(t);a(this._console,"ERROR",t),n&&a(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&od(t);for(;n&&od(n);)n=od(n);return n||null}}const Um=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(gn))();function Fo(e){return e instanceof Function?e():e}var Ri=(()=>((Ri=Ri||{})[Ri.Important=1]="Important",Ri[Ri.DashCase=2]="DashCase",Ri))();function Lo(e,t){return undefined(e,t)}function Zu(e){const t=e[3];return Mr(t)?t[3]:t}function Hp(e){return Gm(e[13])}function Zp(e){return Gm(e[4])}function Gm(e){for(;null!==e&&!Mr(e);)e=e[4];return e}function Gc(e,t,n,a,c){if(null!=a){let d,y=!1;Mr(a)?d=a:nr(a)&&(y=!0,a=a[0]);const w=Xn(a);0===e&&null!==n?null==c?Jp(t,n,w):Bl(t,n,w,c||null,!0):1===e&&null!==n?Bl(t,n,w,c||null,!0):2===e?function sf(e,t,n){const a=Hc(e,t);a&&function tf(e,t,n,a){Fn(e)?e.removeChild(t,n,a):t.removeChild(n)}(e,a,t,n)}(t,w,y):3===e&&t.destroyNode(w),null!=d&&function lf(e,t,n,a,c){const d=n[7];d!==Xn(n)&&Gc(t,e,a,d,c);for(let w=10;w<n.length;w++){const T=n[w];Gs(T[1],T,e,t,a,d)}}(t,e,d,n,c)}}function cd(e,t,n){return Fn(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Fi(e,t){const n=e[9],a=n.indexOf(t),c=t[3];1024&t[2]&&(t[2]&=-1025,yc(c,-1)),n.splice(a,1)}function Ol(e,t){if(e.length<=10)return;const n=10+t,a=e[n];if(a){const c=a[17];null!==c&&c!==e&&Fi(c,a),t>0&&(e[n-1][4]=a[4]);const d=jh(e,10+t);!function ny(e,t){Gs(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(a[1],a);const y=d[19];null!==y&&y.detachView(d[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function zl(e,t){if(!(256&t[2])){const n=t[11];Fn(n)&&n.destroyNode&&Gs(e,t,n,3,null,null),function Xp(e){let t=e[13];if(!t)return Xu(e[1],e);for(;t;){let n=null;if(nr(t))n=t[13];else{const a=t[10];a&&(n=a)}if(!n){for(;t&&!t[4]&&t!==e;)nr(t)&&Xu(t[1],t),t=t[3];null===t&&(t=e),nr(t)&&Xu(t[1],t),n=t&&t[4]}t=n}}(t)}}function Xu(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function oy(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let a=0;a<n.length;a+=2){const c=t[n[a]];if(!(c instanceof Ve)){const d=n[a+1];if(Array.isArray(d))for(let y=0;y<d.length;y+=2){const w=c[d[y]],T=d[y+1];try{T.call(w)}finally{}}else try{d.call(c)}finally{}}}}(e,t),function ud(e,t){const n=e.cleanup,a=t[7];let c=-1;if(null!==n)for(let d=0;d<n.length-1;d+=2)if("string"==typeof n[d]){const y=n[d+1],w="function"==typeof y?y(t):Xn(t[y]),T=a[c=n[d+2]],P=n[d+3];"boolean"==typeof P?w.removeEventListener(n[d],T,P):P>=0?a[c=P]():a[c=-P].unsubscribe(),d+=2}else{const y=a[c=n[d+1]];n[d].call(y)}if(null!==a){for(let d=c+1;d<a.length;d++)a[d]();t[7]=null}}(e,t),1===t[1].type&&Fn(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&Mr(t[3])){n!==t[3]&&Fi(n,t);const a=t[19];null!==a&&a.detachView(e)}}}function Kp(e,t,n){return function Qp(e,t,n){let a=t;for(;null!==a&&40&a.type;)a=(t=a).parent;if(null===a)return n[0];if(2&a.flags){const c=e.data[a.directiveStart].encapsulation;if(c===oi.None||c===oi.Emulated)return null}return _i(a,n)}(e,t.parent,n)}function Bl(e,t,n,a,c){Fn(e)?e.insertBefore(t,n,a,c):t.insertBefore(n,a,c)}function Jp(e,t,n){Fn(e)?e.appendChild(t,n):t.appendChild(n)}function ef(e,t,n,a,c){null!==a?Bl(e,t,n,a,c):Jp(e,t,n)}function Hc(e,t){return Fn(e)?e.parentNode(t):t.parentNode}let $s=function nf(e,t,n){return 40&e.type?_i(e,n):null};function Yu(e,t,n,a){const c=Kp(e,a,t),d=t[11],w=function Zm(e,t,n){return $s(e,t,n)}(a.parent||t[6],a,t);if(null!=c)if(Array.isArray(n))for(let T=0;T<n.length;T++)ef(d,c,n[T],w,!1);else ef(d,c,n,w,!1)}function Ku(e,t){if(null!==t){const n=t.type;if(3&n)return _i(t,e);if(4&n)return of(-1,e[t.index]);if(8&n){const a=t.child;if(null!==a)return Ku(e,a);{const c=e[t.index];return Mr(c)?of(-1,c):Xn(c)}}if(32&n)return Lo(t,e)()||Xn(e[t.index]);{const a=Wm(e,t);return null!==a?Array.isArray(a)?a[0]:Ku(Zu(e[16]),a):Ku(e,t.next)}}return null}function Wm(e,t){return null!==t?e[16][6].projection[t.projection]:null}function of(e,t){const n=10+e+1;if(n<t.length){const a=t[n],c=a[1].firstChild;if(null!==c)return Ku(a,c)}return t[7]}function dd(e,t,n,a,c,d,y){for(;null!=n;){const w=a[n.index],T=n.type;if(y&&0===t&&(w&&kr(Xn(w),a),n.flags|=4),64!=(64&n.flags))if(8&T)dd(e,t,n.child,a,c,d,!1),Gc(t,e,c,w,d);else if(32&T){const P=Lo(n,a);let O;for(;O=P();)Gc(t,e,c,O,d);Gc(t,e,c,w,d)}else 16&T?af(e,t,a,n,c,d):Gc(t,e,c,w,d);n=y?n.projectionNext:n.next}}function Gs(e,t,n,a,c,d){dd(n,a,e.firstChild,t,c,d,!1)}function af(e,t,n,a,c,d){const y=n[16],T=y[6].projection[a.projection];if(Array.isArray(T))for(let P=0;P<T.length;P++)Gc(t,e,c,T[P],d);else dd(e,t,T,y[3],c,d,!0)}function cf(e,t,n){Fn(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Wc(e,t,n){Fn(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function uf(e,t,n){let a=e.length;for(;;){const c=e.indexOf(t,n);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const d=t.length;if(c+d===a||e.charCodeAt(c+d)<=32)return c}n=c+1}}const Qu="ng-template";function sy(e,t,n){let a=0;for(;a<e.length;){let c=e[a++];if(n&&"class"===c){if(c=e[a],-1!==uf(c.toLowerCase(),t,0))return!0}else if(1===c){for(;a<e.length&&"string"==typeof(c=e[a++]);)if(c.toLowerCase()===t)return!0;return!1}}return!1}function Ym(e){return 4===e.type&&e.value!==Qu}function ay(e,t,n){return t===(4!==e.type||n?e.value:Qu)}function ly(e,t,n){let a=4;const c=e.attrs||[],d=function Km(e){for(let t=0;t<e.length;t++)if(lt(e[t]))return t;return e.length}(c);let y=!1;for(let w=0;w<t.length;w++){const T=t[w];if("number"!=typeof T){if(!y)if(4&a){if(a=2|1&a,""!==T&&!ay(e,T,n)||""===T&&1===t.length){if(Oo(a))return!1;y=!0}}else{const P=8&a?T:t[++w];if(8&a&&null!==e.attrs){if(!sy(e.attrs,P,n)){if(Oo(a))return!1;y=!0}continue}const V=Xc(8&a?"class":T,c,Ym(e),n);if(-1===V){if(Oo(a))return!1;y=!0;continue}if(""!==P){let Q;Q=V>d?"":c[V+1].toLowerCase();const ae=8&a?Q:null;if(ae&&-1!==uf(ae,P,0)||2&a&&P!==Q){if(Oo(a))return!1;y=!0}}}}else{if(!y&&!Oo(a)&&!Oo(T))return!1;if(y&&Oo(T))continue;y=!1,a=T|1&a}}return Oo(a)||y}function Oo(e){return 0==(1&e)}function Xc(e,t,n,a){if(null===t)return-1;let c=0;if(a||!n){let d=!1;for(;c<t.length;){const y=t[c];if(y===e)return c;if(3===y||6===y)d=!0;else{if(1===y||2===y){let w=t[++c];for(;"string"==typeof w;)w=t[++c];continue}if(4===y)break;if(0===y){c+=4;continue}}c+=d?1:2}return-1}return function uy(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const a=e[n];if("number"==typeof a)return-1;if(a===t)return n;n++}return-1}(t,e)}function pd(e,t,n=!1){for(let a=0;a<t.length;a++)if(ly(e,t[a],n))return!0;return!1}function Qm(e,t){return e?":not("+t.trim()+")":t}function Ua(e){let t=e[0],n=1,a=2,c="",d=!1;for(;n<e.length;){let y=e[n];if("string"==typeof y)if(2&a){const w=e[++n];c+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&a?c+="."+y:4&a&&(c+=" "+y);else""!==c&&!Oo(y)&&(t+=Qm(d,c),c=""),a=y,d=d||!Oo(a);n++}return""!==c&&(t+=Qm(d,c)),t}const Tt={};function xf(e,t){const n=e.contentQueries;if(null!==n)for(let a=0;a<n.length;a+=2){const c=n[a],d=n[a+1];if(-1!==d){const y=e.data[d];f(c),y.contentQueries(2,t[d],d)}}}function Yc(e,t,n,a,c,d,y,w,T,P){const O=t.blueprint.slice();return O[0]=c,O[2]=140|a,Du(O),O[3]=O[15]=e,O[8]=n,O[10]=y||e&&e[10],O[11]=w||e&&e[11],O[12]=T||e&&e[12]||null,O[9]=P||e&&e[9]||null,O[6]=d,O[16]=2==t.type?e[16]:O,O}function Zs(e,t,n,a,c){let d=e.data[t];if(null===d)d=function bf(e,t,n,a,c){const d=bl(),y=bc(),T=e.data[t]=function xy(e,t,n,a,c,d){return{type:n,index:a,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:d,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?d:d&&d.parent,n,t,a,c);return null===e.firstChild&&(e.firstChild=T),null!==d&&(y?null==d.child&&null!==T.parent&&(d.child=T):null===d.next&&(d.next=T)),T}(e,t,n,a,c),function El(){return wt.lFrame.inI18n}()&&(d.flags|=64);else if(64&d.type){d.type=n,d.value=a,d.attrs=c;const y=function Ao(){const e=wt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();d.injectorIndex=null===y?-1:y.injectorIndex}return Yi(d,!0),d}function No(e,t,n,a){if(0===n)return-1;const c=t.length;for(let d=0;d<n;d++)t.push(a),e.blueprint.push(a),e.data.push(null);return c}function Ul(e,t,n){g(t);try{const a=e.viewQuery;null!==a&&Xe(1,a,n);const c=e.template;null!==c&&Cd(e,t,c,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&xf(e,t),e.staticViewQueries&&Xe(2,e.viewQuery,n);const d=e.components;null!==d&&function Va(e,t){for(let n=0;n<t.length;n++)$(e,t[n])}(t,d)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{t[2]&=-5,A()}}function ja(e,t,n,a){const c=t[2];if(256==(256&c))return;g(t);const d=wl();try{Du(t),function wc(e){return wt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Cd(e,t,n,2,a);const y=3==(3&c);if(!d)if(y){const P=e.preOrderCheckHooks;null!==P&&ie(t,P,null)}else{const P=e.preOrderHooks;null!==P&&le(t,P,0,null),be(t,0)}if(function k(e){for(let t=Hp(e);null!==t;t=Zp(t)){if(!t[2])continue;const n=t[9];for(let a=0;a<n.length;a++){const c=n[a],d=c[3];0==(1024&c[2])&&yc(d,1),c[2]|=1024}}}(t),function M(e){for(let t=Hp(e);null!==t;t=Zp(t))for(let n=10;n<t.length;n++){const a=t[n],c=a[1];zs(a)&&ja(c,a,c.template,a[8])}}(t),null!==e.contentQueries&&xf(e,t),!d)if(y){const P=e.contentCheckHooks;null!==P&&ie(t,P)}else{const P=e.contentHooks;null!==P&&le(t,P,1),be(t,1)}!function hg(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let a=0;a<n.length;a++){const c=n[a];if(c<0)j(~c);else{const d=c,y=n[++a],w=n[++a];Su(y,d),w(2,t[d])}}}finally{j(-1)}}(e,t);const w=e.components;null!==w&&function dg(e,t){for(let n=0;n<t.length;n++)B(e,t[n])}(t,w);const T=e.viewQuery;if(null!==T&&Xe(2,T,a),!d)if(y){const P=e.viewCheckHooks;null!==P&&ie(t,P)}else{const P=e.viewHooks;null!==P&&le(t,P,2),be(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),d||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,yc(t[3],-1))}finally{A()}}function ps(e,t,n,a){const c=t[10],d=!wl(),y=function Ia(e){return 4==(4&e[2])}(t);try{d&&!y&&c.begin&&c.begin(),y&&Ul(e,t,a),ja(e,t,n,a)}finally{d&&!y&&c.end&&c.end()}}function Cd(e,t,n,a,c){const d=function L(){return wt.lFrame.selectedIndex}(),y=2&a;try{j(-1),y&&t.length>20&&function tg(e,t,n,a){if(!a)if(3==(3&t[2])){const d=e.preOrderCheckHooks;null!==d&&ie(t,d,n)}else{const d=e.preOrderHooks;null!==d&&le(t,d,0,n)}j(n)}(e,t,20,wl()),n(a,c)}finally{j(d)}}function wf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=oh(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function oh(e,t,n,a,c,d,y,w,T,P){const O=20+a,V=O+c,Q=function Sd(e,t){const n=[];for(let a=0;a<t;a++)n.push(a<e?null:Tt);return n}(O,V),ae="function"==typeof P?P():P;return Q[1]={type:e,blueprint:Q,template:n,queries:null,viewQuery:w,declTNode:t,data:Q.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof d?d():d,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:T,consts:ae,incompleteFirstPass:!1}}function Id(e,t,n){for(let a in e)if(e.hasOwnProperty(a)){const c=e[a];(n=null===n?{}:n).hasOwnProperty(a)?n[a].push(t,c):n[a]=[t,c]}return n}function ch(e,t,n,a,c,d){const y=d.hostBindings;if(y){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const T=~t.index;(function wy(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=T&&w.push(T),w.push(a,c,y)}}function _g(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Cf(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function r(e,t,n){if(n){if(t.exportAs)for(let a=0;a<t.exportAs.length;a++)n[t.exportAs[a]]=e;Ar(t)&&(n[""]=e)}}function s(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function l(e,t,n,a,c){e.data[a]=c;const d=c.factory||(c.factory=Xi(c.type)),y=new Ve(d,Ar(c),null);e.blueprint[a]=y,n[a]=y,ch(e,t,0,a,No(e,n,c.hostVars,Tt),c)}function h(e,t,n){const a=_i(t,e),c=wf(n),d=e[10],y=te(e,Yc(e,c,null,n.onPush?64:16,a,t,d,d.createRenderer(a,n),null,null));e[t.index]=y}function b(e,t,n,a,c,d){const y=d[t];if(null!==y){const w=a.setInput;for(let T=0;T<y.length;){const P=y[T++],O=y[T++],V=y[T++];null!==w?a.setInput(n,V,P,O):n[O]=V}}}function E(e,t){let n=null,a=0;for(;a<t.length;){const c=t[a];if(0!==c)if(5!==c){if("number"==typeof c)break;e.hasOwnProperty(c)&&(null===n&&(n=[]),n.push(c,e[c],t[a+1])),a+=2}else a+=2;else a+=4}return n}function B(e,t){const n=Gr(t,e);if(zs(n)){const a=n[1];80&n[2]?ja(a,n,a.template,n[8]):n[5]>0&&N(n)}}function N(e){for(let a=Hp(e);null!==a;a=Zp(a))for(let c=10;c<a.length;c++){const d=a[c];if(1024&d[2]){const y=d[1];ja(y,d,y.template,d[8])}else d[5]>0&&N(d)}const n=e[1].components;if(null!==n)for(let a=0;a<n.length;a++){const c=Gr(n[a],e);zs(c)&&c[5]>0&&N(c)}}function $(e,t){const n=Gr(t,e),a=n[1];(function K(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(a,n),Ul(a,n,n[8])}function te(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function oe(e){for(;e;){e[2]|=64;const t=Zu(e);if(rs(e)&&!t)return e;e=t}return null}function he(e,t,n){const a=t[10];a.begin&&a.begin();try{ja(e,t,e.template,n)}catch(c){throw Ke(t,c),c}finally{a.end&&a.end()}}function ge(e){!function pe(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],a=Vp(n),c=a[1];ps(c,a,c.template,n)}}(e[8])}function Xe(e,t,n){f(0),t(e,n)}const Ae=(()=>Promise.resolve(null))();function Be(e){return e[7]||(e[7]=[])}function $e(e){return e.cleanup||(e.cleanup=[])}function Ke(e,t){const n=e[9],a=n?n.get(Uc,null):null;a&&a.handleError(t)}function un(e,t,n){let a=n?e.styles:null,c=n?e.classes:null,d=0;if(null!==t)for(let y=0;y<t.length;y++){const w=t[y];"number"==typeof w?d=w:1==d?c=Yo(c,w):2==d&&(a=Yo(a,w+": "+t[++y]+";"))}n?e.styles=a:e.stylesWithoutHost=a,n?e.classes=c:e.classesWithoutHost=c}const mn=new cn("INJECTOR",-1);class Yt{get(t,n=ko){if(n===ko){const a=new Error(`NullInjectorError: No provider for ${Qt(t)}!`);throw a.name="NullInjectorError",a}return n}}const $n=new cn("Set Injector scope."),Ln={},lr={};let cr;function hn(){return void 0===cr&&(cr=new Yt),cr}function en(e,t=null,n=null,a){const c=Mn(e,t,n,a);return c._resolveInjectorDefTypes(),c}function Mn(e,t=null,n=null,a){return new Rr(e,n,t||hn(),a)}class Rr{constructor(t,n,a,c=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const d=[];n&&gr(n,w=>this.processProvider(w,t,n)),gr([t],w=>this.processInjectorType(w,[],d)),this.records.set(mn,vr(void 0,this));const y=this.records.get($n);this.scope=null!=y?y.value:null,this.source=c||("object"==typeof t?null:Qt(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=ko,a=bt.Default){this.assertNotDestroyed();const c=Zh(this),d=mi(void 0);try{if(!(a&bt.SkipSelf)){let w=this.records.get(t);if(void 0===w){const T=function Xr(e){return"function"==typeof e||"object"==typeof e&&e instanceof cn}(t)&&pa(t);w=T&&this.injectableDefInScope(T)?vr(Gn(t),Ln):null,this.records.set(t,w)}if(null!=w)return this.hydrate(t,w)}return(a&bt.Self?hn():this.parent).get(t,n=a&bt.Optional&&n===ko?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[Pc]=y[Pc]||[]).unshift(Qt(t)),c)throw y;return function xm(e,t,n,a){const c=e[Pc];throw t[ym]&&c.unshift(t[ym]),e.message=function bm(e,t,n,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let c=Qt(t);if(Array.isArray(t))c=t.map(Qt).join(" -> ");else if("object"==typeof t){let d=[];for(let y in t)if(t.hasOwnProperty(y)){let w=t[y];d.push(y+":"+("string"==typeof w?JSON.stringify(w):Qt(w)))}c=`{${d.join(", ")}}`}return`${n}${a?"("+a+")":""}[${c}]: ${e.replace(E_,"\n  ")}`}("\n"+e.message,c,n,a),e.ngTokenPath=c,e[Pc]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{mi(d),Zh(c)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((a,c)=>t.push(Qt(c))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new kt(205,"")}processInjectorType(t,n,a){if(!(t=Mt(t)))return!1;let c=du(t);const d=null==c&&t.ngModule||void 0,y=void 0===d?t:d,w=-1!==a.indexOf(y);if(void 0!==d&&(c=du(d)),null==c)return!1;if(null!=c.imports&&!w){let O;a.push(y);try{gr(c.imports,V=>{this.processInjectorType(V,n,a)&&(void 0===O&&(O=[]),O.push(V))})}finally{}if(void 0!==O)for(let V=0;V<O.length;V++){const{ngModule:Q,providers:ae}=O[V];gr(ae,ve=>this.processProvider(ve,Q,ae||bn))}}this.injectorDefTypes.add(y);const T=Xi(y)||(()=>new y);this.records.set(y,vr(T,Ln));const P=c.providers;if(null!=P&&!w){const O=t;gr(P,V=>this.processProvider(V,O,P))}return void 0!==d&&void 0!==t.providers}processProvider(t,n,a){let c=An(t=Mt(t))?t:Mt(t&&t.provide);const d=function Fr(e,t,n){return yn(e)?vr(void 0,e.useValue):vr(function On(e,t,n){let a;if(An(e)){const c=Mt(e);return Xi(c)||Gn(c)}if(yn(e))a=()=>Mt(e.useValue);else if(function or(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...bp(e.deps||[]));else if(function ir(e){return!(!e||!e.useExisting)}(e))a=()=>Ct(Mt(e.useExisting));else{const c=Mt(e&&(e.useClass||e.provide));if(!function ur(e){return!!e.deps}(e))return Xi(c)||Gn(c);a=()=>new c(...bp(e.deps))}return a}(e),Ln)}(t);if(An(t)||!0!==t.multi)this.records.get(c);else{let y=this.records.get(c);y||(y=vr(void 0,Ln,!0),y.factory=()=>bp(y.multi),this.records.set(c,y)),c=t,y.multi.push(t)}this.records.set(c,d)}hydrate(t,n){return n.value===Ln&&(n.value=lr,n.value=n.factory()),"object"==typeof n.value&&n.value&&function wn(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Mt(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function Gn(e){const t=pa(e),n=null!==t?t.factory:Xi(e);if(null!==n)return n;if(e instanceof cn)throw new kt(204,"");if(e instanceof Function)return function yr(e){const t=e.length;if(t>0)throw function Jn(e,t){const n=[];for(let a=0;a<e;a++)n.push(t);return n}(t,"?"),new kt(204,"");const n=function Dh(e){const t=e&&(e[ic]||e[oc]);if(t){const n=function lp(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new kt(204,"")}function vr(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function yn(e){return null!==e&&"object"==typeof e&&xp in e}function An(e){return"function"==typeof e}let Un=(()=>{class e{static create(n,a){var c;if(Array.isArray(n))return en({name:""},a,n,"");{const d=null!==(c=n.name)&&void 0!==c?c:"";return en({name:d},n.parent,n.providers,d)}}}return e.THROW_IF_NOT_FOUND=ko,e.NULL=new Yt,e.\u0275prov=Gt({token:e,providedIn:"any",factory:()=>Ct(mn)}),e.__NG_ELEMENT_ID__=-1,e})();function wE(e,t){Z(Vp(e)[1],Yn())}let xg=null;function Rd(){if(!xg){const e=gn.Symbol;if(e&&e.iterator)xg=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const a=t[n];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(xg=a)}}}return xg}function Mf(e){return!!Cy(e)&&(Array.isArray(e)||!(e instanceof Map)&&Rd()in e)}function Cy(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function gt(e,t=bt.Default){const n=Ue();return null===n?Ct(e,t):Au(Yn(),n,Mt(e),t)}function Py(){throw new Error("invalid")}function ky(e,t,n,a,c){const y=c?"class":"style";!function Je(e,t,n,a,c){for(let d=0;d<n.length;){const y=n[d++],w=n[d++],T=t[y],P=e.data[y];null!==P.setInput?P.setInput(T,c,a,w):T[w]=c}}(e,n,t.inputs[y],y,a)}function Se(e,t,n,a){const c=Ue(),d=Ht(),y=20+e,w=c[11],T=c[y]=cd(w,t,function ee(){return wt.lFrame.currentNamespace}()),P=d.firstCreatePass?function nD(e,t,n,a,c,d,y){const w=t.consts,P=Zs(t,e,2,c,Mo(w,d));return function $a(e,t,n,a){let c=!1;if(xl()){const d=function yg(e,t,n){const a=e.directiveRegistry;let c=null;if(a)for(let d=0;d<a.length;d++){const y=a[d];pd(n,y.selectors,!1)&&(c||(c=[]),Ji(ln(n,t),e,y.type),Ar(y)?(Cf(e,n),c.unshift(y)):c.push(y))}return c}(e,t,n),y=null===a?null:{"":-1};if(null!==d){c=!0,s(n,e.data.length,d.length);for(let O=0;O<d.length;O++){const V=d[O];V.providersResolver&&V.providersResolver(V)}let w=!1,T=!1,P=No(e,t,d.length,null);for(let O=0;O<d.length;O++){const V=d[O];n.mergedAttrs=Zt(n.mergedAttrs,V.hostAttrs),l(e,n,t,P,V),r(P,V,y),null!==V.contentQueries&&(n.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(n.flags|=128);const Q=V.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),w=!0),!T&&(Q.ngOnChanges||Q.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),T=!0),P++}!function fg(e,t){const a=t.directiveEnd,c=e.data,d=t.attrs,y=[];let w=null,T=null;for(let P=t.directiveStart;P<a;P++){const O=c[P],V=O.inputs,Q=null===d||Ym(t)?null:E(V,d);y.push(Q),w=Id(V,P,w),T=Id(O.outputs,P,T)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=16),w.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=y,t.inputs=w,t.outputs=T}(e,n)}y&&function o(e,t,n){if(t){const a=e.localNames=[];for(let c=0;c<t.length;c+=2){const d=n[t[c+1]];if(null==d)throw new kt(-301,`Export of name '${t[c+1]}' not found!`);a.push(t[c],d)}}}(n,a,y)}return n.mergedAttrs=Zt(n.mergedAttrs,n.attrs),c}(t,n,P,Mo(w,y)),null!==P.attrs&&un(P,P.attrs,!1),null!==P.mergedAttrs&&un(P,P.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,P),P}(y,d,c,0,t,n,a):d.data[y];Yi(P,!0);const O=P.mergedAttrs;null!==O&&dt(w,T,O);const V=P.classes;null!==V&&Wc(w,T,V);const Q=P.styles;null!==Q&&cf(w,T,Q),64!=(64&P.flags)&&Yu(d,c,T,P),0===function Bh(){return wt.lFrame.elementDepthCount}()&&kr(T,c),function xc(){wt.lFrame.elementDepthCount++}(),fl(P)&&(function no(e,t,n){!xl()||(function Ey(e,t,n,a){const c=n.directiveStart,d=n.directiveEnd;e.firstCreatePass||ln(n,t),kr(a,t);const y=n.initialInputs;for(let w=c;w<d;w++){const T=e.data[w],P=Ar(T);P&&h(t,n,T);const O=Cc(t,e,w,n);kr(O,t),null!==y&&b(0,w-c,O,T,0,y),P&&(Gr(n.index,t)[8]=O)}}(e,t,n,_i(n,t)),128==(128&n.flags)&&function gg(e,t,n){const a=n.directiveStart,c=n.directiveEnd,y=n.index,w=function Aa(){return wt.lFrame.currentDirectiveIndex}();try{j(y);for(let T=a;T<c;T++){const P=e.data[T],O=t[T];Iu(T),(null!==P.hostBindings||0!==P.hostVars||null!==P.hostAttrs)&&_g(P,O)}}finally{j(-1),Iu(w)}}(e,t,n))}(d,c,P),function Td(e,t,n){if(go(t)){const c=t.directiveEnd;for(let d=t.directiveStart;d<c;d++){const y=e.data[d];y.contentQueries&&y.contentQueries(1,n[d],d)}}}(d,P,c)),null!==a&&function Ws(e,t,n=_i){const a=t.localNames;if(null!==a){let c=t.index+1;for(let d=0;d<a.length;d+=2){const y=a[d+1],w=-1===y?n(t,e):e[y];e[c++]=w}}}(c,P)}function Ie(){let e=Yn();bc()?function Bs(){wt.lFrame.isParent=!1}():(e=e.parent,Yi(e,!1));const t=e;!function Ma(){wt.lFrame.elementDepthCount--}();const n=Ht();n.firstCreatePass&&(Z(n,e),go(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function nt(e){return 0!=(16&e.flags)}(t)&&ky(n,t,Ue(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function ct(e){return 0!=(32&e.flags)}(t)&&ky(n,t,Ue(),t.stylesWithoutHost,!1)}function Wt(e,t,n,a){Se(e,t,n,a),Ie()}function Eg(e){return!!e&&"function"==typeof e.then}const a0=function s0(e){return!!e&&"function"==typeof e.subscribe};function Pf(e,t,n,a){const c=Ue(),d=Ht(),y=Yn();return function c0(e,t,n,a,c,d,y,w){const T=fl(a),O=e.firstCreatePass&&$e(e),V=t[8],Q=Be(t);let ae=!0;if(3&a.type||w){const Ge=_i(a,t),Ye=w?w(Ge):Ge,Re=Q.length,st=w?It=>w(Xn(It[a.index])):a.index;if(Fn(n)){let It=null;if(!w&&T&&(It=function sD(e,t,n,a){const c=e.cleanup;if(null!=c)for(let d=0;d<c.length-1;d+=2){const y=c[d];if(y===n&&c[d+1]===a){const w=t[7],T=c[d+2];return w.length>T?w[T]:null}"string"==typeof y&&(d+=2)}return null}(e,t,c,a.index)),null!==It)(It.__ngLastListenerFn__||It).__ngNextListenerFn__=d,It.__ngLastListenerFn__=d,ae=!1;else{d=Ry(a,t,V,d,!1);const dn=n.listen(Ye,c,d);Q.push(d,dn),O&&O.push(c,st,Re,Re+1)}}else d=Ry(a,t,V,d,!0),Ye.addEventListener(c,d,y),Q.push(d),O&&O.push(c,st,Re,y)}else d=Ry(a,t,V,d,!1);const ve=a.outputs;let Oe;if(ae&&null!==ve&&(Oe=ve[c])){const Ge=Oe.length;if(Ge)for(let Ye=0;Ye<Ge;Ye+=2){const jo=t[Oe[Ye]][Oe[Ye+1]].subscribe(d),xh=Q.length;Q.push(d,jo),O&&O.push(c,a.index,xh,-(xh+1))}}}(d,c,c[11],y,e,t,!!n,a),Pf}function u0(e,t,n,a){try{return!1!==n(a)}catch(c){return Ke(e,c),!1}}function Ry(e,t,n,a,c){return function d(y){if(y===Function)return a;const w=2&e.flags?Gr(e.index,t):t;0==(32&t[2])&&oe(w);let T=u0(t,0,a,y),P=d.__ngNextListenerFn__;for(;P;)T=u0(t,0,P,y)&&T,P=P.__ngNextListenerFn__;return c&&!1===T&&(y.preventDefault(),y.returnValue=!1),T}}function xt(e,t=""){const n=Ue(),a=Ht(),c=e+20,d=a.firstCreatePass?Zs(a,c,1,t,null):a.data[c],y=n[c]=function Wp(e,t){return Fn(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Yu(a,n,y,d),Yi(d,!1)}const dh=void 0;var WD=["en",[["a","p"],["AM","PM"],dh],[["AM","PM"],dh,dh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],dh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],dh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",dh,"{1} 'at' {0}",dh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function ZD(e){const n=Math.floor(Math.abs(e)),a=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===a?1:5}];let qd={};function n1(e){return e in qd||(qd[e]=gn.ng&&gn.ng.common&&gn.ng.common.locales&&gn.ng.common.locales[e]),qd[e]}var it=(()=>((it=it||{})[it.LocaleId=0]="LocaleId",it[it.DayPeriodsFormat=1]="DayPeriodsFormat",it[it.DayPeriodsStandalone=2]="DayPeriodsStandalone",it[it.DaysFormat=3]="DaysFormat",it[it.DaysStandalone=4]="DaysStandalone",it[it.MonthsFormat=5]="MonthsFormat",it[it.MonthsStandalone=6]="MonthsStandalone",it[it.Eras=7]="Eras",it[it.FirstDayOfWeek=8]="FirstDayOfWeek",it[it.WeekendRange=9]="WeekendRange",it[it.DateFormat=10]="DateFormat",it[it.TimeFormat=11]="TimeFormat",it[it.DateTimeFormat=12]="DateTimeFormat",it[it.NumberSymbols=13]="NumberSymbols",it[it.NumberFormats=14]="NumberFormats",it[it.CurrencyCode=15]="CurrencyCode",it[it.CurrencySymbol=16]="CurrencySymbol",it[it.CurrencyName=17]="CurrencyName",it[it.Currencies=18]="Currencies",it[it.Directionality=19]="Directionality",it[it.PluralCase=20]="PluralCase",it[it.ExtraData=21]="ExtraData",it))();const Cg="en-US";let r1=Cg;class I1{}class KC{resolveComponentFactory(t){throw function YC(e){const t=Error(`No component factory found for ${Qt(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Zd=(()=>{class e{}return e.NULL=new KC,e})();function QC(){return Wd(Yn(),Ue())}function Wd(e,t){return new tu(_i(e,t))}let tu=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=QC,e})();class A1{}let nT=(()=>{class e{}return e.\u0275prov=Gt({token:e,providedIn:"root",factory:()=>null}),e})();class Pg{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const rT=new Pg("13.1.3"),$y={};function kg(e,t,n,a,c=!1){for(;null!==n;){const d=t[n.index];if(null!==d&&a.push(Xn(d)),Mr(d))for(let w=10;w<d.length;w++){const T=d[w],P=T[1].firstChild;null!==P&&kg(T[1],T,P,a)}const y=n.type;if(8&y)kg(e,t,n.child,a);else if(32&y){const w=Lo(n,t);let T;for(;T=w();)a.push(T)}else if(16&y){const w=Wm(t,n);if(Array.isArray(w))a.push(...w);else{const T=Zu(t[16]);kg(T[1],T,w,a,!0)}}n=c?n.projectionNext:n.next}return a}class zf{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return kg(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Mr(t)){const n=t[8],a=n?n.indexOf(this):-1;a>-1&&(Ol(t,a),jh(n,a))}this._attachedToViewContainer=!1}zl(this._lView[1],this._lView)}onDestroy(t){!function Df(e,t,n,a){const c=Be(t);null===n?c.push(a):(c.push(n),e.firstCreatePass&&$e(e).push(a,c.length-1))}(this._lView[1],this._lView,null,t)}markForCheck(){oe(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){he(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Me(e,t,n){os(!0);try{he(e,t,n)}finally{os(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new kt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function iy(e,t){Gs(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new kt(902,"");this._appRef=t}}class iT extends zf{constructor(t){super(t),this._view=t}detectChanges(){ge(this._view)}checkNoChanges(){!function we(e){os(!0);try{ge(e)}finally{os(!1)}}(this._view)}get context(){return null}}class P1 extends Zd{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=ar(t);return new Gy(n,this.ngModule)}}function k1(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const sT=new cn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Um});class Gy extends I1{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Jm(e){return e.map(Ua).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return k1(this.componentDef.inputs)}get outputs(){return k1(this.componentDef.outputs)}create(t,n,a,c){const d=(c=c||this.ngModule)?function aT(e,t){return{get:(n,a,c)=>{const d=e.get(n,$y,c);return d!==$y||a===$y?d:t.get(n,a,c)}}}(t,c.injector):t,y=d.get(A1,yl),w=d.get(nT,null),T=y.createRenderer(null,this.componentDef),P=this.componentDef.selectors[0][0]||"div",O=a?function pg(e,t,n){if(Fn(e))return e.selectRootElement(t,n===oi.ShadowDom);let a="string"==typeof t?e.querySelector(t):t;return a.textContent="",a}(T,a,this.componentDef.encapsulation):cd(y.createRenderer(null,this.componentDef),P,function oT(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(P)),V=this.componentDef.onPush?576:528,Q=function Fx(e,t){return{components:[],scheduler:e||Um,clean:Ae,playerHandler:t||null,flags:0}}(),ae=oh(0,null,null,1,0,null,null,null,null,null),ve=Yc(null,ae,Q,V,null,null,y,T,w,d);let Oe,Ge;g(ve);try{const Ye=function kx(e,t,n,a,c,d){const y=n[1];n[20]=e;const T=Zs(y,20,2,"#host",null),P=T.mergedAttrs=t.hostAttrs;null!==P&&(un(T,P,!0),null!==e&&(dt(c,e,P),null!==T.classes&&Wc(c,e,T.classes),null!==T.styles&&cf(c,e,T.styles)));const O=a.createRenderer(e,t),V=Yc(n,wf(t),null,t.onPush?64:16,n[20],T,a,O,d||null,null);return y.firstCreatePass&&(Ji(ln(T,n),y,t.type),Cf(y,T),s(T,n.length,1)),te(n,V),n[20]=V}(O,this.componentDef,ve,y,T);if(O)if(a)dt(T,O,["ng-version",rT.full]);else{const{attrs:Re,classes:st}=function eg(e){const t=[],n=[];let a=1,c=2;for(;a<e.length;){let d=e[a];if("string"==typeof d)2===c?""!==d&&t.push(d,e[++a]):8===c&&n.push(d);else{if(!Oo(c))break;c=d}a++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Re&&dt(T,O,Re),st&&st.length>0&&Wc(T,O,st.join(" "))}if(Ge=function tt(e,t){return e.data[t]}(ae,20),void 0!==n){const Re=Ge.projection=[];for(let st=0;st<this.ngContentSelectors.length;st++){const It=n[st];Re.push(null!=It?Array.from(It):null)}}Oe=function Rx(e,t,n,a,c){const d=n[1],y=function by(e,t,n){const a=Yn();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),l(e,a,t,No(e,t,1,null),n));const c=Cc(t,e,a.directiveStart,a);kr(c,t);const d=_i(a,t);return d&&kr(d,t),c}(d,n,t);if(a.components.push(y),e[8]=y,c&&c.forEach(T=>T(y,t)),t.contentQueries){const T=Yn();t.contentQueries(1,y,T.directiveStart)}const w=Yn();return!d.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(j(w.index),ch(n[1],w,0,w.directiveStart,w.directiveEnd,t),_g(t,y)),y}(Ye,this.componentDef,ve,Q,[wE]),Ul(ae,ve,null)}finally{A()}return new cT(this.componentType,Oe,Wd(Ge,ve),ve,Ge)}}class cT extends class XC{}{constructor(t,n,a,c,d){super(),this.location=a,this._rootLView=c,this._tNode=d,this.instance=n,this.hostView=this.changeDetectorRef=new iT(c),this.componentType=t}get injector(){return new Tc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Vl{}class R1{}const Xd=new Map;class O1 extends Vl{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new P1(this);const a=ai(t);this._bootstrapComponents=Fo(a.bootstrap),this._r3Injector=Mn(t,n,[{provide:Vl,useValue:this},{provide:Zd,useValue:this.componentFactoryResolver}],Qt(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=Un.THROW_IF_NOT_FOUND,a=bt.Default){return t===Un||t===Vl||t===mn?this:this._r3Injector.get(t,n,a)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class qy extends R1{constructor(t){super(),this.moduleType=t,null!==ai(t)&&function hT(e){const t=new Set;!function n(a){const c=ai(a,!0),d=c.id;null!==d&&(function F1(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${Qt(t)} vs ${Qt(t.name)}`)}(d,Xd.get(d),a),Xd.set(d,a));const y=Fo(c.imports);for(const w of y)t.has(w)||(t.add(w),n(w))}(e)}(t)}create(t){return new O1(this.moduleType,t)}}function Hy(e){return t=>{setTimeout(e,void 0,t)}}const ao=class MT extends ti{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,a){var c,d,y;let w=t,T=n||(()=>null),P=a;if(t&&"object"==typeof t){const V=t;w=null===(c=V.next)||void 0===c?void 0:c.bind(V),T=null===(d=V.error)||void 0===d?void 0:d.bind(V),P=null===(y=V.complete)||void 0===y?void 0:y.bind(V)}this.__isAsync&&(T=Hy(T),w&&(w=Hy(w)),P&&(P=Hy(P)));const O=super.subscribe({next:w,error:T,complete:P});return t instanceof Vn&&t.add(O),O}};Symbol;let Qs=(()=>{class e{}return e.__NG_ELEMENT_ID__=FT,e})();function FT(){return function G1(e,t){let n;const a=t[e.index];if(Mr(a))n=a;else{let c;if(8&e.type)c=Xn(a);else{const d=t[11];c=d.createComment("");const y=_i(e,t);Bl(d,Hc(d,y),c,function Hm(e,t){return Fn(e)?e.nextSibling(t):t.nextSibling}(d,y),!1)}t[e.index]=n=function I(e,t,n,a){return new Array(e,!0,!1,t,null,0,a,n,null,null)}(a,t,c,e),te(t,n)}return new j1(n,e,t)}(Yn(),Ue())}const LT=Qs,j1=class extends LT{constructor(t,n,a){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=a}get element(){return Wd(this._hostTNode,this._hostLView)}get injector(){return new Tc(this._hostTNode,this._hostLView)}get parentInjector(){const t=Dr(this._hostTNode,this._hostLView);if(mr(t)){const n=kn(t,this._hostLView),a=Qn(t);return new Tc(n[1].data[a+8],n)}return new Tc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=$1(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,a){const c=t.createEmbeddedView(n||{});return this.insert(c,a),c}createComponent(t,n,a,c,d){const y=t&&!function Fu(e){return"function"==typeof e}(t);let w;if(y)w=n;else{const V=n||{};w=V.index,a=V.injector,c=V.projectableNodes,d=V.ngModuleRef}const T=y?t:new Gy(ar(t)),P=a||this.parentInjector;if(!d&&null==T.ngModule&&P){const V=P.get(Vl,null);V&&(d=V)}const O=T.create(P,c,void 0,d);return this.insert(O.hostView,w),O}insert(t,n){const a=t._lView,c=a[1];if(function zh(e){return Mr(e[3])}(a)){const O=this.indexOf(t);if(-1!==O)this.detach(O);else{const V=a[3],Q=new j1(V,V[6],V[3]);Q.detach(Q.indexOf(t))}}const d=this._adjustIndex(n),y=this._lContainer;!function Yp(e,t,n,a){const c=10+a,d=n.length;a>0&&(n[c-1][4]=t),a<d-10?(t[4]=n[c],fm(n,10+a,t)):(n.push(t),t[4]=null),t[3]=n;const y=t[17];null!==y&&n!==y&&function qm(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(y,t);const w=t[19];null!==w&&w.insertView(e),t[2]|=128}(c,a,y,d);const w=of(d,y),T=a[11],P=Hc(T,y[7]);return null!==P&&function ry(e,t,n,a,c,d){a[0]=c,a[6]=t,Gs(e,a,n,1,c,d)}(c,y[6],T,a,P,w),t.attachToViewContainerRef(),fm(Wy(y),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=$1(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),a=Ol(this._lContainer,n);a&&(jh(Wy(this._lContainer),n),zl(a[1],a))}detach(t){const n=this._adjustIndex(t,-1),a=Ol(this._lContainer,n);return a&&null!=jh(Wy(this._lContainer),n)?new zf(a):null}_adjustIndex(t,n=0){return null==t?this.length+n:t}};function $1(e){return e[8]}function Wy(e){return e[8]||(e[8]=[])}function Og(...e){}const zg=new cn("Application Initializer");let Kd=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Og,this.reject=Og,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,c)=>{this.resolve=a,this.reject=c})}runInitializers(){if(this.initialized)return;const n=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const d=this.appInits[c]();if(Eg(d))n.push(d);else if(a0(d)){const y=new Promise((w,T)=>{d.subscribe({complete:w,error:T})});n.push(y)}}Promise.all(n).then(()=>{a()}).catch(c=>{this.reject(c)}),0===n.length&&a(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Ct(zg,8))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const Vf=new cn("AppId"),cS={provide:Vf,useFactory:function lS(){return`${lv()}${lv()}${lv()}`},deps:[]};function lv(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const db=new cn("Platform Initializer"),cv=new cn("Platform ID"),pb=new cn("appBootstrapListener");let fb=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const nu=new cn("LocaleId"),mb=new cn("DefaultCurrencyCode");class uS{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Bg=(()=>{class e{compileModuleSync(n){return new qy(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const a=this.compileModuleSync(n),d=Fo(ai(n).declarations).reduce((y,w)=>{const T=ar(w);return T&&y.push(new Gy(T)),y},[]);return new uS(a,d)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const dS=(()=>Promise.resolve(0))();function uv(e){"undefined"==typeof Zone?dS.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Kr{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ao(!1),this.onMicrotaskEmpty=new ao(!1),this.onStable=new ao(!1),this.onError=new ao(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!a&&n,c.shouldCoalesceRunChangeDetection=a,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function pS(){let e=gn.requestAnimationFrame,t=gn.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function gS(e){const t=()=>{!function mS(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(gn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,dv(e),e.isCheckStableRunning=!0,hv(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),dv(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,a,c,d,y,w)=>{try{return gb(e),n.invokeTask(c,d,y,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&t(),_b(e)}},onInvoke:(n,a,c,d,y,w,T)=>{try{return gb(e),n.invoke(c,d,y,w,T)}finally{e.shouldCoalesceRunChangeDetection&&t(),_b(e)}},onHasTask:(n,a,c,d)=>{n.hasTask(c,d),a===c&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,dv(e),hv(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(n,a,c,d)=>(n.handleError(c,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(c)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Kr.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Kr.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,a){return this._inner.run(t,n,a)}runTask(t,n,a,c){const d=this._inner,y=d.scheduleEventTask("NgZoneEvent: "+c,t,fS,Og,Og);try{return d.runTask(y,n,a)}finally{d.cancelTask(y)}}runGuarded(t,n,a){return this._inner.runGuarded(t,n,a)}runOutsideAngular(t){return this._outer.run(t)}}const fS={};function hv(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function dv(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function gb(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function _b(e){e._nesting--,hv(e)}class _S{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ao,this.onMicrotaskEmpty=new ao,this.onStable=new ao,this.onError=new ao}run(t,n,a){return t.apply(n,a)}runGuarded(t,n,a){return t.apply(n,a)}runOutsideAngular(t){return t()}runTask(t,n,a,c){return t.apply(n,a)}}let pv=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Kr.assertNotInAngularZone(),uv(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())uv(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(n)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,a,c){let d=-1;a&&a>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==d),n(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:n,timeoutId:d,updateCb:c})}whenStable(n,a,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,a,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,a,c){return[]}}return e.\u0275fac=function(n){return new(n||e)(Ct(Kr))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),yb=(()=>{class e{constructor(){this._applications=new Map,fv.addToWindow(this)}registerApplication(n,a){this._applications.set(n,a)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,a=!0){return fv.findTestabilityInTree(this,n,a)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();class yS{addToWindow(t){}findTestabilityInTree(t,n,a){return null}}let Js,fv=new yS;const vb=new cn("AllowMultipleToken");class xb{constructor(t,n){this.name=t,this.token=n}}function bb(e,t,n=[]){const a=`Platform: ${t}`,c=new cn(a);return(d=[])=>{let y=wb();if(!y||y.injector.get(vb,!1))if(e)e(n.concat(d).concat({provide:c,useValue:!0}));else{const w=n.concat(d).concat({provide:c,useValue:!0},{provide:$n,useValue:"platform"});!function wS(e){if(Js&&!Js.destroyed&&!Js.injector.get(vb,!1))throw new kt(400,"");Js=e.get(Eb);const t=e.get(db,null);t&&t.forEach(n=>n())}(Un.create({providers:w,name:a}))}return function ES(e){const t=wb();if(!t)throw new kt(401,"");return t}()}}function wb(){return Js&&!Js.destroyed?Js:null}let Eb=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,a){const w=function DS(e,t){let n;return n="noop"===e?new _S:("zone.js"===e?void 0:e)||new Kr({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),T=[{provide:Kr,useValue:w}];return w.run(()=>{const P=Un.create({providers:T,parent:this.injector,name:n.moduleType.name}),O=n.create(P),V=O.injector.get(Uc,null);if(!V)throw new kt(402,"");return w.runOutsideAngular(()=>{const Q=w.onError.subscribe({next:ae=>{V.handleError(ae)}});O.onDestroy(()=>{mv(this._modules,O),Q.unsubscribe()})}),function CS(e,t,n){try{const a=n();return Eg(a)?a.catch(c=>{throw t.runOutsideAngular(()=>e.handleError(c)),c}):a}catch(a){throw t.runOutsideAngular(()=>e.handleError(a)),a}}(V,w,()=>{const Q=O.injector.get(Kd);return Q.runInitializers(),Q.donePromise.then(()=>(function JD(e){jr(e,"Expected localeId to be defined"),"string"==typeof e&&(r1=e.toLowerCase().replace(/_/g,"-"))}(O.injector.get(nu,Cg)||Cg),this._moduleDoBootstrap(O),O))})})}bootstrapModule(n,a=[]){const c=Db({},a);return function xS(e,t,n){const a=new qy(n);return Promise.resolve(a)}(0,0,n).then(d=>this.bootstrapModuleFactory(d,c))}_moduleDoBootstrap(n){const a=n.injector.get(jf);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(c=>a.bootstrap(c));else{if(!n.instance.ngDoBootstrap)throw new kt(403,"");n.instance.ngDoBootstrap(a)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new kt(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Ct(Un))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();function Db(e,t){return Array.isArray(t)?t.reduce(Db,e):Object.assign(Object.assign({},e),t)}let jf=(()=>{class e{constructor(n,a,c,d,y){this._zone=n,this._injector=a,this._exceptionHandler=c,this._componentFactoryResolver=d,this._initStatus=y,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new xn(P=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{P.next(this._stable),P.complete()})}),T=new xn(P=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{Kr.assertNotInAngularZone(),uv(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,P.next(!0))})})});const V=this._zone.onUnstable.subscribe(()=>{Kr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{P.next(!1)}))});return()=>{O.unsubscribe(),V.unsubscribe()}});this.isStable=function Pt(...e){const t=ot(e),n=function Ze(e,t){return"number"==typeof We(e)?e.pop():t}(e,1/0),a=e;return a.length?1===a.length?br(a[0]):me(n)(je(a,t)):fe}(w,T.pipe(function Zn(e={}){const{connector:t=(()=>new ti),resetOnError:n=!0,resetOnComplete:a=!0,resetOnRefCountZero:c=!0}=e;return d=>{let y=null,w=null,T=null,P=0,O=!1,V=!1;const Q=()=>{null==w||w.unsubscribe(),w=null},ae=()=>{Q(),y=T=null,O=V=!1},ve=()=>{const Oe=y;ae(),null==Oe||Oe.unsubscribe()};return er((Oe,Ge)=>{P++,!V&&!O&&Q();const Ye=T=null!=T?T:t();Ge.add(()=>{P--,0===P&&!V&&!O&&(w=Do(ve,c))}),Ye.subscribe(Ge),y||(y=new xo({next:Re=>Ye.next(Re),error:Re=>{V=!0,Q(),w=Do(ae,n,Re),Ye.error(Re)},complete:()=>{O=!0,Q(),w=Do(ae,a),Ye.complete()}}),je(Oe).subscribe(y))})(d)}}()))}bootstrap(n,a){if(!this._initStatus.done)throw new kt(405,"");let c;c=n instanceof I1?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(c.componentType);const d=function bS(e){return e.isBoundToModule}(c)?void 0:this._injector.get(Vl),w=c.create(Un.NULL,[],a||c.selector,d),T=w.location.nativeElement,P=w.injector.get(pv,null),O=P&&w.injector.get(yb);return P&&O&&O.registerApplication(T,P),w.onDestroy(()=>{this.detachView(w.hostView),mv(this.components,w),O&&O.unregisterApplication(T)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new kt(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const a=n;this._views.push(a),a.attachToAppRef(this)}detachView(n){const a=n;mv(this._views,a),a.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(pb,[]).concat(this._bootstrapListeners).forEach(c=>c(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(Ct(Kr),Ct(Un),Ct(Uc),Ct(Zd),Ct(Kd))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();function mv(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Tb=!0,gv=(()=>{class e{}return e.__NG_ELEMENT_ID__=IS,e})();function IS(e){return function MS(e,t,n){if(Rs(e)&&!n){const a=Gr(e.index,t);return new zf(a,a)}return 47&e.type?new zf(t[16],t):null}(Yn(),Ue(),16==(16&e))}class Rb{constructor(){}supports(t){return Mf(t)}create(t){return new LS(t)}}const FS=(e,t)=>t;class LS{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||FS}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,a=this._removalsHead,c=0,d=null;for(;n||a;){const y=!a||n&&n.currentIndex<Lb(a,c,d)?n:a,w=Lb(y,c,d),T=y.currentIndex;if(y===a)c--,a=a._nextRemoved;else if(n=n._next,null==y.previousIndex)c++;else{d||(d=[]);const P=w-c,O=T-c;if(P!=O){for(let Q=0;Q<P;Q++){const ae=Q<d.length?d[Q]:d[Q]=0,ve=ae+Q;O<=ve&&ve<P&&(d[Q]=ae+1)}d[y.previousIndex]=O-P}}w!==T&&t(y,w,T)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!Mf(t))throw new kt(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let c,d,y,n=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(let w=0;w<this.length;w++)d=t[w],y=this._trackByFn(w,d),null!==n&&Object.is(n.trackById,y)?(a&&(n=this._verifyReinsertion(n,d,y,w)),Object.is(n.item,d)||this._addIdentityChange(n,d)):(n=this._mismatch(n,d,y,w),a=!0),n=n._next}else c=0,function kE(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Rd()]();let a;for(;!(a=n.next()).done;)t(a.value)}}(t,w=>{y=this._trackByFn(c,w),null!==n&&Object.is(n.trackById,y)?(a&&(n=this._verifyReinsertion(n,w,y,c)),Object.is(n.item,w)||this._addIdentityChange(n,w)):(n=this._mismatch(n,w,y,c),a=!0),n=n._next,c++}),this.length=c;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,a,c){let d;return null===t?d=this._itTail:(d=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,d,c)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(a,c))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,d,c)):t=this._addAfter(new OS(n,a),d,c),t}_verifyReinsertion(t,n,a,c){let d=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==d?t=this._reinsertAfter(d,t._prev,c):t.currentIndex!=c&&(t.currentIndex=c,this._addToMoves(t,c)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const c=t._prevRemoved,d=t._nextRemoved;return null===c?this._removalsHead=d:c._nextRemoved=d,null===d?this._removalsTail=c:d._prevRemoved=c,this._insertAfter(t,n,a),this._addToMoves(t,a),t}_moveAfter(t,n,a){return this._unlink(t),this._insertAfter(t,n,a),this._addToMoves(t,a),t}_addAfter(t,n,a){return this._insertAfter(t,n,a),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,a){const c=null===n?this._itHead:n._next;return t._next=c,t._prev=n,null===c?this._itTail=t:c._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new Fb),this._linkedRecords.put(t),t.currentIndex=a,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,a=t._next;return null===n?this._itHead=a:n._next=a,null===a?this._itTail=n:a._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Fb),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class OS{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class zS{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===n||n<=a.currentIndex)&&Object.is(a.trackById,t))return a;return null}remove(t){const n=t._prevDup,a=t._nextDup;return null===n?this._head=a:n._nextDup=a,null===a?this._tail=n:a._prevDup=n,null===this._head}}class Fb{constructor(){this.map=new Map}put(t){const n=t.trackById;let a=this.map.get(n);a||(a=new zS,this.map.set(n,a)),a.add(t)}get(t,n){const c=this.map.get(t);return c?c.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Lb(e,t,n){const a=e.previousIndex;if(null===a)return a;let c=0;return n&&a<n.length&&(c=n[a]),a+t+c}class Ob{constructor(){}supports(t){return t instanceof Map||Cy(t)}create(){return new BS}}class BS{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||Cy(t)))throw new kt(900,"")}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(a,c)=>{if(n&&n.key===c)this._maybeAddToChanges(n,a),this._appendAfter=n,n=n._next;else{const d=this._getOrCreateRecordForKey(c,a);n=this._insertBeforeOrAppend(n,d)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let a=n;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const a=t._prev;return n._next=t,n._prev=a,t._prev=n,a&&(a._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const c=this._records.get(t);this._maybeAddToChanges(c,n);const d=c._prev,y=c._next;return d&&(d._next=y),y&&(y._prev=d),c._next=null,c._prev=null,c}const a=new NS(t);return this._records.set(t,a),a.currentValue=n,this._addToAdditions(a),a}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(a=>n(t[a],a))}}class NS{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function zb(){return new $f([new Rb])}let $f=(()=>{class e{constructor(n){this.factories=n}static create(n,a){if(null!=a){const c=a.factories.slice();n=n.concat(c)}return new e(n)}static extend(n){return{provide:e,useFactory:a=>e.create(n,a||zb()),deps:[[e,new Al,new cs]]}}find(n){const a=this.factories.find(c=>c.supports(n));if(null!=a)return a;throw new kt(901,"")}}return e.\u0275prov=Gt({token:e,providedIn:"root",factory:zb}),e})();function Bb(){return new Qd([new Ob])}let Qd=(()=>{class e{constructor(n){this.factories=n}static create(n,a){if(a){const c=a.factories.slice();n=n.concat(c)}return new e(n)}static extend(n){return{provide:e,useFactory:a=>e.create(n,a||Bb()),deps:[[e,new Al,new cs]]}}find(n){const a=this.factories.find(d=>d.supports(n));if(a)return a;throw new kt(901,"")}}return e.\u0275prov=Gt({token:e,providedIn:"root",factory:Bb}),e})();const US=[new Ob],jS=new $f([new Rb]),$S=new Qd(US),GS=bb(null,"core",[{provide:cv,useValue:"unknown"},{provide:Eb,deps:[Un]},{provide:yb,deps:[]},{provide:fb,deps:[]}]),XS=[{provide:jf,useClass:jf,deps:[Kr,Un,Uc,Zd,Kd]},{provide:sT,deps:[Kr],useFactory:function YS(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(n){t.push(n)}}},{provide:Kd,useClass:Kd,deps:[[new cs,zg]]},{provide:Bg,useClass:Bg,deps:[]},cS,{provide:$f,useFactory:function qS(){return jS},deps:[]},{provide:Qd,useFactory:function HS(){return $S},deps:[]},{provide:nu,useFactory:function ZS(e){return e||function WS(){return"undefined"!=typeof $localize&&$localize.locale||Cg}()},deps:[[new zu(nu),new cs,new Al]]},{provide:mb,useValue:"USD"}];let KS=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Ct(jf))},e.\u0275mod=po({type:e}),e.\u0275inj=Qo({providers:XS}),e})(),Ug=null;function ru(){return Ug}const _s=new cn("DocumentToken");let fh=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:function(){return function tI(){return Ct(Nb)}()},providedIn:"platform"}),e})();const nI=new cn("Location Initialized");let Nb=(()=>{class e extends fh{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ru().getBaseHref(this._doc)}onPopState(n){const a=ru().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",n,!1),()=>a.removeEventListener("popstate",n)}onHashChange(n){const a=ru().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",n,!1),()=>a.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,a,c){Ub()?this._history.pushState(n,a,c):this.location.hash=c}replaceState(n,a,c){Ub()?this._history.replaceState(n,a,c):this.location.hash=c}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Ct(_s))},e.\u0275prov=Gt({token:e,factory:function(){return function rI(){return new Nb(Ct(_s))}()},providedIn:"platform"}),e})();function Ub(){return!!window.history.pushState}function bv(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Vb(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function $l(e){return e&&"?"!==e[0]?"?"+e:e}let Jd=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:function(){return function iI(e){const t=Ct(_s).location;return new jb(Ct(fh),t&&t.origin||"")}()},providedIn:"root"}),e})();const wv=new cn("appBaseHref");let jb=(()=>{class e extends Jd{constructor(n,a){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==a&&(a=this._platformLocation.getBaseHrefFromDOM()),null==a)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=a}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return bv(this._baseHref,n)}path(n=!1){const a=this._platformLocation.pathname+$l(this._platformLocation.search),c=this._platformLocation.hash;return c&&n?`${a}${c}`:a}pushState(n,a,c,d){const y=this.prepareExternalUrl(c+$l(d));this._platformLocation.pushState(n,a,y)}replaceState(n,a,c,d){const y=this.prepareExternalUrl(c+$l(d));this._platformLocation.replaceState(n,a,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,c;null===(c=(a=this._platformLocation).historyGo)||void 0===c||c.call(a,n)}}return e.\u0275fac=function(n){return new(n||e)(Ct(fh),Ct(wv,8))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),oI=(()=>{class e extends Jd{constructor(n,a){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(n){const a=bv(this._baseHref,n);return a.length>0?"#"+a:a}pushState(n,a,c,d){let y=this.prepareExternalUrl(c+$l(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,a,y)}replaceState(n,a,c,d){let y=this.prepareExternalUrl(c+$l(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,a,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,c;null===(c=(a=this._platformLocation).historyGo)||void 0===c||c.call(a,n)}}return e.\u0275fac=function(n){return new(n||e)(Ct(fh),Ct(wv,8))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),Ev=(()=>{class e{constructor(n,a){this._subject=new ao,this._urlChangeListeners=[],this._platformStrategy=n;const c=this._platformStrategy.getBaseHref();this._platformLocation=a,this._baseHref=Vb($b(c)),this._platformStrategy.onPopState(d=>{this._subject.emit({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,a=""){return this.path()==this.normalize(n+$l(a))}normalize(n){return e.stripTrailingSlash(function aI(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,$b(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,a="",c=null){this._platformStrategy.pushState(c,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+$l(a)),c)}replaceState(n,a="",c=null){this._platformStrategy.replaceState(c,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+$l(a)),c)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var a,c;null===(c=(a=this._platformStrategy).historyGo)||void 0===c||c.call(a,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}))}_notifyUrlChangeListeners(n="",a){this._urlChangeListeners.forEach(c=>c(n,a))}subscribe(n,a,c){return this._subject.subscribe({next:n,error:a,complete:c})}}return e.normalizeQueryParams=$l,e.joinWithSlash=bv,e.stripTrailingSlash=Vb,e.\u0275fac=function(n){return new(n||e)(Ct(Jd),Ct(fh))},e.\u0275prov=Gt({token:e,factory:function(){return function sI(){return new Ev(Ct(Jd),Ct(fh))}()},providedIn:"root"}),e})();function $b(e){return e.replace(/\/index.html$/,"")}var Or=(()=>((Or=Or||{})[Or.Zero=0]="Zero",Or[Or.One=1]="One",Or[Or.Two=2]="Two",Or[Or.Few=3]="Few",Or[Or.Many=4]="Many",Or[Or.Other=5]="Other",Or))();const fI=function t1(e){return function so(e){const t=function XD(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=n1(t);if(n)return n;const a=t.split("-")[0];if(n=n1(a),n)return n;if("en"===a)return WD;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[it.PluralCase]};class Yg{}let $I=(()=>{class e extends Yg{constructor(n){super(),this.locale=n}getPluralCategory(n,a){switch(fI(a||this.locale)(n)){case Or.Zero:return"zero";case Or.One:return"one";case Or.Two:return"two";case Or.Few:return"few";case Or.Many:return"many";default:return"other"}}}return e.\u0275fac=function(n){return new(n||e)(Ct(nu))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),EM=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=po({type:e}),e.\u0275inj=Qo({providers:[{provide:Yg,useClass:$I}]}),e})();let SM=(()=>{class e{}return e.\u0275prov=Gt({token:e,providedIn:"root",factory:()=>new IM(Ct(_s),window)}),e})();class IM{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function MM(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const a=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=a.currentNode;for(;c;){const d=c.shadowRoot;if(d){const y=d.getElementById(t)||d.querySelector(`[name="${t}"]`);if(y)return y}c=a.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),this.attemptFocus(n))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),a=n.left+this.window.pageXOffset,c=n.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(a-d[0],c-d[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=rw(this.window.history)||rw(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function rw(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Ov extends class PM extends class eI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function JS(e){Ug||(Ug=e)}(new Ov)}onAndCancel(t,n,a){return t.addEventListener(n,a,!1),()=>{t.removeEventListener(n,a,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function kM(){return Hf=Hf||document.querySelector("base"),Hf?Hf.getAttribute("href"):null}();return null==n?null:function RM(e){Kg=Kg||document.createElement("a"),Kg.setAttribute("href",e);const t=Kg.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Hf=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function GI(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const a=n.indexOf("="),[c,d]=-1==a?[n,""]:[n.slice(0,a),n.slice(a+1)];if(c.trim()===t)return decodeURIComponent(d)}return null}(document.cookie,t)}}let Kg,Hf=null;const iw=new cn("TRANSITION_ID"),LM=[{provide:zg,useFactory:function FM(e,t,n){return()=>{n.get(Kd).donePromise.then(()=>{const a=ru(),c=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let d=0;d<c.length;d++)a.remove(c[d])})}},deps:[iw,_s,Un],multi:!0}];class zv{static init(){!function vS(e){fv=e}(new zv)}addToWindow(t){gn.getAngularTestability=(a,c=!0)=>{const d=t.findTestabilityInTree(a,c);if(null==d)throw new Error("Could not find testability for element.");return d},gn.getAllAngularTestabilities=()=>t.getAllTestabilities(),gn.getAllAngularRootElements=()=>t.getAllRootElements(),gn.frameworkStabilizers||(gn.frameworkStabilizers=[]),gn.frameworkStabilizers.push(a=>{const c=gn.getAllAngularTestabilities();let d=c.length,y=!1;const w=function(T){y=y||T,d--,0==d&&a(y)};c.forEach(function(T){T.whenStable(w)})})}findTestabilityInTree(t,n,a){if(null==n)return null;const c=t.getTestability(n);return null!=c?c:a?ru().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null}}let OM=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const Qg=new cn("EventManagerPlugins");let Jg=(()=>{class e{constructor(n,a){this._zone=a,this._eventNameToPlugin=new Map,n.forEach(c=>c.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,a,c){return this._findPluginFor(a).addEventListener(n,a,c)}addGlobalEventListener(n,a,c){return this._findPluginFor(a).addGlobalEventListener(n,a,c)}getZone(){return this._zone}_findPluginFor(n){const a=this._eventNameToPlugin.get(n);if(a)return a;const c=this._plugins;for(let d=0;d<c.length;d++){const y=c[d];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Ct(Qg),Ct(Kr))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();class ow{constructor(t){this._doc=t}addGlobalEventListener(t,n,a){const c=ru().getGlobalEventTarget(this._doc,t);if(!c)throw new Error(`Unsupported event target ${c} for event ${n}`);return this.addEventListener(c,n,a)}}let sw=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const a=new Set;n.forEach(c=>{this._stylesSet.has(c)||(this._stylesSet.add(c),a.add(c))}),this.onStylesAdded(a)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),Zf=(()=>{class e extends sw{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,a,c){n.forEach(d=>{const y=this._doc.createElement("style");y.textContent=d,c.push(a.appendChild(y))})}addHost(n){const a=[];this._addStylesToHost(this._stylesSet,n,a),this._hostNodes.set(n,a)}removeHost(n){const a=this._hostNodes.get(n);a&&a.forEach(aw),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((a,c)=>{this._addStylesToHost(n,c,a)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(aw))}}return e.\u0275fac=function(n){return new(n||e)(Ct(_s))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();function aw(e){ru().remove(e)}const Bv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Nv=/%COMP%/g;function e_(e,t,n){for(let a=0;a<t.length;a++){let c=t[a];Array.isArray(c)?e_(e,c,n):(c=c.replace(Nv,e),n.push(c))}return n}function uw(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Uv=(()=>{class e{constructor(n,a,c){this.eventManager=n,this.sharedStylesHost=a,this.appId=c,this.rendererByCompId=new Map,this.defaultRenderer=new Vv(n)}createRenderer(n,a){if(!n||!a)return this.defaultRenderer;switch(a.encapsulation){case oi.Emulated:{let c=this.rendererByCompId.get(a.id);return c||(c=new jM(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,c)),c.applyToHost(n),c}case 1:case oi.ShadowDom:return new $M(this.eventManager,this.sharedStylesHost,n,a);default:if(!this.rendererByCompId.has(a.id)){const c=e_(a.id,a.styles,[]);this.sharedStylesHost.addStyles(c),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Ct(Jg),Ct(Zf),Ct(Vf))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();class Vv{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(Bv[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,a){t&&t.insertBefore(n,a)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error(`The selector "${t}" did not match any elements`);return n||(a.textContent=""),a}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,a,c){if(c){n=c+":"+n;const d=Bv[c];d?t.setAttributeNS(d,n,a):t.setAttribute(n,a)}else t.setAttribute(n,a)}removeAttribute(t,n,a){if(a){const c=Bv[a];c?t.removeAttributeNS(c,n):t.removeAttribute(`${a}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,a,c){c&(Ri.DashCase|Ri.Important)?t.style.setProperty(n,a,c&Ri.Important?"important":""):t.style[n]=a}removeStyle(t,n,a){a&Ri.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,a){t[n]=a}setValue(t,n){t.nodeValue=n}listen(t,n,a){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,uw(a)):this.eventManager.addEventListener(t,n,uw(a))}}class jM extends Vv{constructor(t,n,a,c){super(t),this.component=a;const d=e_(c+"-"+a.id,a.styles,[]);n.addStyles(d),this.contentAttr=function NM(e){return"_ngcontent-%COMP%".replace(Nv,e)}(c+"-"+a.id),this.hostAttr=function UM(e){return"_nghost-%COMP%".replace(Nv,e)}(c+"-"+a.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const a=super.createElement(t,n);return super.setAttribute(a,this.contentAttr,""),a}}class $M extends Vv{constructor(t,n,a,c){super(t),this.sharedStylesHost=n,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const d=e_(c.id,c.styles,[]);for(let y=0;y<d.length;y++){const w=document.createElement("style");w.textContent=d[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,a){return super.insertBefore(this.nodeOrShadowRoot(t),n,a)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let GM=(()=>{class e extends ow{constructor(n){super(n)}supports(n){return!0}addEventListener(n,a,c){return n.addEventListener(a,c,!1),()=>this.removeEventListener(n,a,c)}removeEventListener(n,a,c){return n.removeEventListener(a,c)}}return e.\u0275fac=function(n){return new(n||e)(Ct(_s))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const dw=["alt","control","meta","shift"],HM={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},pw={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ZM={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let WM=(()=>{class e extends ow{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,a,c){const d=e.parseEventName(a),y=e.eventCallback(d.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ru().onAndCancel(n,d.domEventName,y))}static parseEventName(n){const a=n.toLowerCase().split("."),c=a.shift();if(0===a.length||"keydown"!==c&&"keyup"!==c)return null;const d=e._normalizeKey(a.pop());let y="";if(dw.forEach(T=>{const P=a.indexOf(T);P>-1&&(a.splice(P,1),y+=T+".")}),y+=d,0!=a.length||0===d.length)return null;const w={};return w.domEventName=c,w.fullKey=y,w}static getEventFullKey(n){let a="",c=function XM(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&pw.hasOwnProperty(t)&&(t=pw[t]))}return HM[t]||t}(n);return c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),dw.forEach(d=>{d!=c&&ZM[d](n)&&(a+=d+".")}),a+=c,a}static eventCallback(n,a,c){return d=>{e.getEventFullKey(d)===n&&c.runGuarded(()=>a(d))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Ct(_s))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const JM=bb(GS,"browser",[{provide:cv,useValue:"browser"},{provide:db,useValue:function YM(){Ov.makeCurrent(),zv.init()},multi:!0},{provide:_s,useFactory:function QM(){return function To(e){_c=e}(document),document},deps:[]}]),eA=[{provide:$n,useValue:"root"},{provide:Uc,useFactory:function KM(){return new Uc},deps:[]},{provide:Qg,useClass:GM,multi:!0,deps:[_s,Kr,cv]},{provide:Qg,useClass:WM,multi:!0,deps:[_s]},{provide:Uv,useClass:Uv,deps:[Jg,Zf,Vf]},{provide:A1,useExisting:Uv},{provide:sw,useExisting:Zf},{provide:Zf,useClass:Zf,deps:[_s]},{provide:pv,useClass:pv,deps:[Kr]},{provide:Jg,useClass:Jg,deps:[Qg,Kr]},{provide:class AM{},useClass:OM,deps:[]}];let tA=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:Vf,useValue:n.appId},{provide:iw,useExisting:Vf},LM]}}}return e.\u0275fac=function(n){return new(n||e)(Ct(e,12))},e.\u0275mod=po({type:e}),e.\u0275inj=Qo({providers:eA,imports:[EM,KS]}),e})();function jt(...e){return je(e,ot(e))}"undefined"!=typeof window&&window;class na extends ti{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:a}=this;if(t)throw n;return this._throwIfClosed(),a}next(t){super.next(this._value=t)}}const{isArray:dA}=Array,{getPrototypeOf:pA,prototype:fA,keys:mA}=Object;const{isArray:yA}=Array;function wA(...e){const t=ot(e),n=function Le(e){return Rn(We(e))?e.pop():void 0}(e),{args:a,keys:c}=function gA(e){if(1===e.length){const t=e[0];if(dA(t))return{args:t,keys:null};if(function _A(e){return e&&"object"==typeof e&&pA(e)===fA}(t)){const n=mA(t);return{args:n.map(a=>t[a]),keys:n}}}return{args:e,keys:null}}(e);if(0===a.length)return je([],t);const d=new xn(function EA(e,t,n=Vi){return a=>{gw(t,()=>{const{length:c}=e,d=new Array(c);let y=c,w=c;for(let T=0;T<c;T++)gw(t,()=>{const P=je(e[T],t);let O=!1;P.subscribe(new En(a,V=>{d[T]=V,O||(O=!0,w--),w||a.next(n(d.slice()))},()=>{--y||a.complete()}))},a)},a)}}(a,t,c?y=>function bA(e,t){return e.reduce((n,a,c)=>(n[a]=t[c],n),{})}(c,y):Vi));return n?d.pipe(function xA(e){return an(t=>function vA(e,t){return yA(t)?e(...t):e(t)}(e,t))}(n)):d}function gw(e,t,n){e?W(n,e,t):t()}const t_=au(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function $v(...e){return function DA(){return me(1)}()(je(e,ot(e)))}function _w(e){return new xn(t=>{br(e()).subscribe(t)})}function yw(){return er((e,t)=>{let n=null;e._refCount++;const a=new En(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const c=e._connection,d=n;n=null,c&&(!d||c===d)&&c.unsubscribe(),t.unsubscribe()});e.subscribe(a),a.closed||(n=e.connect())})}class CA extends xn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,di(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Vn;const n=this.getSubject();t.add(this.source.subscribe(new En(n,void 0,()=>{this._teardown(),n.complete()},a=>{this._teardown(),n.error(a)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Vn.EMPTY)}return t}refCount(){return yw()(this)}}function mh(e,t){return er((n,a)=>{let c=null,d=0,y=!1;const w=()=>y&&!c&&a.complete();n.subscribe(new En(a,T=>{null==c||c.unsubscribe();let P=0;const O=d++;br(e(T,O)).subscribe(c=new En(a,V=>a.next(t?t(T,V,O,P++):V),()=>{c=null,w()}))},()=>{y=!0,w()}))})}function SA(e,t,n,a,c){return(d,y)=>{let w=n,T=t,P=0;d.subscribe(new En(y,O=>{const V=P++;T=w?e(T,O,V):(w=!0,O),a&&y.next(T)},c&&(()=>{w&&y.next(T),y.complete()})))}}function vw(e,t){return er(SA(e,t,arguments.length>=2,!0))}function ep(e,t){return er((n,a)=>{let c=0;n.subscribe(new En(a,d=>e.call(t,d,c++)&&a.next(d)))})}function ou(e){return er((t,n)=>{let d,a=null,c=!1;a=t.subscribe(new En(n,void 0,void 0,y=>{d=br(e(y,ou(e)(t))),a?(a.unsubscribe(),a=null,d.subscribe(n)):c=!0})),c&&(a.unsubscribe(),a=null,d.subscribe(n))})}function Wf(e,t){return Rn(t)?se(e,t,1):se(e,1)}function Gv(e){return e<=0?()=>fe:er((t,n)=>{let a=[];t.subscribe(new En(n,c=>{a.push(c),e<a.length&&a.shift()},()=>{for(const c of a)n.next(c);n.complete()},void 0,()=>{a=null}))})}function xw(e=IA){return er((t,n)=>{let a=!1;t.subscribe(new En(n,c=>{a=!0,n.next(c)},()=>a?n.complete():n.error(e())))})}function IA(){return new t_}function bw(e){return er((t,n)=>{let a=!1;t.subscribe(new En(n,c=>{a=!0,n.next(c)},()=>{a||n.next(e),n.complete()}))})}function tp(e,t){const n=arguments.length>=2;return a=>a.pipe(e?ep((c,d)=>e(c,d,a)):Vi,Dt(1),n?bw(t):xw(()=>new t_))}function Uo(e,t,n){const a=Rn(e)||t||n?{next:e,error:t,complete:n}:e;return a?er((c,d)=>{var y;null===(y=a.subscribe)||void 0===y||y.call(a);let w=!0;c.subscribe(new En(d,T=>{var P;null===(P=a.next)||void 0===P||P.call(a,T),d.next(T)},()=>{var T;w=!1,null===(T=a.complete)||void 0===T||T.call(a),d.complete()},T=>{var P;w=!1,null===(P=a.error)||void 0===P||P.call(a,T),d.error(T)},()=>{var T,P;w&&(null===(T=a.unsubscribe)||void 0===T||T.call(a)),null===(P=a.finalize)||void 0===P||P.call(a)}))}):Vi}class ql{constructor(t,n){this.id=t,this.url=n}}class qv extends ql{constructor(t,n,a="imperative",c=null){super(t,n),this.navigationTrigger=a,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Xf extends ql{constructor(t,n,a){super(t,n),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ww extends ql{constructor(t,n,a){super(t,n),this.reason=a}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class PA extends ql{constructor(t,n,a){super(t,n),this.error=a}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class kA extends ql{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class RA extends ql{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class FA extends ql{constructor(t,n,a,c,d){super(t,n),this.urlAfterRedirects=a,this.state=c,this.shouldActivate=d}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class LA extends ql{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class OA extends ql{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ew{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Dw{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class zA{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class BA{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class NA{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UA{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Cw{constructor(t,n,a){this.routerEvent=t,this.position=n,this.anchor=a}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const tn="primary";class VA{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function np(e){return new VA(e)}const Tw="ngNavigationCancelingError";function Hv(e){const t=Error("NavigationCancelingError: "+e);return t[Tw]=!0,t}function $A(e,t,n){const a=n.path.split("/");if(a.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||a.length<e.length))return null;const c={};for(let d=0;d<a.length;d++){const y=a[d],w=e[d];if(y.startsWith(":"))c[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:e.slice(0,a.length),posParams:c}}function Wa(e,t){const n=e?Object.keys(e):void 0,a=t?Object.keys(t):void 0;if(!n||!a||n.length!=a.length)return!1;let c;for(let d=0;d<n.length;d++)if(c=n[d],!Sw(e[c],t[c]))return!1;return!0}function Sw(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),a=[...t].sort();return n.every((c,d)=>a[d]===c)}return e===t}function Iw(e){return Array.prototype.concat.apply([],e)}function Mw(e){return e.length>0?e[e.length-1]:null}function Ci(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Xa(e){return a0(e)?e:Eg(e)?je(Promise.resolve(e)):jt(e)}const HA={exact:function kw(e,t,n){if(!_h(e.segments,t.segments)||!n_(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const a in t.children)if(!e.children[a]||!kw(e.children[a],t.children[a],n))return!1;return!0},subset:Rw},Aw={exact:function ZA(e,t){return Wa(e,t)},subset:function WA(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Sw(e[n],t[n]))},ignored:()=>!0};function Pw(e,t,n){return HA[n.paths](e.root,t.root,n.matrixParams)&&Aw[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function Rw(e,t,n){return Fw(e,t,t.segments,n)}function Fw(e,t,n,a){if(e.segments.length>n.length){const c=e.segments.slice(0,n.length);return!(!_h(c,n)||t.hasChildren()||!n_(c,n,a))}if(e.segments.length===n.length){if(!_h(e.segments,n)||!n_(e.segments,n,a))return!1;for(const c in t.children)if(!e.children[c]||!Rw(e.children[c],t.children[c],a))return!1;return!0}{const c=n.slice(0,e.segments.length),d=n.slice(e.segments.length);return!!(_h(e.segments,c)&&n_(e.segments,c,a)&&e.children[tn])&&Fw(e.children[tn],t,d,a)}}function n_(e,t,n){return t.every((a,c)=>Aw[n](e[c].parameters,a.parameters))}class gh{constructor(t,n,a){this.root=t,this.queryParams=n,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=np(this.queryParams)),this._queryParamMap}toString(){return KA.serialize(this)}}class sn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Ci(n,(a,c)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return r_(this)}}class Yf{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=np(this.parameters)),this._parameterMap}toString(){return Nw(this)}}function _h(e,t){return e.length===t.length&&e.every((n,a)=>n.path===t[a].path)}class Lw{}class Ow{parse(t){const n=new s2(t);return new gh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${Kf(t.root,!0)}`,a=function e2(e){const t=Object.keys(e).map(n=>{const a=e[n];return Array.isArray(a)?a.map(c=>`${i_(n)}=${i_(c)}`).join("&"):`${i_(n)}=${i_(a)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${a}${"string"==typeof t.fragment?`#${function QA(e){return encodeURI(e)}(t.fragment)}`:""}`}}const KA=new Ow;function r_(e){return e.segments.map(t=>Nw(t)).join("/")}function Kf(e,t){if(!e.hasChildren())return r_(e);if(t){const n=e.children[tn]?Kf(e.children[tn],!1):"",a=[];return Ci(e.children,(c,d)=>{d!==tn&&a.push(`${d}:${Kf(c,!1)}`)}),a.length>0?`${n}(${a.join("//")})`:n}{const n=function YA(e,t){let n=[];return Ci(e.children,(a,c)=>{c===tn&&(n=n.concat(t(a,c)))}),Ci(e.children,(a,c)=>{c!==tn&&(n=n.concat(t(a,c)))}),n}(e,(a,c)=>c===tn?[Kf(e.children[tn],!1)]:[`${c}:${Kf(a,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[tn]?`${r_(e)}/${n[0]}`:`${r_(e)}/(${n.join("//")})`}}function zw(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function i_(e){return zw(e).replace(/%3B/gi,";")}function Zv(e){return zw(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function o_(e){return decodeURIComponent(e)}function Bw(e){return o_(e.replace(/\+/g,"%20"))}function Nw(e){return`${Zv(e.path)}${function JA(e){return Object.keys(e).map(t=>`;${Zv(t)}=${Zv(e[t])}`).join("")}(e.parameters)}`}const t2=/^[^\/()?;=#]+/;function s_(e){const t=e.match(t2);return t?t[0]:""}const n2=/^[^=?&#]+/,i2=/^[^&#]+/;class s2{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new sn([],{}):new sn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(a[tn]=new sn(t,n)),a}parseSegment(){const t=s_(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new Yf(o_(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=s_(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const c=s_(this.remaining);c&&(a=c,this.capture(a))}t[o_(n)]=o_(a)}parseQueryParam(t){const n=function r2(e){const t=e.match(n2);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const y=function o2(e){const t=e.match(i2);return t?t[0]:""}(this.remaining);y&&(a=y,this.capture(a))}const c=Bw(n),d=Bw(a);if(t.hasOwnProperty(c)){let y=t[c];Array.isArray(y)||(y=[y],t[c]=y),y.push(d)}else t[c]=d}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=s_(this.remaining),c=this.remaining[a.length];if("/"!==c&&")"!==c&&";"!==c)throw new Error(`Cannot parse url '${this.url}'`);let d;a.indexOf(":")>-1?(d=a.substr(0,a.indexOf(":")),this.capture(d),this.capture(":")):t&&(d=tn);const y=this.parseChildren();n[d]=1===Object.keys(y).length?y[tn]:new sn([],y),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class Uw{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Wv(t,this._root);return n?n.children.map(a=>a.value):[]}firstChild(t){const n=Wv(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=Xv(t,this._root);return n.length<2?[]:n[n.length-2].children.map(c=>c.value).filter(c=>c!==t)}pathFromRoot(t){return Xv(t,this._root).map(n=>n.value)}}function Wv(e,t){if(e===t.value)return t;for(const n of t.children){const a=Wv(e,n);if(a)return a}return null}function Xv(e,t){if(e===t.value)return[t];for(const n of t.children){const a=Xv(e,n);if(a.length)return a.unshift(t),a}return[]}class Hl{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function rp(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class Vw extends Uw{constructor(t,n){super(t),this.snapshot=n,Yv(this,t)}toString(){return this.snapshot.toString()}}function jw(e,t){const n=function a2(e,t){const y=new a_([],{},{},"",{},tn,t,null,e.root,-1,{});return new Gw("",new Hl(y,[]))}(e,t),a=new na([new Yf("",{})]),c=new na({}),d=new na({}),y=new na({}),w=new na(""),T=new ip(a,c,y,w,d,tn,t,n.root);return T.snapshot=n.root,new Vw(new Hl(T,[]),n)}class ip{constructor(t,n,a,c,d,y,w,T){this.url=t,this.params=n,this.queryParams=a,this.fragment=c,this.data=d,this.outlet=y,this.component=w,this._futureSnapshot=T}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(an(t=>np(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(an(t=>np(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function $w(e,t="emptyOnly"){const n=e.pathFromRoot;let a=0;if("always"!==t)for(a=n.length-1;a>=1;){const c=n[a],d=n[a-1];if(c.routeConfig&&""===c.routeConfig.path)a--;else{if(d.component)break;a--}}return function l2(e){return e.reduce((t,n)=>({params:Object.assign(Object.assign({},t.params),n.params),data:Object.assign(Object.assign({},t.data),n.data),resolve:Object.assign(Object.assign({},t.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(a))}class a_{constructor(t,n,a,c,d,y,w,T,P,O,V){this.url=t,this.params=n,this.queryParams=a,this.fragment=c,this.data=d,this.outlet=y,this.component=w,this.routeConfig=T,this._urlSegment=P,this._lastPathIndex=O,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=np(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=np(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Gw extends Uw{constructor(t,n){super(n),this.url=t,Yv(this,n)}toString(){return qw(this._root)}}function Yv(e,t){t.value._routerState=e,t.children.forEach(n=>Yv(e,n))}function qw(e){const t=e.children.length>0?` { ${e.children.map(qw).join(", ")} } `:"";return`${e.value}${t}`}function Kv(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Wa(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Wa(t.params,n.params)||e.params.next(n.params),function GA(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Wa(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Wa(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Qv(e,t){const n=Wa(e.params,t.params)&&function XA(e,t){return _h(e,t)&&e.every((n,a)=>Wa(n.parameters,t[a].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||Qv(e.parent,t.parent))}function Qf(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const a=n.value;a._futureSnapshot=t.value;const c=function u2(e,t,n){return t.children.map(a=>{for(const c of n.children)if(e.shouldReuseRoute(a.value,c.value.snapshot))return Qf(e,a,c);return Qf(e,a)})}(e,t,n);return new Hl(a,c)}{if(e.shouldAttach(t.value)){const d=e.retrieve(t.value);if(null!==d){const y=d.route;return y.value._futureSnapshot=t.value,y.children=t.children.map(w=>Qf(e,w)),y}}const a=function h2(e){return new ip(new na(e.url),new na(e.params),new na(e.queryParams),new na(e.fragment),new na(e.data),e.outlet,e.component,e)}(t.value),c=t.children.map(d=>Qf(e,d));return new Hl(a,c)}}function l_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Jf(e){return"object"==typeof e&&null!=e&&e.outlets}function Jv(e,t,n,a,c){let d={};return a&&Ci(a,(y,w)=>{d[w]=Array.isArray(y)?y.map(T=>`${T}`):`${y}`}),new gh(n.root===e?t:Hw(n.root,e,t),d,c)}function Hw(e,t,n){const a={};return Ci(e.children,(c,d)=>{a[d]=c===t?n:Hw(c,t,n)}),new sn(e.segments,a)}class Zw{constructor(t,n,a){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=a,t&&a.length>0&&l_(a[0]))throw new Error("Root segment cannot have matrix parameters");const c=a.find(Jf);if(c&&c!==Mw(a))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class ex{constructor(t,n,a){this.segmentGroup=t,this.processChildren=n,this.index=a}}function Ww(e,t,n){if(e||(e=new sn([],{})),0===e.segments.length&&e.hasChildren())return c_(e,t,n);const a=function _2(e,t,n){let a=0,c=t;const d={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(a>=n.length)return d;const y=e.segments[c],w=n[a];if(Jf(w))break;const T=`${w}`,P=a<n.length-1?n[a+1]:null;if(c>0&&void 0===T)break;if(T&&P&&"object"==typeof P&&void 0===P.outlets){if(!Yw(T,P,y))return d;a+=2}else{if(!Yw(T,{},y))return d;a++}c++}return{match:!0,pathIndex:c,commandIndex:a}}(e,t,n),c=n.slice(a.commandIndex);if(a.match&&a.pathIndex<e.segments.length){const d=new sn(e.segments.slice(0,a.pathIndex),{});return d.children[tn]=new sn(e.segments.slice(a.pathIndex),e.children),c_(d,0,c)}return a.match&&0===c.length?new sn(e.segments,{}):a.match&&!e.hasChildren()?tx(e,t,n):a.match?c_(e,0,c):tx(e,t,n)}function c_(e,t,n){if(0===n.length)return new sn(e.segments,{});{const a=function g2(e){return Jf(e[0])?e[0].outlets:{[tn]:e}}(n),c={};return Ci(a,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(c[y]=Ww(e.children[y],t,d))}),Ci(e.children,(d,y)=>{void 0===a[y]&&(c[y]=d)}),new sn(e.segments,c)}}function tx(e,t,n){const a=e.segments.slice(0,t);let c=0;for(;c<n.length;){const d=n[c];if(Jf(d)){const T=y2(d.outlets);return new sn(a,T)}if(0===c&&l_(n[0])){a.push(new Yf(e.segments[t].path,Xw(n[0]))),c++;continue}const y=Jf(d)?d.outlets[tn]:`${d}`,w=c<n.length-1?n[c+1]:null;y&&w&&l_(w)?(a.push(new Yf(y,Xw(w))),c+=2):(a.push(new Yf(y,{})),c++)}return new sn(a,{})}function y2(e){const t={};return Ci(e,(n,a)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[a]=tx(new sn([],{}),0,n))}),t}function Xw(e){const t={};return Ci(e,(n,a)=>t[a]=`${n}`),t}function Yw(e,t,n){return e==n.path&&Wa(t,n.parameters)}class x2{constructor(t,n,a,c){this.routeReuseStrategy=t,this.futureState=n,this.currState=a,this.forwardEvent=c}activate(t){const n=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,a,t),Kv(this.futureState.root),this.activateChildRoutes(n,a,t)}deactivateChildRoutes(t,n,a){const c=rp(n);t.children.forEach(d=>{const y=d.value.outlet;this.deactivateRoutes(d,c[y],a),delete c[y]}),Ci(c,(d,y)=>{this.deactivateRouteAndItsChildren(d,a)})}deactivateRoutes(t,n,a){const c=t.value,d=n?n.value:null;if(c===d)if(c.component){const y=a.getContext(c.outlet);y&&this.deactivateChildRoutes(t,n,y.children)}else this.deactivateChildRoutes(t,n,a);else d&&this.deactivateRouteAndItsChildren(n,a)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const a=n.getContext(t.value.outlet),c=a&&t.value.component?a.children:n,d=rp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],c);if(a&&a.outlet){const y=a.outlet.detach(),w=a.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:y,route:t,contexts:w})}}deactivateRouteAndOutlet(t,n){const a=n.getContext(t.value.outlet),c=a&&t.value.component?a.children:n,d=rp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],c);a&&a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated(),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(t,n,a){const c=rp(n);t.children.forEach(d=>{this.activateRoutes(d,c[d.value.outlet],a),this.forwardEvent(new UA(d.value.snapshot))}),t.children.length&&this.forwardEvent(new BA(t.value.snapshot))}activateRoutes(t,n,a){const c=t.value,d=n?n.value:null;if(Kv(c),c===d)if(c.component){const y=a.getOrCreateContext(c.outlet);this.activateChildRoutes(t,n,y.children)}else this.activateChildRoutes(t,n,a);else if(c.component){const y=a.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const w=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),Kv(w.route.value),this.activateChildRoutes(t,null,y.children)}else{const w=function b2(e){for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(c.snapshot),T=w?w.module.componentFactoryResolver:null;y.attachRef=null,y.route=c,y.resolver=T,y.outlet&&y.outlet.activateWith(c,T),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,a)}}class nx{constructor(t,n){this.routes=t,this.module=n}}function su(e){return"function"==typeof e}function yh(e){return e instanceof gh}const em=Symbol("INITIAL_VALUE");function tm(){return mh(e=>wA(e.map(t=>t.pipe(Dt(1),function TA(...e){const t=ot(e);return er((n,a)=>{(t?$v(e,n,t):$v(e,n)).subscribe(a)})}(em)))).pipe(vw((t,n)=>{let a=!1;return n.reduce((c,d,y)=>c!==em?c:(d===em&&(a=!0),a||!1!==d&&y!==n.length-1&&!yh(d)?c:d),t)},em),ep(t=>t!==em),an(t=>yh(t)?t:!0===t),Dt(1)))}class S2{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new nm,this.attachRef=null}}class nm{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const a=this.getOrCreateContext(t);a.outlet=n,this.contexts.set(t,a)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new S2,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let Kw=(()=>{class e{constructor(n,a,c,d,y){this.parentContexts=n,this.location=a,this.resolver=c,this.changeDetector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new ao,this.deactivateEvents=new ao,this.attachEvents=new ao,this.detachEvents=new ao,this.name=d||tn,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,a){this.activated=n,this._activatedRoute=a,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,a){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const y=(a=a||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,T=new I2(n,w,this.location.injector);this.activated=this.location.createComponent(y,this.location.length,T),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(gt(nm),gt(Qs),gt(Zd),function ka(e){return function Uh(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const a=n.length;let c=0;for(;c<a;){const d=n[c];if(lt(d))break;if(0===d)c+=2;else if("number"==typeof d)for(c++;c<a&&"string"==typeof n[c];)c++;else{if(d===t)return n[c+1];c+=2}}}return null}(Yn(),e)}("name"),gt(gv))},e.\u0275dir=fr({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class I2{constructor(t,n,a){this.route=t,this.childContexts=n,this.parent=a}get(t,n){return t===ip?this.route:t===nm?this.childContexts:this.parent.get(t,n)}}let Qw=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,a){1&n&&Wt(0,"router-outlet")},directives:[Kw],encapsulation:2}),e})();function Jw(e,t=""){for(let n=0;n<e.length;n++){const a=e[n];M2(a,A2(t,a))}}function M2(e,t){e.children&&Jw(e.children,t)}function A2(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function rx(e){const t=e.children&&e.children.map(rx),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==tn&&(n.component=Qw),n}function xs(e){return e.outlet||tn}function eE(e,t){const n=e.filter(a=>xs(a)===t);return n.push(...e.filter(a=>xs(a)!==t)),n}const tE={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function u_(e,t,n){var a;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},tE):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const d=(t.matcher||$A)(n,e,t);if(!d)return Object.assign({},tE);const y={};Ci(d.posParams,(T,P)=>{y[P]=T.path});const w=d.consumed.length>0?Object.assign(Object.assign({},y),d.consumed[d.consumed.length-1].parameters):y;return{matched:!0,consumedSegments:d.consumed,lastChild:d.consumed.length,parameters:w,positionalParamSegments:null!==(a=d.posParams)&&void 0!==a?a:{}}}function h_(e,t,n,a,c="corrected"){if(n.length>0&&function R2(e,t,n){return n.some(a=>d_(e,t,a)&&xs(a)!==tn)}(e,n,a)){const y=new sn(t,function k2(e,t,n,a){const c={};c[tn]=a,a._sourceSegment=e,a._segmentIndexShift=t.length;for(const d of n)if(""===d.path&&xs(d)!==tn){const y=new sn([],{});y._sourceSegment=e,y._segmentIndexShift=t.length,c[xs(d)]=y}return c}(e,t,a,new sn(n,e.children)));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function F2(e,t,n){return n.some(a=>d_(e,t,a))}(e,n,a)){const y=new sn(e.segments,function P2(e,t,n,a,c,d){const y={};for(const w of a)if(d_(e,n,w)&&!c[xs(w)]){const T=new sn([],{});T._sourceSegment=e,T._segmentIndexShift="legacy"===d?e.segments.length:t.length,y[xs(w)]=T}return Object.assign(Object.assign({},c),y)}(e,t,n,a,e.children,c));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:n}}const d=new sn(e.segments,e.children);return d._sourceSegment=e,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:n}}function d_(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function nE(e,t,n,a){return!!(xs(e)===a||a!==tn&&d_(t,n,e))&&("**"===e.path||u_(t,e,n).matched)}function rE(e,t,n){return 0===t.length&&!e.children[n]}class rm{constructor(t){this.segmentGroup=t||null}}class iE{constructor(t){this.urlTree=t}}function p_(e){return new xn(t=>t.error(new rm(e)))}function oE(e){return new xn(t=>t.error(new iE(e)))}function L2(e){return new xn(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class B2{constructor(t,n,a,c,d){this.configLoader=n,this.urlSerializer=a,this.urlTree=c,this.config=d,this.allowRedirects=!0,this.ngModule=t.get(Vl)}apply(){const t=h_(this.urlTree.root,[],[],this.config).segmentGroup,n=new sn(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,tn).pipe(an(d=>this.createUrlTree(ix(d),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ou(d=>{if(d instanceof iE)return this.allowRedirects=!1,this.match(d.urlTree);throw d instanceof rm?this.noMatchError(d):d}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,tn).pipe(an(c=>this.createUrlTree(ix(c),t.queryParams,t.fragment))).pipe(ou(c=>{throw c instanceof rm?this.noMatchError(c):c}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,a){const c=t.segments.length>0?new sn([],{[tn]:t}):t;return new gh(c,n,a)}expandSegmentGroup(t,n,a,c){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(t,n,a).pipe(an(d=>new sn([],d))):this.expandSegment(t,a,n,a.segments,c,!0)}expandChildren(t,n,a){const c=[];for(const d of Object.keys(a.children))"primary"===d?c.unshift(d):c.push(d);return je(c).pipe(Wf(d=>{const y=a.children[d],w=eE(n,d);return this.expandSegmentGroup(t,w,y,d).pipe(an(T=>({segment:T,outlet:d})))}),vw((d,y)=>(d[y.outlet]=y.segment,d),{}),function MA(e,t){const n=arguments.length>=2;return a=>a.pipe(e?ep((c,d)=>e(c,d,a)):Vi,Gv(1),n?bw(t):xw(()=>new t_))}())}expandSegment(t,n,a,c,d,y){return je(a).pipe(Wf(w=>this.expandSegmentAgainstRoute(t,n,a,w,c,d,y).pipe(ou(P=>{if(P instanceof rm)return jt(null);throw P}))),tp(w=>!!w),ou((w,T)=>{if(w instanceof t_||"EmptyError"===w.name){if(rE(n,c,d))return jt(new sn([],{}));throw new rm(n)}throw w}))}expandSegmentAgainstRoute(t,n,a,c,d,y,w){return nE(c,n,d,y)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(t,n,c,d,y):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,a,c,d,y):p_(n):p_(n)}expandSegmentAgainstRouteUsingRedirect(t,n,a,c,d,y){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,a,c,y):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,a,c,d,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,a,c){const d=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?oE(d):this.lineralizeSegments(a,d).pipe(se(y=>{const w=new sn(y,{});return this.expandSegment(t,w,n,y,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,a,c,d,y){const{matched:w,consumedSegments:T,lastChild:P,positionalParamSegments:O}=u_(n,c,d);if(!w)return p_(n);const V=this.applyRedirectCommands(T,c.redirectTo,O);return c.redirectTo.startsWith("/")?oE(V):this.lineralizeSegments(c,V).pipe(se(Q=>this.expandSegment(t,n,a,Q.concat(d.slice(P)),y,!1)))}matchSegmentAgainstRoute(t,n,a,c,d){if("**"===a.path)return a.loadChildren?(a._loadedConfig?jt(a._loadedConfig):this.configLoader.load(t.injector,a)).pipe(an(Q=>(a._loadedConfig=Q,new sn(c,{})))):jt(new sn(c,{}));const{matched:y,consumedSegments:w,lastChild:T}=u_(n,a,c);if(!y)return p_(n);const P=c.slice(T);return this.getChildConfig(t,a,c).pipe(se(V=>{const Q=V.module,ae=V.routes,{segmentGroup:ve,slicedSegments:Oe}=h_(n,w,P,ae),Ge=new sn(ve.segments,ve.children);if(0===Oe.length&&Ge.hasChildren())return this.expandChildren(Q,ae,Ge).pipe(an(It=>new sn(w,It)));if(0===ae.length&&0===Oe.length)return jt(new sn(w,{}));const Ye=xs(a)===d;return this.expandSegment(Q,Ge,ae,Oe,Ye?tn:d,!0).pipe(an(st=>new sn(w.concat(st.segments),st.children)))}))}getChildConfig(t,n,a){return n.children?jt(new nx(n.children,t)):n.loadChildren?void 0!==n._loadedConfig?jt(n._loadedConfig):this.runCanLoadGuards(t.injector,n,a).pipe(se(c=>c?this.configLoader.load(t.injector,n).pipe(an(d=>(n._loadedConfig=d,d))):function O2(e){return new xn(t=>t.error(Hv(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(n))):jt(new nx([],t))}runCanLoadGuards(t,n,a){const c=n.canLoad;return c&&0!==c.length?jt(c.map(y=>{const w=t.get(y);let T;if(function E2(e){return e&&su(e.canLoad)}(w))T=w.canLoad(n,a);else{if(!su(w))throw new Error("Invalid CanLoad guard");T=w(n,a)}return Xa(T)})).pipe(tm(),Uo(y=>{if(!yh(y))return;const w=Hv(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw w.url=y,w}),an(y=>!0===y)):jt(!0)}lineralizeSegments(t,n){let a=[],c=n.root;for(;;){if(a=a.concat(c.segments),0===c.numberOfChildren)return jt(a);if(c.numberOfChildren>1||!c.children[tn])return L2(t.redirectTo);c=c.children[tn]}}applyRedirectCommands(t,n,a){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,a)}applyRedirectCreatreUrlTree(t,n,a,c){const d=this.createSegmentGroup(t,n.root,a,c);return new gh(d,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const a={};return Ci(t,(c,d)=>{if("string"==typeof c&&c.startsWith(":")){const w=c.substring(1);a[d]=n[w]}else a[d]=c}),a}createSegmentGroup(t,n,a,c){const d=this.createSegments(t,n.segments,a,c);let y={};return Ci(n.children,(w,T)=>{y[T]=this.createSegmentGroup(t,w,a,c)}),new sn(d,y)}createSegments(t,n,a,c){return n.map(d=>d.path.startsWith(":")?this.findPosParam(t,d,c):this.findOrReturn(d,a))}findPosParam(t,n,a){const c=a[n.path.substring(1)];if(!c)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return c}findOrReturn(t,n){let a=0;for(const c of n){if(c.path===t.path)return n.splice(a),c;a++}return t}}function ix(e){const t={};for(const a of Object.keys(e.children)){const d=ix(e.children[a]);(d.segments.length>0||d.hasChildren())&&(t[a]=d)}return function N2(e){if(1===e.numberOfChildren&&e.children[tn]){const t=e.children[tn];return new sn(e.segments.concat(t.segments),t.children)}return e}(new sn(e.segments,t))}class sE{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class f_{constructor(t,n){this.component=t,this.route=n}}function V2(e,t,n){const a=e._root;return im(a,t?t._root:null,n,[a.value])}function m_(e,t,n){const a=function $2(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(a?a.module.injector:n).get(e)}function im(e,t,n,a,c={canDeactivateChecks:[],canActivateChecks:[]}){const d=rp(t);return e.children.forEach(y=>{(function G2(e,t,n,a,c={canDeactivateChecks:[],canActivateChecks:[]}){const d=e.value,y=t?t.value:null,w=n?n.getContext(e.value.outlet):null;if(y&&d.routeConfig===y.routeConfig){const T=function q2(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!_h(e.url,t.url);case"pathParamsOrQueryParamsChange":return!_h(e.url,t.url)||!Wa(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Qv(e,t)||!Wa(e.queryParams,t.queryParams);default:return!Qv(e,t)}}(y,d,d.routeConfig.runGuardsAndResolvers);T?c.canActivateChecks.push(new sE(a)):(d.data=y.data,d._resolvedData=y._resolvedData),im(e,t,d.component?w?w.children:null:n,a,c),T&&w&&w.outlet&&w.outlet.isActivated&&c.canDeactivateChecks.push(new f_(w.outlet.component,y))}else y&&om(t,w,c),c.canActivateChecks.push(new sE(a)),im(e,null,d.component?w?w.children:null:n,a,c)})(y,d[y.value.outlet],n,a.concat([y.value]),c),delete d[y.value.outlet]}),Ci(d,(y,w)=>om(y,n.getContext(w),c)),c}function om(e,t,n){const a=rp(e),c=e.value;Ci(a,(d,y)=>{om(d,c.component?t?t.children.getContext(y):null:t,n)}),n.canDeactivateChecks.push(new f_(c.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,c))}class eP{}function aE(e){return new xn(t=>t.error(e))}class nP{constructor(t,n,a,c,d,y){this.rootComponentType=t,this.config=n,this.urlTree=a,this.url=c,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=y}recognize(){const t=h_(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,tn);if(null===n)return null;const a=new a_([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},tn,this.rootComponentType,null,this.urlTree.root,-1,{}),c=new Hl(a,n),d=new Gw(this.url,c);return this.inheritParamsAndData(d._root),d}inheritParamsAndData(t){const n=t.value,a=$w(n,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),t.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(t,n,a){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,a)}processChildren(t,n){const a=[];for(const d of Object.keys(n.children)){const y=n.children[d],w=eE(t,d),T=this.processSegmentGroup(w,y,d);if(null===T)return null;a.push(...T)}const c=lE(a);return function rP(e){e.sort((t,n)=>t.value.outlet===tn?-1:n.value.outlet===tn?1:t.value.outlet.localeCompare(n.value.outlet))}(c),c}processSegment(t,n,a,c){for(const d of t){const y=this.processSegmentAgainstRoute(d,n,a,c);if(null!==y)return y}return rE(n,a,c)?[]:null}processSegmentAgainstRoute(t,n,a,c){if(t.redirectTo||!nE(t,n,a,c))return null;let d,y=[],w=[];if("**"===t.path){const ae=a.length>0?Mw(a).parameters:{};d=new a_(a,ae,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hE(t),xs(t),t.component,t,cE(n),uE(n)+a.length,dE(t))}else{const ae=u_(n,t,a);if(!ae.matched)return null;y=ae.consumedSegments,w=a.slice(ae.lastChild),d=new a_(y,ae.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hE(t),xs(t),t.component,t,cE(n),uE(n)+y.length,dE(t))}const T=function iP(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(t),{segmentGroup:P,slicedSegments:O}=h_(n,y,w,T.filter(ae=>void 0===ae.redirectTo),this.relativeLinkResolution);if(0===O.length&&P.hasChildren()){const ae=this.processChildren(T,P);return null===ae?null:[new Hl(d,ae)]}if(0===T.length&&0===O.length)return[new Hl(d,[])];const V=xs(t)===c,Q=this.processSegment(T,P,O,V?tn:c);return null===Q?null:[new Hl(d,Q)]}}function oP(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function lE(e){const t=[],n=new Set;for(const a of e){if(!oP(a)){t.push(a);continue}const c=t.find(d=>a.value.routeConfig===d.value.routeConfig);void 0!==c?(c.children.push(...a.children),n.add(c)):t.push(a)}for(const a of n){const c=lE(a.children);t.push(new Hl(a.value,c))}return t.filter(a=>!n.has(a))}function cE(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function uE(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function hE(e){return e.data||{}}function dE(e){return e.resolve||{}}function ox(e){return mh(t=>{const n=e(t);return n?je(n).pipe(an(()=>t)):jt(t)})}class pP extends class dP{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const sx=new cn("ROUTES");class pE{constructor(t,n,a,c){this.injector=t,this.compiler=n,this.onLoadStartListener=a,this.onLoadEndListener=c}load(t,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const c=this.loadModuleFactory(n.loadChildren).pipe(an(d=>{this.onLoadEndListener&&this.onLoadEndListener(n);const y=d.create(t);return new nx(Iw(y.injector.get(sx,void 0,bt.Self|bt.Optional)).map(rx),y)}),ou(d=>{throw n._loader$=void 0,d}));return n._loader$=new CA(c,()=>new ti).pipe(yw()),n._loader$}loadModuleFactory(t){return Xa(t()).pipe(se(n=>n instanceof R1?jt(n):je(this.compiler.compileModuleAsync(n))))}}class mP{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function gP(e){throw e}function _P(e,t,n){return t.parse("/")}function fE(e,t){return jt(null)}const yP={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},vP={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Vo=(()=>{class e{constructor(n,a,c,d,y,w,T){this.rootComponentType=n,this.urlSerializer=a,this.rootContexts=c,this.location=d,this.config=T,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new ti,this.errorHandler=gP,this.malformedUriErrorHandler=_P,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:fE,afterPreactivation:fE},this.urlHandlingStrategy=new mP,this.routeReuseStrategy=new pP,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=y.get(Vl),this.console=y.get(fb);const V=y.get(Kr);this.isNgZoneEnabled=V instanceof Kr&&Kr.isInAngularZone(),this.resetConfig(T),this.currentUrlTree=function qA(){return new gh(new sn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new pE(y,w,Q=>this.triggerEvent(new Ew(Q)),Q=>this.triggerEvent(new Dw(Q))),this.routerState=jw(this.currentUrlTree,this.rootComponentType),this.transitions=new na({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const a=this.events;return n.pipe(ep(c=>0!==c.id),an(c=>Object.assign(Object.assign({},c),{extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),mh(c=>{let d=!1,y=!1;return jt(c).pipe(Uo(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),mh(w=>{const T=this.browserUrlTree.toString(),P=!this.navigated||w.extractedUrl.toString()!==T||T!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||P)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return g_(w.source)&&(this.browserUrlTree=w.extractedUrl),jt(w).pipe(mh(V=>{const Q=this.transitions.getValue();return a.next(new qv(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),Q!==this.transitions.getValue()?fe:Promise.resolve(V)}),function U2(e,t,n,a){return mh(c=>function z2(e,t,n,a,c){return new B2(e,t,n,a,c).apply()}(e,t,n,c.extractedUrl,a).pipe(an(d=>Object.assign(Object.assign({},c),{urlAfterRedirects:d}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Uo(V=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:V.urlAfterRedirects})}),function sP(e,t,n,a,c){return se(d=>function tP(e,t,n,a,c="emptyOnly",d="legacy"){try{const y=new nP(e,t,n,a,c,d).recognize();return null===y?aE(new eP):jt(y)}catch(y){return aE(y)}}(e,t,d.urlAfterRedirects,n(d.urlAfterRedirects),a,c).pipe(an(y=>Object.assign(Object.assign({},d),{targetSnapshot:y}))))}(this.rootComponentType,this.config,V=>this.serializeUrl(V),this.paramsInheritanceStrategy,this.relativeLinkResolution),Uo(V=>{if("eager"===this.urlUpdateStrategy){if(!V.extras.skipLocationChange){const ae=this.urlHandlingStrategy.merge(V.urlAfterRedirects,V.rawUrl);this.setBrowserUrl(ae,V)}this.browserUrlTree=V.urlAfterRedirects}const Q=new kA(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);a.next(Q)}));if(P&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Q,extractedUrl:ae,source:ve,restoredState:Oe,extras:Ge}=w,Ye=new qv(Q,this.serializeUrl(ae),ve,Oe);a.next(Ye);const Re=jw(ae,this.rootComponentType).snapshot;return jt(Object.assign(Object.assign({},w),{targetSnapshot:Re,urlAfterRedirects:ae,extras:Object.assign(Object.assign({},Ge),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,w.resolve(null),fe}),ox(w=>{const{targetSnapshot:T,id:P,extractedUrl:O,rawUrl:V,extras:{skipLocationChange:Q,replaceUrl:ae}}=w;return this.hooks.beforePreactivation(T,{navigationId:P,appliedUrlTree:O,rawUrlTree:V,skipLocationChange:!!Q,replaceUrl:!!ae})}),Uo(w=>{const T=new RA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(T)}),an(w=>Object.assign(Object.assign({},w),{guards:V2(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function H2(e,t){return se(n=>{const{targetSnapshot:a,currentSnapshot:c,guards:{canActivateChecks:d,canDeactivateChecks:y}}=n;return 0===y.length&&0===d.length?jt(Object.assign(Object.assign({},n),{guardsResult:!0})):function Z2(e,t,n,a){return je(e).pipe(se(c=>function J2(e,t,n,a,c){const d=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return d&&0!==d.length?jt(d.map(w=>{const T=m_(w,t,c);let P;if(function T2(e){return e&&su(e.canDeactivate)}(T))P=Xa(T.canDeactivate(e,t,n,a));else{if(!su(T))throw new Error("Invalid CanDeactivate guard");P=Xa(T(e,t,n,a))}return P.pipe(tp())})).pipe(tm()):jt(!0)}(c.component,c.route,n,t,a)),tp(c=>!0!==c,!0))}(y,a,c,e).pipe(se(w=>w&&function w2(e){return"boolean"==typeof e}(w)?function W2(e,t,n,a){return je(t).pipe(Wf(c=>$v(function Y2(e,t){return null!==e&&t&&t(new zA(e)),jt(!0)}(c.route.parent,a),function X2(e,t){return null!==e&&t&&t(new NA(e)),jt(!0)}(c.route,a),function Q2(e,t,n){const a=t[t.length-1],d=t.slice(0,t.length-1).reverse().map(y=>function j2(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(y)).filter(y=>null!==y).map(y=>_w(()=>jt(y.guards.map(T=>{const P=m_(T,y.node,n);let O;if(function C2(e){return e&&su(e.canActivateChild)}(P))O=Xa(P.canActivateChild(a,e));else{if(!su(P))throw new Error("Invalid CanActivateChild guard");O=Xa(P(a,e))}return O.pipe(tp())})).pipe(tm())));return jt(d).pipe(tm())}(e,c.path,n),function K2(e,t,n){const a=t.routeConfig?t.routeConfig.canActivate:null;if(!a||0===a.length)return jt(!0);const c=a.map(d=>_w(()=>{const y=m_(d,t,n);let w;if(function D2(e){return e&&su(e.canActivate)}(y))w=Xa(y.canActivate(t,e));else{if(!su(y))throw new Error("Invalid CanActivate guard");w=Xa(y(t,e))}return w.pipe(tp())}));return jt(c).pipe(tm())}(e,c.route,n))),tp(c=>!0!==c,!0))}(a,d,e,t):jt(w)),an(w=>Object.assign(Object.assign({},n),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),Uo(w=>{if(yh(w.guardsResult)){const P=Hv(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw P.url=w.guardsResult,P}const T=new FA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(T)}),ep(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),ox(w=>{if(w.guards.canActivateChecks.length)return jt(w).pipe(Uo(T=>{const P=new LA(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(P)}),mh(T=>{let P=!1;return jt(T).pipe(function aP(e,t){return se(n=>{const{targetSnapshot:a,guards:{canActivateChecks:c}}=n;if(!c.length)return jt(n);let d=0;return je(c).pipe(Wf(y=>function lP(e,t,n,a){return function cP(e,t,n,a){const c=Object.keys(e);if(0===c.length)return jt({});const d={};return je(c).pipe(se(y=>function uP(e,t,n,a){const c=m_(e,t,a);return Xa(c.resolve?c.resolve(t,n):c(t,n))}(e[y],t,n,a).pipe(Uo(w=>{d[y]=w}))),Gv(1),se(()=>Object.keys(d).length===c.length?jt(d):fe))}(e._resolve,e,t,a).pipe(an(d=>(e._resolvedData=d,e.data=Object.assign(Object.assign({},e.data),$w(e,n).resolve),null)))}(y.route,a,e,t)),Uo(()=>d++),Gv(1),se(y=>d===c.length?jt(n):fe))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Uo({next:()=>P=!0,complete:()=>{P||(this.restoreHistory(T),this.cancelNavigationTransition(T,"At least one route resolver didn't emit any value."))}}))}),Uo(T=>{const P=new OA(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(P)}))}),ox(w=>{const{targetSnapshot:T,id:P,extractedUrl:O,rawUrl:V,extras:{skipLocationChange:Q,replaceUrl:ae}}=w;return this.hooks.afterPreactivation(T,{navigationId:P,appliedUrlTree:O,rawUrlTree:V,skipLocationChange:!!Q,replaceUrl:!!ae})}),an(w=>{const T=function c2(e,t,n){const a=Qf(e,t._root,n?n._root:void 0);return new Vw(a,t)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:T})}),Uo(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((e,t,n)=>an(a=>(new x2(t,a.targetRouterState,a.currentRouterState,n).activate(e),a)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),Uo({next(){d=!0},complete(){d=!0}}),function AA(e){return er((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var w;d||y||this.cancelNavigationTransition(c,`Navigation ID ${c.id} is not equal to the current navigation id ${this.navigationId}`),(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===c.id&&(this.currentNavigation=null)}),ou(w=>{if(y=!0,function jA(e){return e&&e[Tw]}(w)){const T=yh(w.url);T||(this.navigated=!0,this.restoreHistory(c,!0));const P=new ww(c.id,this.serializeUrl(c.extractedUrl),w.message);a.next(P),T?setTimeout(()=>{const O=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),V={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||g_(c.source)};this.scheduleNavigation(O,"imperative",null,V,{resolve:c.resolve,reject:c.reject,promise:c.promise})},0):c.resolve(!1)}else{this.restoreHistory(c,!0);const T=new PA(c.id,this.serializeUrl(c.extractedUrl),w);a.next(T);try{c.resolve(this.errorHandler(w))}catch(P){c.reject(P)}}return fe}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const a="popstate"===n.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{var c;const d={replaceUrl:!0},y=(null===(c=n.state)||void 0===c?void 0:c.navigationId)?n.state:null;if(y){const T=Object.assign({},y);delete T.navigationId,delete T.\u0275routerPageId,0!==Object.keys(T).length&&(d.state=T)}const w=this.parseUrl(n.url);this.scheduleNavigation(w,a,y,d)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){Jw(n),this.config=n.map(rx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,a={}){const{relativeTo:c,queryParams:d,fragment:y,queryParamsHandling:w,preserveFragment:T}=a,P=c||this.routerState.root,O=T?this.currentUrlTree.fragment:y;let V=null;switch(w){case"merge":V=Object.assign(Object.assign({},this.currentUrlTree.queryParams),d);break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=d||null}return null!==V&&(V=this.removeEmptyProps(V)),function d2(e,t,n,a,c){if(0===n.length)return Jv(t.root,t.root,t,a,c);const d=function p2(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Zw(!0,0,e);let t=0,n=!1;const a=e.reduce((c,d,y)=>{if("object"==typeof d&&null!=d){if(d.outlets){const w={};return Ci(d.outlets,(T,P)=>{w[P]="string"==typeof T?T.split("/"):T}),[...c,{outlets:w}]}if(d.segmentPath)return[...c,d.segmentPath]}return"string"!=typeof d?[...c,d]:0===y?(d.split("/").forEach((w,T)=>{0==T&&"."===w||(0==T&&""===w?n=!0:".."===w?t++:""!=w&&c.push(w))}),c):[...c,d]},[]);return new Zw(n,t,a)}(n);if(d.toRoot())return Jv(t.root,new sn([],{}),t,a,c);const y=function f2(e,t,n){if(e.isAbsolute)return new ex(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const d=n.snapshot._urlSegment;return new ex(d,d===t.root,0)}const a=l_(e.commands[0])?0:1;return function m2(e,t,n){let a=e,c=t,d=n;for(;d>c;){if(d-=c,a=a.parent,!a)throw new Error("Invalid number of '../'");c=a.segments.length}return new ex(a,!1,c-d)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+a,e.numberOfDoubleDots)}(d,t,e),w=y.processChildren?c_(y.segmentGroup,y.index,d.commands):Ww(y.segmentGroup,y.index,d.commands);return Jv(y.segmentGroup,w,t,a,c)}(P,this.currentUrlTree,n,V,null!=O?O:null)}navigateByUrl(n,a={skipLocationChange:!1}){const c=yh(n)?n:this.parseUrl(n),d=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(d,"imperative",null,a)}navigate(n,a={skipLocationChange:!1}){return function xP(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,a),a)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let a;try{a=this.urlSerializer.parse(n)}catch(c){a=this.malformedUriErrorHandler(c,this.urlSerializer,n)}return a}isActive(n,a){let c;if(c=!0===a?Object.assign({},yP):!1===a?Object.assign({},vP):a,yh(n))return Pw(this.currentUrlTree,n,c);const d=this.parseUrl(n);return Pw(this.currentUrlTree,d,c)}removeEmptyProps(n){return Object.keys(n).reduce((a,c)=>{const d=n[c];return null!=d&&(a[c]=d),a},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Xf(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,a,c,d,y){var w,T,P;if(this.disposed)return Promise.resolve(!1);const O=this.transitions.value,V=g_(a)&&O&&!g_(O.source),Q=O.rawUrl.toString()===n.toString(),ae=O.id===(null===(w=this.currentNavigation)||void 0===w?void 0:w.id);if(V&&Q&&ae)return Promise.resolve(!0);let Oe,Ge,Ye;y?(Oe=y.resolve,Ge=y.reject,Ye=y.promise):Ye=new Promise((It,dn)=>{Oe=It,Ge=dn});const Re=++this.navigationId;let st;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(c=this.location.getState()),st=c&&c.\u0275routerPageId?c.\u0275routerPageId:d.replaceUrl||d.skipLocationChange?null!==(T=this.browserPageId)&&void 0!==T?T:0:(null!==(P=this.browserPageId)&&void 0!==P?P:0)+1):st=0,this.setTransition({id:Re,targetPageId:st,source:a,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:d,resolve:Oe,reject:Ge,promise:Ye,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ye.catch(It=>Promise.reject(It))}setBrowserUrl(n,a){const c=this.urlSerializer.serialize(n),d=Object.assign(Object.assign({},a.extras.state),this.generateNgRouterState(a.id,a.targetPageId));this.location.isCurrentPathEqualTo(c)||a.extras.replaceUrl?this.location.replaceState(c,"",d):this.location.go(c,"",d)}restoreHistory(n,a=!1){var c,d;if("computed"===this.canceledNavigationResolution){const y=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)||0===y?this.currentUrlTree===(null===(d=this.currentNavigation)||void 0===d?void 0:d.finalUrl)&&0===y&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(y)}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,a){const c=new ww(n.id,this.serializeUrl(n.extractedUrl),a);this.triggerEvent(c),n.resolve(!1)}generateNgRouterState(n,a){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:a}:{navigationId:n}}}return e.\u0275fac=function(n){Py()},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();function g_(e){return"imperative"!==e}class mE{}class gE{preload(t,n){return jt(null)}}let _E=(()=>{class e{constructor(n,a,c,d){this.router=n,this.injector=c,this.preloadingStrategy=d,this.loader=new pE(c,a,T=>n.triggerEvent(new Ew(T)),T=>n.triggerEvent(new Dw(T)))}setUpPreloading(){this.subscription=this.router.events.pipe(ep(n=>n instanceof Xf),Wf(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Vl);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,a){const c=[];for(const d of a)if(d.loadChildren&&!d.canLoad&&d._loadedConfig){const y=d._loadedConfig;c.push(this.processRoutes(y.module,y.routes))}else d.loadChildren&&!d.canLoad?c.push(this.preloadConfig(n,d)):d.children&&c.push(this.processRoutes(n,d.children));return je(c).pipe(me(),an(d=>{}))}preloadConfig(n,a){return this.preloadingStrategy.preload(a,()=>(a._loadedConfig?jt(a._loadedConfig):this.loader.load(n.injector,a)).pipe(se(d=>(a._loadedConfig=d,this.processRoutes(d.module,d.routes)))))}}return e.\u0275fac=function(n){return new(n||e)(Ct(Vo),Ct(Bg),Ct(Un),Ct(mE))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})(),cx=(()=>{class e{constructor(n,a,c={}){this.router=n,this.viewportScroller=a,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof qv?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Xf&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Cw&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,a){this.router.triggerEvent(new Cw(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){Py()},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();const vh=new cn("ROUTER_CONFIGURATION"),yE=new cn("ROUTER_FORROOT_GUARD"),DP=[Ev,{provide:Lw,useClass:Ow},{provide:Vo,useFactory:function AP(e,t,n,a,c,d,y={},w,T){const P=new Vo(null,e,t,n,a,c,Iw(d));return w&&(P.urlHandlingStrategy=w),T&&(P.routeReuseStrategy=T),function PP(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(y,P),y.enableTracing&&P.events.subscribe(O=>{var V,Q;null===(V=console.group)||void 0===V||V.call(console,`Router Event: ${O.constructor.name}`),console.log(O.toString()),console.log(O),null===(Q=console.groupEnd)||void 0===Q||Q.call(console)}),P},deps:[Lw,nm,Ev,Un,Bg,sx,vh,[class fP{},new cs],[class hP{},new cs]]},nm,{provide:ip,useFactory:function kP(e){return e.routerState.root},deps:[Vo]},_E,gE,class EP{preload(t,n){return n().pipe(ou(()=>jt(null)))}},{provide:vh,useValue:{enableTracing:!1}}];function CP(){return new xb("Router",Vo)}let TP=(()=>{class e{constructor(n,a){}static forRoot(n,a){return{ngModule:e,providers:[DP,vE(n),{provide:yE,useFactory:MP,deps:[[Vo,new cs,new Al]]},{provide:vh,useValue:a||{}},{provide:Jd,useFactory:IP,deps:[fh,[new zu(wv),new cs],vh]},{provide:cx,useFactory:SP,deps:[Vo,SM,vh]},{provide:mE,useExisting:a&&a.preloadingStrategy?a.preloadingStrategy:gE},{provide:xb,multi:!0,useFactory:CP},[ux,{provide:zg,multi:!0,useFactory:RP,deps:[ux]},{provide:xE,useFactory:FP,deps:[ux]},{provide:pb,multi:!0,useExisting:xE}]]}}static forChild(n){return{ngModule:e,providers:[vE(n)]}}}return e.\u0275fac=function(n){return new(n||e)(Ct(yE,8),Ct(Vo,8))},e.\u0275mod=po({type:e}),e.\u0275inj=Qo({}),e})();function SP(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new cx(e,t,n)}function IP(e,t,n={}){return n.useHash?new oI(e,t):new jb(e,t)}function MP(e){return"guarded"}function vE(e){return[{provide:x_,multi:!0,useValue:e},{provide:sx,multi:!0,useValue:e}]}let ux=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new ti}appInitializer(){return this.injector.get(nI,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let a=null;const c=new Promise(w=>a=w),d=this.injector.get(Vo),y=this.injector.get(vh);return"disabled"===y.initialNavigation?(d.setUpLocationChangeListener(),a(!0)):"enabled"===y.initialNavigation||"enabledBlocking"===y.initialNavigation?(d.hooks.afterPreactivation=()=>this.initNavigation?jt(null):(this.initNavigation=!0,a(!0),this.resultOfPreactivationDone),d.initialNavigation()):a(!0),c})}bootstrapListener(n){const a=this.injector.get(vh),c=this.injector.get(_E),d=this.injector.get(cx),y=this.injector.get(Vo),w=this.injector.get(jf);n===w.components[0]&&(("enabledNonBlocking"===a.initialNavigation||void 0===a.initialNavigation)&&y.initialNavigation(),c.setUpPreloading(),d.init(),y.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(Ct(Un))},e.\u0275prov=Gt({token:e,factory:e.\u0275fac}),e})();function RP(e){return e.appInitializer.bind(e)}function FP(e){return e.bootstrapListener.bind(e)}const xE=new cn("Router Initializer");let OP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=po({type:e}),e.\u0275inj=Qo({imports:[TP]}),e})(),zP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-navbar"]],decls:17,vars:0,consts:[[1,"navbar","navbar-expand-sm","bg-dark","navbar-dark","py-3","fixed-top"],[1,"container"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navmenu",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navmenu",1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto"],[1,"nav-item"],["href","#learn",1,"nav-link"],["href","#questions",1,"nav-link"],["href","#instructors",1,"nav-link"]],template:function(n,a){1&n&&(Se(0,"nav",0),Se(1,"div",1),Se(2,"a",2),xt(3,"Front-end boootcamp"),Ie(),Se(4,"button",3),Wt(5,"span",4),Ie(),Se(6,"div",5),Se(7,"ul",6),Se(8,"li",7),Se(9,"a",8),xt(10,"What You Learn"),Ie(),Ie(),Se(11,"li",7),Se(12,"a",9),xt(13,"Questions"),Ie(),Ie(),Se(14,"li",7),Se(15,"a",10),xt(16,"Instructors"),Ie(),Ie(),Ie(),Ie(),Ie(),Ie())},styles:[""]}),e})(),BP=(()=>{class e{constructor(){}openModal(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-showcase"]],decls:13,vars:0,consts:[[1,"bg-dark","text-light","p-5","p-lg-0","pt-lg-5","text-center","text-sm-start"],[1,"container"],[1,"d-sm-flex","align-items-center","justify-content-between"],[1,"text-warning"],[1,"lead","my-4"],["data-bs-toggle","modal","data-bs-target","#enroll",1,"btn-primary","btn-lg",3,"click"],["src","../assets/developer.svg","alt","developer",1,"w-50","image-fluid"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"div",2),Se(3,"div"),Se(4,"h1"),xt(5," Become a "),Se(6,"span",3),xt(7," Web Developer"),Ie(),Ie(),Se(8,"p",4),xt(9," We focus on teaching our students the fundamentals of the largest and the greatest technology to prepare them for their first dev role "),Ie(),Se(10,"button",5),Pf("click",function(){return a.openModal()}),xt(11," Start the enrollment"),Ie(),Ie(),Wt(12,"img",6),Ie(),Ie(),Ie())},styles:[""]}),e})(),NP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-newsletter"]],decls:9,vars:0,consts:[[1,"bg-primary","text-light","p-5"],[1,"container"],[1,"row","justify-content-between","align-items-center","p-3"],[1,"col-md","mg-3","mb-md-0"],[1,"input-group","news-input","col-md"],["type","text","placeholder","Enter e-mail",1,"form-control"],["type","button",1,"btn","btn-dark","btn-lg"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"div",2),Se(3,"h3",3),xt(4," Sign up For Our newsLetter"),Ie(),Se(5,"div",4),Wt(6,"input",5),Se(7,"button",6),xt(8,"Button"),Ie(),Ie(),Ie(),Ie(),Ie())},styles:["@media (min-width:768px){.news-input[_ngcontent-%COMP%]{width:50%}}"]}),e})(),UP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-learn-sections"]],decls:15,vars:0,consts:[["id","learn",1,"p-5"],[1,"container"],[1,"row","align-items-center","justify-content-between"],[1,"col-md"],["src","../assets/js.svg","width","772px","height","547px","alt","js",1,"image-fluid"],[1,"col-md","p-5"],[1,"lead"],["href","#",1,"btn","btn-light","mt-3"],[1,"bi","bi-chevron-right"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"div",2),Se(3,"div",3),Wt(4,"img",4),Ie(),Se(5,"div",5),Se(6,"h2"),xt(7,"Learn the Fundamentals"),Ie(),Se(8,"p",6),xt(9,"Lorem ipsum dolor sit, amet consectetur adipisicing elit. Laboriosam sed ducimus commodi, necessitatibus, eligendi aspernatur earum magnam veritatis dolor ipsam aut. Fugit ex omnis voluptatum odio modi, nostrum quas molestias."),Ie(),Se(10,"p"),xt(11,"Lorem ipsum dolor, sit amet consectetur adipisicing elit. Consequuntur laudantium quo dicta, quas eveniet cupiditate unde harum dolor similique alias, soluta voluptatibus perspiciatis voluptate! Maiores quod ducimus ad veniam dolorum!"),Ie(),Se(12,"a",7),Wt(13,"i",8),xt(14,"Read More"),Ie(),Ie(),Ie(),Ie(),Ie())},styles:[""]}),e})(),VP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-learn-react-section"]],decls:15,vars:0,consts:[["id","learn",1,"p-5","bg-dark","text-light"],[1,"container"],[1,"row","align-items-center","justify-content-between"],[1,"col-md","p-5"],[1,"lead"],["href","#",1,"btn","btn-light","mt-3"],[1,"bi","bi-chevron-right"],[1,"col-md"],["src","../assets/react.svg","height","554px","width","548px","alt","developer",1,"image-fluid"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"div",2),Se(3,"div",3),Se(4,"h2"),xt(5,"Learn React"),Ie(),Se(6,"p",4),xt(7,"Lorem ipsum dolor sit, amet consectetur adipisicing elit. Laboriosam sed ducimus commodi, necessitatibus, eligendi aspernatur earum magnam veritatis dolor ipsam aut. Fugit ex omnis voluptatum odio modi, nostrum quas molestias."),Ie(),Se(8,"p"),xt(9,"Lorem ipsum dolor, sit amet consectetur adipisicing elit. Consequuntur laudantium quo dicta, quas eveniet cupiditate unde harum dolor similique alias, soluta voluptatibus perspiciatis voluptate! Maiores quod ducimus ad veniam dolorum!"),Ie(),Se(10,"a",5),Wt(11,"i",6),xt(12,"Read More"),Ie(),Ie(),Se(13,"div",7),Wt(14,"img",8),Ie(),Ie(),Ie(),Ie())},styles:[""]}),e})(),jP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-instructors"]],decls:71,vars:0,consts:[["id","instructors",1,"section","p-5","bg-primary"],[1,"container"],[1,"text-center","text-white"],[1,"lead","text-center","text-white","mb-5"],[1,"row","g-4"],[1,"col-md-6","col-lg-3"],[1,"card","bg-light"],[1,"card-body","text-center"],["src","https://randomuser.me/api/portraits/med/women/24.jpg","alt","",1,"rounded-circle","mb-3"],[1,"card-title","mb-3"],[1,"card-text"],["href","#"],[1,"bi","bi-twitter","text-dark","mx-1"],[1,"bi","bi-facebook","text-dark","mx-1"],[1,"bi","bi-linkedin","text-dark","mx-1"],[1,"bi","bi-instagram","text-dark","mx-1"],["src","https://randomuser.me/api/portraits/med/women/28.jpg","alt","",1,"rounded-circle","mb-3"],["src","https://randomuser.me/api/portraits/med/women/26.jpg","alt","",1,"rounded-circle","mb-3"],["src","https://randomuser.me/api/portraits/med/women/27.jpg","alt","",1,"rounded-circle","mb-3"]],template:function(n,a){1&n&&(Se(0,"div",0),Se(1,"div",1),Se(2,"h2",2),xt(3,"Our Instructors"),Ie(),Se(4,"p",3),xt(5,"Our instructors have 5+ years working as a web developer in the industry. "),Ie(),Se(6,"div",4),Se(7,"div",5),Se(8,"div",6),Se(9,"div",7),Wt(10,"img",8),Se(11,"h3",9),xt(12,"Kritika Daylan"),Ie(),Se(13,"p",10),xt(14,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum repellat nisi praesentium molestiae! Alias, sequi."),Ie(),Se(15,"a",11),Wt(16,"i",12),Ie(),Se(17,"a",11),Wt(18,"i",13),Ie(),Se(19,"a",11),Wt(20,"i",14),Ie(),Se(21,"a",11),Wt(22,"i",15),Ie(),Ie(),Ie(),Ie(),Se(23,"div",5),Se(24,"div",6),Se(25,"div",7),Wt(26,"img",16),Se(27,"h3",9),xt(28,"Nabilah Hussain"),Ie(),Se(29,"p",10),xt(30,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum repellat nisi praesentium molestiae! Alias, sequi."),Ie(),Se(31,"a",11),Wt(32,"i",12),Ie(),Se(33,"a",11),Wt(34,"i",13),Ie(),Se(35,"a",11),Wt(36,"i",14),Ie(),Se(37,"a",11),Wt(38,"i",15),Ie(),Ie(),Ie(),Ie(),Se(39,"div",5),Se(40,"div",6),Se(41,"div",7),Wt(42,"img",17),Se(43,"h3",9),xt(44,"Sara Joseph"),Ie(),Se(45,"p",10),xt(46,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum repellat nisi praesentium molestiae! Alias, sequi."),Ie(),Se(47,"a",11),Wt(48,"i",12),Ie(),Se(49,"a",11),Wt(50,"i",13),Ie(),Se(51,"a",11),Wt(52,"i",14),Ie(),Se(53,"a",11),Wt(54,"i",15),Ie(),Ie(),Ie(),Ie(),Se(55,"div",5),Se(56,"div",6),Se(57,"div",7),Wt(58,"img",18),Se(59,"h3",9),xt(60,"Ann Mathew"),Ie(),Se(61,"p",10),xt(62,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum repellat nisi praesentium molestiae! Alias, sequi."),Ie(),Se(63,"a",11),Wt(64,"i",12),Ie(),Se(65,"a",11),Wt(66,"i",13),Ie(),Se(67,"a",11),Wt(68,"i",14),Ie(),Se(69,"a",11),Wt(70,"i",15),Ie(),Ie(),Ie(),Ie(),Ie(),Ie(),Ie())},styles:[""]}),e})(),$P=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-question-accordion-section"]],decls:40,vars:0,consts:[["id","questions",1,"p-5"],[1,"container"],[1,"text-center","mb-4"],[1,"accordion","accordion-flush"],[1,"accordion-item"],[1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#question-one",1,"accordion-button","collapsed"],["id","question-one","data-bs-parent","#questions",1,"accordion-collapse","collapse"],[1,"accordion-body"],["type","button","data-bs-toggle","collapse","data-bs-target","#question-two",1,"accordion-button","collapsed"],["id","question-two","data-bs-parent","#questions",1,"accordion-collapse","collapse"],["type","button","data-bs-toggle","collapse","data-bs-target","#question-three",1,"accordion-button","collapsed"],["id","question-three","data-bs-parent","#questions",1,"accordion-collapse","collapse"],["type","button","data-bs-toggle","collapse","data-bs-target","#question-four",1,"accordion-button","collapsed"],["id","question-four","data-bs-parent","#questions",1,"accordion-collapse","collapse"],["type","button","data-bs-toggle","collapse","data-bs-target","#question-five",1,"accordion-button","collapsed"],["id","question-five","data-bs-parent","#questions",1,"accordion-collapse","collapse"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"h2",2),xt(3,"Frequently Asked Questions"),Ie(),Se(4,"div",3),Se(5,"div",4),Se(6,"h2",5),Se(7,"button",6),xt(8," Where exactly are you located? "),Ie(),Ie(),Se(9,"div",7),Se(10,"div",8),xt(11,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Hic repellendus nesciunt quis eos odit! Ad, soluta eligendi, modi accusamus quis quidem enim tenetur magnam ullam officia odio aliquid ex! Sed voluptatem explicabo cum dicta unde quisquam accusantium aperiam cupiditate deserunt eligendi sit porro nemo, laudantium corrupti mollitia, non temporibus qui?"),Ie(),Ie(),Ie(),Se(12,"div",4),Se(13,"h2",5),Se(14,"button",9),xt(15," What do I need to know? "),Ie(),Ie(),Se(16,"div",10),Se(17,"div",8),xt(18,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Hic repellendus nesciunt quis eos odit! Ad, soluta eligendi, modi accusamus quis quidem enim tenetur magnam ullam officia odio aliquid ex! Sed voluptatem explicabo cum dicta unde quisquam accusantium aperiam cupiditate deserunt eligendi sit porro nemo, laudantium corrupti mollitia, non temporibus qui?"),Ie(),Ie(),Ie(),Se(19,"div",4),Se(20,"h2",5),Se(21,"button",11),xt(22," How much does it cost to attend? "),Ie(),Ie(),Se(23,"div",12),Se(24,"div",8),xt(25,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Hic repellendus nesciunt quis eos odit! Ad, soluta eligendi, modi accusamus quis quidem enim tenetur magnam ullam officia odio aliquid ex! Sed voluptatem explicabo cum dicta unde quisquam accusantium aperiam cupiditate deserunt eligendi sit porro nemo, laudantium corrupti mollitia, non temporibus qui?"),Ie(),Ie(),Ie(),Se(26,"div",4),Se(27,"h2",5),Se(28,"button",13),xt(29," How do I sign up? "),Ie(),Ie(),Se(30,"div",14),Se(31,"div",8),xt(32,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Hic repellendus nesciunt quis eos odit! Ad, soluta eligendi, modi accusamus quis quidem enim tenetur magnam ullam officia odio aliquid ex! Sed voluptatem explicabo cum dicta unde quisquam accusantium aperiam cupiditate deserunt eligendi sit porro nemo, laudantium corrupti mollitia, non temporibus qui?"),Ie(),Ie(),Ie(),Se(33,"div",4),Se(34,"h2",5),Se(35,"button",15),xt(36," Will you help me find a job ? "),Ie(),Ie(),Se(37,"div",16),Se(38,"div",8),xt(39,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Hic repellendus nesciunt quis eos odit! Ad, soluta eligendi, modi accusamus quis quidem enim tenetur magnam ullam officia odio aliquid ex! Sed voluptatem explicabo cum dicta unde quisquam accusantium aperiam cupiditate deserunt eligendi sit porro nemo, laudantium corrupti mollitia, non temporibus qui?"),Ie(),Ie(),Ie(),Ie(),Ie(),Ie())},styles:[""]}),e})();var GP=Wl(898);let qP=(()=>{class e{ngOnInit(){new GP.Map({accessToken:"pk.eyJ1IjoidmFydGlrYWphaW4iLCJhIjoiY2t5bHlhZTU5Mmc3bTJvcXBqcnpwYW8yaiJ9.ORDu0BGAeZtzV7qqTezjUg",container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-71.060982,42.35725],zoom:18})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-contact-and-map"]],decls:29,vars:0,consts:[[1,"p-5"],[1,"container"],[1,"row","g-4"],[1,"col-md"],[1,"text-center","mb-4"],[1,"list-group-item"],[1,"fw-bold"],["id","map"]],template:function(n,a){1&n&&(Se(0,"section",0),Se(1,"div",1),Se(2,"div",2),Se(3,"div",3),Se(4,"h2",4),xt(5,"Contact Info"),Ie(),Se(6,"ul"),Se(7,"li",5),Se(8,"span",6),xt(9,"Main Location :"),Ie(),xt(10," 50 Main street Boston"),Ie(),Se(11,"li",5),Se(12,"span",6),xt(13,"Enrollemnt Phone :"),Ie(),xt(14," 084433-98-0998"),Ie(),Se(15,"li",5),Se(16,"span",6),xt(17,"Student Phone :"),Ie(),xt(18," 876-0988-099"),Ie(),Se(19,"li",5),Se(20,"span",6),xt(21,"Enrollement Email :"),Ie(),xt(22," enroll@gmail.com"),Ie(),Se(23,"li",5),Se(24,"span",6),xt(25,"Student Email :"),Ie(),xt(26," student@gmail.com"),Ie(),Ie(),Ie(),Se(27,"div",3),Wt(28,"div",7),Ie(),Ie(),Ie(),Ie())},styles:["#map[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}"]}),e})(),HP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-footer"]],decls:6,vars:0,consts:[[1,"p-5","bg-dark","text-white","text-center","position-relative"],[1,"container"],[1,"lead"],["href","",1,"position-absolute","bottom-0","end-0","p-5"],[1,"bi","bi-arrow-up-circle","h1"]],template:function(n,a){1&n&&(Se(0,"footer",0),Se(1,"div",1),Se(2,"p",2),xt(3,"Copyright \xa9 2021 Frontend bootcamp"),Ie(),Se(4,"a",3),Wt(5,"i",4),Ie(),Ie(),Ie())},styles:[""]}),e})(),ZP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=pr({type:e,selectors:[["app-root"]],decls:9,vars:0,template:function(n,a){1&n&&(Wt(0,"app-navbar"),Wt(1,"app-showcase"),Wt(2,"app-newsletter"),Wt(3,"app-learn-sections"),Wt(4,"app-learn-react-section"),Wt(5,"app-instructors"),Wt(6,"app-question-accordion-section"),Wt(7,"app-contact-and-map"),Wt(8,"app-footer"))},directives:[zP,BP,NP,UP,VP,jP,$P,qP,HP],styles:[""]}),e})(),WP=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=po({type:e,bootstrap:[ZP]}),e.\u0275inj=Qo({providers:[],imports:[[tA,OP]]}),e})();(function SS(){Tb=!1})(),JM().bootstrapModule(WP).catch(e=>console.error(e))},898:function(sp){sp.exports=function(){"use strict";var Zl,Wl,Rn;function au(p,Vn){if(Zl)if(Wl){var yo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Zl+")(sharedChunk); ("+Wl+")(sharedChunk); self.onerror = null;",Jr={};Zl(Jr),Rn=Vn(Jr),"undefined"!=typeof window&&(Rn.workerUrl=window.URL.createObjectURL(new Blob([yo],{type:"text/javascript"})))}else Wl=Vn;else Zl=Vn}return au(0,function(p){var yo=Jr;function Jr(o,r,s,l){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=s,this.p2y=l}Jr.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Jr.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Jr.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Jr.prototype.solveCurveX=function(o,r){var s,l,h,m,_;for(void 0===r&&(r=1e-6),h=o,_=0;_<8;_++){if(m=this.sampleCurveX(h)-o,Math.abs(m)<r)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=m/b}if((h=o)<(s=0))return s;if(h>(l=1))return l;for(;s<l;){if(m=this.sampleCurveX(h),Math.abs(m-o)<r)return h;o>m?s=h:l=h,h=.5*(l-s)+s}return h},Jr.prototype.solve=function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))};var ze=Fe;function Fe(o,r){this.x=o,this.y=r}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,s=o.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),s=Math.sin(o),l=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=l,this},_rotateAround:function(o,r){var s=Math.cos(o),l=Math.sin(o),h=r.y+l*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-l*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(o){return o instanceof Fe?o:Array.isArray(o)?new Fe(o[0],o[1]):o};var at="undefined"!=typeof self?self:{};const Ni=Math.pow(2,53)-1,$o=Math.PI/180,ra=180/Math.PI;function vn(o){return o*$o}function ei(o){return o*ra}const ia=[[0,0],[1,0],[1,1],[0,1]];function Ti(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,s=r*o;return 4*(o<.5?s:3*(o-r)+s-.75)}function Ui(o,r,s,l){const h=new yo(o,r,s,l);return function(m){return h.solve(m)}}const vo=Ui(.25,.1,.25,1);function Kt(o,r,s){return Math.min(s,Math.max(r,o))}function xo(o,r,s){const l=s-r,h=((o-r)%l+l)%l+r;return h===r?s:h}function Go(o,r,s){if(!o.length)return s(null,[]);let l=o.length;const h=new Array(o.length);let m=null;o.forEach((_,b)=>{r(_,(E,C)=>{E&&(m=E),h[b]=C,0==--l&&s(m,h)})})}function bs(o){const r=[];for(const s in o)r.push(o[s]);return r}function zn(o,...r){for(const s of r)for(const l in s)o[l]=s[l];return o}let lu=1;function bo(){return lu++}function Vi(){return function o(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Xl(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function oa(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function xn(o,r){o.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function qo(o,r){return-1!==o.indexOf(r,o.length-r.length)}function wo(o,r,s){const l={};for(const h in o)l[h]=r.call(s||this,o[h],h,o);return l}function co(o,r,s){const l={};for(const h in o)r.call(s||this,o[h],h,o)&&(l[h]=o[h]);return l}function dr(o){return Array.isArray(o)?o.map(dr):"object"==typeof o&&o?wo(o,dr):o}const ti={};function Pn(o){ti[o]||("undefined"!=typeof console&&console.warn(o),ti[o]=!0)}function di(o,r,s){return(s.y-o.y)*(r.x-o.x)>(r.y-o.y)*(s.x-o.x)}function er(o){let r=0;for(let s,l,h=0,m=o.length,_=m-1;h<m;_=h++)s=o[h],l=o[_],r+=(l.x-s.x)*(s.y+l.y);return r}function En(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function an(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,m)=>{const _=h||m;return r[l]=!_||_.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let Ho,Xt,ws,Ya=null;function Yl(o){if(null==Ya){const r=o.navigator?o.navigator.userAgent:null;Ya=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ya}function sa(o){try{const r=at[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const Si={now:()=>void 0!==ws?ws:at.performance.now(),setNow(o){ws=o},restoreNow(){ws=void 0},frame(o){const r=at.requestAnimationFrame(o);return{cancel:()=>at.cancelAnimationFrame(r)}},getImageData(o,r=0){const s=at.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=o.width,s.height=o.height,l.drawImage(o,0,0,o.width,o.height),l.getImageData(-r,-r,o.width+2*r,o.height+2*r)},resolveURL:o=>(Ho||(Ho=at.document.createElement("a")),Ho.href=o,Ho.href),get devicePixelRatio(){return at.devicePixelRatio},get prefersReducedMotion(){return!!at.matchMedia&&(null==Xt&&(Xt=at.matchMedia("(prefers-reduced-motion: reduce)")),Xt.matches)}};let aa;const zt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==aa){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{aa=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(r){aa=o}}return aa},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Zo={supported:!1,testSupport:function(o){!Ka&&ji&&(Ds?Qa(o):Es=o)}};let Es,ji,Ka=!1,Ds=!1;function Qa(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,ji),o.isContextLost())return;Zo.supported=!0}catch(s){}o.deleteTexture(r),Ka=!0}at.document&&(ji=at.document.createElement("img"),ji.onload=function(){Es&&Qa(Es),Es=null,Ds=!0},ji.onerror=function(){Ka=!0,Es=null},ji.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ja="01",Ii="NO_ACCESS_TOKEN";function Mi(o){return 0===o.indexOf("mapbox:")}function Cs(o){return zt.API_URL_REGEX.test(o)}const Kl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $i(o){const r=o.match(Kl);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Br(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}function cu(o){if(!o)return null;const r=o.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(at.atob(r[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class el{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const s=cu(zt.ACCESS_TOKEN);let l="";return l=s&&s.u?at.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):zt.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const r=sa("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(r)try{const h=at.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const m=at.localStorage.getItem(l);m&&(this.anonId=m)}catch(h){Pn("Unable to read from LocalStorage")}}saveEventData(){const r=sa("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(r)try{at.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&at.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(h){Pn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,s,l,h){if(!zt.EVENTS_URL)return;const m=$i(zt.EVENTS_URL);m.params.push(`access_token=${h||zt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:Ja,userId:this.anonId},b=s?zn(_,s):_,E={url:Br(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=W(E,C=>{this.pendingRequest=null,l(C),this.saveEventData(),this.processRequests(h)})}queueRequest(r,s){this.queue.push(r),this.processRequests(s)}}const Ql=new class extends el{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){zt.EVENTS_URL&&zt.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Mi(s)||Cs(s))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=cu(zt.ACCESS_TOKEN),s=r?r.u:zt.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;oa(this.anonId)||(this.anonId=Vi(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),b=(h-this.eventData.lastSuccess)/864e5;l=l||b>=1||b<-1||m.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},o)}},Jl=Ql.postTurnstileEvent.bind(Ql),Ts=new class extends el{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,s,l){this.skuToken=r,this.errorCb=l,zt.EVENTS_URL&&(s||zt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ii)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),oa(this.anonId)||(this.anonId=Vi()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):r&&(this.success[r]=!0)},o))}},ec=Ts.postMapLoadEvent.bind(Ts),tl=new class extends el{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,s,l){if(!zt.API_URL||!zt.SESSION_PATH)return;const h=$i(zt.API_URL+zt.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${l||zt.ACCESS_TOKEN||""}`);const m={url:Br(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ne(m,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(o,r,s,l){this.skuToken=r,this.errorCb=l,zt.SESSION_PATH&&zt.API_URL&&(s||zt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ii)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):r&&(this.success[r]=!0)},o)}},nl=tl.getSessionAPI.bind(tl),Eo=new Set,rl="mapbox-tiles";let pi,Wo,il=500,Xo=50;function br(){at.caches&&!pi&&(pi=at.caches.open(rl))}function la(o){const r=o.indexOf("?");return r<0?o:o.slice(0,r)}let ol=1/0;const Ss={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ss);class Is extends Error{constructor(r,s,l){401===s&&Cs(l)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Y=En()?()=>self.worker&&self.worker.referrer:()=>("blob:"===at.location.protocol?at.parent:at).location.href,z=function(o,r){if(!(/^file:/.test(s=o.url)||/^file:/.test(Y())&&!/^\w+:/.test(s))){if(at.fetch&&at.Request&&at.AbortController&&at.Request.prototype.hasOwnProperty("signal"))return function(l,h){const m=new at.AbortController,_=new at.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Y(),signal:m.signal});let b=!1,E=!1;const C=(I=_.url).indexOf("sku=")>0&&Cs(I);var I;"json"===l.type&&_.headers.set("Accept","application/json");const M=(B,N,$)=>{if(E)return;if(B&&"SecurityError"!==B.message&&Pn(B),N&&$)return k(N);const K=Date.now();at.fetch(_).then(te=>{if(te.ok){const oe=C?te.clone():null;return k(te,oe,K)}return h(new Is(te.statusText,te.status,l.url))}).catch(te=>{20!==te.code&&h(new Error(te.message))})},k=(B,N,$)=>{("arrayBuffer"===l.type?B.arrayBuffer():"json"===l.type?B.json():B.text()).then(K=>{E||(N&&$&&function(te,oe,ue){if(br(),!pi)return;const pe={status:oe.status,statusText:oe.statusText,headers:new at.Headers};oe.headers.forEach((ge,Me)=>pe.headers.set(Me,ge));const he=an(oe.headers.get("Cache-Control")||"");he["no-store"]||(he["max-age"]&&pe.headers.set("Expires",new Date(ue+1e3*he["max-age"]).toUTCString()),new Date(pe.headers.get("Expires")).getTime()-ue<42e4||function(ge,Me){if(void 0===Wo)try{new Response(new ReadableStream),Wo=!0}catch(we){Wo=!1}Wo?Me(ge.body):ge.blob().then(Me)}(oe,ge=>{const Me=new at.Response(ge,pe);br(),pi&&pi.then(we=>we.put(la(te.url),Me)).catch(we=>Pn(we.message))}))}(_,N,$),b=!0,h(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(K=>{E||h(new Error(K.message))})};return C?function(B,N){if(br(),!pi)return N(null);const $=la(B.url);pi.then(K=>{K.match($).then(te=>{const oe=function(ue){if(!ue)return!1;const pe=new Date(ue.headers.get("Expires")||0),he=an(ue.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(te);K.delete($),oe&&K.put($,te.clone()),N(null,te,oe)}).catch(N)}).catch(N)}(_,M):M(null,null),{cancel:()=>{E=!0,b||m.abort()}}}(o,r);if(En()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var s;return function(l,h){const m=new at.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===l.type)try{_=JSON.parse(m.response)}catch(b){return h(b)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new Is(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(o,r)},U=function(o,r){return z(zn(o,{type:"arrayBuffer"}),r)},W=function(o,r){return z(zn(o,{method:"POST"}),r)},ne=function(o,r){return z(zn(o,{method:"GET"}),r)};function se(o){const r=at.document.createElement("a");return r.href=o,r.protocol===at.document.location.protocol&&r.host===at.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fe,ce;fe=[],ce=0;const _e=function(o,r){if(Zo.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ce>=zt.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return fe.push(m),m}ce++;let s=!1;const l=()=>{if(!s)for(s=!0,ce--;fe.length&&ce<zt.MAX_PARALLEL_IMAGE_REQUESTS;){const m=fe.shift(),{requestParameters:_,callback:b,cancelled:E}=m;E||(m.cancel=_e(_,b).cancel)}},h=U(o,(m,_,b,E)=>{l(),m?r(m):_&&(at.createImageBitmap?function(C,I){const M=new at.Blob([new Uint8Array(C)],{type:"image/png"});at.createImageBitmap(M).then(k=>{I(null,k)}).catch(k=>{I(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(C,I)=>r(C,I,b,E)):function(C,I){const M=new at.Image,k=at.URL;M.onload=()=>{I(null,M),k.revokeObjectURL(M.src),M.onload=null,at.requestAnimationFrame(()=>{M.src=me})},M.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new at.Blob([new Uint8Array(C)],{type:"image/png"});M.src=C.byteLength?k.createObjectURL(B):me}(_,(C,I)=>r(C,I,b,E)))});return{cancel:()=>{h.cancel(),l()}}};function Pe(o,r,s){s[o]&&-1!==s[o].indexOf(r)||(s[o]=s[o]||[],s[o].push(r))}function We(o,r,s){if(s&&s[o]){const l=s[o].indexOf(r);-1!==l&&s[o].splice(l,1)}}class Le{constructor(r,s={}){zn(this,s),this.type=r}}class ot extends Le{constructor(r,s={}){super("error",zn({error:r},s))}}class Ze{on(r,s){return this._listeners=this._listeners||{},Pe(r,s,this._listeners),this}off(r,s){return We(r,s,this._listeners),We(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(r,s,this._oneTimeListeners),this):new Promise(l=>this.once(r,l))}fire(r,s){"string"==typeof r&&(r=new Le(r,s||{}));const l=r.type;if(this.listens(l)){r.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of h)b.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of m)We(l,b,this._oneTimeListeners),b.call(this,r);const _=this._eventedParent;_&&(zn(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof ot&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var de=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class De{constructor(r,s,l,h){this.message=(r?`${r}: `:"")+l,h&&(this.identifier=h),null!=s&&s.__line__&&(this.line=s.__line__)}}function Ft(o){const r=o.value;return r?[new De(o.key,r,"constants have been deprecated as of v8")]:[]}function nn(o,...r){for(const s of r)for(const l in s)o[l]=s[l];return o}function _t(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Bt(o){if(Array.isArray(o))return o.map(Bt);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const s in o)r[s]=Bt(o[s]);return r}return _t(o)}class $t extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class Ms{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(r){return new Ms(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const uo={kind:"null"},je={kind:"number"},Pt={kind:"string"},Dt={kind:"boolean"},Zn={kind:"color"},Do={kind:"object"},rt={kind:"value"},ca={kind:"collator"},Qt={kind:"formatted"},Yo={kind:"resolvedImage"};function fi(o,r){return{kind:"array",itemType:o,N:r}}function Dn(o){if("array"===o.kind){const r=Dn(o.itemType);return"number"==typeof o.N?`array<${r}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${r}>`}return o.kind}const Mt=[uo,je,Pt,Dt,Zn,Qt,Do,fi(rt),Yo];function Co(o,r){if("error"===r.kind)return null;if("array"===o.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Co(o.itemType,r.itemType))&&("number"!=typeof o.N||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if("value"===o.kind)for(const s of Mt)if(!Co(s,r))return null}return`Expected ${Dn(o)} but found ${Dn(r)} instead.`}function bh(o,r){return r.some(s=>s.kind===o.kind)}function kt(o,r){return r.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}function ua(o){var r={exports:{}};return o(r,r.exports),r.exports}var ht=ua(function(o,r){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(b){return(b=Math.round(b))<0?0:b>255?255:b}function h(b){return l("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function m(b){return(E="%"===b[b.length-1]?parseFloat(b)/100:parseFloat(b))<0?0:E>1?1:E;var E}function _(b,E,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?b+(E-b)*C*6:2*C<1?E:3*C<2?b+(E-b)*(2/3-C)*6:b}try{r.parseCSSColor=function(b){var E,C=b.replace(/ /g,"").toLowerCase();if(C in s)return s[C].slice();if("#"===C[0])return 4===C.length?(E=parseInt(C.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===C.length&&(E=parseInt(C.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var I=C.indexOf("("),M=C.indexOf(")");if(-1!==I&&M+1===C.length){var k=C.substr(0,I),B=C.substr(I+1,M-(I+1)).split(","),N=1;switch(k){case"rgba":if(4!==B.length)return null;N=m(B.pop());case"rgb":return 3!==B.length?null:[h(B[0]),h(B[1]),h(B[2]),N];case"hsla":if(4!==B.length)return null;N=m(B.pop());case"hsl":if(3!==B.length)return null;var $=(parseFloat(B[0])%360+360)%360/360,K=m(B[1]),te=m(B[2]),oe=te<=.5?te*(K+1):te+K-te*K,ue=2*te-oe;return[l(255*_(ue,oe,$+1/3)),l(255*_(ue,oe,$)),l(255*_(ue,oe,$-1/3)),N];default:return null}}return null}}catch(b){}});class yt{constructor(r,s,l,h=1){this.r=r,this.g=s,this.b=l,this.a=h}static parse(r){if(!r)return;if(r instanceof yt)return r;if("string"!=typeof r)return;const s=ht.parseCSSColor(r);return s?new yt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[r,s,l,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(l)},${h})`}toArray(){const{r,g:s,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*s/h,255*l/h,h]}}yt.black=new yt(0,0,0,1),yt.white=new yt(1,1,1,1),yt.transparent=new yt(0,0,0,0),yt.red=new yt(1,0,0,1),yt.blue=new yt(0,0,1,1);class tc{constructor(r,s,l){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ha{constructor(r,s,l,h,m){this.text=r,this.image=s,this.scale=l,this.fontStack=h,this.textColor=m}}class Nr{constructor(r){this.sections=r}static fromString(r){return new Nr([new ha(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Nr?r:Nr.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.name]);continue}r.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),r.push(l)}return r}}class Ur{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ur({name:r,available:!1}):null}serialize(){return["image",this.name]}}function ni(o,r,s,l){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[o,r,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[o,r,s,l]:[o,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uu(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof yt||o instanceof tc||o instanceof Nr||o instanceof Ur)return!0;if(Array.isArray(o)){for(const r of o)if(!uu(r))return!1;return!0}if("object"==typeof o){for(const r in o)if(!uu(o[r]))return!1;return!0}return!1}function Wn(o){if(null===o)return uo;if("string"==typeof o)return Pt;if("boolean"==typeof o)return Dt;if("number"==typeof o)return je;if(o instanceof yt)return Zn;if(o instanceof tc)return ca;if(o instanceof Nr)return Qt;if(o instanceof Ur)return Yo;if(Array.isArray(o)){const r=o.length;let s;for(const l of o){const h=Wn(l);if(s){if(s===h)continue;s=rt;break}s=h}return fi(s||rt,r)}return Do}function da(o){const r=typeof o;return null===o?"":"string"===r||"number"===r||"boolean"===r?String(o):o instanceof yt||o instanceof Nr||o instanceof Ur?o.toString():JSON.stringify(o)}class Vr{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(2!==r.length)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!uu(r[1]))return s.error("invalid value");const l=r[1];let h=Wn(l);const m=s.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Vr(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof yt?["rgba"].concat(this.value.toArray()):this.value instanceof Nr?this.value.serialize():this.value}}class sr{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const wh={string:Pt,number:je,boolean:Dt,object:Do};class ho{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let l,h=1;const m=r[0];if("array"===m){let b,E;if(r.length>2){const C=r[1];if("string"!=typeof C||!(C in wh)||"object"===C)return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=wh[C],h++}else b=rt;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],h++}l=fi(b,E)}else l=wh[m];const _=[];for(;h<r.length;h++){const b=s.parse(r[h],h,rt);if(!b)return null;_.push(b)}return new ho(l,_)}evaluate(r){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(r);if(!Co(this.type,Wn(l)))return l;if(s===this.args.length-1)throw new sr(`Expected value to be of type ${Dn(this.type)}, but found ${Dn(Wn(l))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if("array"===r.kind){const l=r.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class nc{constructor(r){this.type=Qt,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const l=r[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=r.length-1;++_){const b=r[_];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let E=null;if(b["font-scale"]&&(E=s.parse(b["font-scale"],1,je),!E))return null;let C=null;if(b["text-font"]&&(C=s.parse(b["text-font"],1,fi(Pt)),!C))return null;let I=null;if(b["text-color"]&&(I=s.parse(b["text-color"],1,Zn),!I))return null;const M=h[h.length-1];M.scale=E,M.font=C,M.textColor=I}else{const E=s.parse(r[_],1,rt);if(!E)return null;const C=E.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new nc(h)}evaluate(r){return new Nr(this.sections.map(s=>{const l=s.content.evaluate(r);return Wn(l)===Yo?new ha("",l,null,null,null):new ha(da(l),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),r.push(l)}return r}}class rc{constructor(r){this.type=Yo,this.input=r}static parse(r,s){if(2!==r.length)return s.error("Expected two arguments.");const l=s.parse(r[1],1,Pt);return l?new rc(l):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),l=Ur.fromString(s);return l&&r.availableImages&&(l.available=r.availableImages.indexOf(s)>-1),l}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sm={"to-boolean":Dt,"to-color":Zn,"to-number":je,"to-string":Pt};class Ko{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const l=r[0];if(("to-boolean"===l||"to-string"===l)&&2!==r.length)return s.error("Expected one argument.");const h=sm[l],m=[];for(let _=1;_<r.length;_++){const b=s.parse(r[_],_,rt);if(!b)return null;m.push(b)}return new Ko(h,m)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let s,l;for(const h of this.args){if(s=h.evaluate(r),l=null,s instanceof yt)return s;if("string"==typeof s){const m=r.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ni(s[0],s[1],s[2],s[3]),!l))return new yt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new sr(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(r),null===s)return 0;const h=Number(s);if(!isNaN(h))return h}throw new sr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Nr.fromString(da(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Ur.fromString(da(this.args[0].evaluate(r))):da(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new nc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new rc(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const am=["Unknown","Point","LineString","Polygon"];class jr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?am[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-r[0])+this.featureDistanceData.bearing[1]*(h*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=yt.parse(r)),s}}class Lt{constructor(r,s,l,h){this.name=r,this.type=s,this._evaluate=l,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const l=r[0],h=Lt.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=_.filter(([C])=>!Array.isArray(C)||C.length===r.length-1);let E=null;for(const[C,I]of b){E=new ii(s.registry,s.path,null,s.scope);const M=[];let k=!1;for(let B=1;B<r.length;B++){const N=r[B],$=Array.isArray(C)?C[B-1]:C.type,K=E.parse(N,1+M.length,$);if(!K){k=!0;break}M.push(K)}if(!k)if(Array.isArray(C)&&C.length!==M.length)E.error(`Expected ${C.length} arguments, but found ${M.length} instead.`);else{for(let B=0;B<M.length;B++){const N=Array.isArray(C)?C[B]:C.type,$=M[B];E.concat(B+1).checkSubtype(N,$.type)}if(0===E.errors.length)return new Lt(l,m,I,M)}}if(1===b.length)s.errors.push(...E.errors);else{const C=(b.length?b:_).map(([M])=>{return k=M,Array.isArray(k)?`(${k.map(Dn).join(", ")})`:`(${Dn(k.type)}...)`;var k}).join(" | "),I=[];for(let M=1;M<r.length;M++){const k=s.parse(r[M],1+I.length);if(!k)return null;I.push(Dn(k.type))}s.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(r,s){Lt.definitions=s;for(const l in s)r[l]=Lt}}class hu{constructor(r,s,l){this.type=ca,this.locale=l,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(2!==r.length)return s.error("Expected one argument.");const l=r[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,Dt);if(!h)return null;const m=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,Dt);if(!m)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,Pt),!_)?null:new hu(h,m,_)}evaluate(r){return new tc(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const As=8192;function Eh(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Gt(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function lm(o,r){const s=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(s*h*As),Math.round(l*h*As)]}function Qo(o,r,s){const l=o[0]-r[0],h=o[1]-r[1],m=o[0]-s[0],_=o[1]-s[1];return l*_-m*h==0&&l*m<=0&&h*_<=0}function pa(o,r){let s=!1;for(let _=0,b=r.length;_<b;_++){const E=r[_];for(let C=0,I=E.length;C<I-1;C++){if(Qo(o,E[C],E[C+1]))return!1;(h=E[C])[1]>(l=o)[1]!=(m=E[C+1])[1]>l[1]&&l[0]<(m[0]-h[0])*(l[1]-h[1])/(m[1]-h[1])+h[0]&&(s=!s)}}var l,h,m;return s}function sl(o,r){for(let s=0;s<r.length;s++)if(pa(o,r[s]))return!0;return!1}function Dh(o,r,s,l){const h=l[0]-s[0],m=l[1]-s[1],_=(o[0]-s[0])*m-h*(o[1]-s[1]),b=(r[0]-s[0])*m-h*(r[1]-s[1]);return _>0&&b<0||_<0&&b>0}function lp(o,r,s){for(const C of s)for(let I=0;I<C.length-1;++I)if((b=[(_=C[I+1])[0]-(m=C[I])[0],_[1]-m[1]])[0]*(E=[(h=r)[0]-(l=o)[0],h[1]-l[1]])[1]-b[1]*E[0]!=0&&Dh(l,h,m,_)&&Dh(m,_,l,h))return!0;var l,h,m,_,b,E;return!1}function du(o,r){for(let s=0;s<o.length;++s)if(!pa(o[s],r))return!1;for(let s=0;s<o.length-1;++s)if(lp(o[s],o[s+1],r))return!1;return!0}function ic(o,r){for(let s=0;s<r.length;s++)if(du(o,r[s]))return!0;return!1}function ri(o,r,s){const l=[];for(let h=0;h<o.length;h++){const m=[];for(let _=0;_<o[h].length;_++){const b=lm(o[h][_],s);Eh(r,b),m.push(b)}l.push(m)}return l}function oc(o,r,s){const l=[];for(let h=0;h<o.length;h++){const m=ri(o[h],r,s);l.push(m)}return l}function pu(o,r,s,l){if(o[0]<s[0]||o[0]>s[2]){const h=.5*l;let m=o[0]-s[0]>h?-l:s[0]-o[0]>h?l:0;0===m&&(m=o[0]-s[2]>h?-l:s[2]-o[0]>h?l:0),o[0]+=m}Eh(r,o)}function bt(o,r,s,l){const h=Math.pow(2,l.z)*As,m=[l.x*As,l.y*As],_=[];for(const b of o)for(const E of b){const C=[E.x+m[0],E.y+m[1]];pu(C,r,s,h),_.push(C)}return _}function Jo(o,r,s,l){const h=Math.pow(2,l.z)*As,m=[l.x*As,l.y*As],_=[];for(const E of o){const C=[];for(const I of E){const M=[I.x+m[0],I.y+m[1]];Eh(r,M),C.push(M)}_.push(C)}if(r[2]-r[0]<=h/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of _)for(const C of E)pu(C,r,s,h)}var b;return _}class es{constructor(r,s){this.type=Dt,this.geojson=r,this.geometries=s}static parse(r,s){if(2!==r.length)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(uu(r[1])){const l=r[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const m=l.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new es(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new es(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new es(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const b=ri(l.coordinates,m,_),E=bt(s.geometry(),h,m,_);if(!Gt(h,m))return!1;for(const C of E)if(!pa(C,b))return!1}if("MultiPolygon"===l.type){const b=oc(l.coordinates,m,_),E=bt(s.geometry(),h,m,_);if(!Gt(h,m))return!1;for(const C of E)if(!sl(C,b))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const b=ri(l.coordinates,m,_),E=Jo(s.geometry(),h,m,_);if(!Gt(h,m))return!1;for(const C of E)if(!du(C,b))return!1}if("MultiPolygon"===l.type){const b=oc(l.coordinates,m,_),E=Jo(s.geometry(),h,m,_);if(!Gt(h,m))return!1;for(const C of E)if(!ic(C,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function mi(o){if(o instanceof Lt&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof es)return!1;let r=!0;return o.eachChild(s=>{r&&!mi(s)&&(r=!1)}),r}function al(o){if(o instanceof Lt&&"feature-state"===o.name)return!1;let r=!0;return o.eachChild(s=>{r&&!al(s)&&(r=!1)}),r}function qt(o,r){if(o instanceof Lt&&r.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(l=>{s&&!qt(l,r)&&(s=!1)}),s}class Gi{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(2!==r.length||"string"!=typeof r[1])return s.error("'var' expression requires exactly one string literal argument.");const l=r[1];return s.scope.has(l)?new Gi(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ii{constructor(r,s=[],l,h=new Ms,m=[]){this.registry=r,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=l}parse(r,s,l,h,m={}){return s?this.concat(s,l,h)._parse(r,m):this._parse(r,m)}_parse(r,s){function l(h,m,_){return"assert"===_?new ho(m,[h]):"coerce"===_?new Ko(m,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(r,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,E=_.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==E.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(b,E))return null}else _=l(_,b,s.typeAnnotation||"coerce");else _=l(_,b,s.typeAnnotation||"assert")}if(!(_ instanceof Vr)&&"resolvedImage"!==_.type.kind&&Ch(_)){const b=new jr;try{_=new Vr(_.type,_.evaluate(b))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,l){const h="number"==typeof r?this.path.concat(r):this.path,m=l?this.scope.concat(l):this.scope;return new ii(this.registry,h,s||null,m,this.errors)}error(r,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new $t(l,r))}checkSubtype(r,s){const l=Co(r,s);return l&&this.error(l),l}}function Ch(o){if(o instanceof Gi)return Ch(o.boundExpression);if(o instanceof Lt&&"error"===o.name||o instanceof hu||o instanceof es)return!1;const r=o instanceof Ko||o instanceof ho;let s=!0;return o.eachChild(l=>{s=r?s&&Ch(l):s&&l instanceof Vr}),!!s&&mi(o)&&qt(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function sc(o,r){const s=o.length-1;let l,h,m=0,_=s,b=0;for(;m<=_;)if(b=Math.floor((m+_)/2),l=o[b],h=o[b+1],l<=r){if(b===s||r<h)return b;m=b+1}else{if(!(l>r))throw new sr("Input is not a number.");_=b-1}return 0}class oi{constructor(r,s,l){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(r[1],1,je);if(!l)return null;const h=[];let m=null;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);for(let _=1;_<r.length;_+=2){const b=1===_?-1/0:r[_],E=r[_+1],C=_,I=_+1;if("number"!=typeof b)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const M=s.parse(E,I,m);if(!M)return null;m=m||M.type,h.push([b,M])}return new oi(m,l,h)}evaluate(r){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(r);const h=this.input.evaluate(r);if(h<=s[0])return l[0].evaluate(r);const m=s.length;return h>=s[m-1]?l[m-1].evaluate(r):l[sc(s,h)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}function Jt(o,r,s){return o*(1-s)+r*s}var ll=Object.freeze({__proto__:null,number:Jt,color:function(o,r,s){return new yt(Jt(o.r,r.r,s),Jt(o.g,r.g,s),Jt(o.b,r.b,s),Jt(o.a,r.a,s))},array:function(o,r,s){return o.map((l,h)=>Jt(l,r[h],s))}});const gn=4/29,lc=6/29,Sh=3*lc*lc,fa=Math.PI/180,bn=180/Math.PI;function ma(o){return o>.008856451679035631?Math.pow(o,1/3):o/Sh+gn}function ga(o){return o>lc?o*o*o:Sh*(o-gn)}function _a(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function cl(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function qi(o){const r=cl(o.r),s=cl(o.g),l=cl(o.b),h=ma((.4124564*r+.3575761*s+.1804375*l)/.95047),m=ma((.2126729*r+.7151522*s+.072175*l)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-ma((.0193339*r+.119192*s+.9503041*l)/1.08883)),alpha:o.a}}function ya(o){let r=(o.l+16)/116,s=isNaN(o.a)?r:r+o.a/500,l=isNaN(o.b)?r:r-o.b/200;return r=1*ga(r),s=.95047*ga(s),l=1.08883*ga(l),new yt(_a(3.2404542*s-1.5371385*r-.4985314*l),_a(-.969266*s+1.8760108*r+.041556*l),_a(.0556434*s-.2040259*r+1.0572252*l),o.alpha)}function Ih(o,r,s){const l=r-o;return o+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const pr={forward:qi,reverse:ya,interpolate:function(o,r,s){return{l:Jt(o.l,r.l,s),a:Jt(o.a,r.a,s),b:Jt(o.b,r.b,s),alpha:Jt(o.alpha,r.alpha,s)}}},ul={forward:function(o){const{l:r,a:s,b:l}=qi(o),h=Math.atan2(l,s)*bn;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:r,alpha:o.a}},reverse:function(o){const r=o.h*fa,s=o.c;return ya({l:o.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:o.alpha})},interpolate:function(o,r,s){return{h:Ih(o.h,r.h,s),c:Jt(o.c,r.c,s),l:Jt(o.l,r.l,s),alpha:Jt(o.alpha,r.alpha,s)}}};var fu=Object.freeze({__proto__:null,lab:pr,hcl:ul});class si{constructor(r,s,l,h,m){this.type=r,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,b]of m)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(r,s,l,h){let m=0;if("exponential"===r.name)m=cc(s,r.base,l,h);else if("linear"===r.name)m=cc(s,1,l,h);else if("cubic-bezier"===r.name){const _=r.controlPoints;m=new yo(_[0],_[1],_[2],_[3]).solve(cc(s,1,l,h))}return m}static parse(r,s){let[l,h,m,..._]=r;if(!Array.isArray(h)||0===h.length)return s.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const C=h[1];if("number"!=typeof C)return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if("cubic-bezier"!==h[0])return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(4!==C.length||C.some(I=>"number"!=typeof I||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,je),!m)return null;const b=[];let E=null;"interpolate-hcl"===l||"interpolate-lab"===l?E=Zn:s.expectedType&&"value"!==s.expectedType.kind&&(E=s.expectedType);for(let C=0;C<_.length;C+=2){const I=_[C],M=_[C+1],k=C+3,B=C+4;if("number"!=typeof I)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(b.length&&b[b.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const N=s.parse(M,B,E);if(!N)return null;E=E||N.type,b.push([I,N])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new si(E,l,h,m,b):s.error(`Type ${Dn(E)} is not interpolatable.`)}evaluate(r){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(r);const h=this.input.evaluate(r);if(h<=s[0])return l[0].evaluate(r);const m=s.length;if(h>=s[m-1])return l[m-1].evaluate(r);const _=sc(s,h),b=si.interpolationFactor(this.interpolation,h,s[_],s[_+1]),E=l[_].evaluate(r),C=l[_+1].evaluate(r);return"interpolate"===this.operator?ll[this.type.kind.toLowerCase()](E,C,b):"interpolate-hcl"===this.operator?ul.reverse(ul.interpolate(ul.forward(E),ul.forward(C),b)):pr.reverse(pr.interpolate(pr.forward(E),pr.forward(C),b))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function cc(o,r,s,l){const h=l-s,m=o-s;return 0===h?0:1===r?m/h:(Math.pow(r,m)-1)/(Math.pow(r,h)-1)}class po{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&"value"!==h.kind&&(l=h);const m=[];for(const b of r.slice(1)){const E=s.parse(b,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,m.push(E)}const _=h&&m.some(b=>Co(h,b.type));return new po(_?rt:l,m)}evaluate(r){let s,l=null,h=0;for(const m of this.args)if(h++,l=m.evaluate(r),l&&l instanceof Ur&&!l.available&&(s||(s=l.name),l=null,h===this.args.length&&(l=s)),null!==l)break;return l}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class hl{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const l=[];for(let m=1;m<r.length-1;m+=2){const _=r[m];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=s.parse(r[m+1],m+1);if(!b)return null;l.push([_,b])}const h=s.parse(r[r.length-1],r.length-1,s.expectedType,l);return h?new hl(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,l]of this.bindings)r.push(s,l.serialize());return r.push(this.result.serialize()),r}}class uc{constructor(r,s,l){this.type=r,this.index=s,this.input=l}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const l=s.parse(r[1],1,je),h=s.parse(r[2],2,fi(s.expectedType||rt));return l&&h?new uc(h.type.itemType,l,h):null}evaluate(r){const s=this.index.evaluate(r),l=this.input.evaluate(r);if(s<0)throw new sr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new sr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new sr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class fr{constructor(r,s){this.type=Dt,this.needle=r,this.haystack=s}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const l=s.parse(r[1],1,rt),h=s.parse(r[2],2,rt);return l&&h?bh(l.type,[Dt,Pt,je,uo,rt])?new fr(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(l.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),l=this.haystack.evaluate(r);if(!l)return!1;if(!kt(s,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Wn(s))} instead.`);if(!kt(l,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${Dn(Wn(l))} instead.`);return l.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wr{constructor(r,s,l){this.type=je,this.needle=r,this.haystack=s,this.fromIndex=l}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const l=s.parse(r[1],1,rt),h=s.parse(r[2],2,rt);if(!l||!h)return null;if(!bh(l.type,[Dt,Pt,je,uo,rt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(l.type)} instead`);if(4===r.length){const m=s.parse(r[3],3,je);return m?new wr(l,h,m):null}return new wr(l,h)}evaluate(r){const s=this.needle.evaluate(r),l=this.haystack.evaluate(r);if(!kt(s,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Wn(s))} instead.`);if(!kt(l,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${Dn(Wn(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ar{constructor(r,s,l,h,m,_){this.inputType=r,this.type=s,this.input=l,this.cases=h,this.outputs=m,this.otherwise=_}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&"value"!==s.expectedType.kind&&(h=s.expectedType);const m={},_=[];for(let C=2;C<r.length-1;C+=2){let I=r[C];const M=r[C+1];Array.isArray(I)||(I=[I]);const k=s.concat(C);if(0===I.length)return k.error("Expected at least one branch label.");for(const N of I){if("number"!=typeof N&&"string"!=typeof N)return k.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return k.error("Numeric branch labels must be integer values.");if(l){if(k.checkSubtype(l,Wn(N)))return null}else l=Wn(N);if(void 0!==m[String(N)])return k.error("Branch labels must be unique.");m[String(N)]=_.length}const B=s.parse(M,C,h);if(!B)return null;h=h||B.type,_.push(B)}const b=s.parse(r[1],1,rt);if(!b)return null;const E=s.parse(r[r.length-1],r.length-1,h);return E?"value"!==b.type.kind&&s.concat(1).checkSubtype(l,b.type)?null:new ar(l,h,b,m,_,E):null}evaluate(r){const s=this.input.evaluate(r);return(Wn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const _ of s){const b=h[this.cases[_]];void 0===b?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[b][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,b]of l)r.push(1===b.length?m(b[0]):b.map(m)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class Hi{constructor(r,s,l){this.type=r,this.branches=s,this.otherwise=l}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const h=[];for(let _=1;_<r.length-1;_+=2){const b=s.parse(r[_],_,Dt);if(!b)return null;const E=s.parse(r[_+1],_+1,l);if(!E)return null;h.push([b,E]),l=l||E.type}const m=s.parse(r[r.length-1],r.length-1,l);return m?new Hi(l,h,m):null}evaluate(r){for(const[s,l]of this.branches)if(s.evaluate(r))return l.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,l]of this.branches)r(s),r(l);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class fo{constructor(r,s,l,h){this.type=r,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const l=s.parse(r[1],1,rt),h=s.parse(r[2],2,je);if(!l||!h)return null;if(!bh(l.type,[fi(rt),Pt,rt]))return s.error(`Expected first argument to be of type array or string, but found ${Dn(l.type)} instead`);if(4===r.length){const m=s.parse(r[3],3,je);return m?new fo(l.type,l,h,m):null}return new fo(l.type,l,h)}evaluate(r){const s=this.input.evaluate(r),l=this.beginIndex.evaluate(r);if(!kt(s,["string","array"]))throw new sr(`Expected first argument to be of type array or string, but found ${Dn(Wn(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return s.slice(l,h)}return s.slice(l)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ai(o,r){return"=="===o||"!="===o?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function dl(o,r,s,l){return 0===l.compare(r,s)}function ts(o,r,s){const l="=="!==o&&"!="!==o;return class bE{constructor(m,_,b){this.type=Dt,this.lhs=m,this.rhs=_,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const b=m[0];let E=_.parse(m[1],1,rt);if(!E)return null;if(!ai(b,E.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Dn(E.type)}'.`);let C=_.parse(m[2],2,rt);if(!C)return null;if(!ai(b,C.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Dn(C.type)}'.`);if(E.type.kind!==C.type.kind&&"value"!==E.type.kind&&"value"!==C.type.kind)return _.error(`Cannot compare types '${Dn(E.type)}' and '${Dn(C.type)}'.`);l&&("value"===E.type.kind&&"value"!==C.type.kind?E=new ho(C.type,[E]):"value"!==E.type.kind&&"value"===C.type.kind&&(C=new ho(E.type,[C])));let I=null;if(4===m.length){if("string"!==E.type.kind&&"string"!==C.type.kind&&"value"!==E.type.kind&&"value"!==C.type.kind)return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(m[3],3,ca),!I)return null}return new bE(E,C,I)}evaluate(m){const _=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const E=Wn(_),C=Wn(b);if(E.kind!==C.kind||"string"!==E.kind&&"number"!==E.kind)throw new sr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${C.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=Wn(_),C=Wn(b);if("string"!==E.kind||"string"!==C.kind)return r(m,_,b)}return this.collator?s(m,_,b,this.collator.evaluate(m)):r(m,_,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const va=ts("==",function(o,r,s){return r===s},dl),pl=ts("!=",function(o,r,s){return r!==s},function(o,r,s,l){return!dl(0,r,s,l)}),Ps=ts("<",function(o,r,s){return r<s},function(o,r,s,l){return l.compare(r,s)<0}),Ir=ts(">",function(o,r,s){return r>s},function(o,r,s,l){return l.compare(r,s)>0}),cp=ts("<=",function(o,r,s){return r<=s},function(o,r,s,l){return l.compare(r,s)<=0}),Ai=ts(">=",function(o,r,s){return r>=s},function(o,r,s,l){return l.compare(r,s)>=0});class et{constructor(r,s,l,h,m){this.type=Pt,this.number=r,this.locale=s,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(r,s){if(3!==r.length)return s.error("Expected two arguments.");const l=s.parse(r[1],1,je);if(!l)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=s.parse(h.locale,1,Pt),!m))return null;let _=null;if(h.currency&&(_=s.parse(h.currency,1,Pt),!_))return null;let b=null;if(h["min-fraction-digits"]&&(b=s.parse(h["min-fraction-digits"],1,je),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parse(h["max-fraction-digits"],1,je),!E)?null:new et(l,m,_,b,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Rt{constructor(r){this.type=je,this.input=r}static parse(r,s){if(2!==r.length)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const l=s.parse(r[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${Dn(l.type)} instead.`):new Rt(l):null}evaluate(r){const s=this.input.evaluate(r);if("string"==typeof s||Array.isArray(s))return s.length;throw new sr(`Expected value to be of type string or array, but found ${Dn(Wn(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}const pn={"==":va,"!=":pl,">":Ir,"<":Ps,">=":Ai,"<=":cp,array:ho,at:uc,boolean:ho,case:Hi,coalesce:po,collator:hu,format:nc,image:rc,in:fr,"index-of":wr,interpolate:si,"interpolate-hcl":si,"interpolate-lab":si,length:Rt,let:hl,literal:Vr,match:ar,number:ho,"number-format":et,object:ho,slice:fo,step:oi,string:ho,"to-boolean":Ko,"to-color":Ko,"to-number":Ko,"to-string":Ko,var:Gi,within:es};function li(o,[r,s,l,h]){r=r.evaluate(o),s=s.evaluate(o),l=l.evaluate(o);const m=h?h.evaluate(o):1,_=ni(r,s,l,m);if(_)throw new sr(_);return new yt(r/255*m,s/255*m,l/255*m,m)}function ns(o,r){return o in r}function tr(o,r){const s=r[o];return void 0===s?null:s}function ci(o){return{type:o}}function Bn(o){return{result:"success",value:o}}function Zi(o){return{result:"error",value:o}}function gi(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function At(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function xa(o){return!!o.expression&&o.expression.interpolated}function Ot(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function ba(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function wa(o){return o}function $r(o,r){const s="color"===r.type,l=o.stops&&"object"==typeof o.stops[0][0],h=l||!(l||void 0!==o.property),m=o.type||(xa(r)?"exponential":"interval");if(s&&((o=nn({},o)).stops&&(o.stops=o.stops.map(C=>[C[0],yt.parse(C[1])])),o.default=yt.parse(o.default?o.default:r.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!fu[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,b,E;if("exponential"===m)_=Cn;else if("interval"===m)_=ui;else if("categorical"===m){_=ks,b=Object.create(null);for(const C of o.stops)b[C[0]]=C[1];E=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=up}if(l){const C={},I=[];for(let B=0;B<o.stops.length;B++){const N=o.stops[B],$=N[0].zoom;void 0===C[$]&&(C[$]={zoom:$,type:o.type,property:o.property,default:o.default,stops:[]},I.push($)),C[$].stops.push([N[0].value,N[1]])}const M=[];for(const B of I)M.push([C[B].zoom,$r(C[B],r)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:si.interpolationFactor.bind(void 0,k),zoomStops:M.map(B=>B[0]),evaluate:({zoom:B},N)=>Cn({stops:M,base:o.base},r,B).evaluate(B,N)}}if(h){const C="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:si.interpolationFactor.bind(void 0,C),zoomStops:o.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(o,r,I,b,E)}}return{kind:"source",evaluate(C,I){const M=I&&I.properties?I.properties[o.property]:void 0;return void 0===M?mo(o.default,r.default):_(o,r,M,b,E)}}}function mo(o,r,s){return void 0!==o?o:void 0!==r?r:void 0!==s?s:void 0}function ks(o,r,s,l,h){return mo(typeof s===h?l[s]:void 0,o.default,r.default)}function ui(o,r,s){if("number"!==Ot(s))return mo(o.default,r.default);const l=o.stops.length;if(1===l||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[l-1][0])return o.stops[l-1][1];const h=sc(o.stops.map(m=>m[0]),s);return o.stops[h][1]}function Cn(o,r,s){const l=void 0!==o.base?o.base:1;if("number"!==Ot(s))return mo(o.default,r.default);const h=o.stops.length;if(1===h||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[h-1][0])return o.stops[h-1][1];const m=sc(o.stops.map(I=>I[0]),s),_=function(I,M,k,B){const N=B-k,$=I-k;return 0===N?0:1===M?$/N:(Math.pow(M,$)-1)/(Math.pow(M,N)-1)}(s,l,o.stops[m][0],o.stops[m+1][0]),b=o.stops[m][1],E=o.stops[m+1][1];let C=ll[r.type]||wa;if(o.colorSpace&&"rgb"!==o.colorSpace){const I=fu[o.colorSpace];C=(M,k)=>I.reverse(I.interpolate(I.forward(M),I.forward(k),_))}return"function"==typeof b.evaluate?{evaluate(...I){const M=b.evaluate.apply(void 0,I),k=E.evaluate.apply(void 0,I);if(void 0!==M&&void 0!==k)return C(M,k,_)}}:C(b,E,_)}function up(o,r,s){return"color"===r.type?s=yt.parse(s):"formatted"===r.type?s=Nr.fromString(s.toString()):"resolvedImage"===r.type?s=Ur.fromString(s.toString()):Ot(s)===r.type||"enum"===r.type&&r.values[s]||(s=void 0),mo(s,o.default,r.default)}Lt.register(pn,{error:[{kind:"error"},[Pt],(o,[r])=>{throw new sr(r.evaluate(o))}],typeof:[Pt,[rt],(o,[r])=>Dn(Wn(r.evaluate(o)))],"to-rgba":[fi(je,4),[Zn],(o,[r])=>r.evaluate(o).toArray()],rgb:[Zn,[je,je,je],li],rgba:[Zn,[je,je,je,je],li],has:{type:Dt,overloads:[[[Pt],(o,[r])=>ns(r.evaluate(o),o.properties())],[[Pt,Do],(o,[r,s])=>ns(r.evaluate(o),s.evaluate(o))]]},get:{type:rt,overloads:[[[Pt],(o,[r])=>tr(r.evaluate(o),o.properties())],[[Pt,Do],(o,[r,s])=>tr(r.evaluate(o),s.evaluate(o))]]},"feature-state":[rt,[Pt],(o,[r])=>tr(r.evaluate(o),o.featureState||{})],properties:[Do,[],o=>o.properties()],"geometry-type":[Pt,[],o=>o.geometryType()],id:[rt,[],o=>o.id()],zoom:[je,[],o=>o.globals.zoom],pitch:[je,[],o=>o.globals.pitch||0],"distance-from-center":[je,[],o=>o.distanceFromCenter()],"heatmap-density":[je,[],o=>o.globals.heatmapDensity||0],"line-progress":[je,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[je,[],o=>o.globals.skyRadialProgress||0],accumulated:[rt,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[je,ci(je),(o,r)=>{let s=0;for(const l of r)s+=l.evaluate(o);return s}],"*":[je,ci(je),(o,r)=>{let s=1;for(const l of r)s*=l.evaluate(o);return s}],"-":{type:je,overloads:[[[je,je],(o,[r,s])=>r.evaluate(o)-s.evaluate(o)],[[je],(o,[r])=>-r.evaluate(o)]]},"/":[je,[je,je],(o,[r,s])=>r.evaluate(o)/s.evaluate(o)],"%":[je,[je,je],(o,[r,s])=>r.evaluate(o)%s.evaluate(o)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(o,[r,s])=>Math.pow(r.evaluate(o),s.evaluate(o))],sqrt:[je,[je],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[je,[je],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[je,[je],(o,[r])=>Math.log(r.evaluate(o))],log2:[je,[je],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[je,[je],(o,[r])=>Math.sin(r.evaluate(o))],cos:[je,[je],(o,[r])=>Math.cos(r.evaluate(o))],tan:[je,[je],(o,[r])=>Math.tan(r.evaluate(o))],asin:[je,[je],(o,[r])=>Math.asin(r.evaluate(o))],acos:[je,[je],(o,[r])=>Math.acos(r.evaluate(o))],atan:[je,[je],(o,[r])=>Math.atan(r.evaluate(o))],min:[je,ci(je),(o,r)=>Math.min(...r.map(s=>s.evaluate(o)))],max:[je,ci(je),(o,r)=>Math.max(...r.map(s=>s.evaluate(o)))],abs:[je,[je],(o,[r])=>Math.abs(r.evaluate(o))],round:[je,[je],(o,[r])=>{const s=r.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[je,[je],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[je,[je],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[Dt,[Pt,rt],(o,[r,s])=>o.properties()[r.value]===s.value],"filter-id-==":[Dt,[rt],(o,[r])=>o.id()===r.value],"filter-type-==":[Dt,[Pt],(o,[r])=>o.geometryType()===r.value],"filter-<":[Dt,[Pt,rt],(o,[r,s])=>{const l=o.properties()[r.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Dt,[rt],(o,[r])=>{const s=o.id(),l=r.value;return typeof s==typeof l&&s<l}],"filter->":[Dt,[Pt,rt],(o,[r,s])=>{const l=o.properties()[r.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[Dt,[rt],(o,[r])=>{const s=o.id(),l=r.value;return typeof s==typeof l&&s>l}],"filter-<=":[Dt,[Pt,rt],(o,[r,s])=>{const l=o.properties()[r.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Dt,[rt],(o,[r])=>{const s=o.id(),l=r.value;return typeof s==typeof l&&s<=l}],"filter->=":[Dt,[Pt,rt],(o,[r,s])=>{const l=o.properties()[r.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Dt,[rt],(o,[r])=>{const s=o.id(),l=r.value;return typeof s==typeof l&&s>=l}],"filter-has":[Dt,[rt],(o,[r])=>r.value in o.properties()],"filter-has-id":[Dt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[Dt,[fi(Pt)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[Dt,[fi(rt)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[Dt,[Pt,fi(rt)],(o,[r,s])=>s.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[Dt,[Pt,fi(rt)],(o,[r,s])=>function(l,h,m,_){for(;m<=_;){const b=m+_>>1;if(h[b]===l)return!0;h[b]>l?_=b-1:m=b+1}return!1}(o.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(o,[r,s])=>r.evaluate(o)&&s.evaluate(o)],[ci(Dt),(o,r)=>{for(const s of r)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(o,[r,s])=>r.evaluate(o)||s.evaluate(o)],[ci(Dt),(o,r)=>{for(const s of r)if(s.evaluate(o))return!0;return!1}]]},"!":[Dt,[Dt],(o,[r])=>!r.evaluate(o)],"is-supported-script":[Dt,[Pt],(o,[r])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(r.evaluate(o))}],upcase:[Pt,[Pt],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[Pt,[Pt],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[Pt,ci(rt),(o,r)=>r.map(s=>da(s.evaluate(o))).join("")],"resolved-locale":[Pt,[ca],(o,[r])=>r.evaluate(o).resolvedLocale()]});class mu{constructor(r,s){var l;this.expression=r,this._warningHistory={},this._evaluator=new jr,this._defaultValue=s?"color"===(l=s).type&&ba(l.default)?new yt(0,0,0,0):"color"===l.type?yt.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(r,s,l,h,m,_,b,E){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,l,h,m,_,b,E){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new sr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,"undefined"!=typeof console&&console.warn(C.message)),this._defaultValue}}}function nr(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in pn}function Mr(o,r){const s=new ii(pn,[],r?function(h){const m={color:Zn,string:Pt,number:je,enum:Pt,boolean:Dt,formatted:Qt,resolvedImage:Yo};return"array"===h.type?fi(m[h.value]||rt,h.length):m[h.type]}(r):void 0),l=s.parse(o,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return l?Bn(new mu(l,r)):Zi(s.errors)}class go{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent="constant"!==r&&!al(s.expression)}evaluateWithoutErrorHandling(r,s,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,s,l,h,m,_)}evaluate(r,s,l,h,m,_){return this._styleExpression.evaluate(r,s,l,h,m,_)}}class Rs{constructor(r,s,l,h){this.kind=r,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==r&&!al(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,s,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,s,l,h,m,_)}evaluate(r,s,l,h,m,_){return this._styleExpression.evaluate(r,s,l,h,m,_)}interpolationFactor(r,s,l){return this.interpolationType?si.interpolationFactor(this.interpolationType,r,s,l):0}}function fl(o,r){if("error"===(o=Mr(o,r)).result)return o;const s=o.value.expression,l=mi(s);if(!l&&!gi(r))return Zi([new $t("","data expressions not supported")]);const h=qt(s,["zoom","pitch","distance-from-center"]);if(!h&&!At(r))return Zi([new $t("","zoom expressions not supported")]);const m=rs(s);return m||h?m instanceof $t?Zi([m]):m instanceof si&&!xa(r)?Zi([new $t("",'"interpolate" expressions cannot be used with this property')]):Bn(m?new Rs(l?"camera":"composite",o.value,m.labels,m instanceof si?m.interpolation:void 0):new go(l?"constant":"source",o.value)):Zi([new $t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ar{constructor(r,s){this._parameters=r,this._specification=s,nn(this,$r(this._parameters,this._specification))}static deserialize(r){return new Ar(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function rs(o){let r=null;if(o instanceof hl)r=rs(o.result);else if(o instanceof po){for(const s of o.args)if(r=rs(s),r)break}else(o instanceof oi||o instanceof si)&&o.input instanceof Lt&&"zoom"===o.input.name&&(r=o);return r instanceof $t||o.eachChild(s=>{const l=rs(s);l instanceof $t?r=l:!r&&l?r=new $t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&l&&r!==l&&(r=new $t("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Wi(o){const r=o.key,s=o.value,l=o.valueSpec||{},h=o.objectElementValidators||{},m=o.style,_=o.styleSpec;let b=[];const E=Ot(s);if("object"!==E)return[new De(r,s,`object expected, ${E} found`)];for(const C in s){const I=C.split(".")[0],M=l[I]||l["*"];let k;if(h[I])k=h[I];else if(l[I])k=Tn;else if(h["*"])k=h["*"];else{if(!l["*"]){b.push(new De(r,s[C],`unknown property "${C}"`));continue}k=Tn}b=b.concat(k({key:(r&&`${r}.`)+C,value:s[C],valueSpec:M,style:m,styleSpec:_,object:s,objectKey:C},s))}for(const C in l)h[C]||l[C].required&&void 0===l[C].default&&void 0===s[C]&&b.push(new De(r,s,`missing required property "${C}"`));return b}function hc(o){const r=o.value,s=o.valueSpec,l=o.style,h=o.styleSpec,m=o.key,_=o.arrayElementValidator||Tn;if("array"!==Ot(r))return[new De(m,r,`array expected, ${Ot(r)} found`)];if(s.length&&r.length!==s.length)return[new De(m,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new De(m,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};h.$version<7&&(b.function=s.function),"object"===Ot(s.value)&&(b=s.value);let E=[];for(let C=0;C<r.length;C++)E=E.concat(_({array:r,arrayIndex:C,value:r[C],valueSpec:b,style:l,styleSpec:h,key:`${m}[${C}]`}));return E}function gu(o){const r=o.key,s=o.value,l=o.valueSpec;let h=Ot(s);if("number"===h&&s!=s&&(h="NaN"),"number"!==h)return[new De(r,s,`number expected, ${h} found`)];if("minimum"in l){let m=l.minimum;if("array"===Ot(l.minimum)&&(m=l.minimum[o.arrayIndex]),s<m)return[new De(r,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===Ot(l.maximum)&&(m=l.maximum[o.arrayIndex]),s>m)return[new De(r,s,`${s} is greater than the maximum value ${m}`)]}return[]}function _u(o){const r=o.valueSpec,s=_t(o.value.type);let l,h,m,_={};const b="categorical"!==s&&void 0===o.value.property,E=!b,C="array"===Ot(o.value.stops)&&"array"===Ot(o.value.stops[0])&&"object"===Ot(o.value.stops[0][0]),I=Wi({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(B){if("identity"===s)return[new De(B.key,B.value,'identity function may not have a "stops" property')];let N=[];const $=B.value;return N=N.concat(hc({key:B.key,value:$,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:M})),"array"===Ot($)&&0===$.length&&N.push(new De(B.key,$,"array must have at least one stop")),N},default:function(B){return Tn({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===s&&b&&I.push(new De(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||I.push(new De(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!xa(o.valueSpec)&&I.push(new De(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!gi(o.valueSpec)?I.push(new De(o.key,o.value,"property functions not supported")):b&&!At(o.valueSpec)&&I.push(new De(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!C||void 0!==o.value.property||I.push(new De(o.key,o.value,'"property" property is required')),I;function M(B){let N=[];const $=B.value,K=B.key;if("array"!==Ot($))return[new De(K,$,`array expected, ${Ot($)} found`)];if(2!==$.length)return[new De(K,$,`array length 2 expected, length ${$.length} found`)];if(C){if("object"!==Ot($[0]))return[new De(K,$,`object expected, ${Ot($[0])} found`)];if(void 0===$[0].zoom)return[new De(K,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new De(K,$,"object stop key must have value")];if(m&&m>_t($[0].zoom))return[new De(K,$[0].zoom,"stop zoom values must appear in ascending order")];_t($[0].zoom)!==m&&(m=_t($[0].zoom),h=void 0,_={}),N=N.concat(Wi({key:`${K}[0]`,value:$[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:gu,value:k}}))}else N=N.concat(k({key:`${K}[0]`,value:$[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},$));return nr(Bt($[1]))?N.concat([new De(`${K}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(Tn({key:`${K}[1]`,value:$[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function k(B,N){const $=Ot(B.value),K=_t(B.value),te=null!==B.value?B.value:N;if(l){if($!==l)return[new De(B.key,te,`${$} stop domain type must match previous stop domain type ${l}`)]}else l=$;if("number"!==$&&"string"!==$&&"boolean"!==$)return[new De(B.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==s){let oe=`number expected, ${$} found`;return gi(r)&&void 0===s&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(B.key,te,oe)]}return"categorical"!==s||"number"!==$||isFinite(K)&&Math.floor(K)===K?"categorical"!==s&&"number"===$&&void 0!==h&&K<h?[new De(B.key,te,"stop domain values must appear in ascending order")]:(h=K,"categorical"===s&&K in _?[new De(B.key,te,"stop domain values must be unique")]:(_[K]=!0,[])):[new De(B.key,te,`integer expected, found ${K}`)]}}function Fs(o){const r=("property"===o.expressionContext?fl:Mr)(Bt(o.value),o.valueSpec);if("error"===r.result)return r.value.map(l=>new De(`${o.key}${l.key}`,o.value,l.message));const s=r.value.expression||r.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new De(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!al(s))return[new De(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return Mh(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!qt(s,["zoom","feature-state"]))return[new De(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!mi(s))return[new De(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mh(o,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of r.valueSpec.expression.parameters)s.delete(h);if(0===s.size)return[];const l=[];return o instanceof Lt&&s.has(o.name)?[new De(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild(h=>{l.push(...Mh(h,r))}),l)}function ml(o){const r=o.key,s=o.value,l=o.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(_t(s))&&h.push(new De(r,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(_t(s))&&h.push(new De(r,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function yu(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!yu(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function dc(o,r="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yu(o)||(o=vu(o));const s=o;let l=!0;try{l=function(C){if(!Da(C))return C;let I=Bt(C);return Ea(I),I=Ah(I),I}(s)}catch(C){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const h=de[`filter_${r}`],m=Mr(l,h);let _=null;if("error"===m.result)throw new Error(m.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,I,M)=>m.value.evaluate(C,I,{},M);let b=null,E=null;if(l!==s){const C=Mr(s,h);if("error"===C.result)throw new Error(C.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,M,k,B,N)=>C.value.evaluate(I,M,{},k,void 0,void 0,B,N),E=!mi(C.value.expression)}return _=_,{filter:_,dynamicFilter:b||void 0,needGeometry:kh(l),needFeature:!!E}}function Ah(o){if(!Array.isArray(o))return o;const r=function(s){if(hp.has(s[0]))for(let l=1;l<s.length;l++)if(Da(s[l]))return!0;return s}(o);return!0===r?r:r.map(s=>Ah(s))}function Ea(o){let r=!1;const s=[];if("case"===o[0]){for(let l=1;l<o.length-1;l+=2)r=r||Da(o[l]),s.push(o[l+1]);s.push(o[o.length-1])}else if("match"===o[0]){r=r||Da(o[1]);for(let l=2;l<o.length-1;l+=2)s.push(o[l+1]);s.push(o[o.length-1])}else if("step"===o[0]){r=r||Da(o[1]);for(let l=1;l<o.length-1;l+=2)s.push(o[l+1])}r&&(o.length=0,o.push("any",...s));for(let l=1;l<o.length;l++)Ea(o[l])}function Da(o){if(!Array.isArray(o))return!1;if("pitch"===(r=o[0])||"distance-from-center"===r)return!0;var r;for(let s=1;s<o.length;s++)if(Da(o[s]))return!0;return!1}const hp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ph(o,r){return o<r?-1:o>r?1:0}function kh(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let r=1;r<o.length;r++)if(kh(o[r]))return!0;return!1}function vu(o){if(!o)return!0;const r=o[0];return o.length<=1?"any"!==r:"=="===r?gl(o[1],o[2],"=="):"!="===r?bu(gl(o[1],o[2],"==")):"<"===r||">"===r||"<="===r||">="===r?gl(o[1],o[2],r):"any"===r?(s=o.slice(1),["any"].concat(s.map(vu))):"all"===r?["all"].concat(o.slice(1).map(vu)):"none"===r?["all"].concat(o.slice(1).map(vu).map(bu)):"in"===r?xu(o[1],o.slice(2)):"!in"===r?bu(xu(o[1],o.slice(2))):"has"===r?pc(o[1]):"!has"===r?bu(pc(o[1])):"within"!==r||o;var s}function gl(o,r,s){switch(o){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,o,r]}}function xu(o,r){if(0===r.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Ph)]]:["filter-in-small",o,["literal",r]]}}function pc(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function bu(o){return["!",o]}function Rh(o){if(yu(Bt(o.value))){const r=Bt(o.layerType);return Fs(nn({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${r||"fill"}`]}))}return dp(o)}function dp(o){const r=o.value,s=o.key;if("array"!==Ot(r))return[new De(s,r,`array expected, ${Ot(r)} found`)];const l=o.styleSpec;let h,m=[];if(r.length<1)return[new De(s,r,"filter array must have at least 1 element")];switch(m=m.concat(ml({key:`${s}[0]`,value:r[0],valueSpec:l.filter_operator,style:o.style,styleSpec:o.styleSpec})),_t(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===_t(r[1])&&m.push(new De(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&m.push(new De(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=Ot(r[1]),"string"!==h&&m.push(new De(`${s}[1]`,r[1],`string expected, ${h} found`)));for(let _=2;_<r.length;_++)h=Ot(r[_]),"$type"===_t(r[1])?m=m.concat(ml({key:`${s}[${_}]`,value:r[_],valueSpec:l.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new De(`${s}[${_}]`,r[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)m=m.concat(dp({key:`${s}[${_}]`,value:r[_],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":h=Ot(r[1]),2!==r.length?m.push(new De(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new De(`${s}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=Ot(r[1]),2!==r.length?m.push(new De(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new De(`${s}[1]`,r[1],`object expected, ${h} found`))}return m}function Xi(o,r){const s=o.key,l=o.style,h=o.styleSpec,m=o.value,_=o.objectKey,b=h[`${r}_${o.layerType}`];if(!b)return[];const E=_.match(/^(.*)-transition$/);if("paint"===r&&E&&b[E[1]]&&b[E[1]].transition)return Tn({key:s,value:m,valueSpec:h.transition,style:l,styleSpec:h});const C=o.valueSpec||b[_];if(!C)return[new De(s,m,`unknown property "${_}"`)];let I;if("string"===Ot(m)&&gi(C)&&!C.tokens&&(I=/^{([^}]+)}$/.exec(m)))return[new De(s,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const M=[];return"symbol"===o.layerType&&("text-field"===_&&l&&!l.glyphs&&M.push(new De(s,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&ba(Bt(m))&&"identity"===_t(m.type)&&M.push(new De(s,m,'"text-font" does not support identity functions'))),M.concat(Tn({key:o.key,value:m,valueSpec:C,style:l,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:_}))}function _l(o){return Xi(o,"paint")}function rr(o){return Xi(o,"layout")}function Ca(o){let r=[];const s=o.value,l=o.key,h=o.style,m=o.styleSpec;s.type||s.ref||r.push(new De(l,s,'either "type" or "ref" is required'));let _=_t(s.type);const b=_t(s.ref);if(s.id){const E=_t(s.id);for(let C=0;C<o.arrayIndex;C++){const I=h.layers[C];_t(I.id)===E&&r.push(new De(l,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&r.push(new De(l,s[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{_t(C.id)===b&&(E=C)}),E?E.ref?r.push(new De(l,s.ref,"ref cannot reference another ref layer")):_=_t(E.type):r.push(new De(l,s.ref,`ref layer "${b}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const E=h.sources&&h.sources[s.source],C=E&&_t(E.type);E?"vector"===C&&"raster"===_?r.push(new De(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===C&&"raster"!==_?r.push(new De(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==C||s["source-layer"]?"raster-dem"===C&&"hillshade"!==_?r.push(new De(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===C&&E.lineMetrics||r.push(new De(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new De(l,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new De(l,s.source,`source "${s.source}" not found`))}else r.push(new De(l,s,'missing required property "source"'));return r=r.concat(Wi({key:l,value:s,valueSpec:m.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Tn({key:`${l}.type`,value:s.type,valueSpec:m.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:E=>Rh(nn({layerType:_},E)),layout:E=>Wi({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":C=>rr(nn({layerType:_},C))}}),paint:E=>Wi({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":C=>_l(nn({layerType:_},C))}})}})),r}function Ta(o){const r=o.value,s=o.key,l=Ot(r);return"string"!==l?[new De(s,r,`string expected, ${l} found`)]:[]}const Fh={promoteId:function({key:o,value:r}){if("string"===Ot(r))return Ta({key:o,value:r});{const s=[];for(const l in r)s.push(...Ta({key:`${o}.${l}`,value:r[l]}));return s}}};function wu(o){const r=o.value,s=o.key,l=o.styleSpec,h=o.style;if(!r.type)return[new De(s,r,'"type" is required')];const m=_t(r.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Wi({key:s,value:r,valueSpec:l[`source_${m.replace("-","_")}`],style:o.style,styleSpec:l,objectElementValidators:Fh}),_;case"geojson":if(_=Wi({key:s,value:r,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Fh}),r.cluster)for(const b in r.clusterProperties){const[E,C]=r.clusterProperties[b],I="string"==typeof E?[E,["accumulated"],["get",b]]:E;_.push(...Fs({key:`${s}.${b}.map`,value:C,expressionContext:"cluster-map"})),_.push(...Fs({key:`${s}.${b}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return Wi({key:s,value:r,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return Wi({key:s,value:r,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new De(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ml({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function Eu(o){const r=o.value,s=o.styleSpec,l=s.light,h=o.style;let m=[];const _=Ot(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new De("light",r,`object expected, ${_} found`)]),m;for(const b in r){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&l[E[1]]&&l[E[1]].transition?Tn({key:b,value:r[b],valueSpec:s.transition,style:h,styleSpec:s}):l[b]?Tn({key:b,value:r[b],valueSpec:l[b],style:h,styleSpec:s}):[new De(b,r[b],`unknown property "${b}"`)])}return m}function fc(o){const r=o.value,s=o.key,l=o.style,h=o.styleSpec,m=h.terrain;let _=[];const b=Ot(r);if(void 0===r)return _;if("object"!==b)return _=_.concat([new De("terrain",r,`object expected, ${b} found`)]),_;for(const E in r){const C=E.match(/^(.*)-transition$/);_=_.concat(C&&m[C[1]]&&m[C[1]].transition?Tn({key:E,value:r[E],valueSpec:h.transition,style:l,styleSpec:h}):m[E]?Tn({key:E,value:r[E],valueSpec:m[E],style:l,styleSpec:h}):[new De(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=l.sources&&l.sources[r.source],C=E&&_t(E.type);E?"raster-dem"!==C&&_.push(new De(s,r.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):_.push(new De(s,r.source,`source "${r.source}" not found`))}else _.push(new De(s,r,'terrain is missing required property "source"'));return _}function mc(o){const r=o.value,s=o.style,l=o.styleSpec,h=l.fog;let m=[];const _=Ot(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new De("fog",r,`object expected, ${_} found`)]),m;for(const b in r){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&h[E[1]]&&h[E[1]].transition?Tn({key:b,value:r[b],valueSpec:l.transition,style:s,styleSpec:l}):h[b]?Tn({key:b,value:r[b],valueSpec:h[b],style:s,styleSpec:l}):[new De(b,r[b],`unknown property "${b}"`)])}return m}const gc={"*":()=>[],array:hc,boolean:function(o){const r=o.value,s=o.key,l=Ot(r);return"boolean"!==l?[new De(s,r,`boolean expected, ${l} found`)]:[]},number:gu,color:function(o){const r=o.key,s=o.value,l=Ot(s);return"string"!==l?[new De(r,s,`color expected, ${l} found`)]:null===ht.parseCSSColor(s)?[new De(r,s,`color expected, "${s}" found`)]:[]},constants:Ft,enum:ml,filter:Rh,function:_u,layer:Ca,object:Wi,source:wu,light:Eu,terrain:fc,fog:mc,string:Ta,formatted:function(o){return 0===Ta(o).length?[]:Fs(o)},resolvedImage:function(o){return 0===Ta(o).length?[]:Fs(o)},projection:function(o){const r=o.value,s=o.styleSpec,l=s.projection,h=o.style;let m=[];const _=Ot(r);if("object"===_)for(const b in r)m=m.concat(Tn({key:b,value:r[b],valueSpec:l[b],style:h,styleSpec:s}));else"string"!==_&&(m=m.concat([new De("projection",r,`object or string expected, ${_} found`)]));return m}};function Tn(o){const r=o.value,s=o.valueSpec,l=o.styleSpec;return s.expression&&ba(_t(r))?_u(o):s.expression&&nr(Bt(r))?Fs(o):s.type&&gc[s.type]?gc[s.type](o):Wi(nn({},o,{valueSpec:s.type?l[s.type]:s}))}function Lh(o){const r=o.value,s=o.key,l=Ta(o);return l.length||(-1===r.indexOf("{fontstack}")&&l.push(new De(s,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&l.push(new De(s,r,'"glyphs" url must include a "{range}" token'))),l}function Pi(o,r=de){let s=[];return s=s.concat(Tn({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:Lh,"*":()=>[]}})),o.constants&&(s=s.concat(Ft({key:"constants",value:o.constants,style:o,styleSpec:r}))),_c(s)}function _c(o){return[].concat(o).sort((r,s)=>r.line-s.line)}function To(o){return function(...r){return _c(o.apply(this,r))}}Pi.source=To(wu),Pi.light=To(Eu),Pi.terrain=To(fc),Pi.fog=To(mc),Pi.layer=To(Ca),Pi.filter=To(Rh),Pi.paintProperty=To(_l),Pi.layoutProperty=To(rr);const So=Pi,cm=So.light,Fn=So.fog,yl=So.paintProperty,Oh=So.layoutProperty;function Xn(o,r){let s=!1;if(r&&r.length)for(const l of r)o.fire(new ot(new Error(l.message))),s=!0;return s}var Sa=Io;function Io(o,r,s){var l=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var h=new Int32Array(this.arrayBuffer);o=h[0],this.d=(r=h[1])+2*(s=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],b=h[3+m+1];l.push(_===b?null:h.subarray(_,b))}var E=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*s;for(var C=0;C<this.d*this.d;C++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=s,this.scale=r/o,this.uid=0;var I=s/r*o;this.min=-I,this.max=o+I}Io.prototype.insert=function(o,r,s,l,h){this._forEachCell(r,s,l,h,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)},Io.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Io.prototype._insertCell=function(o,r,s,l,h,m){this.cells[h].push(m)},Io.prototype.query=function(o,r,s,l,h){var m=this.min,_=this.max;if(o<=m&&r<=m&&_<=s&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(o,r,s,l,this._queryCell,b,{},h),b},Io.prototype._queryCell=function(o,r,s,l,h,m,_,b){var E=this.cells[h];if(null!==E)for(var C=this.keys,I=this.bboxes,M=0;M<E.length;M++){var k=E[M];if(void 0===_[k]){var B=4*k;(b?b(I[B+0],I[B+1],I[B+2],I[B+3]):o<=I[B+2]&&r<=I[B+3]&&s>=I[B+0]&&l>=I[B+1])?(_[k]=!0,m.push(C[k])):_[k]=!1}}},Io.prototype._forEachCell=function(o,r,s,l,h,m,_,b){for(var E=this._convertToCellCoord(o),C=this._convertToCellCoord(r),I=this._convertToCellCoord(s),M=this._convertToCellCoord(l),k=E;k<=I;k++)for(var B=C;B<=M;B++){var N=this.d*B+k;if((!b||b(this._convertFromCellCoord(k),this._convertFromCellCoord(B),this._convertFromCellCoord(k+1),this._convertFromCellCoord(B+1)))&&h.call(this,o,r,s,l,N,m,_,b))return}},Io.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Io.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Io.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var h=new Int32Array(r+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=r,_=0;_<o.length;_++){var b=o[_];h[3+_]=m,h.set(b,m),m+=b.length}return h[3+o.length]=m,h.set(this.keys,m),h[3+o.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const{ImageData:Ls,ImageBitmap:_i}=at,vl={};function tt(o,r,s={}){Object.defineProperty(r,"_classRegistryKey",{value:o,writeable:!1}),vl[o]={klass:r,omit:s.omit||[],shallow:s.shallow||[]}}tt("Object",Object),Sa.serialize=function(o,r){const s=o.toArrayBuffer();return r&&r.push(s),{buffer:s}},Sa.deserialize=function(o){return new Sa(o.buffer)},tt("Grid",Sa),tt("Color",yt),tt("Error",Error),tt("ResolvedImage",Ur),tt("StylePropertyFunction",Ar),tt("StyleExpression",mu,{omit:["_evaluator"]}),tt("ZoomDependentExpression",Rs),tt("ZoomConstantExpression",go),tt("CompoundExpression",Lt,{omit:["_evaluate"]});for(const o in pn)pn[o]._classRegistryKey||tt(`Expression_${o}`,pn[o]);function Os(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Gr(o){return _i&&o instanceof _i}function Ia(o,r){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Os(o)||Gr(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return r&&r.push(s.buffer),s}if(o instanceof Ls)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const l of o)s.push(Ia(l,r));return s}if("object"==typeof o){const s=o.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const h=s.serialize?s.serialize(o,r):{};if(!s.serialize){for(const m in o){if(!o.hasOwnProperty(m)||vl[l].omit.indexOf(m)>=0)continue;const _=o[m];h[m]=vl[l].shallow.indexOf(m)>=0?_:Ia(_,r)}o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof o)}function zs(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Os(o)||Gr(o)||ArrayBuffer.isView(o)||o instanceof Ls)return o;if(Array.isArray(o))return o.map(zs);if("object"==typeof o){const r=o.$name||"Object",{klass:s}=vl[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(o);const l=Object.create(s.prototype);for(const h of Object.keys(o)){if("$name"===h)continue;const m=o[h];l[h]=vl[r].shallow.indexOf(h)>=0?m:zs(m)}return l}throw new Error("can't deserialize object of type "+typeof o)}class zh{constructor(){this.first=!0}update(r,s){const l=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=l,!0))}}const Mo=o=>o>=1536&&o<=1791,Du=o=>o>=1872&&o<=1919,yc=o=>o>=2208&&o<=2303,wt=o=>o>=11904&&o<=12031,vc=o=>o>=12032&&o<=12255,Bh=o=>o>=12272&&o<=12287,xc=o=>o>=12288&&o<=12351,Ma=o=>o>=12352&&o<=12447,xl=o=>o>=12448&&o<=12543,Cu=o=>o>=12544&&o<=12591,Nh=o=>o>=12704&&o<=12735,Ue=o=>o>=12736&&o<=12783,Ht=o=>o>=12784&&o<=12799,Tu=o=>o>=12800&&o<=13055,Yn=o=>o>=13056&&o<=13311,bl=o=>o>=13312&&o<=19903,Ao=o=>o>=19968&&o<=40959,Yi=o=>o>=40960&&o<=42127,bc=o=>o>=42128&&o<=42191,Bs=o=>o>=44032&&o<=55215,pp=o=>o>=63744&&o<=64255,is=o=>o>=64336&&o<=65023,wl=o=>o>=65040&&o<=65055,os=o=>o>=65072&&o<=65103,Pr=o=>o>=65104&&o<=65135,Ki=o=>o>=65136&&o<=65279,wc=o=>o>=65280&&o<=65519;function yi(o){for(const r of o)if(Ec(r.charCodeAt(0)))return!0;return!1}function ki(o){for(const r of o)if(!El(r.charCodeAt(0)))return!1;return!0}function El(o){return!(Mo(o)||Du(o)||yc(o)||is(o)||Ki(o))}function Ec(o){return!(746!==o&&747!==o&&(o<4352||!(Nh(o)||Cu(o)||os(o)&&!(o>=65097&&o<=65103)||pp(o)||Yn(o)||wt(o)||Ue(o)||!(!xc(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||bl(o)||Ao(o)||Tu(o)||(r=o,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(o)||(r=>r>=55216&&r<=55295)(o)||(r=>r>=4352&&r<=4607)(o)||Bs(o)||Ma(o)||Bh(o)||(r=>r>=12688&&r<=12703)(o)||vc(o)||Ht(o)||xl(o)&&12540!==o||!(!wc(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Pr(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(r=>r>=5120&&r<=5759)(o)||(r=>r>=6320&&r<=6399)(o)||wl(o)||(r=>r>=19904&&r<=19967)(o)||Yi(o)||bc(o))));var r}function Su(o){return!(Ec(o)||(r=o,(s=r)>=128&&s<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(s=>s>=8192&&s<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(s=>s>=8448&&s<=8527)(r)||(s=>s>=8528&&s<=8591)(r)||(s=>s>=8960&&s<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(s=>s>=9216&&s<=9279)(r)&&9251!==r||(s=>s>=9280&&s<=9311)(r)||(s=>s>=9312&&s<=9471)(r)||(s=>s>=9632&&s<=9727)(r)||(s=>s>=9728&&s<=9983)(r)&&!(r>=9754&&r<=9759)||(s=>s>=11008&&s<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||xc(r)||xl(r)||(s=>s>=57344&&s<=63743)(r)||os(r)||Pr(r)||wc(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,s}function Aa(o){return o>=1424&&o<=2303||is(o)||Ki(o)}function Iu(o,r){return!(!r&&Aa(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=o,s>=6016&&s<=6143));var s}function Mu(o){for(const r of o)if(Aa(r.charCodeAt(0)))return!0;return!1}const Ns="deferred",f="loading",i="loaded";let u=null,g="unavailable",v=null;const x=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(g="error"),u&&u(o)};function D(){S.fire(new Le("pluginStateChange",{pluginStatus:g,pluginURL:v}))}const S=new Ze,A=function(){return g},R=function(){if(g!==Ns||!v)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=f,D(),v&&U({url:v},o=>{o?x(o):(g=i,D())})},F={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===i||null!=F.applyArabicShaping,isLoading:()=>g===f,setState(o){g=o.pluginStatus,v=o.pluginURL},isParsed:()=>null!=F.applyArabicShaping&&null!=F.processBidirectionalText&&null!=F.processStyledBidirectionalText,getPluginURL:()=>v};class L{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zh,this.transition={},this.pitch=0)}isSupportedScript(r){return function(s,l){for(const h of s)if(!Iu(h.charCodeAt(0),l))return!1;return!0}(r,F.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),l=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class j{constructor(r,s){this.property=r,this.value=s,this.expression=function(l,h){if(ba(l))return new Ar(l,h);if(nr(l)){const m=fl(l,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===h.type&&(m=yt.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===s?r.specification.default:s,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,s,l){return this.property.possiblyEvaluate(this,r,s,l)}}class G{constructor(r){this.property=r,this.value=new j(r,void 0)}transitioned(r,s){return new q(this.property,this.value,s,zn({},r.transition,this.transition),r.now)}untransitioned(){return new q(this.property,this.value,null,{},0)}}class X{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return dr(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new G(this._values[r].property)),this._values[r].value=new j(this._values[r].property,null===s?void 0:dr(s))}getTransition(r){return dr(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new G(this._values[r].property)),this._values[r].transition=dr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(r[s]=l);const h=this.getTransition(s);void 0!==h&&(r[`${s}-transition`]=h)}return r}transitioned(r,s){const l=new J(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(r,s._values[h]);return l}untransitioned(){const r=new J(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class q{constructor(r,s,l,h,m){const _=h.delay||0,b=h.duration||0;m=m||0,this.property=r,this.value=s,this.begin=m+_,this.end=this.begin+b,r.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(r,s,l){const h=r.now||0,m=this.value.possiblyEvaluate(r,s,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(r,s,l);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,s,l),m,Ti(b))}}return m}}class J{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,l){const h=new re(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,s,l);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class H{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return dr(this._values[r].value)}setValue(r,s){this._values[r]=new j(this._values[r].property,null===s?void 0:dr(s))}serialize(){const r={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(r[s]=l)}return r}possiblyEvaluate(r,s,l){const h=new re(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,s,l);return h}}class ee{constructor(r,s,l){this.property=r,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,s,l,h){return this.property.evaluate(this.value,this.parameters,r,s,l,h)}}class re{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Z{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,l){const h=ll[this.specification.type];return h?h(r,s,l):r}}class ie{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,l,h){return new ee(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(s,null,{},l,h)}:r.expression,s)}interpolate(r,s,l){if("constant"!==r.value.kind||"constant"!==s.value.kind)return r;if(void 0===r.value.value||void 0===s.value.value)return new ee(this,{kind:"constant",value:void 0},r.parameters);const h=ll[this.specification.type];return h?new ee(this,{kind:"constant",value:h(r.value.value,s.value.value,l)},r.parameters):r}evaluate(r,s,l,h,m,_){return"constant"===r.kind?r.value:r.evaluate(s,l,h,m,_)}}class le extends ie{possiblyEvaluate(r,s,l,h){if(void 0===r.value)return new ee(this,{kind:"constant",value:void 0},s);if("constant"===r.expression.kind){const m=r.expression.evaluate(s,null,{},l,h),_="resolvedImage"===r.property.specification.type&&"string"!=typeof m?m.name:m,b=this._calculate(_,_,_,s);return new ee(this,{kind:"constant",value:b},s)}if("camera"===r.expression.kind){const m=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new ee(this,{kind:"constant",value:m},s)}return new ee(this,r.expression,s)}evaluate(r,s,l,h,m,_){if("source"===r.kind){const b=r.evaluate(s,l,h,m,_);return this._calculate(b,b,b,s)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},l,h),r.evaluate({zoom:Math.floor(s.zoom)},l,h),r.evaluate({zoom:Math.floor(s.zoom)+1},l,h),s):r.value}_calculate(r,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:s,other:l}:{from:l,to:s,other:r}}interpolate(r){return r}}class be{constructor(r){this.specification=r}possiblyEvaluate(r,s,l,h){if(void 0!==r.value){if("constant"===r.expression.kind){const m=r.expression.evaluate(s,null,{},l,h);return this._calculate(m,m,m,s)}return this._calculate(r.expression.evaluate(new L(Math.floor(s.zoom-1),s)),r.expression.evaluate(new L(Math.floor(s.zoom),s)),r.expression.evaluate(new L(Math.floor(s.zoom+1),s)),s)}}_calculate(r,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:l,to:s}}interpolate(r){return r}}class xe{constructor(r){this.specification=r}possiblyEvaluate(r,s,l,h){return!!r.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class Te{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const l=r[s];l.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new j(l,void 0),m=this.defaultTransitionablePropertyValues[s]=new G(l);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}function Ee(o,r){return 256*(o=Kt(Math.floor(o),0,255))+Kt(Math.floor(r),0,255)}tt("DataDrivenProperty",ie),tt("DataConstantProperty",Z),tt("CrossFadedDataDrivenProperty",le),tt("CrossFadedProperty",be),tt("ColorRampProperty",xe);const Ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ce{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ye(o,r=1){let s=0,l=0;return{members:o.map(h=>{const m=Ve[h.type].BYTES_PER_ELEMENT,_=s=He(s,Math.max(r,m)),b=h.components||1;return l=Math.max(l,m),s+=m*b,{name:h.name,type:h.type,components:b,offset:_}}),size:He(s,Math.max(l,r)),alignment:r}}function He(o,r){return Math.ceil(o/r)*r}class nt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const l=this.length;return this.resize(l+1),this.emplace(l,r,s)}emplace(r,s,l){const h=2*r;return this.int16[h+0]=s,this.int16[h+1]=l,r}}nt.prototype.bytesPerElement=4,tt("StructArrayLayout2i4",nt);class ct extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,l,h)}emplace(r,s,l,h,m){const _=4*r;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=m,r}}ct.prototype.bytesPerElement=8,tt("StructArrayLayout4i8",ct);class ft extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,l,h,m,_,b)}emplace(r,s,l,h,m,_,b,E){const C=6*r,I=12*r,M=3*r;return this.int16[C+0]=s,this.int16[C+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=m,this.uint8[I+6]=_,this.uint8[I+7]=b,this.float32[M+2]=E,r}}ft.prototype.bytesPerElement=12,tt("StructArrayLayout2i4ub1f12",ft);class mt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,l)}emplace(r,s,l,h){const m=3*r;return this.float32[m+0]=s,this.float32[m+1]=l,this.float32[m+2]=h,r}}mt.prototype.bytesPerElement=12,tt("StructArrayLayout3f12",mt);class dt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E,C,I){const M=this.length;return this.resize(M+1),this.emplace(M,r,s,l,h,m,_,b,E,C,I)}emplace(r,s,l,h,m,_,b,E,C,I,M){const k=10*r;return this.uint16[k+0]=s,this.uint16[k+1]=l,this.uint16[k+2]=h,this.uint16[k+3]=m,this.uint16[k+4]=_,this.uint16[k+5]=b,this.uint16[k+6]=E,this.uint16[k+7]=C,this.uint16[k+8]=I,this.uint16[k+9]=M,r}}dt.prototype.bytesPerElement=20,tt("StructArrayLayout10ui20",dt);class lt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,s,l,h,m,_,b,E)}emplace(r,s,l,h,m,_,b,E,C){const I=8*r;return this.uint16[I+0]=s,this.uint16[I+1]=l,this.uint16[I+2]=h,this.uint16[I+3]=m,this.uint16[I+4]=_,this.uint16[I+5]=b,this.uint16[I+6]=E,this.uint16[I+7]=C,r}}lt.prototype.bytesPerElement=16,tt("StructArrayLayout8ui16",lt);class vt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K){const te=this.length;return this.resize(te+1),this.emplace(te,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K)}emplace(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te){const oe=16*r;return this.int16[oe+0]=s,this.int16[oe+1]=l,this.int16[oe+2]=h,this.int16[oe+3]=m,this.uint16[oe+4]=_,this.uint16[oe+5]=b,this.uint16[oe+6]=E,this.uint16[oe+7]=C,this.int16[oe+8]=I,this.int16[oe+9]=M,this.int16[oe+10]=k,this.int16[oe+11]=B,this.int16[oe+12]=N,this.int16[oe+13]=$,this.int16[oe+14]=K,this.int16[oe+15]=te,r}}vt.prototype.bytesPerElement=32,tt("StructArrayLayout4i4ui4i4i32",vt);class Zt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}Zt.prototype.bytesPerElement=4,tt("StructArrayLayout1ul4",Zt);class Kn extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E,C,I,M,k,B){const N=this.length;return this.resize(N+1),this.emplace(N,r,s,l,h,m,_,b,E,C,I,M,k,B)}emplace(r,s,l,h,m,_,b,E,C,I,M,k,B,N){const $=20*r,K=10*r;return this.int16[$+0]=s,this.int16[$+1]=l,this.int16[$+2]=h,this.int16[$+3]=m,this.int16[$+4]=_,this.float32[K+3]=b,this.float32[K+4]=E,this.float32[K+5]=C,this.float32[K+6]=I,this.int16[$+14]=M,this.uint32[K+8]=k,this.uint16[$+18]=B,this.uint16[$+19]=N,r}}Kn.prototype.bytesPerElement=40,tt("StructArrayLayout5i4f1i1ul2ui40",Kn);class mr extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,l,h,m,_,b)}emplace(r,s,l,h,m,_,b,E){const C=8*r;return this.int16[C+0]=s,this.int16[C+1]=l,this.int16[C+2]=h,this.int16[C+4]=m,this.int16[C+5]=_,this.int16[C+6]=b,this.int16[C+7]=E,r}}mr.prototype.bytesPerElement=16,tt("StructArrayLayout3i2i2i16",mr);class Qn extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,s,l,h,m)}emplace(r,s,l,h,m,_){const b=4*r,E=8*r;return this.float32[b+0]=s,this.float32[b+1]=l,this.float32[b+2]=h,this.int16[E+6]=m,this.int16[E+7]=_,r}}Qn.prototype.bytesPerElement=16,tt("StructArrayLayout2f1f2i16",Qn);class qr extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,l,h)}emplace(r,s,l,h,m){const _=12*r,b=3*r;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[b+1]=h,this.float32[b+2]=m,r}}qr.prototype.bytesPerElement=12,tt("StructArrayLayout2ub2f12",qr);class kn extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,l)}emplace(r,s,l,h){const m=3*r;return this.uint16[m+0]=s,this.uint16[m+1]=l,this.uint16[m+2]=h,r}}kn.prototype.bytesPerElement=6,tt("StructArrayLayout3ui6",kn);class Qi extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he){const ge=this.length;return this.resize(ge+1),this.emplace(ge,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he)}emplace(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he,ge){const Me=30*r,we=15*r,Xe=60*r;return this.int16[Me+0]=s,this.int16[Me+1]=l,this.int16[Me+2]=h,this.float32[we+2]=m,this.float32[we+3]=_,this.uint16[Me+8]=b,this.uint16[Me+9]=E,this.uint32[we+5]=C,this.uint32[we+6]=I,this.uint32[we+7]=M,this.uint16[Me+16]=k,this.uint16[Me+17]=B,this.uint16[Me+18]=N,this.float32[we+10]=$,this.float32[we+11]=K,this.uint8[Xe+48]=te,this.uint8[Xe+49]=oe,this.uint8[Xe+50]=ue,this.uint32[we+13]=pe,this.int16[Me+28]=he,this.uint8[Xe+58]=ge,r}}Qi.prototype.bytesPerElement=60,tt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Qi);class vi extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he,ge,Me,we,Xe,Ne,Ae,Be,$e,ke){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he,ge,Me,we,Xe,Ne,Ae,Be,$e,ke)}emplace(r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K,te,oe,ue,pe,he,ge,Me,we,Xe,Ne,Ae,Be,$e,ke,Ke){const Je=38*r,ut=19*r;return this.int16[Je+0]=s,this.int16[Je+1]=l,this.int16[Je+2]=h,this.float32[ut+2]=m,this.float32[ut+3]=_,this.int16[Je+8]=b,this.int16[Je+9]=E,this.int16[Je+10]=C,this.int16[Je+11]=I,this.int16[Je+12]=M,this.int16[Je+13]=k,this.uint16[Je+14]=B,this.uint16[Je+15]=N,this.uint16[Je+16]=$,this.uint16[Je+17]=K,this.uint16[Je+18]=te,this.uint16[Je+19]=oe,this.uint16[Je+20]=ue,this.uint16[Je+21]=pe,this.uint16[Je+22]=he,this.uint16[Je+23]=ge,this.uint16[Je+24]=Me,this.uint16[Je+25]=we,this.uint16[Je+26]=Xe,this.uint16[Je+27]=Ne,this.uint16[Je+28]=Ae,this.uint32[ut+15]=Be,this.float32[ut+16]=$e,this.float32[ut+17]=ke,this.float32[ut+18]=Ke,r}}vi.prototype.bytesPerElement=76,tt("StructArrayLayout3i2f6i15ui1ul3f76",vi);class Sn extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}Sn.prototype.bytesPerElement=4,tt("StructArrayLayout1f4",Sn);class Nn extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,l)}emplace(r,s,l,h){const m=3*r;return this.int16[m+0]=s,this.int16[m+1]=l,this.int16[m+2]=h,r}}Nn.prototype.bytesPerElement=6,tt("StructArrayLayout3i6",Nn);class Nt extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,l,h)}emplace(r,s,l,h,m){const _=6*r;return this.uint32[3*r+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=m,r}}Nt.prototype.bytesPerElement=12,tt("StructArrayLayout1ul3ui12",Nt);class In extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const l=this.length;return this.resize(l+1),this.emplace(l,r,s)}emplace(r,s,l){const h=2*r;return this.uint16[h+0]=s,this.uint16[h+1]=l,r}}In.prototype.bytesPerElement=4,tt("StructArrayLayout2ui4",In);class Er extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}Er.prototype.bytesPerElement=2,tt("StructArrayLayout1ui2",Er);class ln extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const l=this.length;return this.resize(l+1),this.emplace(l,r,s)}emplace(r,s,l){const h=2*r;return this.float32[h+0]=s,this.float32[h+1]=l,r}}ln.prototype.bytesPerElement=8,tt("StructArrayLayout2f8",ln);class Hr extends qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,l,h)}emplace(r,s,l,h,m){const _=4*r;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=m,r}}Hr.prototype.bytesPerElement=16,tt("StructArrayLayout4f16",Hr);class Us extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Us.prototype.size=40;class Dr extends Kn{get(r){return new Us(this,r)}}tt("CollisionBoxArray",Dr);class Ji extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Ji.prototype.size=60;class Uh extends Qi{get(r){return new Ji(this,r)}}tt("PlacedSymbolArray",Uh);class Dl extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Dl.prototype.size=76;class Vs extends vi{get(r){return new Dl(this,r)}}tt("SymbolInstanceArray",Vs);class Au extends Sn{getoffsetX(r){return this.float32[1*r+0]}}tt("GlyphOffsetArray",Au);class Pa extends Nn{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}tt("SymbolLineVertexArray",Pa);class Dc extends Ce{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Dc.prototype.size=12;class um extends Nt{get(r){return new Dc(this,r)}}tt("FeatureIndexArray",um);class Pu extends Ce{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Pu.prototype.size=4;class Cc extends In{get(r){return new Pu(this,r)}}tt("FillExtrusionCentroidArray",Cc);const __=ye([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),hm=ye([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var fp=ua(function(o){o.exports=function(r,s){var l,h,m,_,b,E,C,I;for(h=r.length-(l=3&r.length),m=s,b=3432918353,E=461845907,I=0;I<h;)C=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,m=27492+(65535&(_=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&r.charCodeAt(I+2))<<16;case 2:C^=(255&r.charCodeAt(I+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&r.charCodeAt(I)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Tc=ua(function(o){o.exports=function(r,s){for(var l,h=r.length,m=s^h,_=0;h>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&r.charCodeAt(_+2))<<16;case 2:m^=(255&r.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),ku=fp,mp=Tc;ku.murmur3=fp,ku.murmur2=mp;class ka{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,l,h){this.ids.push(Cl(r)),this.positions.push(s,l,h)}getPositions(r){const s=Cl(r);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=s?h=_:l=_+1}const m=[];for(;this.ids[l]===s;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(r,s){const l=new Float64Array(r.ids),h=new Uint32Array(r.positions);return Ra(l,h,0,l.length-1),s&&s.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(r){const s=new ka;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function Cl(o){const r=+o;return!isNaN(r)&&r<=Ni?r:ku(String(o))}function Ra(o,r,s,l){for(;s<l;){const h=o[s+l>>1];let m=s-1,_=l+1;for(;;){do{m++}while(o[m]<h);do{_--}while(o[_]>h);if(m>=_)break;js(o,m,_),js(r,3*m,3*_),js(r,3*m+1,3*_+1),js(r,3*m+2,3*_+2)}_-s<l-_?(Ra(o,r,s,_),s=_+1):(Ra(o,r,_+1,l),l=_)}}function js(o,r,s){const l=o[r];o[r]=o[s],o[s]=l}tt("FeaturePositionMap",ka);class ss{constructor(r,s){this.gl=r.gl,this.location=s}}class Sc extends ss{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Tl extends ss{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class y_ extends ss{constructor(r,s){super(r,s),this.current=yt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const v_=new Float32Array(16),cn=new Float32Array(9),x_=new Float32Array(4);function dm(o){return[Ee(255*o.r,255*o.g),Ee(255*o.b,255*o.a)]}class Vh{constructor(r,s,l){this.value=r,this.uniformNames=s.map(h=>`u_${h}`),this.type=l}setUniform(r,s,l){r.set(l.constantOr(this.value))}getBinding(r,s,l){return"color"===this.type?new y_(r,s):new Sc(r,s)}}class Ru{constructor(r,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,s,l,h){const m="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;m&&r.set(m)}getBinding(r,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new Tl(r,s):new Sc(r,s)}}class Fa{constructor(r,s,l,h){this.expression=r,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,s,l,h,m,_){const b=this.paintVertexArray.length,E=this.expression.evaluate(new L(0),s,{},m,h,_);this.paintVertexArray.resize(r),this._setPaintValue(b,r,E)}updatePaintArray(r,s,l,h,m){const _=this.expression.evaluate({zoom:0},l,h,void 0,m);this._setPaintValue(r,s,_)}_setPaintValue(r,s,l){if("color"===this.type){const h=dm(l);for(let m=r;m<s;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=r;h<s;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class as{constructor(r,s,l,h,m,_){this.expression=r,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,s,l,h,m,_){const b=this.expression.evaluate(new L(this.zoom),s,{},m,h,_),E=this.expression.evaluate(new L(this.zoom+1),s,{},m,h,_),C=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(C,r,b,E)}updatePaintArray(r,s,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,m),b=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,m);this._setPaintValue(r,s,_,b)}_setPaintValue(r,s,l,h){if("color"===this.type){const m=dm(l),_=dm(h);for(let b=r;b<s;b++)this.paintVertexArray.emplace(b,m[0],m[1],_[0],_[1])}else{for(let m=r;m<s;m++)this.paintVertexArray.emplace(m,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=Kt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,s,l){return new Sc(r,s)}}class Sl{constructor(r,s,l,h,m,_,b){this.expression=r,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=b,this.paintVertexAttributes=("array"===l?hm:__).members;for(let E=0;E<s.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,s,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(r,s,l,h,m,_){this._setPaintValues(r,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(r,s,l,h){if(!h||!l)return;const{min:m,mid:_,max:b}=l,E=h[m],C=h[_],I=h[b];if(E&&C&&I)for(let M=r;M<s;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,C,E),this._setPaintValue(this.zoomOutPaintVertexArray,M,C,I)}_setPaintValue(r,s,l,h){r.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class eo{constructor(r,s,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in r.paint._values){if(!l(m))continue;const _=r.paint.get(m);if(!(_ instanceof ee&&gi(_.property.specification)))continue;const b=gp(m,r.type),E=_.value,C=_.property.specification.type,I=_.property.useIntegerZoom,M=_.property.specification["property-type"],k="cross-faded"===M||"cross-faded-data-driven"===M,B="line-dasharray"===String(m)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||B)if("source"===E.kind||B||k){const N=pm(m,C,"source");this.binders[m]=k?new Sl(E,b,C,I,s,N,r.id):new Fa(E,b,C,N),h.push(`/a_${m}`)}else{const N=pm(m,C,"composite");this.binders[m]=new as(E,b,C,I,s,N),h.push(`/z_${m}`)}else this.binders[m]=k?new Ru(E.value,b):new Vh(E.value,b,C),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof Fa||s instanceof as?s.maxValue:0}populatePaintArrays(r,s,l,h,m,_){for(const b in this.binders){const E=this.binders[b];(E instanceof Fa||E instanceof as||E instanceof Sl)&&E.populatePaintArray(r,s,l,h,m,_)}}setConstantPatternPositions(r,s){for(const l in this.binders){const h=this.binders[l];h instanceof Ru&&h.setConstantPatternPositions(r,s)}}updatePaintArrays(r,s,l,h,m,_){let b=!1;for(const E in r){const C=s.getPositions(E);for(const I of C){const M=l.feature(I.index);for(const k in this.binders){const B=this.binders[k];if((B instanceof Fa||B instanceof as||B instanceof Sl)&&!0===B.expression.isStateDependent){const N=h.paint.get(k);B.expression=N.value,B.updatePaintArray(I.start,I.end,M,r[E],m,_),b=!0}}}}return b}defines(){const r=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Vh||l instanceof Ru)&&r.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Fa||l instanceof as||l instanceof Sl)for(let h=0;h<l.paintVertexAttributes.length;h++)r.push(l.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Vh||l instanceof Ru||l instanceof as)for(const h of l.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Vh||m instanceof Ru||m instanceof as)for(const _ of m.uniformNames)if(s[_]){const b=m.getBinding(r,s[_],_);l.push({name:_,property:h,binding:b})}}return l}setUniforms(r,s,l,h){for(const{name:m,property:_,binding:b}of s)this.binders[_].setUniform(b,h,l.get(_),m)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(r&&l instanceof Sl){const h=2===r.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Fa||l instanceof as)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const s in this.binders){const l=this.binders[s];(l instanceof Fa||l instanceof as||l instanceof Sl)&&l.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof Fa||s instanceof as||s instanceof Sl)&&s.destroy()}}}class Ic{constructor(r,s,l=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new eo(h,s,l);this.needsUpload=!1,this._featureMap=new ka,this._bufferOffset=0}populatePaintArrays(r,s,l,h,m,_,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,s,h,m,_,b);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,l,h,m){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,s,_,h,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Cr={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function gp(o,r){return Cr[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const Fu={"line-pattern":{source:dt,composite:dt},"fill-pattern":{source:dt,composite:dt},"fill-extrusion-pattern":{source:dt,composite:dt},"line-dasharray":{source:lt,composite:lt}},xx={color:{source:ln,composite:Hr},number:{source:Sn,composite:ln}};function pm(o,r,s){const l=Fu[o];return l&&l[s]||xx[r][s]}tt("ConstantBinder",Vh),tt("CrossFadedConstantBinder",Ru),tt("SourceExpressionBinder",Fa),tt("CrossFadedCompositeBinder",Sl),tt("CompositeExpressionBinder",as),tt("ProgramConfiguration",eo,{omit:["_buffers"]}),tt("ProgramConfigurationSet",Ic);const xi="-transition";class gr extends Ze{constructor(r,s){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),s.layout&&(this._unevaluatedLayout=new H(s.layout)),s.paint)){this._transitionablePaint=new X(s.paint);for(const l in r.paint)this.setPaintProperty(l,r.paint[l],{validate:!1});for(const l in r.layout)this.setLayoutProperty(l,r.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s,l={}){null!=s&&this._validate(Oh,`layers.${this.id}.layout.${r}`,r,s,l)||("visibility"!==r?this._unevaluatedLayout.setValue(r,s):this.visibility=s)}getPaintProperty(r){return qo(r,xi)?this._transitionablePaint.getTransition(r.slice(0,-xi.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,l={}){if(null!=s&&this._validate(yl,`layers.${this.id}.paint.${r}`,r,s,l))return!1;if(qo(r,xi))return this._transitionablePaint.setTransition(r.slice(0,-xi.length),s||void 0),!1;{const h=this._transitionablePaint._values[r],m="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),b=h.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(r,b,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,s,l){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),co(r,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(r,s,l,h,m={}){return(!m||!1!==m.validate)&&Xn(this,r.call(So,{key:s,layerType:this.type,objectKey:l,value:h,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof ee&&gi(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=dc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const fm=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:jh}=fm;class Jn{constructor(r=[]){this.segments=r}prepareSegment(r,s,l,h){let m=this.segments[this.segments.length-1];return r>Jn.MAX_VERTEX_ARRAY_LENGTH&&Pn(`Max vertices per segment is ${Jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>Jn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,l,h){return new Jn([{vertexOffset:r,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}Jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt("SegmentVector",Jn);var Ut=8192;class Il{constructor(r,s){r&&(s?this.setSouthWest(r).setNorthEast(s):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof _n?new _n(r.lng,r.lat):_n.convert(r),this}setSouthWest(r){return this._sw=r instanceof _n?new _n(r.lng,r.lat):_n.convert(r),this}extend(r){const s=this._sw,l=this._ne;let h,m;if(r instanceof _n)h=r,m=r;else{if(!(r instanceof Il))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Il.convert(r)):this.extend(_n.convert(r)):this;if(h=r._sw,m=r._ne,!h||!m)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new _n(h.lng,h.lat),this._ne=new _n(m.lng,m.lat)),this}getCenter(){return new _n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _n(this.getWest(),this.getNorth())}getSouthEast(){return new _n(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:l}=_n.convert(r);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(r){return!r||r instanceof Il?r:new Il(r)}}const mm=6371008.8;class _n{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _n(xo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,l=this.lat*s,h=r.lat*s,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((r.lng-this.lng)*s);return mm*Math.acos(Math.min(m,1))}toBounds(r=0){const s=360*r/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Il(new _n(this.lng-l,this.lat-s),new _n(this.lng+l,this.lat+s))}static convert(r){if(r instanceof _n)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new _n(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new _n(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const b_=2*Math.PI*mm;function _p(o){return b_*Math.cos(o*Math.PI/180)}function bi(o){return(180+o)/360}function Lu(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function La(o,r){return o/_p(r)}function Mc(o){return 360*o-180}function Po(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function yp(o,r){return o*_p(Po(r))}const Oa=85.051129;class $h{constructor(r,s,l=0){this.x=+r,this.y=+s,this.z=+l}static fromLngLat(r,s=0){const l=_n.convert(r);return new $h(bi(l.lng),Lu(l.lat),La(s,l.lat))}toLngLat(){return new _n(Mc(this.x),Po(this.y))}toAltitude(){return yp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/b_*(r=Po(this.y),1/Math.cos(r*Math.PI/180));var r}}function vp(o,r,s,l,h,m,_,b,E){const C=(r+l)/2,I=(s+h)/2,M=new ze(C,I);b(M),function(k,B,N,$,K,te){const oe=N-K,ue=$-te;return Math.abs(($-B)*oe-(N-k)*ue)/Math.hypot(oe,ue)}(M.x,M.y,m.x,m.y,_.x,_.y)>=E?(vp(o,r,s,C,I,m,M,b,E),vp(o,C,I,l,h,M,_,b,E)):o.push(_)}function w_(o,r,s){const l=[];let h,m,_;for(const b of o){const{x:E,y:C}=b;r(b),_?vp(l,h,m,E,C,_,b,r,s):l.push(b),h=E,m=C,_=b}return l}const Gh=Math.pow(2,14)-1,qh=-Gh-1;function Hh(o,r){const s=Math.round(o.x*r),l=Math.round(o.y*r);return o.x=Kt(s,qh,Gh),o.y=Kt(l,qh,Gh),(s<o.x||s>o.x+1||l<o.y||l>o.y+1)&&Pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function za(o,r,s){const l=o.loadGeometry(),h=o.extent,m=Ut/h;if(r&&s&&"mercator"!==s.projection.name){const _=1<<r.z,{scale:b,x:E,y:C,projection:I}=s,M=k=>{const B=Mc((r.x+k.x/h)/_),N=Po((r.y+k.y/h)/_),$=I.project(B,N);k.x=($.x*b-E)*h,k.y=($.y*b-C)*h};for(let k=0;k<l.length;k++)if(1!==o.type)l[k]=w_(l[k],M,1);else{const B=[];for(const N of l[k])N.x<0||N.x>=h||N.y<0||N.y>=h||(M(N),B.push(N));l[k]=B}}for(const _ of l)for(const b of _)Hh(b,m);return l}function ko(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?za(o):[]}}function Ac(o,r,s,l,h){o.emplaceBack(2*r+(l+1)/2,2*s+(h+1)/2)}class Pc{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new nt,this.indexArray=new kn,this.segments=new Jn,this.programConfigurations=new Ic(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,l,h){const m=this.layers[0],_=[];let b=null;"circle"===m.type&&(b=m.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:I,sourceLayerIndex:M}of r){const k=this.layers[0]._featureFilter.needGeometry,B=ko(E,k);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),B,l))continue;const N=b?b.evaluate(B,{},l):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:M,index:I,geometry:k?B.geometry:za(E,l,h),patterns:{},sortKey:N};_.push($)}b&&_.sort((E,C)=>E.sortKey-C.sortKey);for(const E of _){const{geometry:C,index:I,sourceLayerIndex:M}=E,k=r[I].feature;this.addFeature(E,C,I,s.availableImages,l),s.featureIndex.insert(k,C,I,M,this.index)}}update(r,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,jh),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,l,h,m){for(const _ of s)for(const b of _){const E=b.x,C=b.y;if(E<0||E>=Ut||C<0||C>=Ut)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),M=I.vertexLength;Ac(this.layoutVertexArray,E,C,-1,-1),Ac(this.layoutVertexArray,E,C,1,-1),Ac(this.layoutVertexArray,E,C,1,1),Ac(this.layoutVertexArray,E,C,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,{},h,m)}}function gm(o,r){for(let s=0;s<o.length;s++)if(Ml(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(Ml(o,r[s]))return!0;return!!xp(o,r)}function E_(o,r,s){return!!Ml(o,r)||!!Zh(r,o,s)}function _m(o,r){if(1===o.length)return Ct(r,o[0]);for(let s=0;s<r.length;s++){const l=r[s];for(let h=0;h<l.length;h++)if(Ml(o,l[h]))return!0}for(let s=0;s<o.length;s++)if(Ct(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(xp(o,r[s]))return!0;return!1}function ym(o,r,s){if(o.length>1){if(xp(o,r))return!0;for(let l=0;l<r.length;l++)if(Zh(r[l],o,s))return!0}for(let l=0;l<o.length;l++)if(Zh(o[l],r,s))return!0;return!1}function xp(o,r){if(0===o.length||0===r.length)return!1;for(let s=0;s<o.length-1;s++){const l=o[s],h=o[s+1];for(let m=0;m<r.length-1;m++)if(Ou(l,h,r[m],r[m+1]))return!0}return!1}function Ou(o,r,s,l){return di(o,s,l)!==di(r,s,l)&&di(o,r,s)!==di(o,r,l)}function Zh(o,r,s){const l=s*s;if(1===r.length)return o.distSqr(r[0])<l;for(let h=1;h<r.length;h++)if(vm(o,r[h-1],r[h])<l)return!0;return!1}function vm(o,r,s){const l=r.distSqr(s);if(0===l)return o.distSqr(r);const h=((o.x-r.x)*(s.x-r.x)+(o.y-r.y)*(s.y-r.y))/l;return o.distSqr(h<0?r:h>1?s:s.sub(r)._mult(h)._add(r))}function Ct(o,r){let s,l,h,m=!1;for(let _=0;_<o.length;_++){s=o[_];for(let b=0,E=s.length-1;b<s.length;E=b++)l=s[b],h=s[E],l.y>r.y!=h.y>r.y&&r.x<(h.x-l.x)*(r.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function Ml(o,r){let s=!1;for(let l=0,h=o.length-1;l<o.length;h=l++){const m=o[l],_=o[h];m.y>r.y!=_.y>r.y&&r.x<(_.x-m.x)*(r.y-m.y)/(_.y-m.y)+m.x&&(s=!s)}return s}function D_(o,r,s,l,h){for(const _ of o)if(r<=_.x&&s<=_.y&&l>=_.x&&h>=_.y)return!0;const m=[new ze(r,s),new ze(r,h),new ze(l,h),new ze(l,s)];if(o.length>2)for(const _ of m)if(Ml(o,_))return!0;for(let _=0;_<o.length-1;_++)if(bp(o[_],o[_+1],m))return!0;return!1}function bp(o,r,s){const l=s[0],h=s[2];if(o.x<l.x&&r.x<l.x||o.x>h.x&&r.x>h.x||o.y<l.y&&r.y<l.y||o.y>h.y&&r.y>h.y)return!1;const m=di(o,r,s[0]);return m!==di(o,r,s[1])||m!==di(o,r,s[2])||m!==di(o,r,s[3])}function ls(o,r,s){const l=r.paint.get(o).value;return"constant"===l.kind?l.value:s.programConfigurations.get(r.id).getMaxValue(o)}function Wh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function xm(o,r,s,l,h){if(!r[0]&&!r[1])return o;const m=ze.convert(r)._mult(h);"viewport"===s&&m._rotate(-l);const _=[];for(let b=0;b<o.length;b++)_.push(o[b].sub(m));return _}function bm(o,r,s,l){const h=ze.convert(o)._mult(l);return"viewport"===r&&h._rotate(-s),h}tt("CircleBucket",Pc,{omit:["layers"]});const zu=new Te({"circle-sort-key":new ie(de.layout_circle["circle-sort-key"])});var cs={paint:new Te({"circle-radius":new ie(de.paint_circle["circle-radius"]),"circle-color":new ie(de.paint_circle["circle-color"]),"circle-blur":new ie(de.paint_circle["circle-blur"]),"circle-opacity":new ie(de.paint_circle["circle-opacity"]),"circle-translate":new Z(de.paint_circle["circle-translate"]),"circle-translate-anchor":new Z(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Z(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Z(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ie(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ie(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ie(de.paint_circle["circle-stroke-opacity"])}),layout:zu},Zr="undefined"!=typeof Float32Array?Float32Array:Array;function Al(){var o=new Zr(9);return Zr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function wp(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ep(o,r,s){var l=r[0],h=r[1],m=r[2],_=r[3],b=r[4],E=r[5],C=r[6],I=r[7],M=r[8],k=r[9],B=r[10],N=r[11],$=r[12],K=r[13],te=r[14],oe=r[15],ue=s[0],pe=s[1],he=s[2],ge=s[3];return o[0]=ue*l+pe*b+he*M+ge*$,o[1]=ue*h+pe*E+he*k+ge*K,o[2]=ue*m+pe*C+he*B+ge*te,o[3]=ue*_+pe*I+he*N+ge*oe,o[4]=(ue=s[4])*l+(pe=s[5])*b+(he=s[6])*M+(ge=s[7])*$,o[5]=ue*h+pe*E+he*k+ge*K,o[6]=ue*m+pe*C+he*B+ge*te,o[7]=ue*_+pe*I+he*N+ge*oe,o[8]=(ue=s[8])*l+(pe=s[9])*b+(he=s[10])*M+(ge=s[11])*$,o[9]=ue*h+pe*E+he*k+ge*K,o[10]=ue*m+pe*C+he*B+ge*te,o[11]=ue*_+pe*I+he*N+ge*oe,o[12]=(ue=s[12])*l+(pe=s[13])*b+(he=s[14])*M+(ge=s[15])*$,o[13]=ue*h+pe*E+he*k+ge*K,o[14]=ue*m+pe*C+he*B+ge*te,o[15]=ue*_+pe*I+he*N+ge*oe,o}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var Dp=Ep;function Pl(){var o=new Zr(3);return Zr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Cp(o){return Math.hypot(o[0],o[1],o[2])}function kc(o,r,s){var l=new Zr(3);return l[0]=o,l[1]=r,l[2]=s,l}function wm(o,r,s){return o[0]=r[0]-s[0],o[1]=r[1]-s[1],o[2]=r[2]-s[2],o}function kl(o,r,s){return o[0]=r[0]*s[0],o[1]=r[1]*s[1],o[2]=r[2]*s[2],o}function Rc(o,r,s,l){return o[0]=r[0]+s[0]*l,o[1]=r[1]+s[1]*l,o[2]=r[2]+s[2]*l,o}function Em(o,r){var s=r[0],l=r[1],h=r[2],m=s*s+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),o[0]=r[0]*m,o[1]=r[1]*m,o[2]=r[2]*m,o}function C_(o,r,s){var l=s[0],h=s[1],m=s[2],_=r[0],b=r[1],E=r[2],C=h*E-m*b,I=m*_-l*E,M=l*b-h*_,k=h*M-m*I,B=m*C-l*M,N=l*I-h*C,$=2*s[3];return I*=$,M*=$,B*=2,N*=2,o[0]=_+(C*=$)+(k*=2),o[1]=b+I+B,o[2]=E+M+N,o}var Fc,o,T_=wm,bx=kl,S_=Cp;function Bu(o,r,s){var l=r[0],h=r[1],m=r[2],_=r[3];return o[0]=s[0]*l+s[4]*h+s[8]*m+s[12]*_,o[1]=s[1]*l+s[5]*h+s[9]*m+s[13]*_,o[2]=s[2]*l+s[6]*h+s[10]*m+s[14]*_,o[3]=s[3]*l+s[7]*h+s[11]*m+s[15]*_,o}function Tp(){var o=new Zr(4);return Zr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Nu(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Xh(o,r,s){s*=.5;var l=r[0],h=r[1],m=r[2],_=r[3],b=Math.sin(s),E=Math.cos(s);return o[0]=l*E+_*b,o[1]=h*E+m*b,o[2]=m*E-h*b,o[3]=_*E-l*b,o}function Rl(o,r){return o[0]===r[0]&&o[1]===r[1]}function Dm(o,r,s,l,h,m,_,b,E){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(E*=o.pixelToTileUnitsFactor);for(const C of r)for(const I of C){const M=I.add(b),k=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(M.x,M.y,!0):0,B=m?M:I_(M,k,l),N=m?o.tilespaceRays.map(K=>Sp(K,k)):o.queryGeometry.screenGeometry,$=Bu([],[I.x,I.y,k,1],l);if(!_&&m?E*=$[3]/s.cameraToCenterDistance:_&&!m&&(E*=s.cameraToCenterDistance/$[3]),E_(N,B,E))return!0}return!1}function I_(o,r,s){const l=Bu([],[o.x,o.y,r,1],s);return new ze(l[0]/l[3],l[1]/l[3])}Pl(),Fc=new Zr(4),Zr!=Float32Array&&(Fc[0]=0,Fc[1]=0,Fc[2]=0,Fc[3]=0),Pl(),kc(1,0,0),kc(0,1,0),Tp(),Tp(),Al(),o=new Zr(2),Zr!=Float32Array&&(o[0]=0,o[1]=0);const M_=kc(0,0,0),Yh=kc(0,0,1);function Sp(o,r){const s=Pl();return M_[2]=r,o.intersectsPlane(M_,Yh,s),new ze(s[0],s[1])}class Ip extends Pc{}function Kh(o,{width:r,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*s*l);return o.width=r,o.height=s,o.data=h,o}function Mp(o,{width:r,height:s},l){if(r===o.width&&s===o.height)return;const h=Kh({},{width:r,height:s},l);Qh(o,h,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,r),height:Math.min(o.height,s)},l),o.width=r,o.height=s,o.data=h.data}function Qh(o,r,s,l,h,m){if(0===h.width||0===h.height)return r;if(h.width>o.width||h.height>o.height||s.x>o.width-h.width||s.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||l.x>r.width-h.width||l.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=o.data,b=r.data;for(let E=0;E<h.height;E++){const C=((s.y+E)*o.width+s.x)*m,I=((l.y+E)*r.width+l.x)*m;for(let M=0;M<h.width*m;M++)b[I+M]=_[C+M]}return r}tt("HeatmapBucket",Ip,{omit:["layers"]});class Ba{constructor(r,s){Kh(this,r,1,s)}resize(r){Mp(this,r,1)}clone(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,l,h,m){Qh(r,s,l,h,m,1)}}class to{constructor(r,s){Kh(this,r,4,s)}resize(r){Mp(this,r,4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,l,h,m){Qh(r,s,l,h,m,4)}}tt("AlphaImage",Ba),tt("RGBAImage",to);var A_={paint:new Te({"heatmap-radius":new ie(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ie(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Z(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Z(de.paint_heatmap["heatmap-opacity"])})};function Ap(o){const r={},s=o.resolution||256,l=o.clips?o.clips.length:1,h=o.image||new to({width:s,height:l}),m=(_,b,E)=>{r[o.evaluationKey]=E;const C=o.expression.evaluate(r);h.data[_+b+0]=Math.floor(255*C.r/C.a),h.data[_+b+1]=Math.floor(255*C.g/C.a),h.data[_+b+2]=Math.floor(255*C.b/C.a),h.data[_+b+3]=Math.floor(255*C.a)};if(o.clips)for(let _=0,b=0;_<l;++_,b+=4*s)for(let E=0,C=0;E<s;E++,C+=4){const I=E/(s-1),{start:M,end:k}=o.clips[_];m(b,C,M*(1-I)+k*I)}else for(let _=0,b=0;_<s;_++,b+=4)m(0,b,_/(s-1));return h}var P_={paint:new Te({"hillshade-illumination-direction":new Z(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Z(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Z(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Z(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Z(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Z(de.paint_hillshade["hillshade-accent-color"])})};const Na=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uu}=Na;var Jh=Pp,wx=Pp;function Pp(o,r,s){s=s||2;var l,h,m,_,b,E,C,I=r&&r.length,M=I?r[0]*s:o.length,k=k_(o,0,M,s,!0),B=[];if(!k||k.next===k.prev)return B;if(I&&(k=function($,K,te,oe){var ue,pe,he,ge=[];for(ue=0,pe=K.length;ue<pe;ue++)(he=k_($,K[ue]*oe,ue<pe-1?K[ue+1]*oe:$.length,oe,!1))===he.next&&(he.steiner=!0),ge.push(Tm(he));for(ge.sort(O_),ue=0;ue<ge.length;ue++)te=Fl(te=Ex(ge[ue],te),te.next);return te}(o,r,k,s)),o.length>80*s){l=m=o[0],h=_=o[1];for(var N=s;N<M;N+=s)(b=o[N])<l&&(l=b),(E=o[N+1])<h&&(h=E),b>m&&(m=b),E>_&&(_=E);C=0!==(C=Math.max(m-l,_-h))?1/C:0}return ed(k,B,s,l,h,C),B}function k_(o,r,s,l,h){var m,_;if(h===Im(o,r,s,l)>0)for(m=r;m<s;m+=l)_=rd(m,o[m],o[m+1],_);else for(m=s-l;m>=r;m-=l)_=rd(m,o[m],o[m+1],_);return _&&ju(_,_.next)&&(Ll(_),_=_.next),_}function Fl(o,r){if(!o)return o;r||(r=o);var s,l=o;do{if(s=!1,l.steiner||!ju(l,l.next)&&0!==jn(l.prev,l,l.next))l=l.next;else{if(Ll(l),(l=r=l.prev)===l.next)break;s=!0}}while(s||l!==r);return r}function ed(o,r,s,l,h,m,_){if(o){!_&&m&&function(I,M,k,B){var N=I;do{null===N.z&&(N.z=Lc(N.x,N.y,M,k,B)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==I);N.prevZ.nextZ=null,N.prevZ=null,function($){var K,te,oe,ue,pe,he,ge,Me,we=1;do{for(te=$,$=null,pe=null,he=0;te;){for(he++,oe=te,ge=0,K=0;K<we&&(ge++,oe=oe.nextZ);K++);for(Me=we;ge>0||Me>0&&oe;)0!==ge&&(0===Me||!oe||te.z<=oe.z)?(ue=te,te=te.nextZ,ge--):(ue=oe,oe=oe.nextZ,Me--),pe?pe.nextZ=ue:$=ue,ue.prevZ=pe,pe=ue;te=oe}pe.nextZ=null,we*=2}while(he>1)}(N)}(o,l,h,m);for(var b,E,C=o;o.prev!==o.next;)if(b=o.prev,E=o.next,m?R_(o,l,h,m):Cm(o))r.push(b.i/s),r.push(o.i/s),r.push(E.i/s),Ll(o),o=E.next,C=E.next;else if((o=E)===C){_?1===_?ed(o=F_(Fl(o),r,s),r,s,l,h,m,2):2===_&&L_(o,r,s,l,h,m):ed(Fl(o),r,s,l,h,m,1);break}}}function Cm(o){var r=o.prev,s=o,l=o.next;if(jn(r,s,l)>=0)return!1;for(var h=o.next.next;h!==o.prev;){if(wi(r.x,r.y,s.x,s.y,l.x,l.y,h.x,h.y)&&jn(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function R_(o,r,s,l){var h=o.prev,m=o,_=o.next;if(jn(h,m,_)>=0)return!1;for(var b=h.x>m.x?h.x>_.x?h.x:_.x:m.x>_.x?m.x:_.x,E=h.y>m.y?h.y>_.y?h.y:_.y:m.y>_.y?m.y:_.y,C=Lc(h.x<m.x?h.x<_.x?h.x:_.x:m.x<_.x?m.x:_.x,h.y<m.y?h.y<_.y?h.y:_.y:m.y<_.y?m.y:_.y,r,s,l),I=Lc(b,E,r,s,l),M=o.prevZ,k=o.nextZ;M&&M.z>=C&&k&&k.z<=I;){if(M!==o.prev&&M!==o.next&&wi(h.x,h.y,m.x,m.y,_.x,_.y,M.x,M.y)&&jn(M.prev,M,M.next)>=0||(M=M.prevZ,k!==o.prev&&k!==o.next&&wi(h.x,h.y,m.x,m.y,_.x,_.y,k.x,k.y)&&jn(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;M&&M.z>=C;){if(M!==o.prev&&M!==o.next&&wi(h.x,h.y,m.x,m.y,_.x,_.y,M.x,M.y)&&jn(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;k&&k.z<=I;){if(k!==o.prev&&k!==o.next&&wi(h.x,h.y,m.x,m.y,_.x,_.y,k.x,k.y)&&jn(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function F_(o,r,s){var l=o;do{var h=l.prev,m=l.next.next;!ju(h,m)&&kp(h,l,l.next,m)&&td(h,m)&&td(m,h)&&(r.push(h.i/s),r.push(l.i/s),r.push(m.i/s),Ll(l),Ll(l.next),l=o=m),l=l.next}while(l!==o);return Fl(l)}function L_(o,r,s,l,h,m){var _=o;do{for(var b=_.next.next;b!==_.prev;){if(_.i!==b.i&&Vu(_,b)){var E=nd(_,b);return _=Fl(_,_.next),E=Fl(E,E.next),ed(_,r,s,l,h,m),void ed(E,r,s,l,h,m)}b=b.next}_=_.next}while(_!==o)}function O_(o,r){return o.x-r.x}function Ex(o,r){var s=function(m,_){var b,E=_,C=m.x,I=m.y,M=-1/0;do{if(I<=E.y&&I>=E.next.y&&E.next.y!==E.y){var k=E.x+(I-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(k<=C&&k>M){if(M=k,k===C){if(I===E.y)return E;if(I===E.next.y)return E.next}b=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!b)return null;if(C===M)return b;var B,N=b,$=b.x,K=b.y,te=1/0;E=b;do{C>=E.x&&E.x>=$&&C!==E.x&&wi(I<K?C:M,I,$,K,I<K?M:C,I,E.x,E.y)&&(B=Math.abs(I-E.y)/(C-E.x),td(E,m)&&(B<te||B===te&&(E.x>b.x||E.x===b.x&&z_(b,E)))&&(b=E,te=B)),E=E.next}while(E!==N);return b}(o,r);if(!s)return r;var l=nd(s,o),h=Fl(s,s.next);return Fl(l,l.next),r===s?h:r}function z_(o,r){return jn(o.prev,o,r.prev)<0&&jn(r.next,o,o.next)<0}function Lc(o,r,s,l,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*h)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-l)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Tm(o){var r=o,s=o;do{(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next}while(r!==o);return s}function wi(o,r,s,l,h,m,_,b){return(h-_)*(r-b)-(o-_)*(m-b)>=0&&(o-_)*(l-b)-(s-_)*(r-b)>=0&&(s-_)*(m-b)-(h-_)*(l-b)>=0}function Vu(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(s,l){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&kp(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(o,r)&&(td(o,r)&&td(r,o)&&function(s,l){var h=s,m=!1,_=(s.x+l.x)/2,b=(s.y+l.y)/2;do{h.y>b!=h.next.y>b&&h.next.y!==h.y&&_<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==s);return m}(o,r)&&(jn(o.prev,o,r.prev)||jn(o,r.prev,r))||ju(o,r)&&jn(o.prev,o,o.next)>0&&jn(r.prev,r,r.next)>0)}function jn(o,r,s){return(r.y-o.y)*(s.x-r.x)-(r.x-o.x)*(s.y-r.y)}function ju(o,r){return o.x===r.x&&o.y===r.y}function kp(o,r,s,l){var h=Fp(jn(o,r,s)),m=Fp(jn(o,r,l)),_=Fp(jn(s,l,o)),b=Fp(jn(s,l,r));return h!==m&&_!==b||!(0!==h||!Rp(o,s,r))||!(0!==m||!Rp(o,l,r))||!(0!==_||!Rp(s,o,l))||!(0!==b||!Rp(s,r,l))}function Rp(o,r,s){return r.x<=Math.max(o.x,s.x)&&r.x>=Math.min(o.x,s.x)&&r.y<=Math.max(o.y,s.y)&&r.y>=Math.min(o.y,s.y)}function Fp(o){return o>0?1:o<0?-1:0}function td(o,r){return jn(o.prev,o,o.next)<0?jn(o,r,o.next)>=0&&jn(o,o.prev,r)>=0:jn(o,r,o.prev)<0||jn(o,o.next,r)<0}function nd(o,r){var s=new Sm(o.i,o.x,o.y),l=new Sm(r.i,r.x,r.y),h=o.next,m=r.prev;return o.next=r,r.prev=o,s.next=h,h.prev=s,l.next=s,s.prev=l,m.next=l,l.prev=m,l}function rd(o,r,s,l){var h=new Sm(o,r,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Ll(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Sm(o,r,s){this.i=o,this.x=r,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Im(o,r,s,l){for(var h=0,m=r,_=s-l;m<s;m+=l)h+=(o[_]-o[m])*(o[m+1]+o[_+1]),_=m;return h}function Mm(o,r,s,l,h){Am(o,r,s||0,l||o.length-1,h||B_)}function Am(o,r,s,l,h){for(;l>s;){if(l-s>600){var m=l-s+1,_=r-s+1,b=Math.log(m),E=.5*Math.exp(2*b/3),C=.5*Math.sqrt(b*E*(m-E)/m)*(_-m/2<0?-1:1);Am(o,r,Math.max(s,Math.floor(r-_*E/m+C)),Math.min(l,Math.floor(r+(m-_)*E/m+C)),h)}var I=o[r],M=s,k=l;for($u(o,s,r),h(o[l],I)>0&&$u(o,s,l);M<k;){for($u(o,M,k),M++,k--;h(o[M],I)<0;)M++;for(;h(o[k],I)>0;)k--}0===h(o[s],I)?$u(o,s,k):$u(o,++k,l),k<=r&&(s=k+1),r<=k&&(l=k-1)}}function $u(o,r,s){var l=o[r];o[r]=o[s],o[s]=l}function B_(o,r){return o<r?-1:o>r?1:0}function Lp(o,r){const s=o.length;if(s<=1)return[o];const l=[];let h,m;for(let _=0;_<s;_++){const b=er(o[_]);0!==b&&(o[_].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(h&&l.push(h),h=[o[_]]):h.push(o[_]))}if(h&&l.push(h),r>1)for(let _=0;_<l.length;_++)l[_].length<=r||(Mm(l[_],r,1,l[_].length-1,Pm),l[_]=l[_].slice(0,r));return l}function Pm(o,r){return r.area-o.area}function Oc(o,r,s){const l=s.patternDependencies;let h=!1;for(const m of r){const _=m.paint.get(`${o}-pattern`);_.isConstant()||(h=!0);const b=_.constantOr(null);b&&(h=!0,l[b.to]=!0,l[b.from]=!0)}return h}function Op(o,r,s,l,h){const m=h.patternDependencies;for(const _ of r){const b=_.paint.get(`${o}-pattern`).value;if("constant"!==b.kind){let E=b.evaluate({zoom:l-1},s,{},h.availableImages),C=b.evaluate({zoom:l},s,{},h.availableImages),I=b.evaluate({zoom:l+1},s,{},h.availableImages);E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,m[E]=!0,m[C]=!0,m[I]=!0,s.patterns[_.id]={min:E,mid:C,max:I}}}return s}Pp.deviation=function(o,r,s,l){var h=r&&r.length,m=Math.abs(Im(o,0,h?r[0]*s:o.length,s));if(h)for(var _=0,b=r.length;_<b;_++)m-=Math.abs(Im(o,r[_]*s,_<b-1?r[_+1]*s:o.length,s));var E=0;for(_=0;_<l.length;_+=3){var C=l[_]*s,I=l[_+1]*s,M=l[_+2]*s;E+=Math.abs((o[C]-o[M])*(o[I+1]-o[C+1])-(o[C]-o[I])*(o[M+1]-o[C+1]))}return 0===m&&0===E?0:Math.abs((E-m)/m)},Pp.flatten=function(o){for(var r=o[0][0].length,s={vertices:[],holes:[],dimensions:r},l=0,h=0;h<o.length;h++){for(var m=0;m<o[h].length;m++)for(var _=0;_<r;_++)s.vertices.push(o[h][m][_]);h>0&&s.holes.push(l+=o[h-1].length)}return s},Jh.default=wx;class zc{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new nt,this.indexArray=new kn,this.indexArray2=new In,this.programConfigurations=new Ic(r.layers,r.zoom),this.segments=new Jn,this.segments2=new Jn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,l,h){this.hasPattern=Oc("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:b,id:E,index:C,sourceLayerIndex:I}of r){const M=this.layers[0]._featureFilter.needGeometry,k=ko(b,M);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),k,l))continue;const B=m?m.evaluate(k,{},l,s.availableImages):void 0,N={id:E,properties:b.properties,type:b.type,sourceLayerIndex:I,index:C,geometry:M?k.geometry:za(b,l,h),patterns:{},sortKey:B};_.push(N)}m&&_.sort((b,E)=>b.sortKey-E.sortKey);for(const b of _){const{geometry:E,index:C,sourceLayerIndex:I}=b;if(this.hasPattern){const M=Op("fill",this.layers,b,this.zoom,s);this.patternFeatures.push(M)}else this.addFeature(b,E,C,l,{},s.availableImages);s.featureIndex.insert(r[C].feature,E,C,I,this.index)}}update(r,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,l,h)}addFeatures(r,s,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Uu),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,l,h,m,_=[]){for(const b of Lp(s,500)){let E=0;for(const N of b)E+=N.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),I=C.vertexLength,M=[],k=[];for(const N of b){if(0===N.length)continue;N!==b[0]&&k.push(M.length/2);const $=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),K=$.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(K+N.length-1,K),M.push(N[0].x),M.push(N[0].y);for(let te=1;te<N.length;te++)this.layoutVertexArray.emplaceBack(N[te].x,N[te].y),this.indexArray2.emplaceBack(K+te-1,K+te),M.push(N[te].x),M.push(N[te].y);$.vertexLength+=N.length,$.primitiveLength+=N.length}const B=Jh(M,k);for(let N=0;N<B.length;N+=3)this.indexArray.emplaceBack(I+B[N],I+B[N+1],I+B[N+2]);C.vertexLength+=E,C.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}}tt("FillBucket",zc,{omit:["layers","patternFeatures"]});const N_=new Te({"fill-sort-key":new ie(de.layout_fill["fill-sort-key"])});var _r={paint:new Te({"fill-antialias":new Z(de.paint_fill["fill-antialias"]),"fill-opacity":new ie(de.paint_fill["fill-opacity"]),"fill-color":new ie(de.paint_fill["fill-color"]),"fill-outline-color":new ie(de.paint_fill["fill-outline-color"]),"fill-translate":new Z(de.paint_fill["fill-translate"]),"fill-translate-anchor":new Z(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new le(de.paint_fill["fill-pattern"])}),layout:N_};const U_=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),V_=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:zp}=U_;var Bp=Bc;function Bc(o,r,s,l,h){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=l,this._values=h,o.readFields(j_,this,r)}function j_(o,r,s){1==o?r.id=s.readVarint():2==o?function(l,h){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=h._keys[l.readVarint()],b=h._values[l.readVarint()];h.properties[_]=b}}(s,r):3==o?r.type=s.readVarint():4==o&&(r._geometry=s.pos)}function $_(o){for(var r,s,l=0,h=0,m=o.length,_=m-1;h<m;_=h++)l+=((s=o[_]).x-(r=o[h]).x)*(r.y+s.y);return l}Bc.types=["Unknown","Point","LineString","Polygon"],Bc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,s=o.readVarint()+o.pos,l=1,h=0,m=0,_=0,b=[];o.pos<s;){if(h<=0){var E=o.readVarint();l=7&E,h=E>>3}if(h--,1===l||2===l)m+=o.readSVarint(),_+=o.readSVarint(),1===l&&(r&&b.push(r),r=[]),r.push(new ze(m,_));else{if(7!==l)throw new Error("unknown command "+l);r&&r.push(r[0].clone())}}return r&&b.push(r),b},Bc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,s=1,l=0,h=0,m=0,_=1/0,b=-1/0,E=1/0,C=-1/0;o.pos<r;){if(l<=0){var I=o.readVarint();s=7&I,l=I>>3}if(l--,1===s||2===s)(h+=o.readSVarint())<_&&(_=h),h>b&&(b=h),(m+=o.readSVarint())<E&&(E=m),m>C&&(C=m);else if(7!==s)throw new Error("unknown command "+s)}return[_,E,b,C]},Bc.prototype.toGeoJSON=function(o,r,s){var l,h,m=this.extent*Math.pow(2,s),_=this.extent*o,b=this.extent*r,E=this.loadGeometry(),C=Bc.types[this.type];function I(B){for(var N=0;N<B.length;N++){var $=B[N];B[N]=[360*($.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(l=0;l<E.length;l++)M[l]=E[l][0];I(E=M);break;case 2:for(l=0;l<E.length;l++)I(E[l]);break;case 3:for(E=function(B){var N=B.length;if(N<=1)return[B];for(var $,K,te=[],oe=0;oe<N;oe++){var ue=$_(B[oe]);0!==ue&&(void 0===K&&(K=ue<0),K===ue<0?($&&te.push($),$=[B[oe]]):$.push(B[oe]))}return $&&te.push($),te}(E),l=0;l<E.length;l++)for(h=0;h<E[l].length;h++)I(E[l][h])}1===E.length?E=E[0]:C="Multi"+C;var k={type:"Feature",geometry:{type:C,coordinates:E},properties:this.properties};return"id"in this&&(k.id=this.id),k};var km=Rm;function Rm(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Dx,this,r),this.length=this._features.length}function Dx(o,r,s){15===o?r.version=s.readVarint():1===o?r.name=s.readString():5===o?r.extent=s.readVarint():2===o?r._features.push(s.pos):3===o?r._keys.push(s.readString()):4===o&&r._values.push(function(l){for(var h=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(s))}function Cx(o,r,s){if(3===o){var l=new km(s,s.readVarint()+s.pos);l.length&&(r[l.name]=l)}}Rm.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new Bp(this._pbf,r,this.extent,this._keys,this._values)};var Ro={VectorTile:function(o,r){this.layers=o.readFields(Cx,{},r)},VectorTileFeature:Bp,VectorTileLayer:km};const Ei=Ro.VectorTileFeature.types,Np=Math.pow(2,13);function Nc(o,r,s,l,h,m,_,b){o.emplaceBack((r<<1)+_,(s<<1)+m,(Math.floor(l*Np)<<1)+h,Math.round(b))}class Up{constructor(){this.acc=new ze(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ze(r.x,r.y),this.max=new ze(r.x,r.y))}append(r,s){this.currentPolyCount.edges++,this.acc._add(r);let l=!!this.borders;const h=this.min,m=this.max;r.x<h.x?(h.x=r.x,l=!0):r.x>m.x&&(m.x=r.x,l=!0),r.y<h.y?(h.y=r.y,l=!0):r.y>m.y&&(m.y=r.y,l=!0),((0===r.x||r.x===Ut)&&r.x===s.x)!=((0===r.y||r.y===Ut)&&r.y===s.y)&&this.processBorderOverlap(r,s),l&&this.checkBorderIntersection(r,s)}checkBorderIntersection(r,s){s.x<0!=r.x<0&&this.addBorderIntersection(0,Jt(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>Ut!=r.x>Ut&&this.addBorderIntersection(1,Jt(s.y,r.y,(Ut-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,Jt(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>Ut!=r.y>Ut&&this.addBorderIntersection(3,Jt(s.x,r.x,(Ut-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[r];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const l=0===r.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,r.y)}else{const l=0===r.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,r.x)}}centroid(){const r=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==r?this.acc.div(r)._round():new ze(0,0)}span(){return new ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0)}}class kr{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new Cc,this.indexArray=new kn,this.programConfigurations=new Ic(r.layers,r.zoom),this.segments=new Jn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=r.enableTerrain}populate(r,s,l,h){this.features=[],this.hasPattern=Oc("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/Ut/(1<<m.z)}(l);for(const{feature:m,id:_,index:b,sourceLayerIndex:E}of r){const C=this.layers[0]._featureFilter.needGeometry,I=ko(m,C);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),I,l))continue;const M={id:_,sourceLayerIndex:E,index:b,geometry:C?I.geometry:za(m,l,h),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Op("fill-extrusion",this.layers,M,this.zoom,s)):this.addFeature(M,M.geometry,b,l,{},s.availableImages),s.featureIndex.insert(m,M.geometry,b,E,this.index,k)}this.sortBorders()}addFeatures(r,s,l,h){for(const m of this.features){const{geometry:_}=m;this.addFeature(m,_,m.index,s,l,h)}this.sortBorders()}update(r,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zp),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,V_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,l,h,m,_){const b=this.enableTerrain?new Up:null;for(const C of Lp(s,500)){let I=0,M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===C.length||(E=C[0]).every(K=>K.x<=0)||E.every(K=>K.x>=Ut)||E.every(K=>K.y<=0)||E.every(K=>K.y>=Ut))continue;for(let K=0;K<C.length;K++){const te=C[K];if(0===te.length)continue;I+=te.length;let oe=0;b&&b.startRing(te[0]);for(let ue=0;ue<te.length;ue++){const pe=te[ue];if(ue>=1){const he=te[ue-1];if(!Gu(pe,he)){b&&b.append(pe,he),M.vertexLength+4>Jn.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=pe.sub(he)._perp(),Me=ge.x/(Math.abs(ge.x)+Math.abs(ge.y)),we=ge.y>0?1:0,Xe=he.dist(pe);oe+Xe>32768&&(oe=0),Nc(this.layoutVertexArray,pe.x,pe.y,Me,we,0,0,oe),Nc(this.layoutVertexArray,pe.x,pe.y,Me,we,0,1,oe),oe+=Xe,Nc(this.layoutVertexArray,he.x,he.y,Me,we,0,0,oe),Nc(this.layoutVertexArray,he.x,he.y,Me,we,0,1,oe);const Ne=M.vertexLength;this.indexArray.emplaceBack(Ne,Ne+2,Ne+1),this.indexArray.emplaceBack(Ne+1,Ne+2,Ne+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+I>Jn.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ei[r.type])continue;const k=[],B=[],N=M.vertexLength;for(let K=0;K<C.length;K++){const te=C[K];if(0!==te.length){te!==C[0]&&B.push(k.length/2);for(let oe=0;oe<te.length;oe++){const ue=te[oe];Nc(this.layoutVertexArray,ue.x,ue.y,0,0,1,1,0),k.push(ue.x),k.push(ue.y),b&&b.currentPolyCount.top++}}}const $=Jh(k,B);for(let K=0;K<$.length;K+=3)this.indexArray.emplaceBack(N+$[K],N+$[K+2],N+$[K+1]);M.primitiveLength+=$.length/3,M.vertexLength+=I}var E;if(b&&b.polyCount.length>0){if(b.borders){b.vertexArrayOffset=this.centroidVertexArray.length;const C=b.borders,I=this.featuresOnBorder.push(b)-1;for(let M=0;M<4;M++)C[M][0]!==Number.MAX_VALUE&&this.borders[M].push(I)}this.encodeCentroid(b.borders?void 0:b.centroid(),b)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((s,l)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[l].borders[r][0])}encodeCentroid(r,s,l=!0){let h,m;if(r)if(0!==r.y){const b=s.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(b.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else h=Math.ceil(7*(r.x+450)),m=0;else h=0,m=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const b of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let E=0;E<2*b.edges;E++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m);for(let E=0;E<b.top;E++)this.centroidVertexArray.emplace(_++,h,m)}}}function Gu(o,r){return o.x===r.x&&(o.x<0||o.x>Ut)||o.y===r.y&&(o.y<0||o.y>Ut)}tt("FillExtrusionBucket",kr,{omit:["layers","features"]}),tt("PartMetadata",Up);var Vp={paint:new Te({"fill-extrusion-opacity":new Z(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ie(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Z(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Z(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new le(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ie(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ie(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Z(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function qu(o,r){return o.x*r.x+o.y*r.y}function Fm(o,r){if(1===o.length){let s=0;const l=r[s++];let h;for(;!h||l.equals(h);)if(h=r[s++],!h)return 1/0;for(;s<r.length;s++){const m=r[s],_=o[0],b=h.sub(l),E=m.sub(l),C=_.sub(l),I=qu(b,b),M=qu(b,E),k=qu(E,E),B=qu(C,b),N=qu(C,E),$=I*k-M*M,K=(k*B-M*N)/$,te=(I*N-M*B)/$,oe=l.z*(1-K-te)+h.z*K+m.z*te;if(isFinite(oe))return oe}return 1/0}{let s=1/0;for(const l of r)s=Math.min(s,l.z);return s}}function jp(o){const r=new ze(o[0],o[1]);return r.z=o[2],r}function G_(o,r,s,l,h,m,_,b){const E=_*h.getElevationAt(o,r,!0,!0),C=0!==m[0],I=C?0===m[1]?_*(m[0]/7-450):_*function(M,k,B){const N=Math.floor(k[0]/8),$=Math.floor(k[1]/8),K=10*(k[0]-8*N),te=10*(k[1]-8*$),oe=M.getElevationAt(N,$,!0,!0),ue=M.getMeterToDEM(B),pe=Math.floor(.5*(K*ue-1)),he=Math.floor(.5*(te*ue-1)),ge=M.tileCoordToPixel(N,$),Me=2*pe+1,we=2*he+1,Xe=(un=Me,pt=we,[(Ke=M).getElevationAtPixel(Je=ge.x-pe,ut=ge.y-he,!0),Ke.getElevationAtPixel(Je+pt,ut,!0),Ke.getElevationAtPixel(Je,ut+pt,!0),Ke.getElevationAtPixel(Je+un,ut+pt,!0)]),Ne=Math.abs(Xe[0]-Xe[1]),Ae=Math.abs(Xe[2]-Xe[3]),Be=Math.abs(Xe[0]-Xe[2])+Math.abs(Xe[1]-Xe[3]),$e=Math.min(.25,.5*ue*(Ne+Ae)/Me),ke=Math.min(.25,.5*ue*Be/we);var Ke,Je,ut,un,pt;return oe+Math.max($e*K,ke*te)}(h,m,b):E;return{base:E+(0===s)?-1:s,top:C?Math.max(I+l,E+s+2):E+l}}const Lm=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:q_}=Lm,Om=ye([{name:"a_packed",components:3,type:"Float32"}]),{members:H_}=Om,Z_=Ro.VectorTileFeature.types,$p=Math.cos(Math.PI/180*37.5);class id{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ft,this.layoutVertexArray2=new mt,this.indexArray=new kn,this.programConfigurations=new Ic(r.layers,r.zoom),this.segments=new Jn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,l,h){this.hasPattern=Oc("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:M,index:k,sourceLayerIndex:B}of r){const N=this.layers[0]._featureFilter.needGeometry,$=ko(I,N);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),$,l))continue;const K=m?m.evaluate($,{},l):void 0,te={id:M,properties:I.properties,type:I.type,sourceLayerIndex:B,index:k,geometry:N?$.geometry:za(I,l,h),patterns:{},sortKey:K};_.push(te)}m&&_.sort((I,M)=>I.sortKey-M.sortKey);const{lineAtlas:b,featureIndex:E}=s,C=this.addConstantDashes(b);for(const I of _){const{geometry:M,index:k,sourceLayerIndex:B}=I;if(C&&this.addFeatureDashes(I,b),this.hasPattern){const N=Op("line",this.layers,I,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(I,M,k,l,b.positions,s.availableImages);E.insert(r[k].feature,M,k,B,this.index)}}addConstantDashes(r){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)s=!0;else{const _=m.value,b=h.value;if(!b)continue;r.addDash(b.from,_),r.addDash(b.to,_),b.other&&r.addDash(b.other,_)}}return s}addFeatureDashes(r,s){const l=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let b,E,C,I,M,k;if("constant"===m.kind){const K=m.value;if(!K)continue;b=K.other||K.to,E=K.to,C=K.from}else b=m.evaluate({zoom:l-1},r),E=m.evaluate({zoom:l},r),C=m.evaluate({zoom:l+1},r);"constant"===_.kind?I=M=k=_.value:(I=_.evaluate({zoom:l-1},r),M=_.evaluate({zoom:l},r),k=_.evaluate({zoom:l+1},r)),s.addDash(b,I),s.addDash(E,M),s.addDash(C,k);const B=s.getKey(b,I),N=s.getKey(E,M),$=s.getKey(C,k);r.patterns[h.id]={min:B,mid:N,max:$}}}update(r,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,l,h)}addFeatures(r,s,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,H_)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,q_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,l,h,m,_){const b=this.layers[0].layout,E=b.get("line-join").evaluate(r,{}),C=b.get("line-cap").evaluate(r,{}),I=b.get("line-miter-limit"),M=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const k of s)this.addLine(k,r,E,C,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}addLine(r,s,l,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<r.length-1;te++)this.totalDistance+=r[te].dist(r[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===Z_[s.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let C=0;for(;C<E-1&&r[C].equals(r[C+1]);)C++;if(E<(b?3:2))return;"bevel"===l&&(m=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let k,B,N,$,K;this.e1=this.e2=-1,b&&(k=r[E-2],K=r[C].sub(k)._unit()._perp());for(let te=C;te<E;te++){if(N=te===E-1?b?r[C+1]:void 0:r[te+1],N&&r[te].equals(N))continue;K&&($=K),k&&(B=k),k=r[te],K=N?N.sub(k)._unit()._perp():$,$=$||K;let oe=$.add(K);0===oe.x&&0===oe.y||oe._unit();const ue=$.x*K.x+$.y*K.y,pe=oe.x*K.x+oe.y*K.y,he=0!==pe?1/pe:1/0,ge=2*Math.sqrt(2-2*pe),Me=pe<$p&&B&&N,we=$.x*K.y-$.y*K.x>0;if(Me&&te>C){const Ae=k.dist(B);if(Ae>2*I){const Be=k.sub(k.sub(B)._mult(I/Ae)._round());this.updateDistance(B,Be),this.addCurrentVertex(Be,$,0,0,M),B=Be}}const Xe=B&&N;let Ne=Xe?l:b?"butt":h;if(Xe&&"round"===Ne&&(he<_?Ne="miter":he<=2&&(Ne="fakeround")),"miter"===Ne&&he>m&&(Ne="bevel"),"bevel"===Ne&&(he>2&&(Ne="flipbevel"),he<m&&(Ne="miter")),B&&this.updateDistance(B,k),"miter"===Ne)oe._mult(he),this.addCurrentVertex(k,oe,0,0,M);else if("flipbevel"===Ne){if(he>100)oe=K.mult(-1);else{const Ae=he*$.add(K).mag()/$.sub(K).mag();oe._perp()._mult(Ae*(we?-1:1))}this.addCurrentVertex(k,oe,0,0,M),this.addCurrentVertex(k,oe.mult(-1),0,0,M)}else if("bevel"===Ne||"fakeround"===Ne){const Ae=-Math.sqrt(he*he-1),Be=we?Ae:0,$e=we?0:Ae;if(B&&this.addCurrentVertex(k,$,Be,$e,M),"fakeround"===Ne){const ke=Math.round(180*ge/Math.PI/20);for(let Ke=1;Ke<ke;Ke++){let Je=Ke/ke;if(.5!==Je){const un=Je-.5;Je+=Je*un*(Je-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*un*un+(.848013+ue*(.215638*ue-1.06021)))}const ut=K.sub($)._mult(Je)._add($)._unit()._mult(we?-1:1);this.addHalfVertex(k,ut.x,ut.y,!1,we,0,M)}}N&&this.addCurrentVertex(k,K,-Be,-$e,M)}else if("butt"===Ne)this.addCurrentVertex(k,oe,0,0,M);else if("square"===Ne){const Ae=B?1:-1;B||this.addCurrentVertex(k,oe,Ae,Ae,M),this.addCurrentVertex(k,oe,0,0,M),B&&this.addCurrentVertex(k,oe,Ae,Ae,M)}else"round"===Ne&&(B&&(this.addCurrentVertex(k,$,0,0,M),this.addCurrentVertex(k,$,1,1,M,!0)),N&&(this.addCurrentVertex(k,K,-1,-1,M,!0),this.addCurrentVertex(k,K,0,0,M)));if(Me&&te<E-1){const Ae=k.dist(N);if(Ae>2*I){const Be=k.add(N.sub(k)._mult(I/Ae)._round());this.updateDistance(k,Be),this.addCurrentVertex(Be,K,0,0,M),k=Be}}}}addCurrentVertex(r,s,l,h,m,_=!1){const b=s.y*h-s.x,E=-s.y-s.x*h;this.addHalfVertex(r,s.x+s.y*l,s.y-s.x*l,_,!1,l,m),this.addHalfVertex(r,b,E,_,!0,-h,m)}addHalfVertex({x:r,y:s},l,h,m,_,b,E){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const C=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),E.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}tt("LineBucket",id,{omit:["layers","patternFeatures"]});const W_=new Te({"line-cap":new ie(de.layout_line["line-cap"]),"line-join":new ie(de.layout_line["line-join"]),"line-miter-limit":new Z(de.layout_line["line-miter-limit"]),"line-round-limit":new Z(de.layout_line["line-round-limit"]),"line-sort-key":new ie(de.layout_line["line-sort-key"])});var od={paint:new Te({"line-opacity":new ie(de.paint_line["line-opacity"]),"line-color":new ie(de.paint_line["line-color"]),"line-translate":new Z(de.paint_line["line-translate"]),"line-translate-anchor":new Z(de.paint_line["line-translate-anchor"]),"line-width":new ie(de.paint_line["line-width"]),"line-gap-width":new ie(de.paint_line["line-gap-width"]),"line-offset":new ie(de.paint_line["line-offset"]),"line-blur":new ie(de.paint_line["line-blur"]),"line-dasharray":new le(de.paint_line["line-dasharray"]),"line-pattern":new le(de.paint_line["line-pattern"]),"line-gradient":new xe(de.paint_line["line-gradient"])}),layout:W_};const zm=new class extends ie{possiblyEvaluate(o,r){return r=new L(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,s,l){return r=zn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,s,l)}}(od.paint.properties["line-width"].specification);function Bm(o,r){return r>0?r+2*o:o}zm.useIntegerZoom=!0;const Uc=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),X_=ye([{name:"a_projected_pos",components:3,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Y_=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),K_=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nm=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Q_=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const us=128;function Gp(o,r){const{expression:s}=r;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new L(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=s;let m=0;for(;m<l.length&&l[m]<=o;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<o+1;)_++;_=Math.min(l.length-1,_);const b=l[m],E=l[_];return"composite"===s.kind?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:E,minSize:s.evaluate(new L(b)),maxSize:s.evaluate(new L(E)),interpolationType:h}}}function sd(o,{uSize:r,uSizeT:s},{lowerSize:l,upperSize:h}){return"source"===o.kind?l/us:"composite"===o.kind?Jt(l/us,h/us,s):r}function Vc(o,r){let s=0,l=0;if("constant"===o.kind)l=o.layoutSize;else if("source"!==o.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=o,b=h?Kt(si.interpolationFactor(h,r,m,_),0,1):0;"camera"===o.kind?l=Jt(o.minSize,o.maxSize,b):s=b}return{uSizeT:s,uSize:l}}var Um=Object.freeze({__proto__:null,getSizeData:Gp,evaluateSizeForFeature:sd,evaluateSizeForZoom:Vc,SIZE_PACK_FACTOR:us});function J_(o,r,s){return o.sections.forEach(l=>{l.text=function(h,m,_){const b=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===b?h=h.toLocaleUpperCase():"lowercase"===b&&(h=h.toLocaleLowerCase()),F.applyArabicShaping&&(h=F.applyArabicShaping(h)),h}(l.text,r,s)}),o}const Hu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function ey(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function jc(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Fo=function(o,r,s,l,h){var m,_,b=8*h-l-1,E=(1<<b)-1,C=E>>1,I=-7,M=s?h-1:0,k=s?-1:1,B=o[r+M];for(M+=k,m=B&(1<<-I)-1,B>>=-I,I+=b;I>0;m=256*m+o[r+M],M+=k,I-=8);for(_=m&(1<<-I)-1,m>>=-I,I+=l;I>0;_=256*_+o[r+M],M+=k,I-=8);if(0===m)m=1-C;else{if(m===E)return _?NaN:1/0*(B?-1:1);_+=Math.pow(2,l),m-=C}return(B?-1:1)*_*Math.pow(2,m-l)},ty=function(o,r,s,l,h,m){var _,b,E,C=8*m-h-1,I=(1<<C)-1,M=I>>1,k=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,B=l?0:m-1,N=l?1:-1,$=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(b=isNaN(r)?1:0,_=I):(_=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-_))<1&&(_--,E*=2),(r+=_+M>=1?k/E:k*Math.pow(2,1-M))*E>=2&&(_++,E/=2),_+M>=I?(b=0,_=I):_+M>=1?(b=(r*E-1)*Math.pow(2,h),_+=M):(b=r*Math.pow(2,M-1)*Math.pow(2,h),_=0));h>=8;o[s+B]=255&b,B+=N,b/=256,h-=8);for(_=_<<h|b,C+=h;C>0;o[s+B]=255&_,B+=N,_/=256,C-=8);o[s+B-N]|=128*$},ad=fn;function fn(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}fn.Varint=0,fn.Fixed64=1,fn.Bytes=2,fn.Fixed32=5;var Vm=4294967296,Ri=1/Vm,ld="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Lo(o){return o.type===fn.Bytes?o.readVarint()+o.pos:o.pos+1}function qp(o,r,s){var l=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(l);for(var h=s.pos-1;h>=o;h--)s.buf[h+l]=s.buf[h]}function Zu(o,r){for(var s=0;s<o.length;s++)r.writeVarint(o[s])}function jm(o,r){for(var s=0;s<o.length;s++)r.writeSVarint(o[s])}function $m(o,r){for(var s=0;s<o.length;s++)r.writeFloat(o[s])}function Hp(o,r){for(var s=0;s<o.length;s++)r.writeDouble(o[s])}function Zp(o,r){for(var s=0;s<o.length;s++)r.writeBoolean(o[s])}function Gm(o,r){for(var s=0;s<o.length;s++)r.writeFixed32(o[s])}function Tx(o,r){for(var s=0;s<o.length;s++)r.writeSFixed32(o[s])}function Gc(o,r){for(var s=0;s<o.length;s++)r.writeFixed64(o[s])}function Wp(o,r){for(var s=0;s<o.length;s++)r.writeSFixed64(o[s])}function Wu(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function qc(o,r,s){o[s]=r,o[s+1]=r>>>8,o[s+2]=r>>>16,o[s+3]=r>>>24}function cd(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}function ny(o,r,s){r.glyphs=[],1===o&&s.readMessage(ry,r)}function ry(o,r,s){if(3===o){const{id:l,bitmap:h,width:m,height:_,left:b,top:E,advance:C}=s.readMessage(iy,{});r.glyphs.push({id:l,bitmap:new Ba({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:b,top:E,advance:C}})}else 4===o?r.ascender=s.readSVarint():5===o&&(r.descender=s.readSVarint())}function iy(o,r,s){1===o?r.id=s.readVarint():2===o?r.bitmap=s.readBytes():3===o?r.width=s.readVarint():4===o?r.height=s.readVarint():5===o?r.left=s.readSVarint():6===o?r.top=s.readSVarint():7===o&&(r.advance=s.readVarint())}function Xp(o){let r=0,s=0;for(const _ of o)r+=_.w*_.h,s=Math.max(s,_.w);o.sort((_,b)=>b.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let h=0,m=0;for(const _ of o)for(let b=l.length-1;b>=0;b--){const E=l[b];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===E.w&&_.h===E.h){const C=l.pop();b<l.length&&(l[b]=C)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(l.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:h,h:m,fill:r/(h*m)||0}}fn.prototype={destroy:function(){this.buf=null},readFields:function(o,r,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),h=l>>3,m=this.pos;this.type=7&l,o(h,r,this),this.pos===m&&this.skip(l)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=Wu(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=cd(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Wu(this.buf,this.pos)+Wu(this.buf,this.pos+4)*Vm;return this.pos+=8,o},readSFixed64:function(){var o=Wu(this.buf,this.pos)+cd(this.buf,this.pos+4)*Vm;return this.pos+=8,o},readFloat:function(){var o=Fo(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Fo(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,s,l=this.buf;return r=127&(s=l[this.pos++]),s<128?r:(r|=(127&(s=l[this.pos++]))<<7,s<128?r:(r|=(127&(s=l[this.pos++]))<<14,s<128?r:(r|=(127&(s=l[this.pos++]))<<21,s<128?r:function(h,m,_){var b,E,C=_.buf;if(b=(112&(E=C[_.pos++]))>>4,E<128||(b|=(127&(E=C[_.pos++]))<<3,E<128)||(b|=(127&(E=C[_.pos++]))<<10,E<128)||(b|=(127&(E=C[_.pos++]))<<17,E<128)||(b|=(127&(E=C[_.pos++]))<<24,E<128)||(b|=(1&(E=C[_.pos++]))<<31,E<128))return function $c(o,r,s){return s?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}(h,b,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(s=l[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&ld?ld.decode(this.buf.subarray(r,o)):function(s,l,h){for(var m="",_=l;_<h;){var b,E,C,I=s[_],M=null,k=I>239?4:I>223?3:I>191?2:1;if(_+k>h)break;1===k?I<128&&(M=I):2===k?128==(192&(b=s[_+1]))&&(M=(31&I)<<6|63&b)<=127&&(M=null):3===k?(E=s[_+2],128==(192&(b=s[_+1]))&&128==(192&E)&&((M=(15&I)<<12|(63&b)<<6|63&E)<=2047||M>=55296&&M<=57343)&&(M=null)):4===k&&(E=s[_+2],C=s[_+3],128==(192&(b=s[_+1]))&&128==(192&E)&&128==(192&C)&&((M=(15&I)<<18|(63&b)<<12|(63&E)<<6|63&C)<=65535||M>=1114112)&&(M=null)),null===M?(M=65533,k=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),_+=k}return m}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==fn.Bytes)return o.push(this.readVarint(r));var s=Lo(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==fn.Bytes)return o.push(this.readSVarint());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==fn.Bytes)return o.push(this.readBoolean());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==fn.Bytes)return o.push(this.readFloat());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==fn.Bytes)return o.push(this.readDouble());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==fn.Bytes)return o.push(this.readFixed32());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==fn.Bytes)return o.push(this.readSFixed32());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==fn.Bytes)return o.push(this.readFixed64());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==fn.Bytes)return o.push(this.readSFixed64());var r=Lo(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===fn.Varint)for(;this.buf[this.pos++]>127;);else if(r===fn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===fn.Fixed32)this.pos+=4;else{if(r!==fn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),qc(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),qc(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),qc(this.buf,-1&o,this.pos),qc(this.buf,Math.floor(o*Ri),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),qc(this.buf,-1&o,this.pos),qc(this.buf,Math.floor(o*Ri),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,s){var l,h,m,b;if(r>=0?(l=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(l=~(-r%4294967296))?l=l+1|0:(l=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),m=l,(b=s).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,_){var b=(7&m)<<4;_.buf[_.pos++]|=b|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(l,h,m){for(var _,b,E=0;E<h.length;E++){if((_=h.charCodeAt(E))>55295&&_<57344){if(!b){_>56319||E+1===h.length?(l[m++]=239,l[m++]=191,l[m++]=189):b=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(l[m++]=239,l[m++]=191,l[m++]=189,b=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,o,this.pos);var s=this.pos-r;s>=128&&qp(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),ty(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),ty(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var s=0;s<r;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,r){this.pos++;var s=this.pos;o(r,this);var l=this.pos-s;l>=128&&qp(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(o,r,s){this.writeTag(o,fn.Bytes),this.writeRawMessage(r,s)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,Zu,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,jm,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,Zp,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,$m,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,Hp,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,Gm,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,Tx,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,Gc,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,Wp,r)},writeBytesField:function(o,r){this.writeTag(o,fn.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,fn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,fn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,fn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,fn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,fn.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,fn.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,fn.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,fn.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,fn.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,Boolean(r))}};class Yp{constructor(r,{pixelRatio:s,version:l,stretchX:h,stretchY:m,content:_}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=h,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class qm{constructor(r,s){const l={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,l,m),this.addImages(s,h,m);const{w:_,h:b}=Xp(m),E=new to({width:_||1,height:b||1});for(const C in r){const I=r[C],M=l[C].paddedRect;to.copy(I.data,E,{x:0,y:0},{x:M.x+1,y:M.y+1},I.data)}for(const C in s){const I=s[C],M=h[C].paddedRect,k=M.x+1,B=M.y+1,N=I.data.width,$=I.data.height;to.copy(I.data,E,{x:0,y:0},{x:k,y:B},I.data),to.copy(I.data,E,{x:0,y:$-1},{x:k,y:B-1},{width:N,height:1}),to.copy(I.data,E,{x:0,y:0},{x:k,y:B+$},{width:N,height:1}),to.copy(I.data,E,{x:N-1,y:0},{x:k-1,y:B},{width:1,height:$}),to.copy(I.data,E,{x:0,y:0},{x:k+N,y:B},{width:1,height:$})}this.image=E,this.iconPositions=l,this.patternPositions=h}addImages(r,s,l){for(const h in r){const m=r[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),s[h]=new Yp(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,s){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in r.updatedImages)this.patchUpdatedImage(this.iconPositions[l],r.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],r.getImage(l),s)}patchUpdatedImage(r,s,l){if(!r||!s||r.version===s.version)return;r.version=s.version;const[h,m]=r.tl;l.update(s.data,void 0,{x:h,y:m})}}tt("ImagePosition",Yp),tt("ImageAtlas",qm);const Fi={horizontal:1,vertical:2,horizontalOnly:3};class Ol{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,s){const l=new Ol;return l.scale=r||1,l.fontStack=s,l}static forImage(r){const s=new Ol;return s.imageName=r,s}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const l=new zl;for(let h=0;h<r.sections.length;h++){const m=r.sections[h];m.image?l.addImageSection(m):l.addTextSection(m,s)}return l}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(s,l){let h="";for(let m=0;m<s.length;m++){const _=s.charCodeAt(m+1)||null,b=s.charCodeAt(m-1)||null;h+=!l&&(_&&Su(_)&&!Hu[s[m+1]]||b&&Su(b)&&!Hu[s[m-1]])||!Hu[s[m]]?s[m]:Hu[s[m]]}return h}(this.text,r)}trim(){let r=0;for(let l=0;l<this.text.length&&ud[this.text.charCodeAt(l)];l++)r++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=r&&ud[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const l=new zl;return l.text=this.text.substring(r,s),l.sectionIndex=this.sectionIndex.slice(r,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Ol.forText(r.scale,r.fontStack||s));const l=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(l)}addImageSection(r){const s=r.image?r.image.name:"";if(0===s.length)return void Pn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ol.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xu(o,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$){const K=zl.fromFeature(o,h);let te;M===Fi.vertical&&K.verticalizePunctuation(k);const{processBidirectionalText:oe,processStyledBidirectionalText:ue}=F;if(oe&&1===K.sections.length){te=[];const ge=oe(K.toString(),tf(K,C,m,r,l,B,N));for(const Me of ge){const we=new zl;we.text=Me,we.sections=K.sections;for(let Xe=0;Xe<Me.length;Xe++)we.sectionIndex.push(0);te.push(we)}}else if(ue){te=[];const ge=ue(K.text,K.sectionIndex,tf(K,C,m,r,l,B,N));for(const Me of ge){const we=new zl;we.text=Me[0],we.sectionIndex=Me[1],we.sections=K.sections,te.push(we)}}else te=function(ge,Me){const we=[],Xe=ge.text;let Ne=0;for(const Ae of Me)we.push(ge.substring(Ne,Ae)),Ne=Ae;return Ne<Xe.length&&we.push(ge.substring(Ne,Xe.length)),we}(K,tf(K,C,m,r,l,B,N));const pe=[],he={positionedLines:pe,text:K.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Me,we,Xe,Ne,Ae,Be,$e,ke,Ke,Je,ut){let un=0,pt=0,rn=0;const Qe="right"===$e?1:"left"===$e?0:.5;let mn=!1;for(const hn of Ne){const en=hn.getSections();for(const Mn of en){if(Mn.imageName)continue;const Rr=Me[Mn.fontStack];if(Rr&&(mn=void 0!==Rr.ascender&&void 0!==Rr.descender,!mn))break}if(!mn)break}let Yt=0;for(const hn of Ne){hn.trim();const en=hn.getMaxScale(),Mn=24*(en-1),Rr={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Yt]=Rr;const Gn=Rr.positionedGlyphs;let yr=0;if(!hn.length()){pt+=Ae,++Yt;continue}let Fr=0,On=0;for(let yn=0;yn<hn.length();yn++){const ir=hn.getSection(yn),or=hn.getSectionIndex(yn),An=hn.getCharCode(yn);let qn=ir.scale,ur=null,wn=null,Xr=null,Un=24,Di=0;const io=!(ke===Fi.horizontal||!Je&&!Ec(An)||Je&&(ud[An]||($n=An,Mo($n)||Du($n)||yc($n)||is($n)||Ki($n))));if(ir.imageName){const zi=Xe[ir.imageName];if(!zi)continue;Xr=ir.imageName,ge.iconsInText=ge.iconsInText||!0,wn=zi.paddedRect;const Lr=zi.displaySize;qn=24*qn/ut,ur={width:Lr[0],height:Lr[1],left:1,top:-3,advance:io?Lr[1]:Lr[0],localGlyph:!1},Di=mn?-ur.height*qn:24*en-17-Lr[1]*qn,Un=ur.advance;const fs=(io?Lr[0]:Lr[1])*qn-24*en;fs>0&&fs>yr&&(yr=fs)}else{const zi=we[ir.fontStack];if(!zi)continue;zi[An]&&(wn=zi[An]);const Lr=Me[ir.fontStack];if(!Lr)continue;const fs=Lr.glyphs[An];if(!fs)continue;if(ur=fs.metrics,Un=8203!==An?24:0,mn){const Kc=void 0!==Lr.ascender?Math.abs(Lr.ascender):0,Qc=void 0!==Lr.descender?Math.abs(Lr.descender):0,Jc=(Kc+Qc)*qn;Fr<Jc&&(Fr=Jc,On=(Kc-Qc)/2*qn),Di=-Kc*qn}else Di=24*(en-qn)-17}io?(ge.verticalizable=!0,Gn.push({glyph:An,imageName:Xr,x:un,y:pt+Di,vertical:io,scale:qn,localGlyph:ur.localGlyph,fontStack:ir.fontStack,sectionIndex:or,metrics:ur,rect:wn}),un+=Un*qn+Ke):(Gn.push({glyph:An,imageName:Xr,x:un,y:pt+Di,vertical:io,scale:qn,localGlyph:ur.localGlyph,fontStack:ir.fontStack,sectionIndex:or,metrics:ur,rect:wn}),un+=ur.advance*qn+Ke)}0!==Gn.length&&(rn=Math.max(un-Ke,rn),mn?Hm(Gn,Qe,yr,On,Ae*en/2):Hm(Gn,Qe,yr,0,Ae/2)),un=0;const vr=Ae*en+yr;Rr.lineOffset=Math.max(yr,Mn),pt+=vr,++Yt}var $n;const Ln=pt,{horizontalAlign:lr,verticalAlign:cr}=Hc(Be);(function(hn,en,Mn,Rr,Gn,yr){const Fr=(en-Mn)*Gn,On=-yr*Rr;for(const vr of hn)for(const yn of vr.positionedGlyphs)yn.x+=Fr,yn.y+=On})(ge.positionedLines,Qe,lr,cr,rn,Ln),ge.top+=-cr*Ln,ge.bottom=ge.top+Ln,ge.left+=-lr*rn,ge.right=ge.left+rn,ge.hasBaseline=mn}(he,r,s,l,te,_,b,E,M,C,k,$),!function(ge){for(const Me of ge)if(0!==Me.positionedGlyphs.length)return!1;return!0}(pe)&&he}const ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kp(o,r,s,l,h,m){if(r.imageName){const _=l[r.imageName];return _?_.displaySize[0]*r.scale*24/m+h:0}{const _=s[r.fontStack],b=_&&_.glyphs[o];return b?b.metrics.advance*r.scale+h:0}}function Qp(o,r,s,l){const h=Math.pow(o-r,2);return l?o<r?h/2:2*h:h+Math.abs(s)*s}function Bl(o,r,s){let l=0;return 10===o&&(l-=1e4),s&&(l+=150),40!==o&&65288!==o||(l+=50),41!==r&&65289!==r||(l+=50),l}function Jp(o,r,s,l,h,m){let _=null,b=Qp(r,s,h,m);for(const E of l){const C=Qp(r-E.x,s,h,m)+E.badness;C<=b&&(_=E,b=C)}return{index:o,x:r,priorBreak:_,badness:b}}function ef(o){return o?ef(o.priorBreak).concat(o.index):[]}function tf(o,r,s,l,h,m,_){if("point"!==m)return[];if(!o)return[];const b=[],E=function(k,B,N,$,K,te){let oe=0;for(let ue=0;ue<k.length();ue++){const pe=k.getSection(ue);oe+=Kp(k.getCharCode(ue),pe,$,K,B,te)}return oe/Math.max(1,Math.ceil(oe/N))}(o,r,s,l,h,_),C=o.text.indexOf("\u200b")>=0;let I=0;for(let k=0;k<o.length();k++){const B=o.getSection(k),N=o.getCharCode(k);if(ud[N]||(I+=Kp(N,B,l,h,r,_)),k<o.length()-1){const $=!((M=N)<11904||!(Nh(M)||Cu(M)||os(M)||pp(M)||Yn(M)||wt(M)||Ue(M)||xc(M)||bl(M)||Ao(M)||Tu(M)||wc(M)||Ma(M)||Bh(M)||vc(M)||Ht(M)||xl(M)||wl(M)||bc(M)||Yi(M)));(oy[N]||$||B.imageName)&&b.push(Jp(k+1,I,E,b,Bl(N,o.getCharCode(k+1),$&&C),!1))}}var M;return ef(Jp(o.length(),I,E,b,0,!0))}function Hc(o){let r=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function Hm(o,r,s,l,h){if(!(r||s||l||h))return;const m=o.length-1,_=o[m],b=(_.x+_.metrics.advance*_.scale)*r;for(let E=0;E<=m;E++)o[E].x-=b,o[E].y+=s+l+h}function Zm(o,r,s){const{horizontalAlign:l,verticalAlign:h}=Hc(s),m=r[0]-o.displaySize[0]*l,_=r[1]-o.displaySize[1]*h;return{image:o,top:_,bottom:_+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function nf(o,r,s,l,h,m){const _=o.image;let b;if(_.content){const K=_.content,te=_.pixelRatio||1;b=[K[0]/te,K[1]/te,_.displaySize[0]-K[2]/te,_.displaySize[1]-K[3]/te]}const E=r.left*m,C=r.right*m;let I,M,k,B;"width"===s||"both"===s?(B=h[0]+E-l[3],M=h[0]+C+l[1]):(B=h[0]+(E+C-_.displaySize[0])/2,M=B+_.displaySize[0]);const N=r.top*m,$=r.bottom*m;return"height"===s||"both"===s?(I=h[1]+N-l[0],k=h[1]+$+l[2]):(I=h[1]+(N+$-_.displaySize[1])/2,k=I+_.displaySize[1]),{image:_,top:I,right:M,bottom:k,left:B,collisionPadding:b}}class $s extends ze{constructor(r,s,l,h,m){super(r,s),this.angle=h,this.z=l,void 0!==m&&(this.segment=m)}clone(){return new $s(this.x,this.y,this.z,this.angle,this.segment)}}function hd(o,r,s,l,h){if(void 0===r.segment)return!0;let m=r,_=r.segment+1,b=0;for(;b>-s/2;){if(_--,_<0)return!1;b-=o[_].dist(m),m=o[_]}b+=o[_].dist(o[_+1]),_++;const E=[];let C=0;for(;b<s/2;){const I=o[_],M=o[_+1];if(!M)return!1;let k=o[_-1].angleTo(I)-I.angleTo(M);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:k}),C+=k;b-E[0].distance>l;)C-=E.shift().angleDelta;if(C>h)return!1;_++,b+=I.dist(M)}return!0}function rf(o){let r=0;for(let s=0;s<o.length-1;s++)r+=o[s].dist(o[s+1]);return r}function Yu(o,r,s){return o?.6*r*s:0}function Ku(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function Wm(o,r,s,l,h,m){const _=Yu(s,h,m),b=Ku(s,l)*m;let E=0;const C=rf(o)/2;for(let I=0;I<o.length-1;I++){const M=o[I],k=o[I+1],B=M.dist(k);if(E+B>C){const N=(C-E)/B,$=Jt(M.x,k.x,N),K=Jt(M.y,k.y,N),te=new $s($,K,0,k.angleTo(M),I);return!_||hd(o,te,b,_,r)?te:void 0}E+=B}}function of(o,r,s,l,h,m,_,b,E){const C=Yu(l,m,_),I=Ku(l,h),M=I*_,k=0===o[0].x||o[0].x===E||0===o[0].y||o[0].y===E;return r-M<r/4&&(r=M+r/4),sf(o,k?r/2*b%r:(I/2+2*m)*_*b%r,r,C,s,M,k,!1,E)}function sf(o,r,s,l,h,m,_,b,E){const C=m/2,I=rf(o);let M=0,k=r-s,B=[];for(let N=0;N<o.length-1;N++){const $=o[N],K=o[N+1],te=$.dist(K),oe=K.angleTo($);for(;k+s<M+te;){k+=s;const ue=(k-M)/te,pe=Jt($.x,K.x,ue),he=Jt($.y,K.y,ue);if(pe>=0&&pe<E&&he>=0&&he<E&&k-C>=0&&k+C<=I){const ge=new $s(pe,he,0,oe,N);ge._round(),l&&!hd(o,ge,m,l,h)||B.push(ge)}}M+=te}return b||B.length||_||(B=sf(o,M/2,s,l,h,m,_,!0,E)),B}function dd(o,r,s,l,h){const m=[];for(let _=0;_<o.length;_++){const b=o[_];let E;for(let C=0;C<b.length-1;C++){let I=b[C],M=b[C+1];I.x<r&&M.x<r||(I.x<r?I=new ze(r,I.y+(r-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x<r&&(M=new ze(r,I.y+(r-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y<s&&M.y<s||(I.y<s?I=new ze(I.x+(s-I.y)/(M.y-I.y)*(M.x-I.x),s)._round():M.y<s&&(M=new ze(I.x+(s-I.y)/(M.y-I.y)*(M.x-I.x),s)._round()),I.x>=l&&M.x>=l||(I.x>=l?I=new ze(l,I.y+(l-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x>=l&&(M=new ze(l,I.y+(l-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y>=h&&M.y>=h||(I.y>=h?I=new ze(I.x+(h-I.y)/(M.y-I.y)*(M.x-I.x),h)._round():M.y>=h&&(M=new ze(I.x+(h-I.y)/(M.y-I.y)*(M.x-I.x),h)._round()),E&&I.equals(E[E.length-1])||(E=[I],m.push(E)),E.push(M)))))}}return m}tt("Anchor",$s);const Gs=1e20;function Xm(o,r,s,l,h,m,_,b,E){for(let C=r;C<r+l;C++)af(o,s*m+C,m,h,_,b,E);for(let C=s;C<s+h;C++)af(o,C*m+r,1,l,_,b,E)}function af(o,r,s,l,h,m,_){m[0]=0,_[0]=-Gs,_[1]=Gs,h[0]=o[r];for(let b=1,E=0,C=0;b<l;b++){h[b]=o[r+b*s];const I=b*b;do{const M=m[E];C=(h[b]-h[M]+I-M*M)/(b-M)/2}while(C<=_[E]&&--E>-1);E++,m[E]=b,_[E]=C,_[E+1]=Gs}for(let b=0,E=0;b<l;b++){for(;_[E+1]<b;)E++;const C=m[E],I=b-C;o[r+b*s]=h[C]+I*I}}const lf={none:0,ideographs:1,all:2};class Zc{constructor(r,s,l){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,s){const l=[];for(const h in r)for(const m of r[h])l.push({stack:h,id:m});Go(l,({stack:h,id:m},_)=>{let b=this.entries[h];b||(b=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[m];if(void 0!==E)return void _(null,{stack:h,id:m,glyph:E});if(E=this._tinySDF(b,h,m),E)return b.glyphs[m]=E,void _(null,{stack:h,id:m,glyph:E});const C=Math.floor(m/256);if(256*C>65535)return void _(new Error("glyphs > 65535 not supported"));if(b.ranges[C])return void _(null,{stack:h,id:m,glyph:E});let I=b.requests[C];I||(I=b.requests[C]=[],Zc.loadGlyphRange(h,C,this.url,this.requestManager,(M,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(const B in k.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=k.glyphs[+B]);b.ranges[C]=!0}for(const B of I)B(M,k);delete b.requests[C]})),I.push((M,k)=>{M?_(M):k&&_(null,{stack:h,id:m,glyph:k.glyphs[m]||null})})},(h,m)=>{if(h)s(h);else if(m){const _={};for(const{stack:b,id:E,glyph:C}of m)void 0===_[b]&&(_[b]={}),void 0===_[b].glyphs&&(_[b].glyphs={}),_[b].glyphs[E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},_[b].ascender=this.entries[b].ascender,_[b].descender=this.entries[b].descender;s(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==lf.none&&(this.localGlyphMode===lf.all?!!this.localFontFamily:!!this.localFontFamily&&(Ao(r)||Bs(r)||Ma(r)||xl(r))||xc(r))}_tinySDF(r,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=r.tinySDF;if(!m){let $="400";/bold/i.test(s)?$="900":/medium/i.test(s)?$="500":/light/i.test(s)&&($="200"),m=r.tinySDF=new Zc.TinySDF({fontFamily:h,fontWeight:$,fontSize:48,buffer:6,radius:16}),m.fontWeight=$}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCharCode(l),{data:b,width:E,height:C,glyphWidth:I,glyphHeight:M,glyphLeft:k,glyphTop:B,glyphAdvance:N}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Ba({width:E,height:C},b),metrics:{width:I/2,height:M/2,left:k/2,top:B/2-27,advance:N/2,localGlyph:!0}}}}function cf(o,r,s,l){const h=[],m=o.image,_=m.pixelRatio,b=m.paddedRect.w-2,E=m.paddedRect.h-2,C=o.right-o.left,I=o.bottom-o.top,M=m.stretchX||[[0,b]],k=m.stretchY||[[0,E]],B=(Ae,Be)=>Ae+Be[1]-Be[0],N=M.reduce(B,0),$=k.reduce(B,0),K=b-N,te=E-$;let oe=0,ue=N,pe=0,he=$,ge=0,Me=K,we=0,Xe=te;if(m.content&&l){const Ae=m.content;oe=Wc(M,0,Ae[0]),pe=Wc(k,0,Ae[1]),ue=Wc(M,Ae[0],Ae[2]),he=Wc(k,Ae[1],Ae[3]),ge=Ae[0]-oe,we=Ae[1]-pe,Me=Ae[2]-Ae[0]-ue,Xe=Ae[3]-Ae[1]-he}const Ne=(Ae,Be,$e,ke)=>{const Ke=hf(Ae.stretch-oe,ue,C,o.left),Je=Qu(Ae.fixed-ge,Me,Ae.stretch,N),ut=hf(Be.stretch-pe,he,I,o.top),un=Qu(Be.fixed-we,Xe,Be.stretch,$),pt=hf($e.stretch-oe,ue,C,o.left),rn=Qu($e.fixed-ge,Me,$e.stretch,N),Qe=hf(ke.stretch-pe,he,I,o.top),mn=Qu(ke.fixed-we,Xe,ke.stretch,$),Yt=new ze(Ke,ut),$n=new ze(pt,ut),Ln=new ze(pt,Qe),lr=new ze(Ke,Qe),cr=new ze(Je/_,un/_),hn=new ze(rn/_,mn/_),en=r*Math.PI/180;if(en){const Gn=Math.sin(en),yr=Math.cos(en),Fr=[yr,-Gn,Gn,yr];Yt._matMult(Fr),$n._matMult(Fr),lr._matMult(Fr),Ln._matMult(Fr)}const Mn=Ae.stretch+Ae.fixed,Rr=Be.stretch+Be.fixed;return{tl:Yt,tr:$n,bl:lr,br:Ln,tex:{x:m.paddedRect.x+1+Mn,y:m.paddedRect.y+1+Rr,w:$e.stretch+$e.fixed-Mn,h:ke.stretch+ke.fixed-Rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:hn,minFontScaleX:Me/_/C,minFontScaleY:Xe/_/I,isSDF:s}};if(l&&(m.stretchX||m.stretchY)){const Ae=uf(M,K,N),Be=uf(k,te,$);for(let $e=0;$e<Ae.length-1;$e++){const ke=Ae[$e],Ke=Ae[$e+1];for(let Je=0;Je<Be.length-1;Je++)h.push(Ne(ke,Be[Je],Ke,Be[Je+1]))}}else h.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return h}function Wc(o,r,s){let l=0;for(const h of o)l+=Math.max(r,Math.min(s,h[1]))-Math.max(r,Math.min(s,h[0]));return l}function uf(o,r,s){const l=[{fixed:-1,stretch:0}];for(const[h,m]of o){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return l.push({fixed:r+1,stretch:s}),l}function hf(o,r,s,l){return o/r*s+l}function Qu(o,r,s,l){return o-r*s/l}function sy(o,r,s,l){const h=r+o.positionedLines[l].lineOffset;return 0===l?s+h/2:s+(h+(r+o.positionedLines[l-1].lineOffset))/2}Zc.loadGlyphRange=function(o,r,s,l,h){const m=256*r,_=m+255,b=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),Ss.Glyphs);U(b,(E,C)=>{if(E)h(E);else if(C){const I={},M=new ad(C).readFields(ny,{});for(const k of M.glyphs)I[k.id]=k;h(null,{glyphs:I,ascender:M.ascender,descender:M.descender})}})},Zc.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}){this.buffer=r,this.cutoff=l,this.radius=s;const b=this.size=o+4*r,E=this._createCanvas(b),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${m} ${o}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.floor(s),b=Math.min(this.size-this.buffer,Math.ceil(m-h)),E=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),C=b+2*this.buffer,I=E+2*this.buffer,M=C*I,k=new Uint8ClampedArray(M),B={data:k,width:C,height:I,glyphWidth:b,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===b||0===E)return B;const{ctx:N,buffer:$,gridInner:K,gridOuter:te}=this;N.clearRect($,$,b,E),N.fillText(o,$,$+_+1);const oe=N.getImageData($,$,b,E);te.fill(Gs,0,M),K.fill(0,0,M);for(let ue=0;ue<E;ue++)for(let pe=0;pe<b;pe++){const he=oe.data[4*(ue*b+pe)+3]/255;if(0===he)continue;const ge=(ue+$)*C+pe+$;if(1===he)te[ge]=0,K[ge]=Gs;else{const Me=.5-he;te[ge]=Me>0?Me*Me:0,K[ge]=Me<0?Me*Me:0}}Xm(te,0,0,C,I,C,this.f,this.v,this.z),Xm(K,$,$,b,E,C,this.f,this.v,this.z);for(let ue=0;ue<M;ue++){const pe=Math.sqrt(te[ue])-Math.sqrt(K[ue]);k[ue]=Math.round(255-255*(pe/this.radius+this.cutoff))}return B}};class Ym{constructor(r=[],s=ay){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:l}=this,h=s[r];for(;r>0;){const m=r-1>>1,_=s[m];if(l(h,_)>=0)break;s[r]=_,r=m}s[r]=h}_down(r){const{data:s,compare:l}=this,h=this.length>>1,m=s[r];for(;r<h;){let _=1+(r<<1),b=s[_];const E=_+1;if(E<this.length&&l(s[E],b)<0&&(_=E,b=s[E]),l(b,m)>=0)break;s[r]=b,r=_}s[r]=m}}function ay(o,r){return o<r?-1:o>r?1:0}function ly(o,r=1,s=!1){let l=1/0,h=1/0,m=-1/0,_=-1/0;const b=o[0];for(let B=0;B<b.length;B++){const N=b[B];(!B||N.x<l)&&(l=N.x),(!B||N.y<h)&&(h=N.y),(!B||N.x>m)&&(m=N.x),(!B||N.y>_)&&(_=N.y)}const E=Math.min(m-l,_-h);let C=E/2;const I=new Ym([],Oo);if(0===E)return new ze(l,h);for(let B=l;B<m;B+=E)for(let N=h;N<_;N+=E)I.push(new Xc(B+C,N+C,C,o));let M=function(B){let N=0,$=0,K=0;const te=B[0];for(let oe=0,ue=te.length,pe=ue-1;oe<ue;pe=oe++){const he=te[oe],ge=te[pe],Me=he.x*ge.y-ge.x*he.y;$+=(he.x+ge.x)*Me,K+=(he.y+ge.y)*Me,N+=3*Me}return new Xc($/N,K/N,0,B)}(o),k=I.length;for(;I.length;){const B=I.pop();(B.d>M.d||!M.d)&&(M=B,s&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,k)),B.max-M.d<=r||(C=B.h/2,I.push(new Xc(B.p.x-C,B.p.y-C,C,o)),I.push(new Xc(B.p.x+C,B.p.y-C,C,o)),I.push(new Xc(B.p.x-C,B.p.y+C,C,o)),I.push(new Xc(B.p.x+C,B.p.y+C,C,o)),k+=4)}return s&&(console.log(`num probes: ${k}`),console.log(`best distance: ${M.d}`)),M.p}function Oo(o,r){return r.max-o.max}function Xc(o,r,s,l){this.p=new ze(o,r),this.h=s,this.d=function(h,m){let _=!1,b=1/0;for(let E=0;E<m.length;E++){const C=m[E];for(let I=0,M=C.length,k=M-1;I<M;k=I++){const B=C[I],N=C[k];B.y>h.y!=N.y>h.y&&h.x<(N.x-B.x)*(h.y-B.y)/(N.y-B.y)+B.x&&(_=!_),b=Math.min(b,vm(h,B,N))}}return(_?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const pd=Number.POSITIVE_INFINITY,cy=Math.sqrt(2);function Km(o,r){return r[1]!==pd?function(s,l,h){let m=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),s){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(s){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,_]}(o,r[0],r[1]):function(s,l){let h=0,m=0;l<0&&(l=0);const _=l/cy;switch(s){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,m]}(o,r[0])}function uy(o,r,s,l,h,m,_,b,E){o.createArrays(),o.tilePixelRatio=Ut/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const C=o.layers[0].layout,I=o.layers[0]._unevaluatedLayout._values,M={};if("composite"===o.textSizeData.kind){const{minZoom:N,maxZoom:$}=o.textSizeData;M.compositeTextSizes=[I["text-size"].possiblyEvaluate(new L(N),b),I["text-size"].possiblyEvaluate(new L($),b)]}if("composite"===o.iconSizeData.kind){const{minZoom:N,maxZoom:$}=o.iconSizeData;M.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new L(N),b),I["icon-size"].possiblyEvaluate(new L($),b)]}M.layoutTextSize=I["text-size"].possiblyEvaluate(new L(E+1),b),M.layoutIconSize=I["icon-size"].possiblyEvaluate(new L(E+1),b),M.textMaxSize=I["text-size"].possiblyEvaluate(new L(18),b);const k="map"===C.get("text-rotation-alignment")&&"point"!==C.get("symbol-placement"),B=C.get("text-size");for(const N of o.features){const $=C.get("text-font").evaluate(N,{},b).join(","),K=B.evaluate(N,{},b),te=M.layoutTextSize.evaluate(N,{},b),oe=(M.layoutIconSize.evaluate(N,{},b),{horizontal:{},vertical:void 0}),ue=N.text;let pe,he=[0,0];if(ue){const we=ue.toString(),Xe=24*C.get("text-letter-spacing").evaluate(N,{},b),Ne=24*C.get("text-line-height").evaluate(N,{},b),Ae=ki(we)?Xe:0,Be=C.get("text-anchor").evaluate(N,{},b),$e=C.get("text-variable-anchor");if(!$e){const pt=C.get("text-radial-offset").evaluate(N,{},b);he=pt?Km(Be,[24*pt,pd]):C.get("text-offset").evaluate(N,{},b).map(rn=>24*rn)}let ke=k?"center":C.get("text-justify").evaluate(N,{},b);const Ke=C.get("symbol-placement"),Je="point"===Ke,ut="point"===Ke?24*C.get("text-max-width").evaluate(N,{},b):0,un=pt=>{o.allowVerticalPlacement&&yi(we)&&(oe.vertical=Xu(ue,r,s,h,$,ut,Ne,Be,pt,Ae,he,Fi.vertical,!0,Ke,te,K))};if(!k&&$e){const pt="auto"===ke?$e.map(Qe=>df(Qe)):[ke];let rn=!1;for(let Qe=0;Qe<pt.length;Qe++){const mn=pt[Qe];if(!oe.horizontal[mn])if(rn)oe.horizontal[mn]=oe.horizontal[0];else{const Yt=Xu(ue,r,s,h,$,ut,Ne,"center",mn,Ae,he,Fi.horizontal,!1,Ke,te,K);Yt&&(oe.horizontal[mn]=Yt,rn=1===Yt.positionedLines.length)}}un("left")}else{if("auto"===ke&&(ke=df(Be)),Je||C.get("text-writing-mode").indexOf("horizontal")>=0||!yi(we)){const pt=Xu(ue,r,s,h,$,ut,Ne,Be,ke,Ae,he,Fi.horizontal,!1,Ke,te,K);pt&&(oe.horizontal[ke]=pt)}un("point"===Ke?"left":ke)}}let ge=!1;if(N.icon&&N.icon.name){const we=l[N.icon.name];we&&(pe=Zm(h[N.icon.name],C.get("icon-offset").evaluate(N,{},b),C.get("icon-anchor").evaluate(N,{},b)),ge=we.sdf,void 0===o.sdfIcons?o.sdfIcons=we.sdf:o.sdfIcons!==we.sdf&&Pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==o.pixelRatio||0!==C.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Me=eg(oe.horizontal)||oe.vertical;o.iconsInText||(o.iconsInText=!!Me&&Me.iconsInText),(Me||pe)&&Qm(o,N,oe,pe,l,M,te,0,he,ge,_,b)}m&&o.generateCollisionDebugBuffers(E,o.collisionBoxArray)}function df(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qm(o,r,s,l,h,m,_,b,E,C,I,M){let k=m.textMaxSize.evaluate(r,{},M);void 0===k&&(k=_);const B=o.layers[0].layout,N=B.get("icon-offset").evaluate(r,{},M),$=eg(s.horizontal)||s.vertical,K=_/24,te=o.tilePixelRatio*k/24,oe=o.tilePixelRatio*B.get("symbol-spacing"),ue=B.get("text-padding")*o.tilePixelRatio,pe=B.get("icon-padding")*o.tilePixelRatio,he=vn(B.get("text-max-angle")),ge="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),Me="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),we=B.get("symbol-placement"),Xe=oe/2,Ne=B.get("icon-text-fit");let Ae;l&&"none"!==Ne&&(o.allowVerticalPlacement&&s.vertical&&(Ae=nf(l,s.vertical,Ne,B.get("icon-text-fit-padding"),N,K)),$&&(l=nf(l,$,Ne,B.get("icon-text-fit-padding"),N,K)));const Be=($e,ke)=>{ke.x<0||ke.x>=Ut||ke.y<0||ke.y>=Ut||function(Ke,Je,ut,un,pt,rn,Qe,mn,Yt,$n,Ln,lr,cr,hn,en,Mn,Rr,Gn,yr,Fr,On,vr,yn,ir,or){const An=Ke.addToLineVertexArray(Je,un);let qn,ur,wn,Xr,Un,Di,io,zi=0,Lr=0,fs=0,Kc=0,Qc=-1,Jc=-1;const ms={};let Tf=ku(""),vg=0,Pd=0;if(void 0===Yt._unevaluatedLayout.getValue("text-radial-offset")?[vg,Pd]=Yt.layout.get("text-offset").evaluate(On,{},or).map(oo=>24*oo):(vg=24*Yt.layout.get("text-radial-offset").evaluate(On,{},or),Pd=pd),Ke.allowVerticalPlacement&&pt.vertical){const oo=pt.vertical;if(en)Di=pf(oo),mn&&(io=pf(mn));else{const hi=Yt.layout.get("text-rotate").evaluate(On,{},or)+90;wn=Tt($n,ut,Je,Ln,lr,cr,oo,hn,hi,Mn),mn&&(Xr=Tt($n,ut,Je,Ln,lr,cr,mn,Gn,hi))}}if(rn){const oo=Yt.layout.get("icon-rotate").evaluate(On,{},or),hi="none"!==Yt.layout.get("icon-text-fit"),uh=cf(rn,oo,yn,hi),kd=mn?cf(mn,oo,yn,hi):void 0;ur=Tt($n,ut,Je,Ln,lr,cr,rn,Gn,oo),zi=4*uh.length;const If=Ke.iconSizeData;let eu=null;"source"===If.kind?(eu=[us*Yt.layout.get("icon-size").evaluate(On,{},or)],eu[0]>Ua&&Pn(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===If.kind&&(eu=[us*vr.compositeIconSizes[0].evaluate(On,{},or),us*vr.compositeIconSizes[1].evaluate(On,{},or)],(eu[0]>Ua||eu[1]>Ua)&&Pn(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ke.addSymbols(Ke.icon,uh,eu,Fr,yr,On,!1,ut,Je,An.lineStartIndex,An.lineLength,-1,ir,or),Qc=Ke.icon.placedSymbolArray.length-1,kd&&(Lr=4*kd.length,Ke.addSymbols(Ke.icon,kd,eu,Fr,yr,On,Fi.vertical,ut,Je,An.lineStartIndex,An.lineLength,-1,ir,or),Jc=Ke.icon.placedSymbolArray.length-1)}for(const oo in pt.horizontal){const hi=pt.horizontal[oo];qn||(Tf=ku(hi.text),en?Un=pf(hi):qn=Tt($n,ut,Je,Ln,lr,cr,hi,hn,Yt.layout.get("text-rotate").evaluate(On,{},or),Mn));const uh=1===hi.positionedLines.length;if(fs+=Jm(Ke,ut,Je,hi,Qe,Yt,en,On,Mn,An,pt.vertical?Fi.horizontal:Fi.horizontalOnly,uh?Object.keys(pt.horizontal):[oo],ms,Qc,vr,ir,or),uh)break}pt.vertical&&(Kc+=Jm(Ke,ut,Je,pt.vertical,Qe,Yt,en,On,Mn,An,Fi.vertical,["vertical"],ms,Jc,vr,ir,or));let Ga=-1;const Sf=(oo,hi)=>oo?Math.max(oo,hi):hi;Ga=Sf(Un,Ga),Ga=Sf(Di,Ga),Ga=Sf(io,Ga);const Px=Ga>-1?1:0;Ke.glyphOffsetArray.length>=hs.MAX_GLYPHS&&Pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==On.sortKey&&Ke.addToSortKeyRanges(Ke.symbolInstances.length,On.sortKey),Ke.symbolInstances.emplaceBack(ut.x,ut.y,ut.z,Je.x,Je.y,ms.right>=0?ms.right:-1,ms.center>=0?ms.center:-1,ms.left>=0?ms.left:-1,ms.vertical>=0?ms.vertical:-1,Qc,Jc,Tf,void 0!==qn?qn:Ke.collisionBoxArray.length,void 0!==qn?qn+1:Ke.collisionBoxArray.length,void 0!==wn?wn:Ke.collisionBoxArray.length,void 0!==wn?wn+1:Ke.collisionBoxArray.length,void 0!==ur?ur:Ke.collisionBoxArray.length,void 0!==ur?ur+1:Ke.collisionBoxArray.length,Xr||Ke.collisionBoxArray.length,Xr?Xr+1:Ke.collisionBoxArray.length,Ln,fs,Kc,zi,Lr,Px,0,vg,Pd,Ga)}(o,ke,ke,$e,s,l,h,Ae,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,ue,ge,E,0,pe,Me,N,r,m,C,I,M)};if("line"===we)for(const $e of dd(r.geometry,0,0,Ut,Ut)){const ke=of($e,oe,he,s.vertical||$,l,24,te,o.overscaling,Ut);for(const Ke of ke){const Je=$;Je&&tg(o,Je.text,Xe,Ke)||Be($e,Ke)}}else if("line-center"===we){for(const $e of r.geometry)if($e.length>1){const ke=Wm($e,he,s.vertical||$,l,24,te);ke&&Be($e,ke)}}else if("Polygon"===r.type)for(const $e of Lp(r.geometry,0)){const ke=ly($e,16);Be($e[0],new $s(ke.x,ke.y,0,0,void 0))}else if("LineString"===r.type)for(const $e of r.geometry)Be($e,new $s($e[0].x,$e[0].y,0,0,void 0));else if("Point"===r.type)for(const $e of r.geometry)for(const ke of $e)Be([ke],new $s(ke.x,ke.y,0,0,void 0))}const Ua=32640;function Jm(o,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$,K){const te=function(pe,he,ge,Me,we,Xe,Ne,Ae){const Be=[];if(0===he.positionedLines.length)return Be;const $e=Me.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,ke=function(pt){const rn=pt[0],Qe=pt[1],mn=rn*Qe;return mn>0?[rn,-Qe]:mn<0?[-rn,Qe]:0===rn?[Qe,rn]:[Qe,-rn]}(ge);let Ke=Math.abs(he.top-he.bottom);for(const pt of he.positionedLines)Ke-=pt.lineOffset;const Je=he.positionedLines.length,ut=Ke/Je;let un=he.top-ge[1];for(let pt=0;pt<Je;++pt){const rn=he.positionedLines[pt];un=sy(he,ut,un,pt);for(const Qe of rn.positionedGlyphs){if(!Qe.rect)continue;const mn=Qe.rect||{};let Yt=4,$n=!0,Ln=1,lr=0;if(Qe.imageName){const wn=Ne[Qe.imageName];if(!wn)continue;if(wn.sdf){Pn("SDF images are not supported in formatted text and will be ignored.");continue}$n=!1,Ln=wn.pixelRatio,Yt=1/Ln}const cr=(we||Ae)&&Qe.vertical,hn=Qe.metrics.advance*Qe.scale/2,en=Qe.metrics,Mn=Qe.rect;if(null===Mn)continue;Ae&&he.verticalizable&&(lr=Qe.imageName?hn-Qe.metrics.width*Qe.scale/2:0);const Rr=we?[Qe.x+hn,Qe.y]:[0,0];let Gn=[0,0],yr=[0,0],Fr=!1;we||(cr?(yr=[Qe.x+hn+ke[0],Qe.y+ke[1]-lr],Fr=!0):Gn=[Qe.x+hn+ge[0],Qe.y+ge[1]-lr]);const On=Mn.w*Qe.scale/(Ln*(Qe.localGlyph?2:1)),vr=Mn.h*Qe.scale/(Ln*(Qe.localGlyph?2:1));let yn,ir,or,An;if(cr){const wn=Qe.y-un,Xr=new ze(-hn,hn-wn),Un=-Math.PI/2,Di=new ze(...yr);yn=new ze(-hn+Gn[0],Gn[1]),yn._rotateAround(Un,Xr)._add(Di),yn.x+=-wn+hn,yn.y-=(en.left-Yt)*Qe.scale;const io=Qe.imageName?en.advance*Qe.scale:24*Qe.scale,zi=String.fromCharCode(Qe.glyph);ey(zi)?yn.x+=(1-Yt)*Qe.scale:jc(zi)?yn.x+=io-en.height*Qe.scale+(-Yt-1)*Qe.scale:yn.x+=Qe.imageName||en.width+2*Yt===Mn.w&&en.height+2*Yt===Mn.h?(io-vr)/2:(io-(en.height+2*Yt)*Qe.scale)/2,ir=new ze(yn.x,yn.y-On),or=new ze(yn.x+vr,yn.y),An=new ze(yn.x+vr,yn.y-On)}else{const wn=(en.left-Yt)*Qe.scale-hn+Gn[0],Xr=(-en.top-Yt)*Qe.scale+Gn[1],Un=wn+On,Di=Xr+vr;yn=new ze(wn,Xr),ir=new ze(Un,Xr),or=new ze(wn,Di),An=new ze(Un,Di)}if($e){let wn;wn=we?new ze(0,0):Fr?new ze(ke[0],ke[1]):new ze(ge[0],ge[1]),yn._rotateAround($e,wn),ir._rotateAround($e,wn),or._rotateAround($e,wn),An._rotateAround($e,wn)}const qn=new ze(0,0),ur=new ze(0,0);Be.push({tl:yn,tr:ir,bl:or,br:An,tex:mn,writingMode:he.writingMode,glyphOffset:Rr,sectionIndex:Qe.sectionIndex,isSDF:$n,pixelOffsetTL:qn,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,l,E,m,_,b,h,o.allowVerticalPlacement),oe=o.textSizeData;let ue=null;"source"===oe.kind?(ue=[us*m.layout.get("text-size").evaluate(b,{},K)],ue[0]>Ua&&Pn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===oe.kind&&(ue=[us*N.compositeTextSizes[0].evaluate(b,{},K),us*N.compositeTextSizes[1].evaluate(b,{},K)],(ue[0]>Ua||ue[1]>Ua)&&Pn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,te,ue,E,_,b,I,r,s,C.lineStartIndex,C.lineLength,B,$,K);for(const pe of M)k[pe]=o.text.placedSymbolArray.length-1;return 4*te.length}function eg(o){for(const r in o)return o[r];return null}function Tt(o,r,s,l,h,m,_,b,E,C){let I=_.top,M=_.bottom,k=_.left,B=_.right;const N=_.collisionPadding;if(N&&(k-=N[0],I-=N[1],B+=N[2],M+=N[3]),E){const $=new ze(k,I),K=new ze(B,I),te=new ze(k,M),oe=new ze(B,M),ue=vn(E);let pe=new ze(0,0);C&&(pe=new ze(C[0],C[1])),$._rotateAround(ue,pe),K._rotateAround(ue,pe),te._rotateAround(ue,pe),oe._rotateAround(ue,pe),k=Math.min($.x,K.x,te.x,oe.x),B=Math.max($.x,K.x,te.x,oe.x),I=Math.min($.y,K.y,te.y,oe.y),M=Math.max($.y,K.y,te.y,oe.y)}return o.emplaceBack(r.x,r.y,r.z,s.x,s.y,k,I,B,M,b,l,h,m),o.length-1}function pf(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function tg(o,r,s,l){const h=o.compareText;if(r in h){const m=h[r];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<s)return!0}else h[r]=[];return h[r].push(l),!1}const ng=Ro.VectorTileFeature.types,fd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Li(o,r,s,l,h,m,_,b,E,C,I,M,k,B,N,$){const K=I?Math.min(Ua,Math.round(I[0])):0,te=I?Math.min(Ua,Math.round(I[1])):0;o.emplaceBack(r,s,Math.round(32*_),Math.round(32*b),E,C,(K<<1)+(M?1:0),te,16*k,16*B,256*N,256*$,l,h,m,0)}function md(o,r,s){o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s)}function hy(o){for(const r of o.sections)if(Mu(r.text))return!0;return!1}class Ju{constructor(r){this.layoutVertexArray=new vt,this.indexArray=new kn,this.programConfigurations=r,this.segments=new Jn,this.dynamicLayoutVertexArray=new mt,this.opacityVertexArray=new Zt,this.placedSymbolArray=new Uh}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,s,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Uc.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,X_.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,fd,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tt("SymbolBuffers",Ju);class zo{constructor(r,s,l){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Jn,this.collisionVertexArray=new qr,this.collisionVertexArrayExt=new mt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Y_.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,K_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tt("CollisionBuffers",zo);class hs{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wp([]),this.placementViewportMatrix=wp([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gp(this.zoom,s["text-size"]),this.iconSizeData=Gp(this.zoom,s["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Fi[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID}createArrays(){this.text=new Ju(new Ic(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Ju(new Ic(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Au,this.lineVertexArray=new Pa,this.symbolInstances=new Vs}calculateGlyphDependencies(r,s,l,h,m){for(let _=0;_<r.length;_++)if(s[r.charCodeAt(_)]=!0,h&&m){const b=Hu[r.charAt(_)];b&&(s[b.charCodeAt(0)]=!0)}}populate(r,s,l,h){const m=this.layers[0],_=m.layout,b=_.get("text-font"),E=_.get("text-field"),C=_.get("icon-image"),I=("constant"!==E.value.kind||E.value.value instanceof Nr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),M="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,k=_.get("symbol-sort-key");if(this.features=[],!I&&!M)return;const B=s.iconDependencies,N=s.glyphDependencies,$=s.availableImages,K=new L(this.zoom);for(const{feature:te,id:oe,index:ue,sourceLayerIndex:pe}of r){const he=m._featureFilter.needGeometry,ge=ko(te,he);if(!m._featureFilter.filter(K,ge,l))continue;let Me,we;if(he||(ge.geometry=za(te,l,h)),I){const Ne=m.getValueAndResolveTokens("text-field",ge,l,$),Ae=Nr.factory(Ne);hy(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===A()||this.hasRTLText&&F.isParsed())&&(Me=J_(Ae,m,ge))}if(M){const Ne=m.getValueAndResolveTokens("icon-image",ge,l,$);we=Ne instanceof Ur?Ne:Ur.fromString(Ne)}if(!Me&&!we)continue;const Xe=this.sortFeaturesByKey?k.evaluate(ge,{},l):void 0;if(this.features.push({id:oe,text:Me,icon:we,index:ue,sourceLayerIndex:pe,geometry:ge.geometry,properties:te.properties,type:ng[te.type],sortKey:Xe}),we&&(B[we.name]=!0),Me){const Ne=b.evaluate(ge,{},l).join(","),Ae="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fi.vertical)>=0;for(const Be of Me.sections)if(Be.image)B[Be.image.name]=!0;else{const $e=yi(Me.toString()),ke=Be.fontStack||Ne,Ke=N[ke]=N[ke]||{};this.calculateGlyphDependencies(Be.text,Ke,Ae,this.allowVerticalPlacement,$e)}}}"line"===_.get("symbol-placement")&&(this.features=function(te){const oe={},ue={},pe=[];let he=0;function ge(Ne){pe.push(te[Ne]),he++}function Me(Ne,Ae,Be){const $e=ue[Ne];return delete ue[Ne],ue[Ae]=$e,pe[$e].geometry[0].pop(),pe[$e].geometry[0]=pe[$e].geometry[0].concat(Be[0]),$e}function we(Ne,Ae,Be){const $e=oe[Ae];return delete oe[Ae],oe[Ne]=$e,pe[$e].geometry[0].shift(),pe[$e].geometry[0]=Be[0].concat(pe[$e].geometry[0]),$e}function Xe(Ne,Ae,Be){const $e=Be?Ae[0][Ae[0].length-1]:Ae[0][0];return`${Ne}:${$e.x}:${$e.y}`}for(let Ne=0;Ne<te.length;Ne++){const Ae=te[Ne],Be=Ae.geometry,$e=Ae.text?Ae.text.toString():null;if(!$e){ge(Ne);continue}const ke=Xe($e,Be),Ke=Xe($e,Be,!0);if(ke in ue&&Ke in oe&&ue[ke]!==oe[Ke]){const Je=we(ke,Ke,Be),ut=Me(ke,Ke,pe[Je].geometry);delete oe[ke],delete ue[Ke],ue[Xe($e,pe[ut].geometry,!0)]=ut,pe[Je].geometry=null}else ke in ue?Me(ke,Ke,Be):Ke in oe?we(ke,Ke,Be):(ge(Ne),oe[ke]=he-1,ue[Ke]=he-1)}return pe.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,oe)=>te.sortKey-oe.sortKey)}update(r,s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const l=this.lineVertexArray.length;if(void 0!==r.segment){let h=r.dist(s[r.segment+1]),m=r.dist(s[r.segment]);const _={};for(let b=r.segment+1;b<s.length;b++)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:h},b<s.length-1&&(h+=s[b+1].dist(s[b]));for(let b=r.segment||0;b>=0;b--)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const E=_[b];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(r,s,l,h,m,_,b,E,C,I,M,k,B,N){const $=r.indexArray,K=r.layoutVertexArray,te=r.segments.prepareSegment(4*s.length,K,$,this.canOverlap?_.sortKey:void 0),oe=this.glyphOffsetArray.length,ue=te.vertexLength,pe=this.allowVerticalPlacement&&b===Fi.vertical?Math.PI/2:0,he=_.text&&_.text.sections;for(let ge=0;ge<s.length;ge++){const{tl:Me,tr:we,bl:Xe,br:Ne,tex:Ae,pixelOffsetTL:Be,pixelOffsetBR:$e,minFontScaleX:ke,minFontScaleY:Ke,glyphOffset:Je,isSDF:ut,sectionIndex:un}=s[ge],pt=te.vertexLength,rn=Je[1];Li(K,E.x,E.y,E.z,C.x,C.y,Me.x,rn+Me.y,Ae.x,Ae.y,l,ut,Be.x,Be.y,ke,Ke),Li(K,E.x,E.y,E.z,C.x,C.y,we.x,rn+we.y,Ae.x+Ae.w,Ae.y,l,ut,$e.x,Be.y,ke,Ke),Li(K,E.x,E.y,E.z,C.x,C.y,Xe.x,rn+Xe.y,Ae.x,Ae.y+Ae.h,l,ut,Be.x,$e.y,ke,Ke),Li(K,E.x,E.y,E.z,C.x,C.y,Ne.x,rn+Ne.y,Ae.x+Ae.w,Ae.y+Ae.h,l,ut,$e.x,$e.y,ke,Ke),md(r.dynamicLayoutVertexArray,E,pe),$.emplaceBack(pt,pt+1,pt+2),$.emplaceBack(pt+1,pt+2,pt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),ge!==s.length-1&&un===s[ge+1].sectionIndex||r.programConfigurations.populatePaintArrays(K.length,_,_.index,{},B,N,he&&he[un])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,C.x,C.y,oe,this.glyphOffsetArray.length-oe,ue,I,M,C.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],b,0,!1,0,k,0)}_commitLayoutVertex(r,s,l,h,m,_,b){r.emplaceBack(s,l,h,m,_,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,s,l,h,m,_,b){const E=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),C=E.vertexLength,I=b.tileAnchorX,M=b.tileAnchorY;for(let B=0;B<4;B++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-r.padding,-r.padding),l.collisionVertexArrayExt.emplaceBack(s,r.padding,-r.padding),l.collisionVertexArrayExt.emplaceBack(s,r.padding,r.padding),l.collisionVertexArrayExt.emplaceBack(s,-r.padding,r.padding),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,I,M,new ze(r.x1,r.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,I,M,new ze(r.x2,r.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,I,M,new ze(r.x2,r.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,I,M,new ze(r.x1,r.y2)),E.vertexLength+=4;const k=l.indexArray;k.emplaceBack(C,C+1),k.emplaceBack(C+1,C+2),k.emplaceBack(C+2,C+3),k.emplaceBack(C+3,C),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,l,h,m,_){for(let b=h;b<m;b++){const E=l.get(b),C=this.getSymbolInstanceTextSize(r,_,s,b);this._addCollisionDebugVertices(E,C,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,s,l,h,m,_){for(let b=h;b<m;b++){const E=l.get(b),C=this.getSymbolInstanceIconSize(r,s,b);this._addCollisionDebugVertices(E,C,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zo(mr,Nm.members,In),this.iconCollisionBox=new zo(mr,Nm.members,In);const l=Vc(this.iconSizeData,r),h=Vc(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,r,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,r,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,r,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,r,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,s,l,h){const m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),_=sd(this.textSizeData,r,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,s,l){const h=this.icon.placedSymbolArray.get(l),m=sd(this.iconSizeData,r,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,s,l){r.emplaceBack(s,-l,-l),r.emplaceBack(s,l,-l),r.emplaceBack(s,l,l),r.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(r,s,l,h,m,_){for(let b=h;b<m;b++){const E=l.get(b),C=this.getSymbolInstanceTextSize(r,_,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,E.padding)}}_updateIconDebugCollisionBoxes(r,s,l,h,m){for(let _=h;_<m;_++){const b=l.get(_),E=this.getSymbolInstanceIconSize(r,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding)}}updateCollisionDebugBuffers(r,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Vc(this.iconSizeData,r),h=Vc(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,r,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,r,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,r,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,r,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,l,h,m,_,b,E,C){const I={};for(let M=s;M<l;M++){const k=r.get(M);I.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.textFeatureIndex=k.featureIndex;break}for(let M=h;M<m;M++){const k=r.get(M);I.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalTextFeatureIndex=k.featureIndex;break}for(let M=_;M<b;M++){const k=r.get(M);I.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.iconFeatureIndex=k.featureIndex;break}for(let M=E;M<C;M++){const k=r.get(M);I.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalIconFeatureIndex=k.featureIndex;break}return I}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const l=r.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(r),l=Math.cos(r),h=[],m=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const E=this.symbolInstances.get(b);h.push(0|Math.round(s*E.tileAnchorX+l*E.tileAnchorY)),m.push(E.featureIndex)}return _.sort((b,E)=>h[b]-h[E]||m[E]-m[b]),_}addToSortKeyRanges(r,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,m,_)=>{h>=0&&_.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tt("SymbolBucket",hs,{omit:["layers","collisionBoxArray","features","compareText"]}),hs.MAX_GLYPHS=65535,hs.addDynamicAttributes=md;const rg=new Te({"symbol-placement":new Z(de.layout_symbol["symbol-placement"]),"symbol-spacing":new Z(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Z(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ie(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Z(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Z(de.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Z(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new Z(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Z(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new ie(de.layout_symbol["icon-size"]),"icon-text-fit":new Z(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Z(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new ie(de.layout_symbol["icon-image"]),"icon-rotate":new ie(de.layout_symbol["icon-rotate"]),"icon-padding":new Z(de.layout_symbol["icon-padding"]),"icon-keep-upright":new Z(de.layout_symbol["icon-keep-upright"]),"icon-offset":new ie(de.layout_symbol["icon-offset"]),"icon-anchor":new ie(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Z(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Z(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Z(de.layout_symbol["text-rotation-alignment"]),"text-field":new ie(de.layout_symbol["text-field"]),"text-font":new ie(de.layout_symbol["text-font"]),"text-size":new ie(de.layout_symbol["text-size"]),"text-max-width":new ie(de.layout_symbol["text-max-width"]),"text-line-height":new ie(de.layout_symbol["text-line-height"]),"text-letter-spacing":new ie(de.layout_symbol["text-letter-spacing"]),"text-justify":new ie(de.layout_symbol["text-justify"]),"text-radial-offset":new ie(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Z(de.layout_symbol["text-variable-anchor"]),"text-anchor":new ie(de.layout_symbol["text-anchor"]),"text-max-angle":new Z(de.layout_symbol["text-max-angle"]),"text-writing-mode":new Z(de.layout_symbol["text-writing-mode"]),"text-rotate":new ie(de.layout_symbol["text-rotate"]),"text-padding":new Z(de.layout_symbol["text-padding"]),"text-keep-upright":new Z(de.layout_symbol["text-keep-upright"]),"text-transform":new ie(de.layout_symbol["text-transform"]),"text-offset":new ie(de.layout_symbol["text-offset"]),"text-allow-overlap":new Z(de.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Z(de.layout_symbol["text-ignore-placement"]),"text-optional":new Z(de.layout_symbol["text-optional"])});var eh={paint:new Te({"icon-opacity":new ie(de.paint_symbol["icon-opacity"]),"icon-color":new ie(de.paint_symbol["icon-color"]),"icon-halo-color":new ie(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new ie(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ie(de.paint_symbol["icon-halo-blur"]),"icon-translate":new Z(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new Z(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new ie(de.paint_symbol["text-opacity"]),"text-color":new ie(de.paint_symbol["text-color"],{runtimeType:Zn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ie(de.paint_symbol["text-halo-color"]),"text-halo-width":new ie(de.paint_symbol["text-halo-width"]),"text-halo-blur":new ie(de.paint_symbol["text-halo-blur"]),"text-translate":new Z(de.paint_symbol["text-translate"]),"text-translate-anchor":new Z(de.paint_symbol["text-translate-anchor"])}),layout:rg};class dy{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:uo,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt("FormatSectionOverride",dy,{omit:["defaultValue"]});class th extends gr{constructor(r){super(r,eh)}recalculate(r,s){super.recalculate(r,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,s,l,h){const m=this.layout.get(r).evaluate(s,{},l,h),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||nr(_.value)||!m?m:(b=s.properties,m.replace(/{([^{}]+)}/g,(C,I)=>I in b?String(b[I]):""));var b}createBucket(r){return new hs(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of eh.paint.overridableProperties){if(!th.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),l=new dy(s),h=new mu(l,s.property.specification);let m=null;m="constant"===s.value.kind||"source"===s.value.kind?new go("source",h):new Rs("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[r]=new ee(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&th.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const l=r.get("text-field"),h=eh.paint.properties[s];let m=!1;const _=b=>{for(const E of b)if(h.overrides&&h.overrides.hasOverride(E))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof Nr)_(l.value.value.sections);else if("source"===l.value.kind){const b=C=>{m||(C instanceof Vr&&Wn(C.value)===Qt?_(C.value.sections):C instanceof nc?_(C.sections):C.eachChild(b))},E=l.value;E._styleExpression&&b(E._styleExpression.expression)}return m}getProgramConfiguration(r){return new eo(this,r)}}var Sx={paint:new Te({"background-color":new Z(de.paint_background["background-color"]),"background-pattern":new be(de.paint_background["background-pattern"]),"background-opacity":new Z(de.paint_background["background-opacity"])})},gd={paint:new Te({"raster-opacity":new Z(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new Z(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Z(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Z(de.paint_raster["raster-brightness-max"]),"raster-saturation":new Z(de.paint_raster["raster-saturation"]),"raster-contrast":new Z(de.paint_raster["raster-contrast"]),"raster-resampling":new Z(de.paint_raster["raster-resampling"]),"raster-fade-duration":new Z(de.paint_raster["raster-fade-duration"])})};class _d extends gr{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var ff={paint:new Te({"sky-type":new Z(de.paint_sky["sky-type"]),"sky-atmosphere-sun":new Z(de.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Z(de.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Z(de.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Z(de.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(de.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Z(de.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Z(de.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Z(de.paint_sky["sky-opacity"])})};function nh(o,r,s){const l=kc(0,0,1),h=Nu(Tp());return function(m,_,b){b*=.5;var E=_[0],C=_[1],I=_[2],M=_[3],k=Math.sin(b),B=Math.cos(b);m[0]=E*B-I*k,m[1]=C*B+M*k,m[2]=I*B+E*k,m[3]=M*B-C*k}(h,h,s?-vn(o)+Math.PI:vn(o)),Xh(h,h,-vn(r)),C_(l,l,h),Em(l,l)}const mf={circle:class extends gr{constructor(o){super(o,cs)}createBucket(o){return new Pc(o)}queryRadius(o){const r=o;return ls("circle-radius",this,r)+ls("circle-stroke-width",this,r)+Wh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,s,l,h,m,_,b){const E=bm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return Dm(o,l,m,_,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,C)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new eo(this,o)}},heatmap:class extends gr{createBucket(o){return new Ip(o)}constructor(o){super(o,A_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ap({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return ls("heatmap-radius",this,o)}queryIntersectsFeature(o,r,s,l,h,m,_,b){const E=this.paint.get("heatmap-radius").evaluate(r,s);return Dm(o,l,m,_,b,!0,!0,new ze(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new eo(this,o)}},hillshade:class extends gr{constructor(o){super(o,P_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(o){return new eo(this,o)}},fill:class extends gr{constructor(o){super(o,_r)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new eo(this,o)}recalculate(o,r){super.recalculate(o,r);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new zc(o)}queryRadius(){return Wh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,s,l,h,m){return!o.queryGeometry.isAboveHorizon&&_m(xm(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends gr{constructor(o){super(o,Vp)}createBucket(o){return new kr(o)}queryRadius(){return Wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new eo(this,o)}queryIntersectsFeature(o,r,s,l,h,m,_,b,E){const C=bm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(r,s),M=this.paint.get("fill-extrusion-base").evaluate(r,s),k=[0,0],B=b&&m.elevation,N=m.elevation?m.elevation.exaggeration():1;if(B){const te=o.tile.getBucket(this).centroidVertexArray,oe=E+1;if(oe<te.length){const ue=te.get(oe);k[0]=ue.a_centroid_pos0,k[1]=ue.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;const $=(te=l,oe=M,ue=I,pe=C,he=_,(ge=B?b:null)?function(Ne,Ae,Be,$e,ke,Ke,Je,ut,un){const pt=[],rn=[],Qe=[0,0,0,1];for(const mn of Ne){const Yt=[],$n=[];for(const Ln of mn){const lr=Ln.x+$e.x,cr=Ln.y+$e.y,hn=G_(lr,cr,Ae,Be,Ke,Je,ut,un);Qe[0]=lr,Qe[1]=cr,Qe[2]=hn.base,Qe[3]=1,Bu(Qe,Qe,ke),Qe[3]=Math.max(Qe[3],1e-5);const en=jp([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);Qe[0]=lr,Qe[1]=cr,Qe[2]=hn.top,Qe[3]=1,Bu(Qe,Qe,ke),Qe[3]=Math.max(Qe[3],1e-5);const Mn=jp([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);Yt.push(en),$n.push(Mn)}pt.push(Yt),rn.push($n)}return[pt,rn]}(te,oe,ue,pe,he,ge,k,N,m.center.lat):function(Ne,Ae,Be,$e,ke){const Ke=[],Je=[],ut=ke[8]*Ae,un=ke[9]*Ae,pt=ke[10]*Ae,rn=ke[11]*Ae,Qe=ke[8]*Be,mn=ke[9]*Be,Yt=ke[10]*Be,$n=ke[11]*Be;for(const Ln of Ne){const lr=[],cr=[];for(const hn of Ln){const en=hn.x+$e.x,Mn=hn.y+$e.y,Rr=ke[0]*en+ke[4]*Mn+ke[12],Gn=ke[1]*en+ke[5]*Mn+ke[13],yr=ke[2]*en+ke[6]*Mn+ke[14],Fr=ke[3]*en+ke[7]*Mn+ke[15],On=Rr+ut,vr=Gn+un,yn=yr+pt,ir=Math.max(Fr+rn,1e-5),or=Rr+Qe,An=Gn+mn,qn=yr+Yt,ur=Math.max(Fr+$n,1e-5),wn=new ze(On/ir,vr/ir);wn.z=yn/ir,lr.push(wn);const Xr=new ze(or/ur,An/ur);Xr.z=qn/ur,cr.push(Xr)}Ke.push(lr),Je.push(cr)}return[Ke,Je]}(te,oe,ue,pe,he)),K=o.queryGeometry;var te,oe,ue,pe,he,ge;return function(te,oe,ue){let pe=1/0;_m(ue,oe)&&(pe=Fm(ue,oe[0]));for(let he=0;he<oe.length;he++){const ge=oe[he],Me=te[he];for(let we=0;we<ge.length-1;we++){const Xe=ge[we],Ne=[Xe,ge[we+1],Me[we+1],Me[we],Xe];gm(ue,Ne)&&(pe=Math.min(pe,Fm(ue,Ne)))}}return pe!==1/0&&pe}($[0],$[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends gr{constructor(o){super(o,od),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof oi,this.gradientVersion=(this.gradientVersion+1)%Ni}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=zm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new id(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new eo(this,o)}queryRadius(o){const r=o,s=Bm(ls("line-width",this,r),ls("line-gap-width",this,r)),l=ls("line-offset",this,r);return s/2+Math.abs(l)+Wh(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,s,l,h,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=xm(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*Bm(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),E=this.paint.get("line-offset").evaluate(r,s);return E&&(l=function(C,I){const M=[],k=new ze(0,0);for(let B=0;B<C.length;B++){const N=C[B],$=[];for(let K=0;K<N.length;K++){const te=N[K-1],oe=N[K],ue=N[K+1],pe=0===K?k:oe.sub(te)._unit()._perp(),he=K===N.length-1?k:ue.sub(oe)._unit()._perp(),ge=pe._add(he)._unit();ge._mult(1/(ge.x*he.x+ge.y*he.y)),$.push(ge._mult(I)._add(oe))}M.push($)}return M}(l,E*o.pixelToTileUnitsFactor)),function(C,I,M){for(let k=0;k<I.length;k++){const B=I[k];if(C.length>=3)for(let N=0;N<B.length;N++)if(Ml(C,B[N]))return!0;if(ym(C,B,M))return!0}return!1}(_,l,b)}isTileClipped(){return!0}},symbol:th,background:class extends gr{constructor(o){super(o,Sx)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends gr{constructor(o){super(o,gd)}getProgramIds(){return["raster"]}},sky:class extends gr{constructor(o){super(o,ff),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ap({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(o,r){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),h=!l,m=o.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&Pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?nh(_.azimuthal,90-_.polar,r):nh(l[0],90-l[1],r)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return nh(l[0],90-l[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}},{HTMLImageElement:py,HTMLCanvasElement:ig,HTMLVideoElement:og,ImageData:sg,ImageBitmap:yd}=at;class rh{constructor(r,s,l,h){this.context=r,this.format=l,this.texture=r.gl.createTexture(),this.update(s,h)}update(r,s,l){const{width:h,height:m}=r,{context:_}=this,{gl:b}=_;if(b.bindTexture(b.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===m){const{x:E,y:C}=l||{x:0,y:0};r instanceof py||r instanceof ig||r instanceof og||r instanceof sg||yd&&r instanceof yd?b.texSubImage2D(b.TEXTURE_2D,0,E,C,b.RGBA,b.UNSIGNED_BYTE,r):b.texSubImage2D(b.TEXTURE_2D,0,E,C,h,m,b.RGBA,b.UNSIGNED_BYTE,r.data)}else this.size=[h,m],r instanceof py||r instanceof ig||r instanceof og||r instanceof sg||yd&&r instanceof yd?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,r):b.texImage2D(b.TEXTURE_2D,0,this.format,h,m,0,this.format,b.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(r,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class ag{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Ba({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const l=this.getKey(r,s);return this.positions[l]}trim(){const r=this.width,s=this.height=Xl(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,l){const h=[];let m=r.length%2==1?-r[r.length-1]*l:0,_=r[0]*l,b=!0;h.push({left:m,right:_,isDash:b,zeroLength:0===r[0]});let E=r[0];for(let C=1;C<r.length;C++){b=!b;const I=r[C];m=E*l,E+=I,_=E*l,h.push({left:m,right:_,isDash:b,zeroLength:0===I})}return h}addRoundDash(r,s,l){const h=s/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let b=0,E=r[b];for(let C=0;C<this.width;C++){C/E.right>1&&(E=r[++b]);const I=Math.abs(C-E.left),M=Math.abs(C-E.right),k=Math.min(I,M);let B;const N=m/l*(h+1);if(E.isDash){const $=h-Math.abs(N);B=Math.sqrt(k*k+$*$)}else B=h-Math.sqrt(k*k+N*N);this.image.data[_+C]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(r,s){for(let E=r.length-1;E>=0;--E){const C=r[E],I=r[E+1];C.zeroLength?r.splice(E,1):I&&I.isDash===C.isDash&&(I.left=C.left,r.splice(E,1))}const l=r[0],h=r[r.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,b=r[_];for(let E=0;E<this.width;E++){E/b.right>1&&(b=r[++_]);const C=Math.abs(E-b.left),I=Math.abs(E-b.right),M=Math.min(C,I);this.image.data[m+E]=Math.max(0,Math.min(255,(b.isDash?M:-M)+s+128))}}addDash(r,s){const l=this.getKey(r,s);if(this.positions[l])return this.positions[l];const h="round"===s,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Pn("LineAtlas out of space"),null;0===r.length&&r.push(1);let b=0;for(let I=0;I<r.length;I++)r[I]<0&&(Pn("Negative value is found in line dasharray, replacing values with 0"),r[I]=0),b+=r[I];if(0!==b){const I=this.width/b,M=this.getDashRanges(r,this.width,I);h?this.addRoundDash(M,I,m):this.addRegularDash(M,"square"===s?.5*I:0)}const E=this.nextRow+m;this.nextRow+=_;const C={tl:[E,m],br:[b,0]};return this.positions[l]=C,C}}tt("LineAtlas",ag);class fy{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Ix=at.performance;function gf(o){const r=o?o.url.toString():void 0;return Ix.getEntriesByName(r)}class lg{constructor(){this.tasks={},this.taskQueue=[],xn(["process"],this),this.invoker=new fy(this.process),this.nextId=0}add(r,s){const l=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-b:"maybePrepare"===m&&_?400-b:500:200-b:100-b}(s);if(0===h){En();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:r,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){En();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<s&&(s=m.priority,r=h)}if(null===r)return null;const l=this.taskQueue[r];return this.taskQueue.splice(r,1),l}remove(){this.invoker.remove()}}function vd(o,r){const s=Math.pow(2,-o.z),l=o.x*s,h=(o.x+1)*s,m=o.y*s,_=(o.y+1)*s;if("mercator"===r.name)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const b=Mc(l),E=Mc(h),C=Po(m),I=Po(_),M=r.project(b,C),k=r.project(E,C),B=r.project(E,I),N=r.project(b,I);let $=Math.min(M.x,k.x,B.x,N.x),K=Math.min(M.y,k.y,B.y,N.y),te=Math.max(M.x,k.x,B.x,N.x),oe=Math.max(M.y,k.y,B.y,N.y);const ue=s/16;function pe(ge,Me,we,Xe,Ne,Ae){const Be=(we+Ne)/2,$e=(Xe+Ae)/2,ke=r.project(Mc(Be),Po($e)),Ke=Math.max(0,$-ke.x,K-ke.y,ke.x-te,ke.y-oe);$=Math.min($,ke.x),te=Math.max(te,ke.x),K=Math.min(K,ke.y),oe=Math.max(oe,ke.y),Ke>ue&&(pe(ge,ke,we,Xe,Be,$e),pe(ke,Me,Be,$e,Ne,Ae))}pe(M,k,l,m,h,m),pe(k,B,h,m,h,_),pe(B,N,h,_,l,_),pe(N,M,l,_,l,m),$-=ue,K-=ue,te+=ue,oe+=ue;const he=1/Math.max(te-$,oe-K);return{scale:he,x:$*he,y:K*he,x2:te*he,y2:oe*he,projection:r}}function xd(o,r,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[o*l-2*Math.PI*6378137/2,r*l-2*Math.PI*6378137/2]}class cg{constructor(r,s,l){this.z=r,this.x=s,this.y=l,this.key=bd(0,r,r,s,l)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s){const l=(m=this.y,_=this.z,b=xd(256*(h=this.x),256*(m=Math.pow(2,_)-m-1),_),E=xd(256*(h+1),256*(m+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]);var h,m,_,b,E;const C=function(I,M,k){let B,N="";for(let $=I;$>0;$--)B=1<<$-1,N+=(M&B?1:0)+(k&B?2:0);return N}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",C).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class my{constructor(r,s){this.wrap=r,this.canonical=s,this.key=bd(r,s.z,s.z,s.x,s.y)}}class Oi{constructor(r,s,l,h,m){this.overscaledZ=r,this.wrap=s,this.canonical=new cg(l,+h,+m),this.key=0===s&&r===l?this.canonical.key:bd(s,r,l,h,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new Oi(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return bd(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-r;return bd(this.wrap*+s,r,r,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Oi(s,this.wrap,s,l,h),new Oi(s,this.wrap,s,l+1,h),new Oi(s,this.wrap,s,l,h+1),new Oi(s,this.wrap,s,l+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Oi(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new my(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bd(o,r,s,l,h){const m=1<<Math.min(s,22);let _=m*(h%m)+l%m;return o&&s<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*_+s)+(r-s)}tt("CanonicalTileID",cg),tt("OverscaledTileID",Oi,{omit:["projMatrix"]});class gy{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const l=r[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class _y{constructor(r,s,l,h,m){this.type="Feature",this._vectorTileFeature=r,r._z=s,r._x=l,r._y=h,this.properties=r.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(r[s]=this[s]);return r}}var Mx=ye([{name:"a_pos",type:"Int16",components:2}]);const Nl=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,s=0,l=0,h=0,m=0,_=0,b=0;for(1&r?h=m=_=32:s=l=b=32;(r>>=1)>1;){const C=s+h>>1,I=l+m>>1;1&r?(h=s,m=l,s=_,l=b):(s=h,l=m,h=_,m=b),_=C,b=I}const E=4*o;Nl[E+0]=s,Nl[E+1]=l,Nl[E+2]=h,Nl[E+3]=m}const Wr=new Uint16Array(2178),ds=new Uint8Array(1089),wd=new Uint16Array(1089);function _f(o){return 0===o?-.03125:32===o?.03125:0}var ih=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const yf={type:2,extent:Ut,loadGeometry:()=>[[new ze(0,0),new ze(8193,0),new ze(8193,8193),new ze(0,8193),new ze(0,0)]]};class Ed{constructor(r,s,l,h,m){this.tileID=r,this.uid=bo(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<Si.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=vd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,l){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const b of h){const E=b.layerIds.map(C=>m.getLayer(C)).filter(Boolean);if(0!==E.length){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(C=>E.filter(I=>I.id===C)[0]));for(const C of E)_[C.id]=b}}return _}(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof hs){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof hs&&m.hasRTLText){this.hasRTLText=!0,F.isLoading()||F.isLoaded()||"deferred"!==A()||R();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Dr}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(r)}const s=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rh(r,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rh(r,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new rh(r,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,s,l,h,m,_,b,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:b,transform:_,params:m,tileTransform:this.tileTransform},r,s,l):{}}querySourceFeatures(r,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=s?s.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const b=dc(s&&s.filter),{z:E,x:C,y:I}=this.tileID.canonical,M={z:E,x:C,y:I};for(let k=0;k<_.length;k++){const B=_.feature(k);if(b.needGeometry){const K=ko(B,!0);if(!b.filter(new L(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new L(this.tileID.overscaledZ),B))continue;const N=l.getId(B,m),$=new _y(B,E,C,I,N);$.tile=M,r.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const l=an(r.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const _=this.buckets[m],b=_.layers[0].sourceLayer||"_geojsonTileLayer",E=l[b],C=r[b];if(!E||!C||0===Object.keys(C).length)continue;if(_.update(C,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof id||_ instanceof zc){const M=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&M&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(M.id,this.tileID)}const I=s&&s.style&&s.style.getLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Si.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Si.now()+r}setDependencies(r,s){const l={};for(const h of s)l[h]=!0;this.dependencies[r]=l}hasDependency(r,s){for(const l of r){const h=this.dependencies[l];if(h)for(const m of s)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=za(yf,this.tileID.canonical,this.tileTransform)[0],h=new nt,m=new Er;for(let _=0;_<l.length;_++){const{x:b,y:E}=l[_];h.emplaceBack(b,E),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,ih.members),this._tileDebugSegments=Jn.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=za(yf,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(b,E){const C=vd(b,E),I=Math.pow(2,b.z);for(let K=0;K<33;K++)for(let te=0;te<33;te++){const oe=Mc((b.x+(te+_f(te))/32)/I),ue=Po((b.y+(K+_f(K))/32)/I),pe=E.project(oe,ue),he=33*K+te;Wr[2*he+0]=Math.round((pe.x*C.scale-C.x)*Ut),Wr[2*he+1]=Math.round((pe.y*C.scale-C.y)*Ut)}ds.fill(0),wd.fill(0);for(let K=2045;K>=0;K--){const te=4*K,oe=Nl[te+0],ue=Nl[te+1],pe=Nl[te+2],he=Nl[te+3],ge=oe+pe>>1,Me=ue+he>>1,we=ge+Me-ue,Xe=Me+oe-ge,Ne=33*ue+oe,Ae=33*he+pe,Be=33*Me+ge,$e=Math.hypot((Wr[2*Ne+0]+Wr[2*Ae+0])/2-Wr[2*Be+0],(Wr[2*Ne+1]+Wr[2*Ae+1])/2-Wr[2*Be+1])>=16;if(ds[Be]=ds[Be]||($e?1:0),K<1022){const ke=33*(ue+Xe>>1)+(oe+we>>1),Ke=33*(he+Xe>>1)+(pe+we>>1);ds[Be]=ds[Be]||ds[ke]||ds[Ke]}}const M=new ct,k=new kn;let B=0;function N(K,te){const oe=33*te+K;return 0===wd[oe]&&(M.emplaceBack(Wr[2*oe+0],Wr[2*oe+1],K*Ut/32,te*Ut/32),wd[oe]=++B),wd[oe]-1}function $(K,te,oe,ue,pe,he){const ge=K+oe>>1,Me=te+ue>>1;if(Math.abs(K-pe)+Math.abs(te-he)>1&&ds[33*Me+ge])$(pe,he,K,te,ge,Me),$(oe,ue,pe,he,ge,Me);else{const we=N(K,te),Xe=N(oe,ue),Ne=N(pe,he);k.emplaceBack(we,Xe,Ne)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:M,indices:k}}(this.tileID.canonical,s);h=_.vertices,m=_.indices}else{h=new ct,m=new kn;for(const{x:b,y:E}of l)h.emplaceBack(b,E,0,0);const _=Jh(h.int16,void 0,4);for(let b=0;b<_.length;b+=3)m.emplaceBack(_[b],_[b+1],_[b+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,ih.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=Jn.simpleSegment(0,0,h.length,m.length)}}class yy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,l){const h=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},zn(this.stateChanges[r][h],l),null===this.deletedStates[r]){this.deletedStates[r]={};for(const m in this.state[r])m!==h&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const m in this.state[r][h])l[m]||(this.deletedStates[r][h][m]=null)}else for(const m in l)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][m]&&delete this.deletedStates[r][h][m]}removeFeatureState(r,s,l){if(null===this.deletedStates[r])return;const h=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},l&&void 0!==s)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][l]=null);else if(void 0!==s)if(this.stateChanges[r]&&this.stateChanges[r][h])for(l in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][l]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,s){const l=String(s),h=zn({},(this.state[r]||{})[l],(this.stateChanges[r]||{})[l]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const m=this.deletedStates[r][s];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(r,s){r.setFeatureState(this.state,s)}coalesceChanges(r,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),zn(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const b of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][b];m[_]=this.state[h][_]}l[h]=l[h]||{},zn(l[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in r)r[h].setFeatureState(l,s)}}class Hs{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const l=this.toIdx(r,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function vf(o,r,s,l){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<o[_]||s[_]>r[_])return null}else{const b=1/l[_];let E=(o[_]-s[_])*b,C=(r[_]-s[_])*b;if(E>C){const I=E;E=C,C=I}if(E>h&&(h=E),C<m&&(m=C),h>m)return null}return h}function ug(o,r,s,l,h,m,_,b,E,C,I){const M=l-o,k=h-r,B=m-s,N=_-o,$=b-r,K=E-s,te=I[1]*K-I[2]*$,oe=I[2]*N-I[0]*K,ue=I[0]*$-I[1]*N,pe=M*te+k*oe+B*ue;if(Math.abs(pe)<1e-15)return null;const he=1/pe,ge=C[0]-o,Me=C[1]-r,we=C[2]-s,Xe=(ge*te+Me*oe+we*ue)*he;if(Xe<0||Xe>1)return null;const Ne=Me*B-we*k,Ae=we*M-ge*B,Be=ge*k-Me*M,$e=(I[0]*Ne+I[1]*Ae+I[2]*Be)*he;return $e<0||Xe+$e>1?null:(N*Ne+$*Ae+K*Be)*he}function Dd(o,r,s){return(o-r)/(s-r)}function hg(o,r,s,l,h,m,_,b,E){const C=1<<s,I=m-l,M=_-h,k=(o+1)/C*I+l,B=(r+0)/C*M+h,N=(r+1)/C*M+h;b[0]=(o+0)/C*I+l,b[1]=B,E[0]=k,E[1]=N}class xf{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(m){const _=Math.ceil(Math.log2(m.dim/8)),b=[];let E=Math.ceil(Math.pow(2,_));const C=1/E,I=(B,N,$,K,te)=>{const oe=K?1:0,ue=(B+1)*$-oe,pe=N*$,he=(N+1)*$-oe;te[0]=B*$,te[1]=pe,te[2]=ue,te[3]=he};let M=new Hs(E);const k=[];for(let B=0;B<E*E;B++){I(B%E,Math.floor(B/E),C,!1,k);const N=Va(k[0],k[1],m),$=Va(k[2],k[1],m),K=Va(k[2],k[3],m),te=Va(k[0],k[3],m);M.minimums.push(Math.min(N,$,K,te)),M.maximums.push(Math.max(N,$,K,te)),M.leaves.push(1)}for(b.push(M),E/=2;E>=1;E/=2){const B=b[b.length-1];M=new Hs(E);for(let N=0;N<E*E;N++){I(N%E,Math.floor(N/E),2,!0,k);const $=B.getElevation(k[0],k[1]),K=B.getElevation(k[2],k[1]),te=B.getElevation(k[2],k[3]),oe=B.getElevation(k[0],k[3]),ue=B.isLeaf(k[0],k[1]),pe=B.isLeaf(k[2],k[1]),he=B.isLeaf(k[2],k[3]),ge=B.isLeaf(k[0],k[3]),Me=Math.min($.min,K.min,te.min,oe.min),we=Math.max($.max,K.max,te.max,oe.max),Xe=ue&&pe&&he&&ge;M.maximums.push(we),M.minimums.push(Me),M.leaves.push(we-Me<=5&&Xe?1:0)}b.push(M)}return b}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(r,s,l,h,m,_,b=1){return vf([r,s,-100],[l,h,this.maximums[0]*b],m,_)}raycast(r,s,l,h,m,_,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,s,l,h,m,_,b);if(null==E)return null;const C=[],I=[],M=[],k=[],B=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:N,t:$,nodex:K,nodey:te,depth:oe}=B.pop();if(this.leaves[N]){hg(K,te,oe,r,s,l,h,M,k);const pe=1<<oe,he=(K+0)/pe,ge=(K+1)/pe,Me=(te+0)/pe,we=(te+1)/pe,Xe=Va(he,Me,this.dem)*b,Ne=Va(ge,Me,this.dem)*b,Ae=Va(ge,we,this.dem)*b,Be=Va(he,we,this.dem)*b,$e=ug(M[0],M[1],Xe,k[0],M[1],Ne,k[0],k[1],Ae,m,_),ke=ug(k[0],k[1],Ae,M[0],k[1],Be,M[0],M[1],Xe,m,_),Ke=Math.min(null!==$e?$e:Number.MAX_VALUE,null!==ke?ke:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Je=Rc([],m,_,$);if(dg(Xe,Ne,Be,Ae,Dd(Je[0],M[0],k[0]),Dd(Je[1],M[1],k[1]))>=Je[2])return $}continue}let ue=0;for(let pe=0;pe<this._siblingOffset.length;pe++){hg((K<<1)+this._siblingOffset[pe][0],(te<<1)+this._siblingOffset[pe][1],oe+1,r,s,l,h,M,k),M[2]=-100,k[2]=this.maximums[this.childOffsets[N]+pe]*b;const he=vf(M,k,m,_);if(null!=he){const ge=he;C[pe]=ge;let Me=!1;for(let we=0;we<ue&&!Me;we++)ge>=C[I[we]]&&(I.splice(we,0,pe),Me=!0);Me||(I[ue]=pe),ue++}}for(let pe=0;pe<ue;pe++){const he=I[pe];B.push({idx:this.childOffsets[N]+he,t:C[he],nodex:(K<<1)+this._siblingOffset[he][0],nodey:(te<<1)+this._siblingOffset[he][1],depth:oe+1})}}return null}_addNode(r,s,l){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,l,h,m){if(1===r[h].isLeaf(s,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,b=r[_];let E,C=0;for(let I=0;I<this._siblingOffset.length;I++){const M=2*s+this._siblingOffset[I][0],k=2*l+this._siblingOffset[I][1],B=b.getElevation(M,k),N=b.isLeaf(M,k),$=this._addNode(B.min,B.max,N);N&&(C|=1<<I),E||(E=$)}for(let I=0;I<this._siblingOffset.length;I++)C&1<<I||this._construct(r,2*s+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],_,E+I)}}function dg(o,r,s,l,h,m){return Jt(Jt(o,s,m),Jt(r,l,m),h)}function Va(o,r,s){const l=s.dim,h=Kt(o*l-.5,0,l-1),m=Kt(r*l-.5,0,l-1),_=Math.floor(h),b=Math.floor(m),E=Math.min(_+1,l-1),C=Math.min(b+1,l-1);return dg(s.get(_,b),s.get(E,b),s.get(_,C),s.get(E,C),h-_,m-b)}const Yc={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Zs{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,l,h=!1,m=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Pn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let b=0;b<_;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(_,b)]=this.data[this._idx(_-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,_)]=this.data[this._idx(b,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new xf(this)}get(r,s,l=!1){const h=new Uint8Array(this.data.buffer);l&&(r=Kt(r,-1,this.dim),s=Kt(s,-1,this.dim));const m=4*this._idx(r,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[m],h[m+1],h[m+2])}static getUnpackVector(r){return Yc[r]}get unpackVector(){return Yc[this.encoding]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}_unpackMapbox(r,s,l){return(256*r*256+256*s+l)/10-1e4}_unpackTerrarium(r,s,l){return 256*r+s+l/256-32768}static pack(r,s){const l=[0,0,0,0],h=Zs.getUnpackVector(s);let m=Math.floor((r+h[3])/h[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new to({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,s,l){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,m=s*this.dim+this.dim,_=l*this.dim,b=l*this.dim+this.dim;switch(s){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:_=b-1;break;case 1:b=_+1}const E=-s*this.dim,C=-l*this.dim;for(let I=_;I<b;I++)for(let M=h;M<m;M++)this.data[this._idx(M,I)]=r.data[this._idx(M+E,I+C)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}tt("DEMData",Zs),tt("DemMinMaxQuadTree",xf,{omit:["dem"]});class bf{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,l){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:s,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(r,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const l=r.wrapped().key,h=void 0===s?0:this.data[l].indexOf(s),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const l in this.data)for(const h of this.data[l])r(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class No{constructor(r,s,l){this.func=r,this.mask=s,this.range=l}}No.ReadOnly=!1,No.ReadWrite=!0,No.disabled=new No(519,No.ReadOnly,[0,1]);class ja{constructor(r,s,l,h,m,_){this.test=r,this.ref=s,this.mask=l,this.fail=h,this.depthFail=m,this.pass=_}}ja.disabled=new ja({func:519,mask:0},0,0,7680,7680,7680);class ps{constructor(r,s,l){this.blendFunction=r,this.blendColor=s,this.mask=l}}ps.Replace=[1,0],ps.disabled=new ps(ps.Replace,yt.transparent,[!1,!1,!1,!1]),ps.unblended=new ps(ps.Replace,yt.transparent,[!0,!0,!0,!0]),ps.alphaBlended=new ps([1,771],yt.transparent,[!0,!0,!0,!0]);class no{constructor(r,s,l){this.enable=r,this.mode=s,this.frontFace=l}}no.disabled=new no(!1,1029,2305),no.backCCW=new no(!0,1029,2305),no.backCW=new no(!0,1029,2304),no.frontCW=new no(!0,1028,2304),no.frontCCW=new no(!0,1028,2305);class Ws extends Ze{constructor(r,s,l){super(),this.id=r,this._onlySymbols=l,s.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new bf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yy}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const s=this._tiles[r];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(r),l.prepare(this.map.style.imageManager)}}getIds(){return bs(this._tiles).map(r=>r.tileID).sort(wf).map(r=>r.key)}getRenderableIds(r){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,r)&&s.push(this._tiles[l]);return r?s.sort((l,h)=>{const m=l.tileID,_=h.tileID,b=new ze(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new ze(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||E.y-b.y||E.x-b.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(wf).map(l=>l.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const l=this._tiles[r];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,r,s)))}_tileLoaded(r,s,l,h){if(h)return r.state="errored",void(404!==h.status?this._source.fire(new ot(h,{tile:r})):this.update(this.transform));r.timeAdded=Si.now(),"expired"===l&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),"raster-dem"===this.getSource().type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Le("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const m=s[h];if(r.neighboringTiles&&r.neighboringTiles[m]){const _=this.getTileByID(m);l(r,_),l(_,r)}}function l(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const b=m.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),C=m.tileID.key;0===_&&0===b||Math.abs(b)>1||(Math.abs(_)>1&&(1===Math.abs(_+E)?_+=E:1===Math.abs(_-E)&&(_-=E)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,b),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,l,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let b=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(b=C)}let E=b;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){h[b.key]=b;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const l=this._loadedParentTiles[r.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=r.overscaledZ-1;l>=s;l--){const h=r.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const l=Math.ceil(r.width/s)+1,h=Math.ceil(r.height/s)+1,m=Math.floor(l*h*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(r){const s=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,s){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,s,l){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(r,s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Oi(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(h=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(b=>this._source.hasTile(b)))):h=[];const m=this._updateRetainedTiles(h);if(oh(this._source.type)&&0!==h.length){const b={},E={},C=Object.keys(m);for(const M of C){const k=m[M],B=this._tiles[M];if(!B||B.fadeEndTime&&B.fadeEndTime<=Si.now())continue;const N=this.findLoadedParent(k,Math.max(k.overscaledZ-Ws.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),b[N.tileID.key]=N.tileID),E[M]=k}const I=h[h.length-1].overscaledZ;for(const M in this._tiles){const k=this._tiles[M];if(m[M]||!k.hasData())continue;let B=k.tileID;for(;B.overscaledZ>I;){B=B.scaledTo(B.overscaledZ-1);const N=this._tiles[B.key];if(N&&N.hasData()&&E[B.key]){m[M]=k.tileID;break}}}for(const M in b)m[M]||(this._coveredTiles[M]=!0,m[M]=b[M])}for(const b in m)this._tiles[b].clearFadeHold();const _=function(b,E){const C=[];for(const I in b)I in E||C.push(I);return C}(this._tiles,m);for(const b of _){const E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(0===r.length)return s;const l={},h=r.reduce((C,I)=>Math.min(C,I.overscaledZ),1/0),m=r[0].overscaledZ,_=Math.max(m-Ws.maxOverzooming,this._source.minzoom),b=Math.max(m+Ws.maxUnderzooming,this._source.minzoom),E={};for(const C of r){const I=this._addTile(C);s[C.key]=C,I.hasData()||h<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,h,b,s);for(const C of r){let I=this._tiles[C.key];if(I.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const k=C.children(this._source.maxzoom)[0],B=this.getTile(k);if(B&&B.hasData()){s[k.key]=k;continue}}else{const k=C.children(this._source.maxzoom);if(s[k[0].key]&&s[k[1].key]&&s[k[2].key]&&s[k[3].key])continue}let M=I.wasRequested();for(let k=C.overscaledZ-1;k>=_;--k){const B=C.scaledTo(k);if(l[B.key]||(l[B.key]=!0,I=this.getTile(B),!I&&M&&(I=this._addTile(B)),I&&(s[B.key]=B,M=I.wasRequested(),I.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let l,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of s)this._loadedParentTiles[m]=l}}_addTile(r){let s=this._tiles[r.key];if(s)return s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const l=Boolean(s);if(!l){const h=this.map?this.map.painter:null;s=new Ed(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s?(s.uses++,this._tiles[r.key]=s,l||this._source.fire(new Le("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const l=s.getExpiryTimeout();l&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},l))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(r,s,l){const h=[],m=this.transform;if(!m)return h;for(const _ in this._tiles){const b=this._tiles[_];if(l&&b.clearQueryDebugViz(),b.holdingForFade())continue;const E=r.containsTile(b,m,s);E&&h.push(E)}return h}getVisibleCoordinates(r){const s=this.getRenderableIds(r).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(oh(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=Si.now())return!0}return!1}setFeatureState(r,s,l){this._state.updateState(r=r||"_geojsonTileLayer",s,l)}removeFeatureState(r,s,l){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,l)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,l){const h=this._tiles[r];h&&h.setDependencies(s,l)}reloadTilesForDependencies(r,s){for(const l in this._tiles)this._tiles[l].hasDependency(r,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(r,s))}}function wf(o,r){const s=Math.abs(2*o.wrap)-+(o.wrap<0),l=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||l-s||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function oh(o){return"raster"===o||"image"===o||"video"===o}Ws.maxOverzooming=10,Ws.maxUnderzooming=3;class Sd{constructor(r,s,l){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(r,s,l){const h=l||r.findDEMTileFor(s);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,b=1<<s.canonical.z-_.canonical.z;return new Sd(h,h.tileSize/Ut/b,[(s.canonical.x/b-_.canonical.x)*m.dim,(s.canonical.y/b-_.canonical.y)*m.dim])}tileCoordToPixel(r,s){const l=s*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(l);return new ze(h,m)}getElevationAt(r,s,l,h){const m=r*this._scale+this._offset[0],_=s*this._scale+this._offset[1],b=Math.floor(m),E=Math.floor(_),C=this._dem;return h=!!h,l?Jt(Jt(C.get(b,E,h),C.get(b,E+1,h),_-E),Jt(C.get(b+1,E,h),C.get(b+1,E+1,h),_-E),m-b):C.get(b,E,h)}getElevationAtPixel(r,s,l){return this._dem.get(r,s,!!l)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*La(1,r)*this._dem.stride}}class Ef{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Sa(Ut,16,0),this.featureIndexArray=new um,this.promoteId=s}insert(r,s,l,h,m,_=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m,_);const E=this.grid;for(let C=0;C<s.length;C++){const I=s[C],M=[1/0,1/0,-1/0,-1/0];for(let k=0;k<I.length;k++){const B=I[k];M[0]=Math.min(M[0],B.x),M[1]=Math.min(M[1],B.y),M[2]=Math.max(M[2],B.x),M[3]=Math.max(M[3],B.y)}M[0]<Ut&&M[1]<Ut&&M[2]>=0&&M[3]>=0&&E.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ro.VectorTile(new ad(this.rawTileData)).layers,this.sourceLayerCoder=new gy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s,l,h){this.loadVTLayers();const m=r.params||{},_=dc(m.filter),b=r.tileResult,E=r.transform,C=b.bufferedTilespaceBounds,I=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(N,$,K,te)=>D_(b.bufferedTilespaceGeometry,N,$,K,te));I.sort(pg);let M=null;E.elevation&&I.length>0&&(M=Sd.create(E.elevation,this.tileID));const k={};let B;for(let N=0;N<I.length;N++){const $=I[N];if($===B)continue;B=$;const K=this.featureIndexArray.get($);let te=null;this.loadMatchingFeature(k,K,_,m.layers,m.availableImages,s,l,h,(oe,ue,pe,he=0)=>(te||(te=za(oe,this.tileID.canonical,r.tileTransform)),ue.queryIntersectsFeature(b,oe,pe,te,this.z,r.transform,r.pixelPosMatrix,M,he)))}return k}loadMatchingFeature(r,s,l,h,m,_,b,E,C){const{featureIndex:I,bucketIndex:M,sourceLayerIndex:k,layoutVertexArrayOffset:B}=s,N=this.bucketLayerIDs[M];if(h&&!function(oe,ue){for(let pe=0;pe<oe.length;pe++)if(ue.indexOf(oe[pe])>=0)return!0;return!1}(h,N))return;const $=this.sourceLayerCoder.decode(k),K=this.vtLayers[$].feature(I);if(l.needGeometry){const oe=ko(K,!0);if(!l.filter(new L(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!l.filter(new L(this.tileID.overscaledZ),K))return;const te=this.getId(K,$);for(let oe=0;oe<N.length;oe++){const ue=N[oe];if(h&&h.indexOf(ue)<0)continue;const pe=_[ue];if(!pe)continue;let he={};void 0!==te&&E&&(he=E.getState(pe.sourceLayer||"_geojsonTileLayer",te));const ge=zn({},b[ue]);ge.paint=vy(ge.paint,pe.paint,K,he,m),ge.layout=vy(ge.layout,pe.layout,K,he,m);const Me=!C||C(K,pe,he,B);if(!Me)continue;const we=new _y(K,this.z,this.x,this.y,te);we.layer=ge;let Xe=r[ue];void 0===Xe&&(Xe=r[ue]=[]),Xe.push({featureIndex:I,feature:we,intersectionZ:Me})}}lookupSymbolFeatures(r,s,l,h,m,_,b,E){const C={};this.loadVTLayers();const I=dc(m);for(const M of r)this.loadMatchingFeature(C,{bucketIndex:l,sourceLayerIndex:h,featureIndex:M,layoutVertexArrayOffset:0},I,_,b,E,s);return C}loadFeature(r){const{featureIndex:s,sourceLayerIndex:l}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),m=this.vtFeatures[h];if(m[s])return m[s];const _=this.vtLayers[h].feature(s);return m[s]=_,_}hasLayer(r){for(const s of this.bucketLayerIDs)for(const l of s)if(r===l)return!0;return!1}getId(r,s){let l=r.id;return this.promoteId&&(l=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function vy(o,r,s,l,h){return wo(o,(m,_)=>{const b=r instanceof re?r.get(_):null;return b&&b.evaluate?b.evaluate(s,l,h):b})}function pg(o,r){return r-o}tt("FeatureIndex",Ef,{omit:["rawTileData","sourceLayerCoder"]});class Df{constructor(r){const s={},l=[];for(const b in r){const E=r[b],C=s[b]={};for(const I in E.glyphs){const M=E.glyphs[+I];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const k=M.metrics.localGlyph?2:1,B={x:0,y:0,w:M.bitmap.width+2*k,h:M.bitmap.height+2*k};l.push(B),C[I]=B}}const{w:h,h:m}=Xp(l),_=new Ba({width:h||1,height:m||1});for(const b in r){const E=r[b];for(const C in E.glyphs){const I=E.glyphs[+C];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const M=s[b][C],k=I.metrics.localGlyph?2:1;Ba.copy(I.bitmap,_,{x:0,y:0},{x:M.x+k,y:M.y+k},I.bitmap)}}this.image=_,this.positions=s}}tt("GlyphAtlas",Df);class xy{constructor(r){this.tileID=new Oi(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,r.projection&&(this.tileTransform=vd(r.tileID.canonical,r.projection))}parse(r,s,l,h,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Dr;const _=new gy(Object.keys(r.layers).sort()),b=new Ef(this.tileID,this.promoteId);b.bucketLayerIDs=[];const E={},C=new ag(256,256),I={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:l},M=s.familiesBySource[this.source];for(const he in M){const ge=r.layers[he];if(!ge)continue;let Me=!1,we=!1;for(const Ae of M[he])"symbol"===Ae[0].type?Me=!0:we=!0;if(!0===this.isSymbolTile&&!Me||!1===this.isSymbolTile&&!we)continue;1===ge.version&&Pn(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xe=_.encode(he),Ne=[];for(let Ae=0;Ae<ge.length;Ae++){const Be=ge.feature(Ae),$e=b.getId(Be,he);Ne.push({feature:Be,id:$e,index:Ae,sourceLayerIndex:Xe})}for(const Ae of M[he]){const Be=Ae[0];void 0!==this.isSymbolTile&&"symbol"===Be.type!==this.isSymbolTile||Be.minzoom&&this.zoom<Math.floor(Be.minzoom)||Be.maxzoom&&this.zoom>=Be.maxzoom||"none"!==Be.visibility&&(Id(Ae,this.zoom,l),(E[Be.id]=Be.createBucket({index:b.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xe,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(Ne,I,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Ae.map($e=>$e.id)))}}let k,B,N,$;C.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},te=wo(I.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(te).length?h.send("getGlyphs",{uid:this.uid,stacks:te},(he,ge)=>{k||(k=he,B=ge,pe.call(this))},void 0,!1,K):B={};const oe=Object.keys(I.iconDependencies);oe.length?h.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(he,ge)=>{k||(k=he,N=ge,pe.call(this))},void 0,!1,K):N={};const ue=Object.keys(I.patternDependencies);function pe(){if(k)return m(k);if(B&&N&&$){const he=new Df(B),ge=new qm(N,$);for(const Me in E){const we=E[Me];we instanceof hs?(Id(we.layers,this.zoom,l),uy(we,B,he.positions,N,ge.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom)):we.hasPattern&&(we instanceof id||we instanceof zc||we instanceof kr)&&(Id(we.layers,this.zoom,l),we.addFeatures(I,this.tileID.canonical,ge.patternPositions,l))}this.status="done",m(null,{buckets:bs(E).filter(Me=>!Me.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:C,imageAtlas:ge,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?he.positions:null})}}ue.length?h.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(he,ge)=>{k||(k=he,$=ge,pe.call(this))},void 0,!1,K):$={},pe.call(this)}}function Id(o,r,s){const l=new L(r);for(const h of o)h.recalculate(l,s)}class fg{constructor(r){this.entries={},this.scheduler=r}request(r,s,l,h){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[_,b]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,b)},s):h(_,b),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=l((_,b)=>{m.result=[_,b];for(const E of m.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,b)},s):E(_,b);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function mg(o,r,s){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const m=U(o.request,(_,b,E,C)=>{_?h(_):b&&h(null,{vectorTile:s?void 0:new Ro.VectorTile(new ad(b)),rawData:b,cacheControl:E,expires:C})});return()=>{m.cancel(),h()}},r)}var ro={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Rl(this.parallels,this.constants.parallels))return;const o=Math.sin(vn(this.parallels[0])),r=(o+Math.sin(vn(this.parallels[1])))/2,s=1+o*(2*r-o),l=Math.sqrt(s)/r;this.constants={n:r,c:s,r0:l,parallels:this.parallels}},project(o,r){this.initializeConstants();const s=vn(o-this.center[0]),l=vn(r),{n:h,c:m,r0:_}=this.constants,b=Math.sqrt(m-2*h*Math.sin(l))/h;return{x:b*Math.sin(s*h),y:b*Math.cos(s*h)-_}},unproject(o,r){this.initializeConstants();const{n:s,c:l,r0:h}=this.constants,m=h+r;let _=Math.atan2(o,Math.abs(m))*Math.sign(m);m*s<0&&(_-=Math.PI*Math.sign(o)*Math.sign(m));const b=vn(this.center[0])*s;_=xo(_,-Math.PI-b,Math.PI-b);const E=ei(_/s)+this.center[0],C=Math.asin(Kt((l-(o*o+m*m)*s*s)/(2*s),-1,1)),I=Kt(ei(C),-85.051129,Oa);return new _n(E,I)}};const sh=1.340264,ah=-.081106,Md=893e-6,Ad=.003796,lh=Math.sqrt(3)/2;var Ax={name:"equalEarth",center:[0,0],range:[3.5,7],project(o,r){r=r/180*Math.PI,o=o/180*Math.PI;const s=Math.asin(lh*Math.sin(r)),l=s*s,h=l*l*l;return{x:.5*(o*Math.cos(s)/(lh*(sh+3*ah*l+h*(7*Md+9*Ad*l)))/Math.PI+.5),y:1-.5*(s*(sh+ah*l+h*(Md+Ad*l))/Math.PI+1)}},unproject(o,r){o=(2*o-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=s*s,h=l*l*l;for(let C,I,M,k=0;k<12&&(I=s*(sh+ah*l+h*(Md+Ad*l))-r,M=sh+3*ah*l+h*(7*Md+9*Ad*l),C=I/M,s=Kt(s-C,-Math.PI/3,Math.PI/3),l=s*s,h=l*l*l,!(Math.abs(C)<1e-12));++k);const m=lh*o*(sh+3*ah*l+h*(7*Md+9*Ad*l))/Math.cos(s),_=Math.asin(Math.sin(s)/lh),b=Kt(180*m/Math.PI,-180,180),E=Kt(180*_/Math.PI,-85.051129,Oa);return new _n(b,E)}},by={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(o,r)=>({x:.5+o/360,y:.5-r/360}),unproject(o,r){const s=360*(o-.5),l=Kt(360*(.5-r),-85.051129,Oa);return new _n(s,l)}};const $a=Math.PI/2;function ch(o){return Math.tan(($a+o)/2)}var wy={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Rl(this.parallels,this.constants.parallels))return;const o=vn(this.parallels[0]),r=vn(this.parallels[1]),s=Math.cos(o),l=o===r?Math.sin(o):Math.log(s/Math.cos(r))/Math.log(ch(r)/ch(o)),h=s*Math.pow(ch(o),l)/l;this.constants={n:l,f:h,parallels:this.parallels}},project(o,r){this.initializeConstants(),r=vn(r),o=vn(o-this.center[0]);const s=1e-6,{n:l,f:h}=this.constants;h>0?r<-$a+s&&(r=-$a+s):r>$a-s&&(r=$a-s);const m=h/Math.pow(ch(r),l),_=m*Math.sin(l*o),b=h-m*Math.cos(l*o);return{x:.5*(_/Math.PI+.5),y:1-.5*(b/Math.PI+.5)}},unproject(o,r){this.initializeConstants(),o=(2*o-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:s,f:l}=this.constants,h=l-r,m=Math.sign(h),_=Math.sign(s)*Math.sqrt(o*o+h*h);let b=Math.atan2(o,Math.abs(h))*m;h*s<0&&(b-=Math.PI*Math.sign(o)*m);const E=Kt(ei(b/s)+this.center[0],-180,180),C=Kt(ei(2*Math.atan(Math.pow(l/_,1/s))-$a),-85.051129,Oa);return new _n(E,C)}},Ey={name:"mercator",wrap:!0,center:[0,0],project:(o,r)=>({x:bi(o),y:Lu(r)}),unproject(o,r){const s=Mc(o),l=Po(r);return new _n(s,l)}};const gg=vn(Oa);var _g={name:"naturalEarth",center:[0,0],range:[3.5,7],project(o,r){const s=(r=vn(r))*r,l=s*s;return{x:.5*((o=vn(o))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1)}},unproject(o,r){o=(2*o-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=25,h=0,m=s*s;do{m=s*s;const E=m*m;h=(s*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-r)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),s=Kt(s-h,-gg,gg)}while(Math.abs(h)>1e-6&&--l>0);m=s*s;const _=Kt(ei(o/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=ei(s);return new _n(_,b)}};const yg=vn(Oa),Cf={albers:ro,equalEarth:Ax,equirectangular:by,lambertConformalConic:wy,mercator:Ey,naturalEarth:_g,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(o,r){r=vn(r),o=vn(o);const s=Math.cos(r),l=2/Math.PI,h=Math.acos(s*Math.cos(o/2)),m=Math.sin(h)/h,_=.5*(o*l+2*s*Math.sin(o/2)/m)||0,b=.5*(r+Math.sin(r)/m)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(b/Math.PI+1)}},unproject(o,r){let s=o=(2*o-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,h=25;const m=1e-6;let _=0,b=0;do{const E=Math.cos(l),C=Math.sin(l),I=2*C*E,M=C*C,k=E*E,B=Math.cos(s/2),N=Math.sin(s/2),$=2*B*N,K=N*N,te=1-k*B*B,oe=te?1/te:0,ue=te?Math.acos(E*B)*Math.sqrt(1/te):0,pe=.5*(2*ue*E*N+2*s/Math.PI)-o,he=.5*(ue*C+l)-r,ge=.5*oe*(k*K+ue*E*B*M)+1/Math.PI,Me=oe*($*I/4-ue*C*N),we=.125*oe*(I*N-ue*C*k*$),Xe=.5*oe*(M*B+ue*K*E)+.5,Ne=Me*we-Xe*ge;_=(he*Me-pe*Xe)/Ne,b=(pe*we-he*ge)/Ne,s=Kt(s-_,-Math.PI,Math.PI),l=Kt(l-b,-yg,yg)}while((Math.abs(_)>m||Math.abs(b)>m)&&--h>0);return new _n(ei(s),ei(l))}}};p.ARRAY_TYPE=Zr,p.AUTH_ERR_MSG=Ii,p.Actor=class{constructor(o,r,s){this.target=o,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},xn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=En()?o:at,this.scheduler=new lg}send(o,r,s,l,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[_]=s);const b=Yl(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:o,hasCallback:!!s,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Ia(r,b)},b),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(o){const r=o.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(r.mustQueue||En()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,r),l&&l.metadata||{type:"message"})}else this.processTask(s,r)}processTask(o,r){if("<response>"===r.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(r.error?s(zs(r.error)):s(null,zs(r.data)))}else{const s=Yl(this.globalScope)?void 0:[],l=r.hasCallback?(m,_)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:m?Ia(m):null,data:Ia(_,s)},s)}:m=>{},h=zs(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,l);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],h.source)[m[1]](h,l)}else l(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=cg,p.Color=yt,p.ColorMode=ps,p.CullFaceMode=no,p.DEMData=Zs,p.DataConstantProperty=Z,p.DedupedRequest=fg,p.DepthMode=No,p.EXTENT=Ut,p.Elevation=class{getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,s=!0){null==r&&(r=null);const l=this._source();if(!l||o.y<0||o.y>1)return r;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(o.x),b=o.x-_,E=new Oi(h,_,h,Math.floor(b*m),Math.floor(o.y*m)),C=this.findDEMTileFor(E);if(!C||!C.dem)return r;const I=C.dem,M=1<<C.tileID.canonical.z,k=(b*M-C.tileID.canonical.x)*I.dim,B=(o.y*M-C.tileID.canonical.y)*I.dim,N=Math.floor(k),$=Math.floor(B);return(s?this.exaggeration():1)*Jt(Jt(I.get(N,$),I.get(N,$+1),B-$),Jt(I.get(N+1,$),I.get(N+1,$+1),B-$),k-N)}getAtTileOffset(o,r,s){const l=1<<o.canonical.z;return this.getAtPointOrZero(new $h(o.wrap+(o.canonical.x+r/Ut)/l,(o.canonical.y+s/Ut)/l))}getForTilePoints(o,r,s,l){const h=Sd.create(this,o,l);return!!h&&(r.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(o){const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const s=r.dem.tree,l=r.tileID,h=1<<o.canonical.z-l.canonical.z;let m=o.canonical.x/h-l.canonical.x,_=o.canonical.y/h-l.canonical.y,b=0;for(let E=0;E<o.canonical.z-l.canonical.z&&!s.leaves[b];E++){m*=2,_*=2;const C=2*Math.floor(_)+Math.floor(m);b=s.childOffsets[b]+C,m%=1,_%=1}return{min:this.exaggeration()*s.minimums[b],max:this.exaggeration()*s.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=ot,p.EvaluationParameters=L,p.Event=Le,p.Evented=Ze,p.GlyphManager=Zc,p.ImagePosition=Yp,p.LineAtlas=ag,p.LngLat=_n,p.LngLatBounds=Il,p.LocalGlyphMode=lf,p.MAX_MERCATOR_LATITUDE=Oa,p.MAX_SAFE_INTEGER=Ni,p.MercatorCoordinate=$h,p.ONE_EM=24,p.OverscaledTileID=Oi,p.Properties=Te,p.RGBAImage=to,p.RequestManager=class{constructor(o,r,s){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let r="";for(let s=0;s<10;s++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ja,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Mi(o))return o;const s=$i(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Mi(o))return o;const s=$i(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeSourceURL(o,r){if(!Mi(o))return o;const s=$i(o);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||r)}normalizeSpriteURL(o,r,s,l){const h=$i(o);return Mi(o)?(h.path=`/styles/v1${h.path}/sprite${r}${s}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${r}${s}`,Br(h))}normalizeTileURL(o,r,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Mi(o))return o;const l=$i(o);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||s&&"raster"!==l.authority&&512===s?"@2x":""}${Zo.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${zt.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${zt.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const b=_.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(l.params)||zt.ACCESS_TOKEN;return zt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(o,r){const s=$i(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${zt.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${zt.TILE_URL_VERSION}/`,"")}`;let h=s.params;return r&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(o,r){const s=!!r&&Mi(r),l=[];for(const h of o.tiles||[])Cs(h)?l.push(this.canonicalizeTileURL(h,s)):l.push(h);return l}_makeAPIURL(o,r){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=$i(zt.API_URL);if(o.protocol=l.protocol,o.authority=l.authority,"http"===o.protocol){const h=o.params.indexOf("secure");h>=0&&o.params.splice(h,1)}if("/"!==l.path&&(o.path=`${l.path}${o.path}`),!zt.REQUIRE_ACCESS_TOKEN)return Br(o);if(r=r||zt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(h=>-1===h.indexOf("access_token")),o.params.push(`access_token=${r||""}`),Br(o)}},p.ResourceType=Ss,p.SegmentVector=Jn,p.SourceCache=Ws,p.StencilMode=ja,p.StructArrayLayout1ui2=Er,p.StructArrayLayout2f1f2i16=Qn,p.StructArrayLayout2i4=nt,p.StructArrayLayout2ui4=In,p.StructArrayLayout3f12=mt,p.StructArrayLayout3ui6=kn,p.StructArrayLayout4i8=ct,p.Texture=rh,p.Tile=Ed,p.Transitionable=X,p.Uniform1f=Sc,p.Uniform1i=class extends ss{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},p.Uniform2f=class extends ss{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},p.Uniform3f=class extends ss{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},p.Uniform4f=Tl,p.UniformColor=y_,p.UniformMatrix2f=class extends ss{constructor(o,r){super(o,r),this.current=x_}set(o){for(let r=0;r<4;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},p.UniformMatrix3f=class extends ss{constructor(o,r){super(o,r),this.current=cn}set(o){for(let r=0;r<9;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},p.UniformMatrix4f=class extends ss{constructor(o,r){super(o,r),this.current=v_}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},p.UnwrappedTileID=my,p.ValidationError=De,p.VectorTileWorkerSource=class extends Ze{constructor(o,r,s,l,h){super(),this.actor=o,this.layerIndex=r,this.availableImages=s,this.loadVectorData=h||mg,this.loading={},this.loaded={},this.deduped=new fg(o.scheduler),this.isSpriteLoaded=l,this.scheduler=o.scheduler}loadTile(o,r){const s=o.uid,l=o&&o.request,h=l&&l.collectResourceTiming,m=this.loading[s]=new xy(o);m.abort=this.loadVectorData(o,(_,b)=>{const E=!this.loading[s];if(delete this.loading[s],E||_||!b)return m.status="done",E||(this.loaded[s]=m),r(_);const C=b.rawData,I={};b.expires&&(I.expires=b.expires),b.cacheControl&&(I.cacheControl=b.cacheControl),m.vectorTile=b.vectorTile||new Ro.VectorTile(new ad(C));const M=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,B)=>{if(k||!B)return r(k);const N={};if(h){const $=gf(l);$.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,zn({rawTileData:C.slice(0)},B,I,N))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[s]=m})}reloadTile(o,r){const s=this.loaded,l=o.uid,h=this;if(s&&s[l]){const m=s[l];m.showCollisionBoxes=o.showCollisionBoxes,m.enableTerrain=!!o.enableTerrain;const _=(b,E)=>{const C=m.reloadCallback;C&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,C)),r(b,E)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(o,r){const s=o.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),r()}removeTile(o,r){const s=this.loaded,l=o.uid;s&&s[l]&&delete s[l],r()}},p.WritingMode=Fi,p.ZoomHistory=zh,p.add=function(o,r,s){return o[0]=r[0]+s[0],o[1]=r[1]+s[1],o[2]=r[2]+s[2],o},p.addDynamicAttributes=md,p.altitudeFromMercatorZ=yp,p.asyncAll=Go,p.bezier=Ui,p.bindAll=xn,p.boundsAttributes=ih,p.bufferConvexPolygon=function(o,r){const s=[];for(let l=0;l<o.length;l++){const h=xo(l-1,-1,o.length-1),m=xo(l+1,-1,o.length-1),_=o[l],b=o[m],E=o[h].sub(_).unit(),C=b.sub(_).unit(),I=C.angleWithSep(E.x,E.y),M=E.add(C).unit().mult(-1*r/Math.sin(I/2));s.push(_.add(M))}return s},p.cacheEntryPossiblyAdded=function(o){ol++,ol>Xo&&(o.getActor().send("enforceCacheSizeLimit",il),ol=0)},p.clamp=Kt,p.clearTileCache=function(o){const r=at.caches.delete(rl);o&&r.catch(o).then(()=>o())},p.clipLine=dd,p.clone=function(o){var r=new Zr(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r},p.clone$1=function(o){var r=new Zr(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},p.clone$2=dr,p.collisionCircleLayout=Q_,p.config=zt,p.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},p.copy=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o},p.create=Pl,p.create$1=function(){var o=new Zr(16);return Zr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},p.create$2=Al,p.createExpression=Mr,p.createLayout=ye,p.createStyleLayer=function(o){return"custom"===o.type?new _d(o):new mf[o.type](o)},p.cross=function(o,r,s){var l=r[0],h=r[1],m=r[2],_=s[0],b=s[1],E=s[2];return o[0]=h*E-m*b,o[1]=m*_-l*E,o[2]=l*b-h*_,o},p.degToRad=vn,p.div=function(o,r,s){return o[0]=r[0]/s[0],o[1]=r[1]/s[1],o[2]=r[2]/s[2],o},p.dot=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]},p.dot$1=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+o[3]*r[3]},p.ease=vo,p.easeCubicInOut=Ti,p.emitValidationErrors=Xn,p.endsWith=qo,p.enforceCacheSizeLimit=function(o){br(),pi&&pi.then(r=>{r.keys().then(s=>{for(let l=0;l<s.length-o;l++)r.delete(s[l])})})},p.evaluateSizeForFeature=sd,p.evaluateSizeForZoom=Vc,p.evaluateVariableOffset=Km,p.evented=S,p.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},p.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},p.exported=Si,p.exported$1=Zo,p.extend=zn,p.filterObject=co,p.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},p.fromQuat=function(o,r){var s=r[0],l=r[1],h=r[2],m=r[3],_=s+s,b=l+l,E=h+h,C=s*_,I=l*_,M=l*b,k=h*_,B=h*b,N=h*E,$=m*_,K=m*b,te=m*E;return o[0]=1-M-N,o[1]=I+te,o[2]=k-K,o[3]=0,o[4]=I-te,o[5]=1-C-N,o[6]=B+$,o[7]=0,o[8]=k+K,o[9]=B-$,o[10]=1-C-M,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},p.fromRotation=function(o,r){var s=Math.sin(r),l=Math.cos(r);return o[0]=l,o[1]=s,o[2]=0,o[3]=-s,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},p.fromScaling=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},p.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return ia[r]},p.getAABBPointSquareDist=function(o,r,s){let l=0;for(let h=0;h<2;++h){const m=s?s[h]:0;o[h]>m&&(l+=(o[h]-m)*(o[h]-m)),r[h]<m&&(l+=(m-r[h])*(m-r[h]))}return l},p.getAnchorAlignment=Hc,p.getAnchorJustification=df,p.getBounds=function(o){let r=1/0,s=1/0,l=-1/0,h=-1/0;for(const m of o)r=Math.min(r,m.x),s=Math.min(s,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return{min:new ze(r,s),max:new ze(l,h)}},p.getImage=_e,p.getJSON=function(o,r){return z(zn(o,{type:"json"}),r)},p.getMapSessionAPI=nl,p.getPerformanceMeasurement=gf,p.getProjection=function(o){const r=Cf[o.name];if(!r)throw new Error(`Invalid projection name: ${o.name}`);return r.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let h=function(m){const _=Math.max(.01,Math.cos(vn(m))),b=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,project(E,C){const I=vn(E)*_,M=Math.sin(vn(C))/_;return{x:I*b+.5,y:-M*b+.5}},unproject(E,C){const I=-(C-.5)/b,M=Kt(ei((E-.5)/b)/_,-180,180),k=Math.asin(Kt(I*_,-1,1)),B=Kt(ei(k),-85.051129,Oa);return new _n(M,B)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:m,unproject:_}=Cf.mercator;h={wrap:!0,project:m,unproject:_}}return zn({},s,l,h)}return zn({},s,l)}(r,o):r},p.getRTLTextPluginStatus=A,p.getReferrer=Y,p.getTilePoint=function(o,{x:r,y:s},l=0){return new ze(((r-l)*o.scale-o.x)*Ut,(s*o.scale-o.y)*Ut)},p.getTileVec3=function(o,r,s=0){return kc(((r.x-s)*o.scale-o.x)*Ut,(r.y*o.scale-o.y)*Ut,yp(r.z,r.y))},p.getVideo=function(o,r){const s=at.document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let l=0;l<o.length;l++){const h=at.document.createElement("source");se(o[l])||(s.crossOrigin="Anonymous"),h.src=o[l],s.appendChild(h)}return{cancel:()=>{}}},p.identity=wp,p.identity$1=Nu,p.invert=function(o,r){var s=r[0],l=r[1],h=r[2],m=r[3],_=r[4],b=r[5],E=r[6],C=r[7],I=r[8],M=r[9],k=r[10],B=r[11],N=r[12],$=r[13],K=r[14],te=r[15],oe=s*b-l*_,ue=s*E-h*_,pe=s*C-m*_,he=l*E-h*b,ge=l*C-m*b,Me=h*C-m*E,we=I*$-M*N,Xe=I*K-k*N,Ne=I*te-B*N,Ae=M*K-k*$,Be=M*te-B*$,$e=k*te-B*K,ke=oe*$e-ue*Be+pe*Ae+he*Ne-ge*Xe+Me*we;return ke?(o[0]=(b*$e-E*Be+C*Ae)*(ke=1/ke),o[1]=(h*Be-l*$e-m*Ae)*ke,o[2]=($*Me-K*ge+te*he)*ke,o[3]=(k*ge-M*Me-B*he)*ke,o[4]=(E*Ne-_*$e-C*Xe)*ke,o[5]=(s*$e-h*Ne+m*Xe)*ke,o[6]=(K*pe-N*Me-te*ue)*ke,o[7]=(I*Me-k*pe+B*ue)*ke,o[8]=(_*Be-b*Ne+C*we)*ke,o[9]=(l*Ne-s*Be-m*we)*ke,o[10]=(N*ge-$*pe+te*oe)*ke,o[11]=(M*pe-I*ge-B*oe)*ke,o[12]=(b*Xe-_*Ae-E*we)*ke,o[13]=(s*Ae-l*Xe+h*we)*ke,o[14]=($*ue-N*he-K*oe)*ke,o[15]=(I*he-M*ue+k*oe)*ke,o):null},p.isMapAuthenticated=function(o){return Eo.has(o)},p.isMapboxURL=Mi,p.latFromMercatorY=Po,p.len=S_,p.length=Cp,p.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},p.loadVectorTile=mg,p.makeRequest=z,p.mercatorXfromLng=bi,p.mercatorYfromLat=Lu,p.mercatorZfromAltitude=La,p.mul=function(o,r,s){return o[0]=r[0]*s[0],o[1]=r[1]*s[1],o[2]=r[2]*s[2],o[3]=r[3]*s[3],o},p.mul$1=Dp,p.mul$2=bx,p.multiply=Ep,p.multiply$1=kl,p.nextPowerOfTwo=Xl,p.normalize=Em,p.normalize$1=function(o,r){var s=r[0],l=r[1],h=r[2],m=r[3],_=s*s+l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=s*_,o[1]=l*_,o[2]=h*_,o[3]=m*_,o},p.number=Jt,p.ortho=function(o,r,s,l,h,m,_){var b=1/(r-s),E=1/(l-h),C=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*C,o[11]=0,o[12]=(r+s)*b,o[13]=(h+l)*E,o[14]=(_+m)*C,o[15]=1,o},p.pbf=ad,p.perspective=function(o,r,s,l,h){var m,_=1/Math.tan(r/2);return o[0]=_/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=h&&h!==1/0?(o[10]=(h+l)*(m=1/(l-h)),o[14]=2*h*l*m):(o[10]=-1,o[14]=-2*l),o},p.pick=function(o,r){const s={};for(let l=0;l<r.length;l++){const h=r[l];h in o&&(s[h]=o[h])}return s},p.plugin=F,p.pointGeometry=ze,p.polygonIntersectsBox=D_,p.polygonIntersectsPolygon=gm,p.polygonizeBounds=function(o,r,s=0,l=!0){const h=new ze(s,s),m=o.sub(h),_=r.add(h),b=[m,new ze(_.x,m.y),_,new ze(m.x,_.y)];return l&&b.push(m),b},p.posAttributes=Mx,p.postMapLoadEvent=ec,p.postTurnstileEvent=Jl,p.potpack=Xp,p.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},p.radToDeg=ei,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(o){return o({pluginStatus:g,pluginURL:v}),S.on("pluginStateChange",o),o},p.removeAuthState=function(o){Eo.delete(o)},p.renderColorRamp=Ap,p.rotateX=function(o,r,s){var l=Math.sin(s),h=Math.cos(s),m=r[4],_=r[5],b=r[6],E=r[7],C=r[8],I=r[9],M=r[10],k=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=m*h+C*l,o[5]=_*h+I*l,o[6]=b*h+M*l,o[7]=E*h+k*l,o[8]=C*h-m*l,o[9]=I*h-_*l,o[10]=M*h-b*l,o[11]=k*h-E*l,o},p.rotateX$1=Xh,p.rotateY=function(o,r,s){var l=Math.sin(s),h=Math.cos(s),m=r[0],_=r[1],b=r[2],E=r[3],C=r[8],I=r[9],M=r[10],k=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=m*h-C*l,o[1]=_*h-I*l,o[2]=b*h-M*l,o[3]=E*h-k*l,o[8]=m*l+C*h,o[9]=_*l+I*h,o[10]=b*l+M*h,o[11]=E*l+k*h,o},p.rotateZ=function(o,r,s){var l=Math.sin(s),h=Math.cos(s),m=r[0],_=r[1],b=r[2],E=r[3],C=r[4],I=r[5],M=r[6],k=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=m*h+C*l,o[1]=_*h+I*l,o[2]=b*h+M*l,o[3]=E*h+k*l,o[4]=C*h-m*l,o[5]=I*h-_*l,o[6]=M*h-b*l,o[7]=k*h-E*l,o},p.rotateZ$1=function(o,r,s){s*=.5;var l=r[0],h=r[1],m=r[2],_=r[3],b=Math.sin(s),E=Math.cos(s);return o[0]=l*E+h*b,o[1]=h*E-l*b,o[2]=m*E+_*b,o[3]=_*E-m*b,o},p.scale=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o},p.scale$1=function(o,r,s){var l=s[0],h=s[1],m=s[2];return o[0]=r[0]*l,o[1]=r[1]*l,o[2]=r[2]*l,o[3]=r[3]*l,o[4]=r[4]*h,o[5]=r[5]*h,o[6]=r[6]*h,o[7]=r[7]*h,o[8]=r[8]*m,o[9]=r[9]*m,o[10]=r[10]*m,o[11]=r[11]*m,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},p.scale$2=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o[3]=r[3]*s,o},p.scaleAndAdd=Rc,p.setCacheLimits=function(o,r){il=o,Xo=r},p.setRTLTextPlugin=function(o,r,s=!1){if(g===Ns||g===f||g===i)throw new Error("setRTLTextPlugin cannot be called multiple times.");v=Si.resolveURL(o),g=Ns,u=r,D(),s||R()},p.smoothstep=function(o,r,s){return(s=Kt((s-o)/(r-o),0,1))*s*(3-2*s)},p.spec=de,p.storeAuthState=function(o,r){r?Eo.add(o):Eo.delete(o)},p.sub=T_,p.subtract=wm,p.symbolSize=Um,p.tileTransform=vd,p.transformMat3=function(o,r,s){var l=r[0],h=r[1],m=r[2];return o[0]=l*s[0]+h*s[3]+m*s[6],o[1]=l*s[1]+h*s[4]+m*s[7],o[2]=l*s[2]+h*s[5]+m*s[8],o},p.transformMat4=Bu,p.transformMat4$1=function(o,r,s){var l=r[0],h=r[1],m=r[2],_=s[3]*l+s[7]*h+s[11]*m+s[15];return o[0]=(s[0]*l+s[4]*h+s[8]*m+s[12])/(_=_||1),o[1]=(s[1]*l+s[5]*h+s[9]*m+s[13])/_,o[2]=(s[2]*l+s[6]*h+s[10]*m+s[14])/_,o},p.transformQuat=C_,p.translate=function(o,r,s){var l,h,m,_,b,E,C,I,M,k,B,N,$=s[0],K=s[1],te=s[2];return r===o?(o[12]=r[0]*$+r[4]*K+r[8]*te+r[12],o[13]=r[1]*$+r[5]*K+r[9]*te+r[13],o[14]=r[2]*$+r[6]*K+r[10]*te+r[14],o[15]=r[3]*$+r[7]*K+r[11]*te+r[15]):(h=r[1],m=r[2],_=r[3],b=r[4],E=r[5],C=r[6],I=r[7],M=r[8],k=r[9],B=r[10],N=r[11],o[0]=l=r[0],o[1]=h,o[2]=m,o[3]=_,o[4]=b,o[5]=E,o[6]=C,o[7]=I,o[8]=M,o[9]=k,o[10]=B,o[11]=N,o[12]=l*$+b*K+M*te+r[12],o[13]=h*$+E*K+k*te+r[13],o[14]=m*$+C*K+B*te+r[14],o[15]=_*$+I*K+N*te+r[15]),o},p.triggerPluginCompletionEvent=x,p.uniqueId=bo,p.validateCustomStyleLayer=function(o){const r=[],s=o.id;return void 0===s&&r.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&r.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFog=Fn,p.validateLight=cm,p.validateStyle=So,p.values=bs,p.vectorTile=Ro,p.version="2.6.1",p.warnOnce=Pn,p.window=at,p.wrap=xo}),au(0,function(p){function Vn(Y){const z=typeof Y;if("number"===z||"boolean"===z||"string"===z||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let ne="[";for(const se of Y)ne+=`${Vn(se)},`;return`${ne}]`}const U=Object.keys(Y).sort();let W="{";for(let ne=0;ne<U.length;ne++)W+=`${JSON.stringify(U[ne])}:${Vn(Y[U[ne]])},`;return`${W}}`}function yo(Y){let z="";for(const U of p.refProperties)z+=`/${Vn(Y[U])}`;return z}class Jr{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,U){for(const ne of z)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=p.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of U)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const W=function(ne,se){const me={};for(let ce=0;ce<ne.length;ce++){const _e=se&&se[ne[ce].id]||yo(ne[ce]);se&&(se[ne[ce].id]=_e);let Pe=me[_e];Pe||(Pe=me[_e]=[]),Pe.push(ne[ce])}const fe=[];for(const ce in me)fe.push(me[ce]);return fe}(p.values(this._layerConfigs),this.keyCache);for(const ne of W){const se=ne.map(We=>this._layers[We.id]),me=se[0];if("none"===me.visibility)continue;const fe=me.source||"";let ce=this.familiesBySource[fe];ce||(ce=this.familiesBySource[fe]={});const _e=me.sourceLayer||"_geojsonTileLayer";let Pe=ce[_e];Pe||(Pe=ce[_e]=[]),Pe.push(se)}}}const{ImageBitmap:ze}=p.window;class Fe{loadTile(z,U){const{uid:W,encoding:ne,rawImageData:se,padding:me,buildQuadTree:fe}=z,ce=ze&&se instanceof ze?this.getImageData(se,me):se;U(null,new p.DEMData(W,ce,ne,me<1,fe))}getImageData(z,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const W=this.offscreenCanvasContext.getImageData(-U,-U,z.width+2*U,z.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:W.width,height:W.height},W.data)}}var at=function Y(z,U){var W,ne=z&&z.type;if("FeatureCollection"===ne)for(W=0;W<z.features.length;W++)Y(z.features[W],U);else if("GeometryCollection"===ne)for(W=0;W<z.geometries.length;W++)Y(z.geometries[W],U);else if("Feature"===ne)Y(z.geometry,U);else if("Polygon"===ne)Ni(z.coordinates,U);else if("MultiPolygon"===ne)for(W=0;W<z.coordinates.length;W++)Ni(z.coordinates[W],U);return z};function Ni(Y,z){if(0!==Y.length){$o(Y[0],z);for(var U=1;U<Y.length;U++)$o(Y[U],!z)}}function $o(Y,z){for(var U=0,W=0,ne=0,se=Y.length,me=se-1;ne<se;me=ne++){var fe=(Y[ne][0]-Y[me][0])*(Y[me][1]+Y[ne][1]),ce=U+fe;W+=Math.abs(U)>=Math.abs(fe)?U-ce+fe:fe-ce+U,U=ce}U+W>=0!=!!z&&Y.reverse()}const ra=p.vectorTile.VectorTileFeature.prototype.toGeoJSON;class vn{constructor(z){this._feature=z,this.extent=p.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const U of this._feature.geometry)z.push([new p.pointGeometry(U[0],U[1])]);return z}{const z=[];for(const U of this._feature.geometry){const W=[];for(const ne of U)W.push(new p.pointGeometry(ne[0],ne[1]));z.push(W)}return z}}toGeoJSON(z,U,W){return ra.call(this,z,U,W)}}class ei{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=z.length,this._features=z}feature(z){return new vn(this._features[z])}}var ia=p.vectorTile.VectorTileFeature,Ti=Ui;function Ui(Y,z){this.options=z||{},this.features=Y,this.length=Y.length}function vo(Y,z){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=z||4096}Ui.prototype.feature=function(Y){return new vo(this.features[Y],this.options.extent)},vo.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var z=0;z<Y.length;z++){for(var U=Y[z],W=[],ne=0;ne<U.length;ne++)W.push(new p.pointGeometry(U[ne][0],U[ne][1]));this.geometry.push(W)}return this.geometry},vo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,z=1/0,U=-1/0,W=1/0,ne=-1/0,se=0;se<Y.length;se++)for(var me=Y[se],fe=0;fe<me.length;fe++){var ce=me[fe];z=Math.min(z,ce.x),U=Math.max(U,ce.x),W=Math.min(W,ce.y),ne=Math.max(ne,ce.y)}return[z,W,U,ne]},vo.prototype.toGeoJSON=ia.prototype.toGeoJSON;var Kt=Go,xo=Ti;function Go(Y){var z=new p.pbf;return function(U,W){for(var ne in U.layers)W.writeMessage(3,bs,U.layers[ne])}(Y,z),z.finish()}function bs(Y,z){var U;z.writeVarintField(15,Y.version||1),z.writeStringField(1,Y.name||""),z.writeVarintField(5,Y.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<Y.length;U++)W.feature=Y.feature(U),z.writeMessage(2,zn,W);var ne=W.keys;for(U=0;U<ne.length;U++)z.writeStringField(3,ne[U]);var se=W.values;for(U=0;U<se.length;U++)z.writeMessage(4,oa,se[U])}function zn(Y,z){var U=Y.feature;void 0!==U.id&&z.writeVarintField(1,U.id),z.writeMessage(2,lu,Y),z.writeVarintField(3,U.type),z.writeMessage(4,Xl,U)}function lu(Y,z){var U=Y.feature,W=Y.keys,ne=Y.values,se=Y.keycache,me=Y.valuecache;for(var fe in U.properties){var ce=U.properties[fe],_e=se[fe];if(null!==ce){void 0===_e&&(W.push(fe),se[fe]=_e=W.length-1),z.writeVarint(_e);var Pe=typeof ce;"string"!==Pe&&"boolean"!==Pe&&"number"!==Pe&&(ce=JSON.stringify(ce));var We=Pe+":"+ce,Le=me[We];void 0===Le&&(ne.push(ce),me[We]=Le=ne.length-1),z.writeVarint(Le)}}}function bo(Y,z){return(z<<3)+(7&Y)}function Vi(Y){return Y<<1^Y>>31}function Xl(Y,z){for(var U=Y.loadGeometry(),W=Y.type,ne=0,se=0,me=U.length,fe=0;fe<me;fe++){var ce=U[fe],_e=1;1===W&&(_e=ce.length),z.writeVarint(bo(1,_e));for(var Pe=3===W?ce.length-1:ce.length,We=0;We<Pe;We++){1===We&&1!==W&&z.writeVarint(bo(2,Pe-1));var Le=ce[We].x-ne,ot=ce[We].y-se;z.writeVarint(Vi(Le)),z.writeVarint(Vi(ot)),ne+=Le,se+=ot}3===W&&z.writeVarint(bo(7,1))}}function oa(Y,z){var U=typeof Y;"string"===U?z.writeStringField(1,Y):"boolean"===U?z.writeBooleanField(7,Y):"number"===U&&(Y%1!=0?z.writeDoubleField(3,Y):Y<0?z.writeSVarintField(6,Y):z.writeVarintField(5,Y))}function xn(Y,z,U,W,ne,se){if(ne-W<=U)return;const me=W+ne>>1;qo(Y,z,me,W,ne,se%2),xn(Y,z,U,W,me-1,se+1),xn(Y,z,U,me+1,ne,se+1)}function qo(Y,z,U,W,ne,se){for(;ne>W;){if(ne-W>600){const _e=ne-W+1,Pe=U-W+1,We=Math.log(_e),Le=.5*Math.exp(2*We/3),ot=.5*Math.sqrt(We*Le*(_e-Le)/_e)*(Pe-_e/2<0?-1:1);qo(Y,z,U,Math.max(W,Math.floor(U-Pe*Le/_e+ot)),Math.min(ne,Math.floor(U+(_e-Pe)*Le/_e+ot)),se)}const me=z[2*U+se];let fe=W,ce=ne;for(wo(Y,z,W,U),z[2*ne+se]>me&&wo(Y,z,W,ne);fe<ce;){for(wo(Y,z,fe,ce),fe++,ce--;z[2*fe+se]<me;)fe++;for(;z[2*ce+se]>me;)ce--}z[2*W+se]===me?wo(Y,z,W,ce):(ce++,wo(Y,z,ce,ne)),ce<=U&&(W=ce+1),U<=ce&&(ne=ce-1)}}function wo(Y,z,U,W){co(Y,U,W),co(z,2*U,2*W),co(z,2*U+1,2*W+1)}function co(Y,z,U){const W=Y[z];Y[z]=Y[U],Y[U]=W}function dr(Y,z,U,W){const ne=Y-U,se=z-W;return ne*ne+se*se}Kt.fromVectorTileJs=Go,Kt.fromGeojsonVt=function(Y,z){z=z||{};var U={};for(var W in Y)U[W]=new Ti(Y[W].features,z),U[W].name=W,U[W].version=z.version,U[W].extent=z.extent;return Go({layers:U})},Kt.GeoJSONWrapper=xo;const ti=Y=>Y[0],Pn=Y=>Y[1];class di{constructor(z,U=ti,W=Pn,ne=64,se=Float64Array){this.nodeSize=ne,this.points=z;const me=z.length<65536?Uint16Array:Uint32Array,fe=this.ids=new me(z.length),ce=this.coords=new se(2*z.length);for(let _e=0;_e<z.length;_e++)fe[_e]=_e,ce[2*_e]=U(z[_e]),ce[2*_e+1]=W(z[_e]);xn(fe,ce,ne,0,fe.length-1,0)}range(z,U,W,ne){return function(se,me,fe,ce,_e,Pe,We){const Le=[0,se.length-1,0],ot=[];let Ze,de;for(;Le.length;){const De=Le.pop(),Ft=Le.pop(),nn=Le.pop();if(Ft-nn<=We){for(let $t=nn;$t<=Ft;$t++)Ze=me[2*$t],de=me[2*$t+1],Ze>=fe&&Ze<=_e&&de>=ce&&de<=Pe&&ot.push(se[$t]);continue}const _t=Math.floor((nn+Ft)/2);Ze=me[2*_t],de=me[2*_t+1],Ze>=fe&&Ze<=_e&&de>=ce&&de<=Pe&&ot.push(se[_t]);const Bt=(De+1)%2;(0===De?fe<=Ze:ce<=de)&&(Le.push(nn),Le.push(_t-1),Le.push(Bt)),(0===De?_e>=Ze:Pe>=de)&&(Le.push(_t+1),Le.push(Ft),Le.push(Bt))}return ot}(this.ids,this.coords,z,U,W,ne,this.nodeSize)}within(z,U,W){return function(ne,se,me,fe,ce,_e){const Pe=[0,ne.length-1,0],We=[],Le=ce*ce;for(;Pe.length;){const ot=Pe.pop(),Ze=Pe.pop(),de=Pe.pop();if(Ze-de<=_e){for(let Bt=de;Bt<=Ze;Bt++)dr(se[2*Bt],se[2*Bt+1],me,fe)<=Le&&We.push(ne[Bt]);continue}const De=Math.floor((de+Ze)/2),Ft=se[2*De],nn=se[2*De+1];dr(Ft,nn,me,fe)<=Le&&We.push(ne[De]);const _t=(ot+1)%2;(0===ot?me-ce<=Ft:fe-ce<=nn)&&(Pe.push(de),Pe.push(De-1),Pe.push(_t)),(0===ot?me+ce>=Ft:fe+ce>=nn)&&(Pe.push(De+1),Pe.push(Ze),Pe.push(_t))}return We}(this.ids,this.coords,z,U,W,this.nodeSize)}}const er={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},En=Math.fround||(an=new Float32Array(1),Y=>(an[0]=+Y,an[0]));var an;class Ho{constructor(z){this.options=zt(Object.create(er),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:U,minZoom:W,maxZoom:ne,nodeSize:se}=this.options;U&&console.time("total time");const me=`prepare ${z.length} points`;U&&console.time(me),this.points=z;let fe=[];for(let ce=0;ce<z.length;ce++)z[ce].geometry&&fe.push(ws(z[ce],ce));this.trees[ne+1]=new di(fe,Zo,Es,se,Float32Array),U&&console.timeEnd(me);for(let ce=ne;ce>=W;ce--){const _e=+Date.now();fe=this._cluster(fe,ce),this.trees[ce]=new di(fe,Zo,Es,se,Float32Array),U&&console.log("z%d: %d clusters in %dms",ce,fe.length,+Date.now()-_e)}return U&&console.timeEnd("total time"),this}getClusters(z,U){let W=((z[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,z[1]));let se=180===z[2]?180:((z[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)W=-180,se=180;else if(W>se){const Pe=this.getClusters([W,ne,180,me],U),We=this.getClusters([-180,ne,se,me],U);return Pe.concat(We)}const fe=this.trees[this._limitZoom(U)],ce=fe.range(sa(W),Si(me),sa(se),Si(ne)),_e=[];for(const Pe of ce){const We=fe.points[Pe];_e.push(We.numPoints?Ya(We):this.points[We.index])}return _e}getChildren(z){const U=this._getOriginId(z),W=this._getOriginZoom(z),ne="No cluster with the specified id.",se=this.trees[W];if(!se)throw new Error(ne);const me=se.points[U];if(!me)throw new Error(ne);const fe=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ce=se.within(me.x,me.y,fe),_e=[];for(const Pe of ce){const We=se.points[Pe];We.parentId===z&&_e.push(We.numPoints?Ya(We):this.points[We.index])}if(0===_e.length)throw new Error(ne);return _e}getLeaves(z,U,W){const ne=[];return this._appendLeaves(ne,z,U=U||10,W=W||0,0),ne}getTile(z,U,W){const ne=this.trees[this._limitZoom(z)],se=Math.pow(2,z),{extent:me,radius:fe}=this.options,ce=fe/me,_e=(W-ce)/se,Pe=(W+1+ce)/se,We={features:[]};return this._addTileFeatures(ne.range((U-ce)/se,_e,(U+1+ce)/se,Pe),ne.points,U,W,se,We),0===U&&this._addTileFeatures(ne.range(1-ce/se,_e,1,Pe),ne.points,se,W,se,We),U===se-1&&this._addTileFeatures(ne.range(0,_e,ce/se,Pe),ne.points,-1,W,se,We),We.features.length?We:null}getClusterExpansionZoom(z){let U=this._getOriginZoom(z)-1;for(;U<=this.options.maxZoom;){const W=this.getChildren(z);if(U++,1!==W.length)break;z=W[0].properties.cluster_id}return U}_appendLeaves(z,U,W,ne,se){const me=this.getChildren(U);for(const fe of me){const ce=fe.properties;if(ce&&ce.cluster?se+ce.point_count<=ne?se+=ce.point_count:se=this._appendLeaves(z,ce.cluster_id,W,ne,se):se<ne?se++:z.push(fe),z.length===W)break}return se}_addTileFeatures(z,U,W,ne,se,me){for(const fe of z){const ce=U[fe],_e=ce.numPoints;let Pe,We,Le;if(_e)Pe=Yl(ce),We=ce.x,Le=ce.y;else{const de=this.points[ce.index];Pe=de.properties,We=sa(de.geometry.coordinates[0]),Le=Si(de.geometry.coordinates[1])}const ot={type:1,geometry:[[Math.round(this.options.extent*(We*se-W)),Math.round(this.options.extent*(Le*se-ne))]],tags:Pe};let Ze;_e?Ze=ce.id:this.options.generateId?Ze=ce.index:this.points[ce.index].id&&(Ze=this.points[ce.index].id),void 0!==Ze&&(ot.id=Ze),me.features.push(ot)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,U){const W=[],{radius:ne,extent:se,reduce:me,minPoints:fe}=this.options,ce=ne/(se*Math.pow(2,U));for(let _e=0;_e<z.length;_e++){const Pe=z[_e];if(Pe.zoom<=U)continue;Pe.zoom=U;const We=this.trees[U+1],Le=We.within(Pe.x,Pe.y,ce),ot=Pe.numPoints||1;let Ze=ot;for(const de of Le){const De=We.points[de];De.zoom>U&&(Ze+=De.numPoints||1)}if(Ze>ot&&Ze>=fe){let de=Pe.x*ot,De=Pe.y*ot,Ft=me&&ot>1?this._map(Pe,!0):null;const nn=(_e<<5)+(U+1)+this.points.length;for(const _t of Le){const Bt=We.points[_t];if(Bt.zoom<=U)continue;Bt.zoom=U;const $t=Bt.numPoints||1;de+=Bt.x*$t,De+=Bt.y*$t,Bt.parentId=nn,me&&(Ft||(Ft=this._map(Pe,!0)),me(Ft,this._map(Bt)))}Pe.parentId=nn,W.push(Xt(de/Ze,De/Ze,nn,Ze,Ft))}else if(W.push(Pe),Ze>1)for(const de of Le){const De=We.points[de];De.zoom<=U||(De.zoom=U,W.push(De))}}return W}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,U){if(z.numPoints)return U?zt({},z.properties):z.properties;const W=this.points[z.index].properties,ne=this.options.map(W);return U&&ne===W?zt({},ne):ne}}function Xt(Y,z,U,W,ne){return{x:En(Y),y:En(z),zoom:1/0,id:U,parentId:-1,numPoints:W,properties:ne}}function ws(Y,z){const[U,W]=Y.geometry.coordinates;return{x:En(sa(U)),y:En(Si(W)),zoom:1/0,index:z,parentId:-1}}function Ya(Y){return{type:"Feature",id:Y.id,properties:Yl(Y),geometry:{type:"Point",coordinates:[(z=Y.x,360*(z-.5)),aa(Y.y)]}};var z}function Yl(Y){const z=Y.numPoints,U=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return zt(zt({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:z,point_count_abbreviated:U})}function sa(Y){return Y/360+.5}function Si(Y){const z=Math.sin(Y*Math.PI/180),U=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return U<0?0:U>1?1:U}function aa(Y){const z=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function zt(Y,z){for(const U in z)Y[U]=z[U];return Y}function Zo(Y){return Y.x}function Es(Y){return Y.y}function ji(Y,z,U,W){for(var ne,se=W,me=U-z>>1,fe=U-z,ce=Y[z],_e=Y[z+1],Pe=Y[U],We=Y[U+1],Le=z+3;Le<U;Le+=3){var ot=Ka(Y[Le],Y[Le+1],ce,_e,Pe,We);if(ot>se)ne=Le,se=ot;else if(ot===se){var Ze=Math.abs(Le-me);Ze<fe&&(ne=Le,fe=Ze)}}se>W&&(ne-z>3&&ji(Y,z,ne,W),Y[ne+2]=se,U-ne>3&&ji(Y,ne,U,W))}function Ka(Y,z,U,W,ne,se){var me=ne-U,fe=se-W;if(0!==me||0!==fe){var ce=((Y-U)*me+(z-W)*fe)/(me*me+fe*fe);ce>1?(U=ne,W=se):ce>0&&(U+=me*ce,W+=fe*ce)}return(me=Y-U)*me+(fe=z-W)*fe}function Ds(Y,z,U,W){var ne={id:void 0===Y?null:Y,type:z,geometry:U,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var me=se.geometry,fe=se.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)Qa(se,me);else if("Polygon"===fe||"MultiLineString"===fe)for(var ce=0;ce<me.length;ce++)Qa(se,me[ce]);else if("MultiPolygon"===fe)for(ce=0;ce<me.length;ce++)for(var _e=0;_e<me[ce].length;_e++)Qa(se,me[ce][_e])}(ne),ne}function Qa(Y,z){for(var U=0;U<z.length;U+=3)Y.minX=Math.min(Y.minX,z[U]),Y.minY=Math.min(Y.minY,z[U+1]),Y.maxX=Math.max(Y.maxX,z[U]),Y.maxY=Math.max(Y.maxY,z[U+1])}function Ja(Y,z,U,W){if(z.geometry){var ne=z.geometry.coordinates,se=z.geometry.type,me=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),fe=[],ce=z.id;if(U.promoteId?ce=z.properties[U.promoteId]:U.generateId&&(ce=W||0),"Point"===se)Ii(ne,fe);else if("MultiPoint"===se)for(var _e=0;_e<ne.length;_e++)Ii(ne[_e],fe);else if("LineString"===se)Mi(ne,fe,me,!1);else if("MultiLineString"===se){if(U.lineMetrics){for(_e=0;_e<ne.length;_e++)Mi(ne[_e],fe=[],me,!1),Y.push(Ds(ce,"LineString",fe,z.properties));return}Cs(ne,fe,me,!1)}else if("Polygon"===se)Cs(ne,fe,me,!0);else{if("MultiPolygon"!==se){if("GeometryCollection"===se){for(_e=0;_e<z.geometry.geometries.length;_e++)Ja(Y,{id:ce,geometry:z.geometry.geometries[_e],properties:z.properties},U,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<ne.length;_e++){var Pe=[];Cs(ne[_e],Pe,me,!0),fe.push(Pe)}}Y.push(Ds(ce,se,fe,z.properties))}}function Ii(Y,z){z.push(Kl(Y[0])),z.push($i(Y[1])),z.push(0)}function Mi(Y,z,U,W){for(var ne,se,me=0,fe=0;fe<Y.length;fe++){var ce=Kl(Y[fe][0]),_e=$i(Y[fe][1]);z.push(ce),z.push(_e),z.push(0),fe>0&&(me+=W?(ne*_e-ce*se)/2:Math.sqrt(Math.pow(ce-ne,2)+Math.pow(_e-se,2))),ne=ce,se=_e}var Pe=z.length-3;z[2]=1,ji(z,0,Pe,U),z[Pe+2]=1,z.size=Math.abs(me),z.start=0,z.end=z.size}function Cs(Y,z,U,W){for(var ne=0;ne<Y.length;ne++){var se=[];Mi(Y[ne],se,U,W),z.push(se)}}function Kl(Y){return Y/360+.5}function $i(Y){var z=Math.sin(Y*Math.PI/180),U=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return U<0?0:U>1?1:U}function Br(Y,z,U,W,ne,se,me,fe){if(W/=z,se>=(U/=z)&&me<W)return Y;if(me<U||se>=W)return null;for(var ce=[],_e=0;_e<Y.length;_e++){var Pe=Y[_e],We=Pe.geometry,Le=Pe.type,ot=0===ne?Pe.minX:Pe.minY,Ze=0===ne?Pe.maxX:Pe.maxY;if(ot>=U&&Ze<W)ce.push(Pe);else if(!(Ze<U||ot>=W)){var de=[];if("Point"===Le||"MultiPoint"===Le)cu(We,de,U,W,ne);else if("LineString"===Le)el(We,de,U,W,ne,!1,fe.lineMetrics);else if("MultiLineString"===Le)Jl(We,de,U,W,ne,!1);else if("Polygon"===Le)Jl(We,de,U,W,ne,!0);else if("MultiPolygon"===Le)for(var De=0;De<We.length;De++){var Ft=[];Jl(We[De],Ft,U,W,ne,!0),Ft.length&&de.push(Ft)}if(de.length){if(fe.lineMetrics&&"LineString"===Le){for(De=0;De<de.length;De++)ce.push(Ds(Pe.id,Le,de[De],Pe.tags));continue}"LineString"!==Le&&"MultiLineString"!==Le||(1===de.length?(Le="LineString",de=de[0]):Le="MultiLineString"),"Point"!==Le&&"MultiPoint"!==Le||(Le=3===de.length?"Point":"MultiPoint"),ce.push(Ds(Pe.id,Le,de,Pe.tags))}}}return ce.length?ce:null}function cu(Y,z,U,W,ne){for(var se=0;se<Y.length;se+=3){var me=Y[se+ne];me>=U&&me<=W&&(z.push(Y[se]),z.push(Y[se+1]),z.push(Y[se+2]))}}function el(Y,z,U,W,ne,se,me){for(var fe,ce,_e=Ql(Y),Pe=0===ne?ec:tl,We=Y.start,Le=0;Le<Y.length-3;Le+=3){var ot=Y[Le],Ze=Y[Le+1],de=Y[Le+2],De=Y[Le+3],Ft=Y[Le+4],nn=0===ne?ot:Ze,_t=0===ne?De:Ft,Bt=!1;me&&(fe=Math.sqrt(Math.pow(ot-De,2)+Math.pow(Ze-Ft,2))),nn<U?_t>U&&(ce=Pe(_e,ot,Ze,De,Ft,U),me&&(_e.start=We+fe*ce)):nn>W?_t<W&&(ce=Pe(_e,ot,Ze,De,Ft,W),me&&(_e.start=We+fe*ce)):Ts(_e,ot,Ze,de),_t<U&&nn>=U&&(ce=Pe(_e,ot,Ze,De,Ft,U),Bt=!0),_t>W&&nn<=W&&(ce=Pe(_e,ot,Ze,De,Ft,W),Bt=!0),!se&&Bt&&(me&&(_e.end=We+fe*ce),z.push(_e),_e=Ql(Y)),me&&(We+=fe)}var $t=Y.length-3;ot=Y[$t],Ze=Y[$t+1],de=Y[$t+2],(nn=0===ne?ot:Ze)>=U&&nn<=W&&Ts(_e,ot,Ze,de),$t=_e.length-3,se&&$t>=3&&(_e[$t]!==_e[0]||_e[$t+1]!==_e[1])&&Ts(_e,_e[0],_e[1],_e[2]),_e.length&&z.push(_e)}function Ql(Y){var z=[];return z.size=Y.size,z.start=Y.start,z.end=Y.end,z}function Jl(Y,z,U,W,ne,se){for(var me=0;me<Y.length;me++)el(Y[me],z,U,W,ne,se,!1)}function Ts(Y,z,U,W){Y.push(z),Y.push(U),Y.push(W)}function ec(Y,z,U,W,ne,se){var me=(se-z)/(W-z);return Y.push(se),Y.push(U+(ne-U)*me),Y.push(1),me}function tl(Y,z,U,W,ne,se){var me=(se-U)/(ne-U);return Y.push(z+(W-z)*me),Y.push(se),Y.push(1),me}function nl(Y,z){for(var U=[],W=0;W<Y.length;W++){var ne,se=Y[W],me=se.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)ne=Eo(se.geometry,z);else if("MultiLineString"===me||"Polygon"===me){ne=[];for(var fe=0;fe<se.geometry.length;fe++)ne.push(Eo(se.geometry[fe],z))}else if("MultiPolygon"===me)for(ne=[],fe=0;fe<se.geometry.length;fe++){for(var ce=[],_e=0;_e<se.geometry[fe].length;_e++)ce.push(Eo(se.geometry[fe][_e],z));ne.push(ce)}U.push(Ds(se.id,me,ne,se.tags))}return U}function Eo(Y,z){var U=[];U.size=Y.size,void 0!==Y.start&&(U.start=Y.start,U.end=Y.end);for(var W=0;W<Y.length;W+=3)U.push(Y[W]+z,Y[W+1],Y[W+2]);return U}function rl(Y,z){if(Y.transformed)return Y;var U,W,ne,se=1<<Y.z,me=Y.x,fe=Y.y;for(U=0;U<Y.features.length;U++){var ce=Y.features[U],_e=ce.geometry,Pe=ce.type;if(ce.geometry=[],1===Pe)for(W=0;W<_e.length;W+=2)ce.geometry.push(pi(_e[W],_e[W+1],z,se,me,fe));else for(W=0;W<_e.length;W++){var We=[];for(ne=0;ne<_e[W].length;ne+=2)We.push(pi(_e[W][ne],_e[W][ne+1],z,se,me,fe));ce.geometry.push(We)}}return Y.transformed=!0,Y}function pi(Y,z,U,W,ne,se){return[Math.round(U*(Y*W-ne)),Math.round(U*(z*W-se))]}function Wo(Y,z,U,W,ne){for(var se=z===ne.maxZoom?0:ne.tolerance/((1<<z)*ne.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:W,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<Y.length;fe++){me.numFeatures++,il(me,Y[fe],se,ne);var ce=Y[fe].minX,_e=Y[fe].minY,Pe=Y[fe].maxX,We=Y[fe].maxY;ce<me.minX&&(me.minX=ce),_e<me.minY&&(me.minY=_e),Pe>me.maxX&&(me.maxX=Pe),We>me.maxY&&(me.maxY=We)}return me}function il(Y,z,U,W){var ne=z.geometry,se=z.type,me=[];if("Point"===se||"MultiPoint"===se)for(var fe=0;fe<ne.length;fe+=3)me.push(ne[fe]),me.push(ne[fe+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===se)Xo(me,ne,Y,U,!1,!1);else if("MultiLineString"===se||"Polygon"===se)for(fe=0;fe<ne.length;fe++)Xo(me,ne[fe],Y,U,"Polygon"===se,0===fe);else if("MultiPolygon"===se)for(var ce=0;ce<ne.length;ce++){var _e=ne[ce];for(fe=0;fe<_e.length;fe++)Xo(me,_e[fe],Y,U,!0,0===fe)}if(me.length){var Pe=z.tags||null;if("LineString"===se&&W.lineMetrics){for(var We in Pe={},z.tags)Pe[We]=z.tags[We];Pe.mapbox_clip_start=ne.start/ne.size,Pe.mapbox_clip_end=ne.end/ne.size}var Le={geometry:me,type:"Polygon"===se||"MultiPolygon"===se?3:"LineString"===se||"MultiLineString"===se?2:1,tags:Pe};null!==z.id&&(Le.id=z.id),Y.features.push(Le)}}function Xo(Y,z,U,W,ne,se){var me=W*W;if(W>0&&z.size<(ne?me:W))U.numPoints+=z.length/3;else{for(var fe=[],ce=0;ce<z.length;ce+=3)(0===W||z[ce+2]>me)&&(U.numSimplified++,fe.push(z[ce]),fe.push(z[ce+1])),U.numPoints++;ne&&function(_e,Pe){for(var We=0,Le=0,ot=_e.length,Ze=ot-2;Le<ot;Ze=Le,Le+=2)We+=(_e[Le]-_e[Ze])*(_e[Le+1]+_e[Ze+1]);if(We>0===Pe)for(Le=0,ot=_e.length;Le<ot/2;Le+=2){var de=_e[Le],De=_e[Le+1];_e[Le]=_e[ot-2-Le],_e[Le+1]=_e[ot-1-Le],_e[ot-2-Le]=de,_e[ot-1-Le]=De}}(fe,se),Y.push(fe)}}function br(Y,z){var U=(z=this.options=function(ne,se){for(var me in se)ne[me]=se[me];return ne}(Object.create(this.options),z)).debug;if(U&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne,se,me,fe,ce,_e,W=function(ne,se){var me=[];if("FeatureCollection"===ne.type)for(var fe=0;fe<ne.features.length;fe++)Ja(me,ne.features[fe],se,fe);else Ja(me,"Feature"===ne.type?ne:{geometry:ne},se);return me}(Y,z);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ne=W,se=z,me=se.buffer/se.extent,fe=ne,ce=Br(ne,1,-1-me,me,0,-1,2,se),_e=Br(ne,1,1-me,2+me,0,-1,2,se),(ce||_e)&&(fe=Br(ne,1,-me,1+me,0,-1,2,se)||[],ce&&(fe=nl(ce,1).concat(fe)),_e&&(fe=fe.concat(nl(_e,-1)))),W=fe).length&&this.splitTile(W,0,0,0),U&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function la(Y,z,U){return 32*((1<<Y)*U+z)+Y}function ol(Y,z){const U=Y.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const W=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!W)return z(null,null);const ne=new ei(W.features);let se=Kt(ne);0===se.byteOffset&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),z(null,{vectorTile:ne,rawData:se.buffer})}br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},br.prototype.splitTile=function(Y,z,U,W,ne,se,me){for(var fe=[Y,z,U,W],ce=this.options,_e=ce.debug;fe.length;){W=fe.pop(),U=fe.pop(),z=fe.pop(),Y=fe.pop();var Pe=1<<z,We=la(z,U,W),Le=this.tiles[We];if(!Le&&(_e>1&&console.time("creation"),Le=this.tiles[We]=Wo(Y,z,U,W,ce),this.tileCoords.push({z,x:U,y:W}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,U,W,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var ot="z"+z;this.stats[ot]=(this.stats[ot]||0)+1,this.total++}if(Le.source=Y,ne){if(z===ce.maxZoom||z===ne)continue;var Ze=1<<ne-z;if(U!==Math.floor(se/Ze)||W!==Math.floor(me/Ze))continue}else if(z===ce.indexMaxZoom||Le.numPoints<=ce.indexMaxPoints)continue;if(Le.source=null,0!==Y.length){_e>1&&console.time("clipping");var de,De,Ft,nn,_t,Bt,$t=.5*ce.buffer/ce.extent,Ms=.5-$t,uo=.5+$t,je=1+$t;de=De=Ft=nn=null,_t=Br(Y,Pe,U-$t,U+uo,0,Le.minX,Le.maxX,ce),Bt=Br(Y,Pe,U+Ms,U+je,0,Le.minX,Le.maxX,ce),Y=null,_t&&(de=Br(_t,Pe,W-$t,W+uo,1,Le.minY,Le.maxY,ce),De=Br(_t,Pe,W+Ms,W+je,1,Le.minY,Le.maxY,ce),_t=null),Bt&&(Ft=Br(Bt,Pe,W-$t,W+uo,1,Le.minY,Le.maxY,ce),nn=Br(Bt,Pe,W+Ms,W+je,1,Le.minY,Le.maxY,ce),Bt=null),_e>1&&console.timeEnd("clipping"),fe.push(de||[],z+1,2*U,2*W),fe.push(De||[],z+1,2*U,2*W+1),fe.push(Ft||[],z+1,2*U+1,2*W),fe.push(nn||[],z+1,2*U+1,2*W+1)}}},br.prototype.getTile=function(Y,z,U){var W=this.options,ne=W.extent,se=W.debug;if(Y<0||Y>24)return null;var me=1<<Y,fe=la(Y,z=(z%me+me)%me,U);if(this.tiles[fe])return rl(this.tiles[fe],ne);se>1&&console.log("drilling down to z%d-%d-%d",Y,z,U);for(var ce,_e=Y,Pe=z,We=U;!ce&&_e>0;)_e--,Pe=Math.floor(Pe/2),We=Math.floor(We/2),ce=this.tiles[la(_e,Pe,We)];return ce&&ce.source?(se>1&&console.log("found parent tile z%d-%d-%d",_e,Pe,We),se>1&&console.time("drilling down"),this.splitTile(ce.source,_e,Pe,We,Y,z,U),se>1&&console.timeEnd("drilling down"),this.tiles[fe]?rl(this.tiles[fe],ne):null):null};class Ss extends p.VectorTileWorkerSource{constructor(z,U,W,ne,se){super(z,U,W,ne,ol),se&&(this.loadGeoJSON=se)}loadData(z,U){const W=z&&z.request,ne=W&&W.collectResourceTiming;this.loadGeoJSON(z,(se,me)=>{if(se||!me)return U(se);if("object"!=typeof me)return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{at(me,!0);try{if(z.filter){const ce=p.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ce.result)throw new Error(ce.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));const _e=me.features.filter(Pe=>ce.value.evaluate({zoom:0},Pe));me={type:"FeatureCollection",features:_e}}this._geoJSONIndex=z.cluster?new Ho(function({superclusterOptions:ce,clusterProperties:_e}){if(!_e||!ce)return ce;const Pe={},We={},Le={accumulated:null,zoom:0},ot={properties:null},Ze=Object.keys(_e);for(const de of Ze){const[De,Ft]=_e[de],nn=p.createExpression(Ft),_t=p.createExpression("string"==typeof De?[De,["accumulated"],["get",de]]:De);Pe[de]=nn.value,We[de]=_t.value}return ce.map=de=>{ot.properties=de;const De={};for(const Ft of Ze)De[Ft]=Pe[Ft].evaluate(Le,ot);return De},ce.reduce=(de,De)=>{ot.properties=De;for(const Ft of Ze)Le.accumulated=de[Ft],de[Ft]=We[Ft].evaluate(Le,ot)},ce}(z)).load(me.features):new br(ce=me,z.geojsonVtOptions)}catch(ce){return U(ce)}this.loaded={};const fe={};if(ne){const ce=p.getPerformanceMeasurement(W);ce&&(fe.resourceTiming={},fe.resourceTiming[z.source]=JSON.parse(JSON.stringify(ce)))}U(null,fe)}var ce})}reloadTile(z,U){const W=this.loaded;return W&&W[z.uid]?super.reloadTile(z,U):this.loadTile(z,U)}loadGeoJSON(z,U){if(z.request)p.getJSON(z.request,U);else{if("string"!=typeof z.data)return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(z.data))}catch(W){return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(W){U(W)}}getClusterChildren(z,U){try{U(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(W){U(W)}}getClusterLeaves(z,U){try{U(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(W){U(W)}}}class Is{constructor(z){this.self=z,this.actor=new p.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Ss},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,W)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=W},this.self.registerRTLTextPlugin=U=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=U.applyArabicShaping,p.plugin.processBidirectionalText=U.processBidirectionalText,p.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(z,U,W){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],W()}checkIfReady(z,U,W){W()}setReferrer(z,U){this.referrer=U}spriteLoaded(z,U){this.isSpriteLoaded[z]=U;for(const W in this.workerSources[z]){const ne=this.workerSources[z][W];for(const se in ne)ne[se]instanceof p.VectorTileWorkerSource&&(ne[se].isSpriteLoaded=U,ne[se].fire(new p.Event("isSpriteLoaded")))}}setImages(z,U,W){this.availableImages[z]=U;for(const ne in this.workerSources[z]){const se=this.workerSources[z][ne];for(const me in se)se[me].availableImages=U}W()}enableTerrain(z,U,W){this.terrain=U,W()}setProjection(z,U){this.projections[z]=p.getProjection(U)}setLayers(z,U,W){this.getLayerIndex(z).replace(U),W()}updateLayers(z,U,W){this.getLayerIndex(z).update(U.layers,U.removedIds),W()}loadTile(z,U,W){const ne=this.enableTerrain?p.extend({enableTerrain:this.terrain},U):U;ne.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,U.type,U.source).loadTile(ne,W)}loadDEMTile(z,U,W){const ne=this.enableTerrain?p.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(z,U.source).loadTile(ne,W)}reloadTile(z,U,W){const ne=this.enableTerrain?p.extend({enableTerrain:this.terrain},U):U;ne.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,U.type,U.source).reloadTile(ne,W)}abortTile(z,U,W){this.getWorkerSource(z,U.type,U.source).abortTile(U,W)}removeTile(z,U,W){this.getWorkerSource(z,U.type,U.source).removeTile(U,W)}removeSource(z,U,W){if(!this.workerSources[z]||!this.workerSources[z][U.type]||!this.workerSources[z][U.type][U.source])return;const ne=this.workerSources[z][U.type][U.source];delete this.workerSources[z][U.type][U.source],void 0!==ne.removeSource?ne.removeSource(U,W):W()}loadWorkerSource(z,U,W){try{this.self.importScripts(U.url),W()}catch(ne){W(ne.toString())}}syncRTLPluginState(z,U,W){try{p.plugin.setState(U);const ne=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=ne){this.self.importScripts(ne);const se=p.plugin.isParsed();W(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),se)}}catch(ne){W(ne.toString())}}getAvailableImages(z){let U=this.availableImages[z];return U||(U=[]),U}getLayerIndex(z){let U=this.layerIndexes[z];return U||(U=this.layerIndexes[z]=new Jr),U}getWorkerSource(z,U,W){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][U]||(this.workerSources[z][U]={}),this.workerSources[z][U][W]||(this.workerSources[z][U][W]=new this.workerSourceTypes[U]({send:(ne,se,me,fe,ce,_e)=>{this.actor.send(ne,se,me,z,ce,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][U][W]}getDEMWorkerSource(z,U){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][U]||(this.demWorkerSources[z][U]=new Fe),this.demWorkerSources[z][U]}enforceCacheSizeLimit(z,U){p.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(z,U,W){W(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Is(self)),Is}),au(0,function(p){var Vn=yo;function yo(f){return i=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(x);try{v=new Worker(D),g=!0}catch(S){g=!1}return v&&v.terminate(),URL.revokeObjectURL(D),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()||(void 0===Jr[u=i&&i.failIfMajorPerformanceCaveat]&&(Jr[u]=function(g){var v,D,S,A,x=(D=g,S=document.createElement("canvas"),(A=Object.create(yo.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,S.getContext("webgl",A)||S.getContext("experimental-webgl",A));if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch(D){return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),!0===x.getShaderParameter(v,x.COMPILE_STATUS))}(u)),!Jr[u]||document.documentMode));var i,u}var Jr={};function ze(f,i){if(Array.isArray(f)){if(!Array.isArray(i)||f.length!==i.length)return!1;for(let u=0;u<f.length;u++)if(!ze(f[u],i[u]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==i){if("object"!=typeof i||Object.keys(f).length!==Object.keys(i).length)return!1;for(const u in f)if(!ze(f[u],i[u]))return!1;return!0}return f===i}yo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Fe={create:function(f,i,u){const g=p.window.document.createElement(f);return void 0!==i&&(g.className=i),u&&u.appendChild(g),g},createNS:function(f,i){return p.window.document.createElementNS(f,i)}},at=p.window.document&&p.window.document.documentElement.style,Ni=at&&void 0!==at.userSelect?"userSelect":"WebkitUserSelect";let $o;Fe.disableDrag=function(){at&&Ni&&($o=at[Ni],at[Ni]="none")},Fe.enableDrag=function(){at&&Ni&&(at[Ni]=$o)},Fe.setTransform=function(f,i){f.style.transform=i};let ra=!1;try{const f=Object.defineProperty({},"passive",{get(){ra=!0}});p.window.addEventListener("test",f,f),p.window.removeEventListener("test",f,f)}catch(f){ra=!1}Fe.addEventListener=function(f,i,u,g={}){f.addEventListener(i,u,"passive"in g&&ra?g:g.capture)},Fe.removeEventListener=function(f,i,u,g={}){f.removeEventListener(i,u,"passive"in g&&ra?g:g.capture)};const vn=function(f){f.preventDefault(),f.stopPropagation(),p.window.removeEventListener("click",vn,!0)};function ei(f,i,u){const g=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new p.pointGeometry((u.clientX-i.left)*g,(u.clientY-i.top)*g)}function ia(f,i){var u=i[0],g=i[1],v=i[2],x=i[3],D=u*x-v*g;return D?(f[0]=x*(D=1/D),f[1]=-g*D,f[2]=-v*D,f[3]=u*D,f):null}Fe.suppressClick=function(){p.window.addEventListener("click",vn,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",vn,!0)},0)},Fe.mousePos=function(f,i){const u=f.getBoundingClientRect();return ei(f,u,i)},Fe.touchPos=function(f,i){const u=f.getBoundingClientRect(),g=[];for(let v=0;v<i.length;v++)g.push(ei(f,u,i[v]));return g},Fe.mouseButton=function(f){return void 0!==p.window.InstallTrigger&&2===f.button&&f.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},Fe.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};class Ti{constructor(i,u){this.pos=i,this.dir=u}intersectsPlane(i,u,g){const v=p.dot(u,this.dir);if(Math.abs(v)<1e-6)return!1;const x=p.dot(p.sub(p.create(),i,this.pos),u)/v,D=p.scaleAndAdd(p.create(),this.pos,this.dir,x);return p.copy(g,D),!0}}class Ui{constructor(i,u){this.points=i,this.planes=u}static fromInvProjectionMatrix(i,u,g){const v=Math.pow(2,g),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=p.transformMat4([],S,i),R=1/A[3]/u*v;return p.mul(A,A,[R,R,1/A[3],R])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=p.sub([],x[S[0]],x[S[1]]),R=p.sub([],x[S[2]],x[S[1]]),F=p.normalize([],p.cross([],A,R)),L=-p.dot(F,x[S[1]]);return F.concat(L)});return new Ui(x,D)}}class vo{constructor(i,u){this.min=i,this.max=u,this.center=p.scale([],p.add([],this.min,this.max),.5)}quadrant(i){const u=[i%2==0,i<2],g=p.clone(this.min),v=p.clone(this.max);for(let x=0;x<u.length;x++)g[x]=u[x]?this.min[x]:this.center[x],v[x]=u[x]?this.center[x]:this.max[x];return v[2]=this.max[2],new vo(g,v)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}intersects(i){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let v=0;v<i.planes.length;v++){const x=i.planes[v];let D=0;for(let S=0;S<u.length;S++)D+=p.dot$1(x,u[S])>=0;if(0===D)return 0;D!==u.length&&(g=!1)}if(g)return 2;for(let v=0;v<3;v++){let x=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let S=0;S<i.points.length;S++){const A=i.points[S][v]-this.min[v];x=Math.min(x,A),D=Math.max(D,A)}if(D<0||x>this.max[v]-this.min[v])return 0}return 1}}function Kt(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class xo extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,u){this._validate(i,u)&&(this.images[i]=u)}_validate(i,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new p.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),g=!1),g}_validateStretch(i,u){if(!i)return!0;let g=0;for(const v of i){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(i,u){return!(i&&(4!==i.length||i[0]<0||u.data.width<i[0]||i[1]<0||u.data.height<i[1]||i[2]<0||u.data.width<i[2]||i[3]<0||u.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,u){u.version=this.images[i].version+1,this.images[i]=u,this.updatedImages[i]=!0}removeImage(i){const u=this.images[i];delete this.images[i],delete this.patterns[i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,u){let g=!0;if(!this.isLoaded())for(const v of i)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(i,u):this.requestors.push({ids:i,callback:u})}_notify(i,u){const g={};for(const v of i){this.images[v]||this.fire(new p.Event("styleimagemissing",{id:v}));const x=this.images[v];x?g[v]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:p.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:i,height:u}=this.atlasImage;return{width:i,height:u}}getPattern(i){const u=this.patterns[i],g=this.getImage(i);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},x=new p.ImagePosition(v,g);this.patterns[i]={bin:v,position:x}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const u=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(i,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const x in this.patterns)i.push(this.patterns[x].bin);const{w:u,h:g}=p.potpack(i),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const x in this.patterns){const{bin:D}=this.patterns[x],S=D.x+1,A=D.y+1,R=this.images[x].data,F=R.width,L=R.height;p.RGBAImage.copy(R,v,{x:0,y:0},{x:S,y:A},{width:F,height:L}),p.RGBAImage.copy(R,v,{x:0,y:L-1},{x:S,y:A-1},{width:F,height:1}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:S,y:A+L},{width:F,height:1}),p.RGBAImage.copy(R,v,{x:F-1,y:0},{x:S-1,y:A},{width:1,height:L}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:S+F,y:A},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const u of i){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];Kt(g)&&this.updateImage(u,g)}}}const Go=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(f,i){return function([u,g,v]){const x=p.degToRad(g+90),D=p.degToRad(v);return{x:u*Math.cos(x)*Math.sin(D),y:u*Math.sin(x)*Math.sin(D),z:u*Math.cos(D),azimuthal:g,polar:v}}(f.expression.evaluate(i))}interpolate(f,i,u){return{x:p.number(f.x,i.x,u),y:p.number(f.y,i.y,u),z:p.number(f.z,i.z,u),azimuthal:p.number(f.azimuthal,i.azimuthal,u),polar:p.number(f.polar,i.polar,u)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),bs="-transition";class zn extends p.Evented{constructor(i){super(),this._transitionable=new p.Transitionable(Go),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u={}){if(!this._validate(p.validateLight,i,u))for(const g in i){const v=i[g];p.endsWith(g,bs)?this._transitionable.setTransition(g.slice(0,-bs.length),v):this._transitionable.setValue(g,v)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,i.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const lu=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),bo="-transition";class Vi extends p.Evented{constructor(i){super(),this._transitionable=new p.Transitionable(lu),this.set(i),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(i){for(const u in i){const g=i[u];p.endsWith(u,bo)?this._transitionable.setTransition(u.slice(0,-bo.length),g):this._transitionable.setValue(u,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function Xl(f,i,u,g){const v=p.smoothstep(45,65,u),[x,D]=oa(f,g),S=p.length(i);let A=1-Math.min(1,Math.exp((S-x)/(D-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*v*f.alpha}function oa(f,i){const u=.5/Math.tan(.5*i);return[f.range[0]+u,f.range[1]+u]}const xn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"])}),qo="-transition";class wo extends p.Evented{constructor(i,u){super(),this._transitionable=new p.Transitionable(xn),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=u}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,u={}){if(!this._validate(p.validateFog,i,u))for(const g in i){const v=i[g];p.endsWith(g,qo)?this._transitionable.setTransition(g.slice(0,-qo.length),v):this._transitionable.setValue(g,v)}}getOpacity(i){if(this.isSoftDisabled())return 0;const u=this.properties&&this.properties.get("color")||1;return p.smoothstep(45,65,i)*u.a}getOpacityAtLatLng(i,u){return this.isSoftDisabled()?0:function(g,v,x){const D=p.MercatorCoordinate.fromLngLat(v),S=x.elevation?x.elevation.getAtPointOrZero(D):0,A=[D.x,D.y,S];return p.transformMat4$1(A,A,x.mercatorFogMatrix),Xl(g,A,x.pitch,x._fov)}(this.state,i,u)}getFovAdjustedRange(i){return this.isSoftDisabled()?[0,1]:oa(this.state,i)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,i.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class co{constructor(i,u){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const x=new co.Actor(g[v],u,this.id);x.name=`Worker ${v}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,u,g){p.asyncAll(this.actors,(v,x)=>{v.send(i,u,x)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dr(f,i,u){return i*(p.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}co.Actor=p.Actor;class ti{constructor(i,u,g,v){this.screenBounds=i,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>v.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,u){let g,v;if(i instanceof p.pointGeometry||"number"==typeof i[0]){const x=p.pointGeometry.convert(i);g=[p.pointGeometry.convert(i)],v=u.isPointAboveHorizon(x)}else{const x=p.pointGeometry.convert(i[0]),D=p.pointGeometry.convert(i[1]);g=[x,D],v=p.polygonizeBounds(x,D).every(S=>u.isPointAboveHorizon(S))}return new ti(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],v=p.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),p.bufferConvexPolygon(v,i)}containsTile(i,u,g){const v=i.queryPadding+1,x=i.tileID.wrap,D=g?this._bufferedCameraMercator(v,u).map(X=>p.getTilePoint(i.tileTransform,X,x)):this._bufferedScreenMercator(v,u).map(X=>p.getTilePoint(i.tileTransform,X,x)),S=this.screenGeometryMercator.map(X=>p.getTileVec3(i.tileTransform,X,x)),A=S.map(X=>new p.pointGeometry(X[0],X[1])),R=u.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),F=p.getTileVec3(i.tileTransform,R,x),L=S.map(X=>{const q=p.sub(X,X,F);return p.normalize(q,q),new Ti(F,q)}),j=dr(i,1,u.zoom);if(p.polygonIntersectsBox(D,0,0,p.EXTENT,p.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:L,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(G=p.getBounds(D),G.min.x=p.clamp(G.min.x,0,p.EXTENT),G.min.y=p.clamp(G.min.y,0,p.EXTENT),G.max.x=p.clamp(G.max.x,0,p.EXTENT),G.max.y=p.clamp(G.max.y,0,p.EXTENT),G),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:j};var G}_bufferedScreenMercator(i,u){const g=Pn(i);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const v=this.bufferedScreenGeometry(i).map(x=>u.pointCoordinate3D(x));return this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(i,u){const g=Pn(i);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const v=this.bufferedCameraGeometry(i).map(x=>u.pointCoordinate3D(x));return this._cameraRaycastCache[g]=v,v}}}function Pn(f){return 100*f|0}function di(f,i,u){const g=function(v,x){if(v)return u(v);if(x){const D=p.pick(p.extend(x,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(D.vectorLayers=x.vector_layers,D.vectorLayerIds=D.vectorLayers.map(S=>S.id)),D.tiles=i.canonicalizeTileset(D,f.url),u(null,D)}};return f.url?p.getJSON(i.transformRequest(i.normalizeSourceURL(f.url),p.ResourceType.Source),g):p.exported.frame(()=>g(null,f))}class er{constructor(i,u,g){this.bounds=p.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),g=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),x=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),D=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=g&&i.x<x&&i.y>=v&&i.y<D}}class En{constructor(i,u,g){this.context=i;const v=i.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const an={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ho{constructor(i,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=i;const x=i.gl;this.buffer=x.createBuffer(),i.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,u,g){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],D=u.attributes[x.name];void 0!==D&&i.vertexAttribPointer(D,x.components,i[an[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ws extends Xt{getDefault(){return p.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ya extends Xt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Yl extends Xt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class sa extends Xt{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Si extends Xt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class aa extends Xt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class zt extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Zo extends Xt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Es extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class ji extends Xt{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ka extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class Ds extends Xt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Qa extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class Ja extends Xt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ii extends Xt{getDefault(){return p.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Mi extends Xt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Cs extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class Kl extends Xt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class $i extends Xt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Br extends Xt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class cu extends Xt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class el extends Xt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ql extends Xt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Jl extends Xt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ts extends Xt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class ec extends Xt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class tl extends Xt{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class nl extends Xt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Eo extends Xt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class rl extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class pi extends Xt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Wo extends Xt{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class il extends Wo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Xo extends Wo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class br extends Xo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class la{constructor(i,u,g,v){this.context=i,this.width=u,this.height=g;const x=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new il(i,x),v&&(this.depthAttachment=new Xo(i,x))}destroy(){const i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&i.deleteRenderbuffer(g)}i.deleteFramebuffer(this.framebuffer)}}class ol{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ws(this),this.clearDepth=new Ya(this),this.clearStencil=new Yl(this),this.colorMask=new sa(this),this.depthMask=new Si(this),this.stencilMask=new aa(this),this.stencilFunc=new zt(this),this.stencilOp=new Zo(this),this.stencilTest=new Es(this),this.depthRange=new ji(this),this.depthTest=new Ka(this),this.depthFunc=new Ds(this),this.blend=new Qa(this),this.blendFunc=new Ja(this),this.blendColor=new Ii(this),this.blendEquation=new Mi(this),this.cullFace=new Cs(this),this.cullFaceSide=new Kl(this),this.frontFace=new $i(this),this.program=new Br(this),this.activeTexture=new cu(this),this.viewport=new el(this),this.bindFramebuffer=new Ql(this),this.bindRenderbuffer=new Jl(this),this.bindTexture=new Ts(this),this.bindVertexBuffer=new ec(this),this.bindElementBuffer=new tl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new nl(this),this.pixelStoreUnpack=new Eo(this),this.pixelStoreUnpackPremultiplyAlpha=new rl(this),this.pixelStoreUnpackFlipY=new pi(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u){return new En(this,i,u)}createVertexBuffer(i,u,g){return new Ho(this,i,u,g)}createRenderbuffer(i,u,g){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,i,u,g),this.bindRenderbuffer.set(null),x}createFramebuffer(i,u,g){return new la(this,i,u,g)}clear({color:i,depth:u,stencil:g}){const v=this.gl;let x=0;i&&(x|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(x|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(x|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(x)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){ze(i.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ss extends p.Evented{constructor(i,u,g,v){super(),this.id=i,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},u),p.extend(this,p.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=di(this._options,this.map._requestManager,(i,u)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new p.ErrorEvent(i)):u&&(p.extend(this,u),u.bounds&&(this.tileBounds=new er(u.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(u.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,u){const g=p.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);i.request=p.getImage(this.map._requestManager.transformRequest(v,p.ResourceType.Tile),(x,D,S,A)=>{if(delete i.request,i.aborted)i.state="unloaded",u(null);else if(x)i.state="errored",u(x);else if(D){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:A});const R=this.map.painter.context,F=R.gl;i.texture=this.map.painter.getTileTexture(D.width),i.texture?i.texture.update(D,{useMipmap:!0}):(i.texture=new p.Texture(R,D,F.RGBA,{useMipmap:!0}),i.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE),R.extTextureFilterAnisotropic&&F.texParameterf(F.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),i.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(i,u){i.request&&(i.request.cancel(),delete i.request),u()}unloadTile(i,u){i.texture&&this.map.painter.saveTileTexture(i.texture),u()}hasTransition(){return!1}}let Is;class Y extends p.Evented{constructor(i,u,g,v){super(),this.id=i,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(i,u){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(g,v)=>{this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):v&&(this.image=p.exported.getImageData(v),i&&(this.coordinates=i),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const u=i.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,x=1/0,D=-1/0,S=-1/0;for(const L of g)v=Math.min(v,L.x),x=Math.min(x,L.y),D=Math.max(D,L.x),S=Math.max(S,L.y);const A=Math.max(D-v,S-x),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),F=Math.pow(2,R);return new p.CanonicalTileID(R,Math.floor((v+D)/2*F),Math.floor((x+S)/2*F))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=p.tileTransform(this.tileID,this.map.transform.projection),u=this.coordinates.map(g=>{const v=i.projection.project(g[0],g[1]);return p.getTilePoint(i,v)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(u[2].x,u[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,u=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(i,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}loadTile(i,u){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},u(null)):(i.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const z={vector:class extends p.Evented{constructor(f,i,u,g){if(super(),this.id=f,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(i,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=di(this._options,this.map._requestManager,(f,i)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new p.ErrorEvent(f)):i&&(p.extend(this,i),i.bounds&&(this.tileBounds=new er(i.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const i=this.map.style._getSourceCaches(this.id);for(const u of i)u.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}loadTile(f,i){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,p.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=i:f.request=f.actor.send("reloadTile",g,v.bind(this));else if(f.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const x=p.loadVectorTile.call({deduped:this._deduped},g,(D,S)=>{D||!S?v.call(this,D):(g.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},f.actor&&f.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);f.request={cancel:x}}function v(x,D){return delete f.request,f.aborted?i(null):x&&404!==x.status?i(x):(D&&D.resourceTiming&&(f.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&f.setExpiryData(D),f.loadVectorData(D,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ss,"raster-dem":class extends Ss{constructor(f,i,u,g){super(f,i,u,g),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(f.state="errored",i(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=p.getImage(this.map._requestManager.transformRequest(u,p.ResourceType.Tile),function(v,x,D,S){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(v)f.state="errored",i(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:D,expires:S});const A=p.window.ImageBitmap&&x instanceof p.window.ImageBitmap&&(null==Is&&(Is=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Is),R=1-(x.width-p.prevPowerOfTwo(x.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const F=A?x:p.exported.getImageData(x,R),L={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:R};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",L,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const i=f.canonical,u=Math.pow(2,i.z),g=(i.x-1+u)%u,v=0===i.x?f.wrap-1:f.wrap,x=(i.x+1+u)%u,D=i.x+1===u?f.wrap+1:f.wrap,S={};return S[new p.OverscaledTileID(f.overscaledZ,v,i.z,g,i.y).key]={backfilled:!1},S[new p.OverscaledTileID(f.overscaledZ,D,i.z,x,i.y).key]={backfilled:!1},i.y>0&&(S[new p.OverscaledTileID(f.overscaledZ,v,i.z,g,i.y-1).key]={backfilled:!1},S[new p.OverscaledTileID(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new p.OverscaledTileID(f.overscaledZ,D,i.z,x,i.y-1).key]={backfilled:!1}),i.y+1<u&&(S[new p.OverscaledTileID(f.overscaledZ,v,i.z,g,i.y+1).key]={backfilled:!1},S[new p.OverscaledTileID(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new p.OverscaledTileID(f.overscaledZ,D,i.z,x,i.y+1).key]={backfilled:!1}),S}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends p.Evented{constructor(f,i,u,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=i.data,this._options=p.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const v=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*v,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*v,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},i),this}getClusterLeaves(f,i,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:i,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=p.extend({},this.workerOptions),i=this._data;"string"==typeof i?(f.request=this.map._requestManager.transformRequest(p.exported.resolveURL(i),p.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new p.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new p.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,i){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?i(null):g?i(g):(f.loadVectorData(v,this.map.painter,"reloadTile"===u),i(null))),void 0,"loadTile"===u)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Y{constructor(f,i,u,g){super(f,i,u,g),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,p.ResourceType.Source).url);p.getVideo(this.urls,(i,u)=>{this._loaded=!0,i?this.fire(new p.ErrorEvent(i)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(f,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const u in this.tiles){const g=this.tiles[u];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Y,canvas:class extends Y{constructor(f,i,u,g){super(f,i,u,g),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(x=>"number"!=typeof x))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,u=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(i,this.canvas,u.RGBA,{premultiply:!0});for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},U=function(f,i,u,g){const v=new z[i.type](f,i,u,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],v),v};function W(f,i){const u=p.identity([]);return p.scale$1(u,u,[.5*f.width,.5*-f.height,1]),p.translate(u,u,[1,-1,0]),p.multiply(u,u,f.calculateProjMatrix(i.toUnwrapped()))}function ne(f,i,u,g,v,x,D,S=!1){const A=f.tilesIn(g,D,S);A.sort(me);const R=[];for(const L of A)R.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(i,u,f._state,L,v,x,W(f.transform,L.tile.tileID),S)});const F=function(L){const j={},G={};for(const X of L){const q=X.queryResults,J=X.wrappedTileID,H=G[J]=G[J]||{};for(const ee in q){const re=q[ee],Z=H[ee]=H[ee]||{},ie=j[ee]=j[ee]||[];for(const le of re)Z[le.featureIndex]||(Z[le.featureIndex]=!0,ie.push(le))}}return j}(R);for(const L in F)F[L].forEach(j=>{const G=j.feature,X=f.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=X});return F}function se(f,i){const u=f.getRenderableIds().map(x=>f.getTileByID(x)),g=[],v={};for(let x=0;x<u.length;x++){const D=u[x],S=D.tileID.canonical.key;v[S]||(v[S]=!0,D.querySourceFeatures(g,i))}return g}function me(f,i){const u=f.tileID,g=i.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function fe(){return null!=Ns.workerClass?new Ns.workerClass:new p.window.Worker(Ns.workerUrl)}const ce="mapboxgl_preloaded_worker_pool";class _e{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<_e.workerCount;)this.workers.push(new fe);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ce]}numActive(){return Object.keys(this.active).length}}let Pe;function We(){return Pe||(Pe=new _e),Pe}function Le(f,i){const u={};for(const g in f)"ref"!==g&&(u[g]=f[g]);return p.refProperties.forEach(g=>{g in i&&(u[g]=i[g])}),u}function ot(f){f=f.slice();const i=Object.create(null);for(let u=0;u<f.length;u++)i[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=Le(f[u],i[f[u].ref]));return f}_e.workerCount=2;const Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function de(f,i,u){u.push({command:Ze.addSource,args:[f,i[f]]})}function De(f,i,u){i.push({command:Ze.removeSource,args:[f]}),u[f]=!0}function Ft(f,i,u,g){De(f,u,g),de(f,i,u)}function nn(f,i,u){let g;for(g in f[u])if(f[u].hasOwnProperty(g)&&"data"!==g&&!ze(f[u][g],i[u][g]))return!1;for(g in i[u])if(i[u].hasOwnProperty(g)&&"data"!==g&&!ze(f[u][g],i[u][g]))return!1;return!0}function _t(f,i,u,g,v,x){let D;for(D in i=i||{},f=f||{})f.hasOwnProperty(D)&&(ze(f[D],i[D])||u.push({command:x,args:[g,D,i[D],v]}));for(D in i)i.hasOwnProperty(D)&&!f.hasOwnProperty(D)&&(ze(f[D],i[D])||u.push({command:x,args:[g,D,i[D],v]}))}function Bt(f){return f.id}function $t(f,i){return f[i.id]=i,f}class Ms{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=p.clamp(i,0,1);let u=1,g=this._distances[u];const v=i*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const x=u-1,D=this._distances[x],S=g-D,A=S>0?(v-D)/S:0;return this.points[x].mult(1-A).add(this.points[u].mult(A))}}class uo{constructor(i,u,g){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/g),this.yCellCount=Math.ceil(u/g);for(let D=0;D<this.xCellCount*this.yCellCount;D++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,g,v,x){this._forEachCell(u,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(i,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(i,u,g,v,x,D){this.boxCells[x].push(D)}_insertCircleCell(i,u,g,v,x,D){this.circleCells[x].push(D)}_query(i,u,g,v,x,D){if(g<0||i>this.width||v<0||u>this.height)return!x&&[];const S=[];if(i<=0&&u<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],F=this.circles[3*A+1],L=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:R-L,y1:F-L,x2:R+L,y2:F+L})}return D?S.filter(D):S}return this._forEachCell(i,u,g,v,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},D),x?S.length>0:S}_queryCircle(i,u,g,v,x){const D=i-g,S=i+g,A=u-g,R=u+g;if(S<0||D>this.width||R<0||A>this.height)return!v&&[];const F=[];return this._forEachCell(D,A,S,R,this._queryCellCircle,F,{hitTest:v,circle:{x:i,y:u,radius:g},seenUids:{box:{},circle:{}}},x),v?F.length>0:F}query(i,u,g,v,x){return this._query(i,u,g,v,!1,x)}hitTest(i,u,g,v,x){return this._query(i,u,g,v,!0,x)}hitTestCircle(i,u,g,v){return this._queryCircle(i,u,g,!0,v)}_queryCell(i,u,g,v,x,D,S,A){const R=S.seenUids,F=this.boxCells[x];if(null!==F){const j=this.bboxes;for(const G of F)if(!R.box[G]){R.box[G]=!0;const X=4*G;if(i<=j[X+2]&&u<=j[X+3]&&g>=j[X+0]&&v>=j[X+1]&&(!A||A(this.boxKeys[G]))){if(S.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[G],x1:j[X],y1:j[X+1],x2:j[X+2],y2:j[X+3]})}}}const L=this.circleCells[x];if(null!==L){const j=this.circles;for(const G of L)if(!R.circle[G]){R.circle[G]=!0;const X=3*G;if(this._circleAndRectCollide(j[X],j[X+1],j[X+2],i,u,g,v)&&(!A||A(this.circleKeys[G]))){if(S.hitTest)return D.push(!0),!0;{const q=j[X],J=j[X+1],H=j[X+2];D.push({key:this.circleKeys[G],x1:q-H,y1:J-H,x2:q+H,y2:J+H})}}}}}_queryCellCircle(i,u,g,v,x,D,S,A){const R=S.circle,F=S.seenUids,L=this.boxCells[x];if(null!==L){const G=this.bboxes;for(const X of L)if(!F.box[X]){F.box[X]=!0;const q=4*X;if(this._circleAndRectCollide(R.x,R.y,R.radius,G[q+0],G[q+1],G[q+2],G[q+3])&&(!A||A(this.boxKeys[X])))return D.push(!0),!0}}const j=this.circleCells[x];if(null!==j){const G=this.circles;for(const X of j)if(!F.circle[X]){F.circle[X]=!0;const q=3*X;if(this._circlesCollide(G[q],G[q+1],G[q+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[X])))return D.push(!0),!0}}}_forEachCell(i,u,g,v,x,D,S,A){const R=this._convertToXCellCoord(i),F=this._convertToYCellCoord(u),L=this._convertToXCellCoord(g),j=this._convertToYCellCoord(v);for(let G=R;G<=L;G++)for(let X=F;X<=j;X++)if(x.call(this,i,u,g,v,this.xCellCount*X+G,D,S,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,g,v,x,D){const S=v-i,A=x-u,R=g+D;return R*R>S*S+A*A}_circleAndRectCollide(i,u,g,v,x,D,S){const A=(D-v)/2,R=Math.abs(i-(v+A));if(R>A+g)return!1;const F=(S-x)/2,L=Math.abs(u-(x+F));if(L>F+g)return!1;if(R<=A||L<=F)return!0;const j=R-A,G=L-F;return j*j+G*G<=g*g}}const je=Math.tan(85*Math.PI/180);function Pt(f,i,u,g,v){const x=p.create$1();if(i){const D=ia([],v);x[0]=D[0],x[1]=D[1],x[4]=D[2],x[5]=D[3],u||p.rotateZ(x,x,g.angle)}else p.multiply(x,g.labelPlaneMatrix,f);return x}function Dt(f,i,u,g,v){if(i){const x=p.clone$1(f),D=p.identity([]);return D[0]=v[0],D[1]=v[1],D[4]=v[2],D[5]=v[3],p.multiply(x,x,D),u||p.rotateZ(x,x,-g.angle),x}return g.glCoordMatrix}function Zn(f,i,u=0){const g=[f.x,f.y,u,1];u?p.transformMat4(g,g,i):ua(g,g,i);const v=g[3];return{point:new p.pointGeometry(g[0]/v,g[1]/v),signedDistanceFromCamera:v}}function Do(f,i){return Math.min(.5+f/i*.5,1.5)}function rt(f,i){const u=f[0]/f[3],g=f[1]/f[3];return u>=-i[0]&&u<=i[0]&&g>=-i[1]&&g<=i[1]}function ca(f,i,u,g,v,x,D,S,A){const R=g?f.textSizeData:f.iconSizeData,F=p.evaluateSizeForZoom(R,u.transform.zoom),L=[256/u.width*2+1,256/u.height*2+1],j=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;j.clear();const G=f.lineVertexArray,X=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,q=u.transform.width/u.transform.height;let J=!1;for(let H=0;H<X.length;H++){const ee=X.get(H);if(ee.writingMode!==p.WritingMode.vertical||J||0!==H&&X.get(H-1).writingMode===p.WritingMode.horizontal||(J=!0),ee.hidden||ee.writingMode===p.WritingMode.vertical&&!J){kt(ee.numGlyphs,j);continue}J=!1;const re=new p.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),Z=A?A(re):0,ie=[re.x,re.y,Z],le=[...ie,1];if(p.transformMat4(le,le,i),!rt(le,L)){kt(ee.numGlyphs,j);continue}const be=Do(u.transform.cameraToCenterDistance,le[3]),xe=p.evaluateSizeForFeature(R,F,ee),Te=D?xe/be:xe*be,Ee=Zn(new p.pointGeometry(ie[0],ie[1]),v,ie[2]);if(Ee.signedDistanceFromCamera<=0){kt(ee.numGlyphs,j);continue}let Ve={};const Ce=D?null:A,qe=fi(ee,Te,!1,S,i,v,x,f.glyphOffsetArray,G,j,Ee.point,re,Ve,q,Ce);J=qe.useVertical,Ce&&qe.needsFlipping&&(Ve={}),(qe.notEnoughRoom||J||qe.needsFlipping&&fi(ee,Te,!0,S,i,v,x,f.glyphOffsetArray,G,j,Ee.point,re,Ve,q,Ce).notEnoughRoom)&&kt(ee.numGlyphs,j)}g?f.text.dynamicLayoutVertexBuffer.updateData(j):f.icon.dynamicLayoutVertexBuffer.updateData(j)}function Qt(f,i,u,g,v,x,D,S,A,R,F,L,j){const G=S.glyphStartIndex+S.numGlyphs,X=S.lineStartIndex,q=S.lineStartIndex+S.lineLength,J=i.getoffsetX(S.glyphStartIndex),H=i.getoffsetX(G-1),ee=Co(f*J,u,g,v,x,D,S.segment,X,q,A,R,F,L,j,!0);if(!ee)return null;const re=Co(f*H,u,g,v,x,D,S.segment,X,q,A,R,F,L,j,!0);return re?{first:ee,last:re}:null}function Yo(f,i,u,g){return f.writingMode===p.WritingMode.horizontal&&Math.abs(u.y-i.y)>Math.abs(u.x-i.x)*g?{useVertical:!0}:f.writingMode===p.WritingMode.vertical?i.y<u.y?{needsFlipping:!0}:null:0!==f.flipState&&function(v,x,D){const S=(x.x-v.x)*D;return 0===S||Math.abs((x.y-v.y)/S)>je}(i,u,g)?1===f.flipState?{needsFlipping:!0}:null:i.x>u.x?{needsFlipping:!0}:null}function fi(f,i,u,g,v,x,D,S,A,R,F,L,j,G,X){const q=i/24,J=f.lineOffsetX*q,H=f.lineOffsetY*q;let ee;if(f.numGlyphs>1){const re=f.glyphStartIndex+f.numGlyphs,Z=f.lineStartIndex,ie=f.lineStartIndex+f.lineLength,le=Qt(q,S,J,H,u,F,L,f,A,x,j,X,!1);if(!le)return{notEnoughRoom:!0};const be=Zn(le.first.point,D).point,xe=Zn(le.last.point,D).point;if(g&&!u){const Te=Yo(f,be,xe,G);if(f.flipState=Te&&Te.needsFlipping?1:2,Te)return Te}ee=[le.first];for(let Te=f.glyphStartIndex+1;Te<re-1;Te++)ee.push(Co(q*S.getoffsetX(Te),J,H,u,F,L,f.segment,Z,ie,A,x,j,X,!1,!1));ee.push(le.last)}else{if(g&&!u){const Z=Zn(L,v).point,ie=f.lineStartIndex+f.segment+1,le=new p.pointGeometry(A.getx(ie),A.gety(ie)),be=Zn(le,v),xe=Yo(f,Z,be.signedDistanceFromCamera>0?be.point:Mt(L,le,Z,1,v,void 0),G);if(f.flipState=xe&&xe.needsFlipping?1:2,xe)return xe}const re=Co(q*S.getoffsetX(f.glyphStartIndex),J,H,u,F,L,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,A,x,j,X,!1,!1);if(!re)return{notEnoughRoom:!0};ee=[re]}for(const re of ee)p.addDynamicAttributes(R,re.point,re.angle);return{}}function Dn(f,i,u){const g={x:f.x,y:f.y,z:0};if(!u)return Zn(g,i,g.z);const v=u(f);return Zn(new p.pointGeometry(g.x,g.y),i,g.z+v)}function Mt(f,i,u,g,v,x){const D=Dn(f.add(f.sub(i)._unit()),v,x).point,S=u.sub(D);return u.add(S._mult(g/S.mag()))}function Co(f,i,u,g,v,x,D,S,A,R,F,L,j,G,X){const q=g?f-i:f+i;let J=q>0?1:-1,H=0;g&&(J*=-1,H=Math.PI),J<0&&(H+=Math.PI);let ee=J>0?S+D:S+D+1,re=v,Z=v,ie=0,le=0;const be=Math.abs(q),xe=[],Te=[];let Ee=x;const Ve=()=>{const ct=ee-J;return 0===ie?x:new p.pointGeometry(R.getx(ct),R.gety(ct))},Ce=()=>Mt(Ve(),Ee,Z,be-ie+1,F,j);for(;ie+le<=be;){if(ee+=J,ee<S||ee>=A)return null;if(Z=re,xe.push(re),G&&Te.push(Ee||Ve()),re=L[ee],void 0===re){Ee=new p.pointGeometry(R.getx(ee),R.gety(ee));const ct=Dn(Ee,F,j);re=ct.signedDistanceFromCamera>0?L[ee]=ct.point:Ce()}else Ee=null;ie+=le,le=Z.dist(re)}X&&j&&(Ee=Ee||new p.pointGeometry(R.getx(ee),R.gety(ee)),L[ee]=re=void 0===L[ee]?re:Ce(),le=Z.dist(re));const qe=(be-ie)/le,ye=re.sub(Z),He=ye.mult(qe)._add(Z);u&&He._add(ye._unit()._perp()._mult(u*J));const nt=H+Math.atan2(re.y-Z.y,re.x-Z.x);return xe.push(He),G&&(Ee=Ee||new p.pointGeometry(R.getx(ee),R.gety(ee)),Te.push(function(ct,ft,mt){const dt=1-mt;return new p.pointGeometry(ct.x*dt+ft.x*mt,ct.y*dt+ft.y*mt)}(Te.length>0?Te[Te.length-1]:Ee,Ee,qe))),{point:He,angle:nt,path:xe,tilePath:Te}}const bh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function kt(f,i){for(let u=0;u<f;u++){const g=i.length;i.resize(g+4),i.float32.set(bh,3*g)}}function ua(f,i,u){const g=i[0],v=i[1];return f[0]=u[0]*g+u[4]*v+u[12],f[1]=u[1]*g+u[5]*v+u[13],f[3]=u[3]*g+u[7]*v+u[15],f}const ht=100;class yt{constructor(i,u,g=new uo(i.width+200,i.height+200,25),v=new uo(i.width+200,i.height+200,25)){this.transform=i,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+ht,this.screenBottomBoundary=i.height+ht,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=u}placeCollisionBox(i,u,g,v,x,D,S){let A=u.projectedAnchorZ;u.elevation&&(A+=u.elevation);const R=this.projectAndGetPerspectiveRatio(D,u.projectedAnchorX,u.projectedAnchorY,A,u.tileID),F=x*R.perspectiveRatio,L=(u.x1*i+g.x-u.padding)*F+R.point.x,j=(u.y1*i+g.y-u.padding)*F+R.point.y,G=(u.x2*i+g.x+u.padding)*F+R.point.x,X=(u.y2*i+g.y+u.padding)*F+R.point.y,q=R.perspectiveRatio<=.55||R.aboveHorizon;return!this.isInsideGrid(L,j,G,X)||!v&&this.grid.hitTest(L,j,G,X,S)||q?{box:[],offscreen:!1}:{box:[L,j,G,X],offscreen:this.isOffscreen(L,j,G,X)}}placeCollisionCircles(i,u,g,v,x,D,S,A,R,F,L,j,G,X){const q=[],J=this.transform.elevation,H=J?Ce=>J.getAtTileOffset(X,Ce.x,Ce.y):Ce=>0,ee=new p.pointGeometry(u.tileAnchorX,u.tileAnchorY),re=H(ee),Z=this.projectAndGetPerspectiveRatio(D,ee.x,ee.y,re,X),{perspectiveRatio:ie}=Z,le=(F?x/ie:x*ie)/p.ONE_EM,be=Zn(ee,S,re).point,xe=Z.signedDistanceFromCamera>0?Qt(le,v,u.lineOffsetX*le,u.lineOffsetY*le,!1,be,ee,u,g,S,{},J&&!F?H:null,F&&!!J):null;let Te=!1,Ee=!1,Ve=!0;if(xe&&!Z.aboveHorizon){const Ce=.5*j*ie+G,qe=new p.pointGeometry(-100,-100),ye=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),He=new Ms,nt=xe.first,ct=xe.last;let ft=[];for(let lt=nt.path.length-1;lt>=1;lt--)ft.push(nt.path[lt]);for(let lt=1;lt<ct.path.length;lt++)ft.push(ct.path[lt]);const mt=2.5*Ce;if(A){const lt=ft.map(J?(vt,Zt)=>{const Kn=H(Zt<nt.path.length-1?nt.tilePath[nt.path.length-1-Zt]:ct.tilePath[Zt-nt.path.length+2]);return Zn(vt,A,Kn)}:vt=>Zn(vt,A));ft=lt.some(vt=>vt.signedDistanceFromCamera<=0)?[]:lt.map(vt=>vt.point)}let dt=[];if(ft.length>0){const lt=ft[0].clone(),vt=ft[0].clone();for(let Zt=1;Zt<ft.length;Zt++)lt.x=Math.min(lt.x,ft[Zt].x),lt.y=Math.min(lt.y,ft[Zt].y),vt.x=Math.max(vt.x,ft[Zt].x),vt.y=Math.max(vt.y,ft[Zt].y);dt=lt.x>=qe.x&&vt.x<=ye.x&&lt.y>=qe.y&&vt.y<=ye.y?[ft]:vt.x<qe.x||lt.x>ye.x||vt.y<qe.y||lt.y>ye.y?[]:p.clipLine([ft],qe.x,qe.y,ye.x,ye.y)}for(const lt of dt){He.reset(lt,.25*Ce);let vt=0;vt=He.length<=.5*Ce?1:Math.ceil(He.paddedLength/mt)+1;for(let Zt=0;Zt<vt;Zt++){const Kn=Zt/Math.max(vt-1,1),mr=He.lerp(Kn),Qn=mr.x+ht,qr=mr.y+ht;q.push(Qn,qr,Ce,0);const kn=Qn-Ce,Qi=qr-Ce,vi=Qn+Ce,Sn=qr+Ce;if(Ve=Ve&&this.isOffscreen(kn,Qi,vi,Sn),Ee=Ee||this.isInsideGrid(kn,Qi,vi,Sn),!i&&this.grid.hitTestCircle(Qn,qr,Ce,L)&&(Te=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!R&&Te||!Ee?[]:q,offscreen:Ve,collisionDetected:Te}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,x=-1/0,D=-1/0;for(const F of i){const L=new p.pointGeometry(F.x+ht,F.y+ht);g=Math.min(g,L.x),v=Math.min(v,L.y),x=Math.max(x,L.x),D=Math.max(D,L.y),u.push(L)}const S=this.grid.query(g,v,x,D).concat(this.ignoredGrid.query(g,v,x,D)),A={},R={};for(const F of S){const L=F.key;if(void 0===A[L.bucketInstanceId]&&(A[L.bucketInstanceId]={}),A[L.bucketInstanceId][L.featureIndex])continue;const j=[new p.pointGeometry(F.x1,F.y1),new p.pointGeometry(F.x2,F.y1),new p.pointGeometry(F.x2,F.y2),new p.pointGeometry(F.x1,F.y2)];p.polygonIntersectsPolygon(u,j)&&(A[L.bucketInstanceId][L.featureIndex]=!0,void 0===R[L.bucketInstanceId]&&(R[L.bucketInstanceId]=[]),R[L.bucketInstanceId].push(L.featureIndex))}return R}insertCollisionBox(i,u,g,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,g,v,x){const D=u?this.ignoredGrid:this.grid,S={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let A=0;A<i.length;A+=4)D.insertCircle(S,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,u,g,v,x){const D=[u,g,v||0,1];let S=!1;if(v||this.transform.pitch>0){p.transformMat4(D,D,i);let A=!1;this.fogState&&x&&(A=function(R,F,L,j,G,X){const q=X.calculateFogTileMatrix(G),J=[F,L,j];return p.transformMat4$1(J,J,q),Xl(R,J,X.pitch,X._fov)}(this.fogState,u,g,v||0,x.toUnwrapped(),this.transform)>.9),S=D[2]>D[3]||A}else ua(D,D,i);return{point:new p.pointGeometry((D[0]/D[3]+1)/2*this.transform.width+ht,(-D[1]/D[3]+1)/2*this.transform.height+ht),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/D[3]*.5,1.5),signedDistanceFromCamera:D[3],aboveHorizon:S}}isOffscreen(i,u,g,v){return g<ht||i>=this.screenRightBoundary||v<ht||u>this.screenBottomBoundary}isInsideGrid(i,u,g,v){return g>=0&&i<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=p.identity([]);return p.translate(i,i,[-100,-100,0]),i}}class tc{constructor(i,u,g,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class ha{constructor(i,u,g,v,x,D=!1){this.text=new tc(i?i.text:null,u,g,x),this.icon=new tc(i?i.icon:null,u,v,x),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Nr{constructor(i,u,g,v=!1){this.text=i,this.icon=u,this.skipFade=g,this.clipped=v}}class Ur{constructor(){this.invProjMatrix=p.create$1(),this.viewportMatrix=p.create$1(),this.circles=[]}}class ni{constructor(i,u,g,v,x){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class uu{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[i]}}function Wn(f,i,u,g,v){const{horizontalAlign:x,verticalAlign:D}=p.getAnchorAlignment(f),S=-(x-.5)*i,A=-(D-.5)*u,R=p.evaluateVariableOffset(f,g);return new p.pointGeometry(S+R[0]*v,A+R[1]*v)}function da(f,i,u,g,v){const x=new p.pointGeometry(f,i);return u&&x._rotate(g?v:-v),x}class Vr{constructor(i,u,g,v,x){this.transform=i.clone(),this.collisionIndex=new yt(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new uu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,u,g,v){const x=g.getBucket(u),D=g.latestFeatureIndex;if(!x||!D||u.id!==x.layerIds[0])return;const S=x.layers[0].layout,A=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),F=g.tileSize/p.EXTENT,L=g.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(L),G="map"===S.get("text-pitch-alignment"),X="map"===S.get("text-rotation-alignment");u.compileFilter();const q=u.dynamicFilter(),J=u.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(g),ee=Pt(j,G,X,this.transform,H);let re=null;if(G){const le=Dt(j,G,X,this.transform,H);re=p.multiply([],this.transform.labelPlaneMatrix,le)}let Z=null;q&&g.latestFeatureIndex&&(Z={unwrappedTileID:L,dynamicFilter:q,dynamicFilterNeedsFeature:J,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new ni(x.bucketInstanceId,D,x.sourceLayerIndex,x.index,g.tileID);const ie={bucket:x,layout:S,posMatrix:j,textLabelPlaneMatrix:ee,labelToScreenMatrix:re,clippingData:Z,scale:R,textPixelRatio:F,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(const le of x.sortKeyRanges){const{sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Te}=le;i.push({sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Te,parameters:ie})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(i,u,g,v,x,D,S,A,R,F,L,j,G,X,q,J,H,ee){const re=[j.textOffset0,j.textOffset1],Z=Wn(i,g,v,re,x),ie=this.collisionIndex.placeCollisionBox(x,u,da(Z.x,Z.y,D,S,this.transform.angle),L,A,R,F.predicate);if((!J||0!==this.collisionIndex.placeCollisionBox(X.getSymbolInstanceIconSize(ee,this.transform.zoom,G),J,da(Z.x,Z.y,D,S,this.transform.angle),L,A,R,F.predicate).box.length)&&ie.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(le=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:re,width:g,height:v,anchor:i,textScale:x,prevAnchor:le},this.markUsedJustification(X,i,j,q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,q,j),this.placedOrientations[j.crossTileID]=q),{shift:Z,placedGlyphBoxes:ie}}}placeLayerBucketPart(i,u,g,v){const{bucket:x,layout:D,posMatrix:S,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:F,textPixelRatio:L,holdingForFade:j,collisionBoxArray:G,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:q,collisionGroup:J}=i.parameters,H=D.get("text-optional"),ee=D.get("icon-optional"),re=D.get("text-allow-overlap"),Z=D.get("icon-allow-overlap"),ie="map"===D.get("text-rotation-alignment"),le="map"===D.get("text-pitch-alignment"),be="none"!==D.get("icon-text-fit"),xe="viewport-y"===D.get("symbol-z-order"),Te=re&&(Z||!x.hasIconData()||ee),Ee=Z&&(re||!x.hasTextData()||H);!x.collisionArrays&&G&&x.deserializeCollisionBoxes(G),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,G);const Ve=(Ce,qe,ye)=>{if(F){const Sn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Nn=null;if(F.dynamicFilterNeedsFeature){const Nt=this.retainedQueryData[x.bucketInstanceId];Nn=F.featureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:Nt.bucketIndex,sourceLayerIndex:Nt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Sn,Nn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new p.pointGeometry(Ce.tileAnchorX,Ce.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Ce.crossTileID]=new Nr(!1,!1,!1,!0),void(u[Ce.crossTileID]=!0)}if(u[Ce.crossTileID])return;if(j)return void(this.placements[Ce.crossTileID]=new Nr(!1,!1,!1));let He=!1,nt=!1,ct=!0,ft=null,mt={box:null,offscreen:null},dt={box:null,offscreen:null},lt=null,vt=null,Zt=null,Kn=0,mr=0,Qn=0;ye.textFeatureIndex?Kn=ye.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(Kn=Ce.featureIndex),ye.verticalTextFeatureIndex&&(mr=ye.verticalTextFeatureIndex);const qr=Sn=>{Sn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Sn.elevation)&&(Sn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Sn.tileAnchorX,Sn.tileAnchorY):0)},kn=ye.textBox;if(kn){qr(kn);const Sn=Nt=>{let In=p.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Nt&&this.prevPlacement){const Er=this.prevPlacement.placedOrientations[Ce.crossTileID];Er&&(this.placedOrientations[Ce.crossTileID]=Er,In=Er,this.markUsedOrientation(x,In,Ce))}return In},Nn=(Nt,In)=>{if(x.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&ye.verticalTextBox){for(const Er of x.writingModes)if(Er===p.WritingMode.vertical?(mt=In(),dt=mt):mt=Nt(),mt&&mt.box&&mt.box.length)break}else mt=Nt()};if(D.get("text-variable-anchor")){let Nt=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ce.crossTileID]){const ln=this.prevPlacement.variableOffsets[Ce.crossTileID];Nt.indexOf(ln.anchor)>0&&(Nt=Nt.filter(Hr=>Hr!==ln.anchor),Nt.unshift(ln.anchor))}const In=(ln,Hr,Us)=>{const Dr=x.getSymbolInstanceTextSize(X,Ce,this.transform.zoom,qe),Ji=(ln.x2-ln.x1)*Dr+2*ln.padding,Uh=(ln.y2-ln.y1)*Dr+2*ln.padding,Dl=be&&!Z?Hr:null;Dl&&qr(Dl);let Vs={box:[],offscreen:!1};const Au=re?2*Nt.length:Nt.length;for(let Pa=0;Pa<Au;++Pa){const Dc=this.attemptAnchorPlacement(Nt[Pa%Nt.length],ln,Ji,Uh,Dr,ie,le,L,S,J,Pa>=Nt.length,Ce,qe,x,Us,Dl,X,q);if(Dc&&(Vs=Dc.placedGlyphBoxes,Vs&&Vs.box&&Vs.box.length)){He=!0,ft=Dc.shift;break}}return Vs};Nn(()=>In(kn,ye.iconBox,p.WritingMode.horizontal),()=>{const ln=ye.verticalTextBox;return ln&&qr(ln),x.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&Ce.numVerticalGlyphVertices>0&&ln?In(ln,ye.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),mt&&(He=mt.box,ct=mt.offscreen);const Er=Sn(mt&&mt.box);if(!He&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[Ce.crossTileID];ln&&(this.variableOffsets[Ce.crossTileID]=ln,this.markUsedJustification(x,ln.anchor,Ce,Er))}}else{const Nt=(In,Er)=>{const ln=x.getSymbolInstanceTextSize(X,Ce,this.transform.zoom,qe),Hr=this.collisionIndex.placeCollisionBox(ln,In,new p.pointGeometry(0,0),re,L,S,J.predicate);return Hr&&Hr.box&&Hr.box.length&&(this.markUsedOrientation(x,Er,Ce),this.placedOrientations[Ce.crossTileID]=Er),Hr};Nn(()=>Nt(kn,p.WritingMode.horizontal),()=>{const In=ye.verticalTextBox;return x.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&In?(qr(In),Nt(In,p.WritingMode.vertical)):{box:null,offscreen:null}}),Sn(mt&&mt.box&&mt.box.length)}}if(lt=mt,He=lt&&lt.box&&lt.box.length>0,ct=lt&&lt.offscreen,Ce.useRuntimeCollisionCircles){const Sn=x.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex>=0?Ce.centerJustifiedTextSymbolIndex:Ce.verticalPlacedTextSymbolIndex),Nn=p.evaluateSizeForFeature(x.textSizeData,X,Sn),Nt=D.get("text-padding");vt=this.collisionIndex.placeCollisionCircles(re,Sn,x.lineVertexArray,x.glyphOffsetArray,Nn,S,A,R,g,le,J.predicate,Ce.collisionCircleDiameter*Nn/p.ONE_EM,Nt,this.retainedQueryData[x.bucketInstanceId].tileID),He=re||vt.circles.length>0&&!vt.collisionDetected,ct=ct&&vt.offscreen}if(ye.iconFeatureIndex&&(Qn=ye.iconFeatureIndex),ye.iconBox){const Sn=Nn=>{qr(Nn);const Nt=be&&ft?da(ft.x,ft.y,ie,le,this.transform.angle):new p.pointGeometry(0,0),In=x.getSymbolInstanceIconSize(q,this.transform.zoom,qe);return this.collisionIndex.placeCollisionBox(In,Nn,Nt,Z,L,S,J.predicate)};dt&&dt.box&&dt.box.length&&ye.verticalIconBox?(Zt=Sn(ye.verticalIconBox),nt=Zt.box.length>0):(Zt=Sn(ye.iconBox),nt=Zt.box.length>0),ct=ct&&Zt.offscreen}const Qi=H||0===Ce.numHorizontalGlyphVertices&&0===Ce.numVerticalGlyphVertices,vi=ee||0===Ce.numIconVertices;if(Qi||vi?vi?Qi||(nt=nt&&He):He=nt&&He:nt=He=nt&&He,He&&lt&&lt.box&&this.collisionIndex.insertCollisionBox(lt.box,D.get("text-ignore-placement"),x.bucketInstanceId,dt&&dt.box&&mr?mr:Kn,J.ID),nt&&Zt&&this.collisionIndex.insertCollisionBox(Zt.box,D.get("icon-ignore-placement"),x.bucketInstanceId,Qn,J.ID),vt&&(He&&this.collisionIndex.insertCollisionCircles(vt.circles,D.get("text-ignore-placement"),x.bucketInstanceId,Kn,J.ID),g)){const Sn=x.bucketInstanceId;let Nn=this.collisionCircleArrays[Sn];void 0===Nn&&(Nn=this.collisionCircleArrays[Sn]=new Ur);for(let Nt=0;Nt<vt.circles.length;Nt+=4)Nn.circles.push(vt.circles[Nt+0]),Nn.circles.push(vt.circles[Nt+1]),Nn.circles.push(vt.circles[Nt+2]),Nn.circles.push(vt.collisionDetected?1:0)}this.placements[Ce.crossTileID]=new Nr(He||Te,nt||Ee,ct||x.justReloaded),u[Ce.crossTileID]=!0};if(xe){const Ce=x.getSortedSymbolIndexes(this.transform.angle);for(let qe=Ce.length-1;qe>=0;--qe){const ye=Ce[qe];Ve(x.symbolInstances.get(ye),ye,x.collisionArrays[ye])}}else for(let Ce=i.symbolInstanceStart;Ce<i.symbolInstanceEnd;Ce++)Ve(x.symbolInstances.get(Ce),Ce,x.collisionArrays[Ce]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[x.bucketInstanceId];p.invert(Ce.invProjMatrix,S),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(i,u,g,v){let x;x=v===p.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];const D=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const S of D)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=x>=0&&S!==x?0:g.crossTileID)}markUsedOrientation(i,u,g){const v=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,x=u===p.WritingMode.vertical?u:0,D=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const S of D)i.text.placedSymbolArray.get(S).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(i):1,x=u?u.opacities:{},D=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],F=x[A];F?(this.opacities[A]=new ha(F,v,R.text,R.icon,null,R.clipped),g=g||R.text!==F.text.placed||R.icon!==F.icon.placed):(this.opacities[A]=new ha(null,v,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const A in x){const R=x[A];if(!this.opacities[A]){const F=new ha(R,v,!1,!1);F.isHidden()||(this.opacities[A]=F,g=g||R.text.placed||R.icon.placed)}}for(const A in D)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=D[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);g?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u){const g={};for(const v of u){const x=v.getBucket(i);x&&v.latestFeatureIndex&&i.id===x.layerIds[0]&&this.updateBucketOpacities(x,g,v.collisionBoxArray)}}updateBucketOpacities(i,u,g){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const v=i.layers[0].layout,x=!!i.layers[0].dynamicFilter(),D=new ha(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),F="map"===v.get("text-rotation-alignment"),L="map"===v.get("text-pitch-alignment"),j="none"!==v.get("icon-text-fit"),G=new ha(null,0,S&&(A||!i.hasIconData()||v.get("icon-optional")),A&&(S||!i.hasTextData()||v.get("text-optional")),!0);!i.collisionArrays&&g&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(g);const X=(q,J,H)=>{for(let ee=0;ee<J/4;ee++)q.opacityVertexArray.emplaceBack(H)};for(let q=0;q<i.symbolInstances.length;q++){const J=i.symbolInstances.get(q),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:ee,crossTileID:re}=J;let Z=this.opacities[re];u[re]?Z=D:Z||(Z=G,this.opacities[re]=Z),u[re]=!0;const ie=J.numIconVertices>0,le=this.placedOrientations[J.crossTileID],be=le===p.WritingMode.vertical,xe=le===p.WritingMode.horizontal||le===p.WritingMode.horizontalOnly;if(H>0||ee>0){const Te=jr(Z.text);X(i.text,H,be?Lt:Te),X(i.text,ee,xe?Lt:Te);const Ee=Z.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(i.text.placedSymbolArray.get(qe).hidden=Ee||be?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=Ee||xe?1:0);const Ve=this.variableOffsets[J.crossTileID];Ve&&this.markUsedJustification(i,Ve.anchor,J,le);const Ce=this.placedOrientations[J.crossTileID];Ce&&(this.markUsedJustification(i,"left",J,Ce),this.markUsedOrientation(i,Ce,J))}if(ie){const Te=jr(Z.icon);J.placedIconSymbolIndex>=0&&(X(i.icon,J.numIconVertices,be?Lt:Te),i.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=Z.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(X(i.icon,J.numVerticalIconVertices,xe?Lt:Te),i.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=Z.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Te=i.collisionArrays[q];if(Te){let Ee=new p.pointGeometry(0,0),Ve=!0;if(Te.textBox||Te.verticalTextBox){if(R){const qe=this.variableOffsets[re];qe?(Ee=Wn(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textScale),F&&Ee._rotate(L?this.transform.angle:-this.transform.angle)):Ve=!1}x&&(Ve=!Z.clipped),Te.textBox&&sr(i.textCollisionBox.collisionVertexArray,Z.text.placed,!Ve||be,Ee.x,Ee.y),Te.verticalTextBox&&sr(i.textCollisionBox.collisionVertexArray,Z.text.placed,!Ve||xe,Ee.x,Ee.y)}const Ce=Ve&&Boolean(!xe&&Te.verticalIconBox);Te.iconBox&&sr(i.iconCollisionBox.collisionVertexArray,Z.icon.placed,Ce,j?Ee.x:0,j?Ee.y:0),Te.verticalIconBox&&sr(i.iconCollisionBox.collisionVertexArray,Z.icon.placed,!Ce,j?Ee.x:0,j?Ee.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=q.invProjMatrix,i.placementViewportMatrix=q.viewportMatrix,i.collisionCircleArray=q.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>i}setStale(){this.stale=!0}}function sr(f,i,u,g,v){f.emplaceBack(i?1:0,u?1:0,g||0,v||0),f.emplaceBack(i?1:0,u?1:0,g||0,v||0),f.emplaceBack(i?1:0,u?1:0,g||0,v||0),f.emplaceBack(i?1:0,u?1:0,g||0,v||0)}const wh=Math.pow(2,25),ho=Math.pow(2,24),nc=Math.pow(2,17),rc=Math.pow(2,16),sm=Math.pow(2,9),Ko=Math.pow(2,8),am=Math.pow(2,1);function jr(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const i=f.placed?1:0,u=Math.floor(127*f.opacity);return u*wh+i*ho+u*nc+i*rc+u*sm+i*Ko+u*am+i}const Lt=0;class hu{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,u,g,v,x){const D=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(D,v,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<D.length;){const S=D[this._currentPartIndex];if(u.placeLayerBucketPart(S,this._seenCrossTileIDs,g,0===S.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class As{constructor(i,u,g,v,x,D,S,A){this.placement=new Vr(i,x,D,S,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,u,g){const v=p.exported.now(),x=()=>{const D=p.exported.now()-v;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=u[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=S)&&(!D.maxzoom||D.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new hu(D)),this._inProgressLayer.continuePlacement(g[D.source],this.placement,this._showCollisionBoxes,D,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Eh=512/p.EXTENT/2;class Gt{constructor(i,u,g){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const x=u.get(v),D=x.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,i)})}}getScaledCoordinates(i,u){const g=Eh/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+i.tileAnchorX)*g),y:Math.floor((u.canonical.y*p.EXTENT+i.tileAnchorY)*g)}}findMatches(i,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let x=0;x<i.length;x++){const D=i.get(x);if(D.crossTileID)continue;const S=this.indexedSymbolInstances[D.key];if(!S)continue;const A=this.getScaledCoordinates(D,u);for(const R of S)if(Math.abs(R.coord.x-A.x)<=v&&Math.abs(R.coord.y-A.y)<=v&&!g[R.crossTileID]){g[R.crossTileID]=!0,D.crossTileID=R.crossTileID;break}}}}class lm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],x={};for(const D in v){const S=v[D];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),x[S.tileID.key]=S}this.indexes[g]=x}this.lng=i}addBucket(i,u,g){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const v=this.usedCrossTileIDs[i.overscaledZ];for(const x in this.indexes){const D=this.indexes[x];if(Number(x)>i.overscaledZ)for(const S in D){const A=D[S];A.tileID.isChildOf(i)&&A.findMatches(u.symbolInstances,i,v)}else{const S=D[i.scaledTo(Number(x)).key];S&&S.findMatches(u.symbolInstances,i,v)}}for(let x=0;x<u.symbolInstances.length;x++){const D=u.symbolInstances.get(x);D.crossTileID||(D.crossTileID=g.generate(),v[D.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Gt(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[i][v.crossTileID]}removeStaleBuckets(i){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const x in v)i[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],u=!0)}return u}}class pa{constructor(){this.layerIndexes={},this.crossTileIDs=new lm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,g){let v=this.layerIndexes[i.id];void 0===v&&(v=this.layerIndexes[i.id]=new Qo);let x=!1;const D={};v.handleWrapJump(g);for(const S of u){const A=S.getBucket(i);A&&i.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(S.tileID,A,this.crossTileIDs)&&(x=!0),D[A.bucketInstanceId]=!0)}return v.removeStaleBuckets(D)&&(x=!0),x}pruneUnusedLayers(i){const u={};i.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const sl=(f,i)=>p.emitValidationErrors(f,i&&i.filter(u=>"source.canvas"!==u.identifier)),Dh=p.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),lp=p.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),du=function(){const f={},i=p.spec.$version;for(const u in p.spec.$root){const g=p.spec.$root[u];if(g.required){let v=null;v="version"===u?i:"array"===g.type?[]:{},null!=v&&(f[u]=v)}}return f}(),ic={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ri extends p.Evented{constructor(i,u={}){super(),this.map=i,this.dispatcher=new co(We(),this),this.imageManager=new xo,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(i._requestManager,u.localFontFamily?p.LocalGlyphMode.all:u.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new p.LineAtlas(256,512),this.crossTileSymbolIndex=new pa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const g=this;this._rtlTextPluginCallback=ri.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,D)=>{if(p.triggerPluginCompletionEvent(x),D&&D.every(S=>S))for(const S in g._sourceCaches){const A=g._sourceCaches[S],R=A.getSource().type;"vector"!==R&&"geojson"!==R||A.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const x=this.getSource(v.sourceId);if(x&&x.vectorLayerIds)for(const D in this._layers){const S=this._layers[D];S.source===x.id&&this._validateLayer(S)}})}loadURL(i,u={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!p.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,u.accessToken);const v=this.map._requestManager.transformRequest(i,p.ResourceType.Style);this._request=p.getJSON(v,(x,D)=>{this._request=null,x?this.fire(new p.ErrorEvent(x)):D&&this._load(D,g)})}loadJSON(i,u={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(i,!1!==u.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(du,!1)}_updateLayerCount(i,u){const g=u?1:-1;i.is3D()&&(this._num3DLayers+=g),"circle"===i.type&&(this._numCircleLayers+=g),"symbol"===i.type&&(this._numSymbolLayers+=g)}_load(i,u){if(u&&sl(this,p.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const v in i.sources)this.addSource(v,i.sources[v],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const g=ot(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=p.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new zn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),i){this.map.painter.clearBackgroundTiles();for(const u in this._sourceCaches)this._sourceCaches[u].clearTiles();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(u,g,v){let x,D,S;const A=p.exported.devicePixelRatio>1?"@2x":"";let R=p.getJSON(g.transformRequest(g.normalizeSpriteURL(u,A,".json"),p.ResourceType.SpriteJSON),(j,G)=>{R=null,S||(S=j,x=G,L())}),F=p.getImage(g.transformRequest(g.normalizeSpriteURL(u,A,".png"),p.ResourceType.SpriteImage),(j,G)=>{F=null,S||(S=j,D=G,L())});function L(){if(S)v(S);else if(x&&D){const j=p.exported.getImageData(D),G={};for(const X in x){const{width:q,height:J,x:H,y:ee,sdf:re,pixelRatio:Z,stretchX:ie,stretchY:le,content:be}=x[X],xe=new p.RGBAImage({width:q,height:J});p.RGBAImage.copy(j,xe,{x:H,y:ee},{x:0,y:0},{width:q,height:J}),G[X]={data:xe,pixelRatio:Z,sdf:re,stretchX:ie,stretchY:le,content:be}}v(null,G)}}return{cancel(){R&&(R.cancel(),R=null),F&&(F.cancel(),F=null)}}}(i,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new p.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(i){const u=this.getSource(i.source);if(!u)return;const g=i.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const u=[];for(const g of i){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&ic[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(v.length||x.length)&&this._updateWorkerLayers(v,x);for(const D in this._updatedSources){const S=this._updatedSources[D];"reload"===S?this._reloadSource(D):"clear"===S&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const x=this._sourceCaches[v];g[v]=x.used,x.used=!1}for(const v of this._order){const x=this._layers[v];if(x.recalculate(i,this._availableImages),!x.isHidden(i.zoom)){const S=this._getLayerSourceCache(x);S&&(S.used=!0)}const D=this.map.painter;if(D){const S=x.getProgramIds();if(!S)continue;const A=x.getProgramConfiguration(i.zoom);for(const R of S)D.useProgram(R,A)}}for(const v in g){const x=this._sourceCaches[v];g[v]!==x.used&&x.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),sl(this,p.validateStyle(i)))return!1;(i=p.clone$2(i)).layers=ot(i.layers);const u=function(v,x){if(!v)return[{command:Ze.setStyle,args:[x]}];let D=[];try{if(!ze(v.version,x.version))return[{command:Ze.setStyle,args:[x]}];ze(v.center,x.center)||D.push({command:Ze.setCenter,args:[x.center]}),ze(v.zoom,x.zoom)||D.push({command:Ze.setZoom,args:[x.zoom]}),ze(v.bearing,x.bearing)||D.push({command:Ze.setBearing,args:[x.bearing]}),ze(v.pitch,x.pitch)||D.push({command:Ze.setPitch,args:[x.pitch]}),ze(v.sprite,x.sprite)||D.push({command:Ze.setSprite,args:[x.sprite]}),ze(v.glyphs,x.glyphs)||D.push({command:Ze.setGlyphs,args:[x.glyphs]}),ze(v.transition,x.transition)||D.push({command:Ze.setTransition,args:[x.transition]}),ze(v.light,x.light)||D.push({command:Ze.setLight,args:[x.light]}),ze(v.fog,x.fog)||D.push({command:Ze.setFog,args:[x.fog]}),ze(v.projection,x.projection)||D.push({command:Ze.setProjection,args:[x.projection]});const S={},A=[];!function(L,j,G,X){let q;for(q in j=j||{},L=L||{})L.hasOwnProperty(q)&&(j.hasOwnProperty(q)||De(q,G,X));for(q in j)j.hasOwnProperty(q)&&(L.hasOwnProperty(q)?ze(L[q],j[q])||("geojson"===L[q].type&&"geojson"===j[q].type&&nn(L,j,q)?G.push({command:Ze.setGeoJSONSourceData,args:[q,j[q].data]}):Ft(q,j,G,X)):de(q,j,G))}(v.sources,x.sources,A,S);const R=[];v.layers&&v.layers.forEach(L=>{S[L.source]?D.push({command:Ze.removeLayer,args:[L.id]}):R.push(L)});let F=v.terrain;F&&S[F.source]&&(D.push({command:Ze.setTerrain,args:[void 0]}),F=void 0),D=D.concat(A),ze(F,x.terrain)||D.push({command:Ze.setTerrain,args:[x.terrain]}),function(L,j,G){j=j||[];const X=(L=L||[]).map(Bt),q=j.map(Bt),J=L.reduce($t,{}),H=j.reduce($t,{}),ee=X.slice(),re=Object.create(null);let Z,ie,le,be,xe,Te,Ee;for(Z=0,ie=0;Z<X.length;Z++)le=X[Z],H.hasOwnProperty(le)?ie++:(G.push({command:Ze.removeLayer,args:[le]}),ee.splice(ee.indexOf(le,ie),1));for(Z=0,ie=0;Z<q.length;Z++)le=q[q.length-1-Z],ee[ee.length-1-Z]!==le&&(J.hasOwnProperty(le)?(G.push({command:Ze.removeLayer,args:[le]}),ee.splice(ee.lastIndexOf(le,ee.length-ie),1)):ie++,Te=ee[ee.length-Z],G.push({command:Ze.addLayer,args:[H[le],Te]}),ee.splice(ee.length-Z,0,le),re[le]=!0);for(Z=0;Z<q.length;Z++)if(le=q[Z],be=J[le],xe=H[le],!re[le]&&!ze(be,xe))if(ze(be.source,xe.source)&&ze(be["source-layer"],xe["source-layer"])&&ze(be.type,xe.type)){for(Ee in _t(be.layout,xe.layout,G,le,null,Ze.setLayoutProperty),_t(be.paint,xe.paint,G,le,null,Ze.setPaintProperty),ze(be.filter,xe.filter)||G.push({command:Ze.setFilter,args:[le,xe.filter]}),ze(be.minzoom,xe.minzoom)&&ze(be.maxzoom,xe.maxzoom)||G.push({command:Ze.setLayerZoomRange,args:[le,xe.minzoom,xe.maxzoom]}),be)be.hasOwnProperty(Ee)&&"layout"!==Ee&&"paint"!==Ee&&"filter"!==Ee&&"metadata"!==Ee&&"minzoom"!==Ee&&"maxzoom"!==Ee&&(0===Ee.indexOf("paint.")?_t(be[Ee],xe[Ee],G,le,Ee.slice(6),Ze.setPaintProperty):ze(be[Ee],xe[Ee])||G.push({command:Ze.setLayerProperty,args:[le,Ee,xe[Ee]]}));for(Ee in xe)xe.hasOwnProperty(Ee)&&!be.hasOwnProperty(Ee)&&"layout"!==Ee&&"paint"!==Ee&&"filter"!==Ee&&"metadata"!==Ee&&"minzoom"!==Ee&&"maxzoom"!==Ee&&(0===Ee.indexOf("paint.")?_t(be[Ee],xe[Ee],G,le,Ee.slice(6),Ze.setPaintProperty):ze(be[Ee],xe[Ee])||G.push({command:Ze.setLayerProperty,args:[le,Ee,xe[Ee]]}))}else G.push({command:Ze.removeLayer,args:[le]}),Te=ee[ee.lastIndexOf(le)+1],G.push({command:Ze.addLayer,args:[xe,Te]})}(R,x.layers,D)}catch(S){console.warn("Unable to compute style diff:",S),D=[{command:Ze.setStyle,args:[x]}]}return D}(this.serialize(),i).filter(v=>!(v.command in lp));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in Dh));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=i,!0}addImage(i,u){if(this.getImage(i))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,u),this._afterImageUpdated(i)}updateImage(i,u){this.imageManager.updateImage(i,u)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(p.validateStyle.source,`sources.${i}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=U(i,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:i}));const x=D=>{const S=(D?"symbol:":"other:")+i,A=this._sourceCaches[S]=new p.SourceCache(S,v,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[i]=A,A.style=this,A.onAdd(this.map)};x(!1),"vector"!==u.type&&"geojson"!==u.type||x(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const u=this.getSource(i);if(void 0===u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===i)return this.fire(new p.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new p.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(i);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,u){this._checkLoaded(),this.getSource(i).setData(u),this._changed=!0}getSource(i){const u=this._getSourceCache(i);return u&&u.getSource()}addLayer(i,u,g={}){this._checkLoaded();const v=i.id;if(this.getLayer(v))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let x;if("custom"===i.type){if(sl(this,p.validateCustomStyleLayer(i)))return;x=p.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(v,i.source),i=p.clone$2(i),i=p.extend(i,{source:v})),this._validate(p.validateStyle.layer,`layers.${v}`,i,{arrayIndex:-1},g))return;x=p.createStyleLayer(i),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const D=u?this._order.indexOf(u):this._order.length;if(u&&-1===D)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(D,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const S=this._getLayerSourceCache(x);if(this._removedLayers[v]&&x.source&&S&&"custom"!==x.type){const A=this._removedLayers[v];delete this._removedLayers[v],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,u){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===u)return;const g=this._order.indexOf(i);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const u=this._layers[i];if(!u)return void this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(i);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=u,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const u in this._layers)if(this._layers[u].type===i)return!0;return!1}setLayerZoomRange(i,u,g){this._checkLoaded();const v=this.getLayer(i);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,u,g={}){this._checkLoaded();const v=this.getLayer(i);if(v){if(!ze(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(p.validateStyle.filter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=p.clone$2(u),this._updateLayer(v)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return p.clone$2(this.getLayer(i).filter)}setLayoutProperty(i,u,g,v={}){this._checkLoaded();const x=this.getLayer(i);x?ze(x.getLayoutProperty(u),g)||(x.setLayoutProperty(u,g,v),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,u){const g=this.getLayer(i);if(g)return g.getLayoutProperty(u);this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,u,g,v={}){this._checkLoaded();const x=this.getLayer(i);x?ze(x.getPaintProperty(u),g)||(x.setPaintProperty(u,g,v)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,u){return this.getLayer(i).getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const g=i.source,v=i.sourceLayer,x=this.getSource(g);if(void 0===x)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const D=x.type;if("geojson"===D&&v)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!v)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(g);for(const A of S)A.setFeatureState(v,i.id,u)}removeFeatureState(i,u){this._checkLoaded();const g=i.source,v=this.getSource(g);if(void 0===v)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const x=v.type,D="vector"===x?i.sourceLayer:void 0;if("vector"===x&&!D)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(g);for(const A of S)A.removeFeatureState(D,i.id,u)}getFeatureState(i){this._checkLoaded();const u=i.source,g=i.sourceLayer,v=this.getSource(u);if(void 0!==v){if("vector"!==v.type||g)return void 0===i.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,i.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();i[g.id]||(i[g.id]=g.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(i){this._updatedLayers[i.id]=!0;const u=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[i.source]="reload",u.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const u=D=>"fill-extrusion"===this._layers[D].type,g={},v=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(u(S)){g[S]=D;for(const A of i){const R=A[S];if(R)for(const F of R)v.push(F)}}}v.sort((D,S)=>S.intersectionZ-D.intersectionZ);const x=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(u(S))for(let A=v.length-1;A>=0;A--){const R=v[A].feature;if(g[R.layer.id]<D)break;x.push(R),v.pop()}else for(const A of i){const R=A[S];if(R)for(const F of R)x.push(F.feature)}}return x}queryRenderedFeatures(i,u,g){u&&u.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of u.layers){const R=this._layers[A];if(!R)return this.fire(new p.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[R.source]=!0}}const x=[];u.availableImages=this._availableImages;const D=u&&u.layers?u.layers.some(A=>{const R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),S=ti.createFromScreenPoints(i,g);for(const A in this._sourceCaches){const R=this._sourceCaches[A].getSource().id;u.layers&&!v[R]||x.push(ne(this._sourceCaches[A],this._layers,this._serializedLayers,S,u,g,D,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,R,F,L,j,G,X){const q={},J=G.queryRenderedSymbols(L),H=[];for(const ee of Object.keys(J).map(Number))H.push(X[ee]);H.sort(me);for(const ee of H){const re=ee.featureIndex.lookupSymbolFeatures(J[ee.bucketInstanceId],R,ee.bucketIndex,ee.sourceLayerIndex,j.filter,j.layers,j.availableImages,A);for(const Z in re){const ie=q[Z]=q[Z]||[],le=re[Z];le.sort((be,xe)=>{const Te=ee.featureSortOrder;if(Te){const Ee=Te.indexOf(be.featureIndex);return Te.indexOf(xe.featureIndex)-Ee}return xe.featureIndex-be.featureIndex});for(const be of le)ie.push(be)}}for(const ee in q)q[ee].forEach(re=>{const Z=re.feature,ie=F(A[ee]).getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=ie});return q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(i,u){u&&u.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(i);let v=[];for(const x of g)v=v.concat(se(x,u));return v}addSourceType(i,u,g){return ri.getSourceType(i)?g(new Error(`A source type called "${i}" already exists.`)):(ri.setSourceType(i,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(i,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const D in i)if(!ze(i[D],g[D])){v=!0;break}if(!v)return;const x={now:p.exported.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(i){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof i.source){const u="terrain-dem-src";this.addSource(u,i.source),i=p.clone$2(i),i=p.extend(i,{source:u})}if(!this._validate(p.validateStyle.terrain,"terrain",i)){if(this.terrain){const u=this.terrain,g=u.get();for(const v in i)if(!ze(i[v],g[v])){u.set(i),this.stylesheet.terrain=i;const x={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(x);break}}else this._createTerrain(i);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(i){const u=this.fog=new wo(i,this.map.transform);this.stylesheet.fog=i;const g={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();for(const v in i)if(!ze(i[v],g[v])){u.set(i),this.stylesheet.fog=i;const x={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(x);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...u)}_createTerrain(i){const u=this.terrain=new Vi(i);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const g={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const u=this._layers[i];"fill-extrusion"===u.type&&this._updateLayer(u)}}_validate(i,u,g,v,x={}){return(!x||!1!==x.validate)&&sl(this,i.call(p.validateStyle,p.extend({key:u,style:this.serialize(),value:g,styleSpec:p.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const u=this._getSourceCaches(i);for(const g of u)g.clearTiles()}_reloadSource(i){const u=this._getSourceCaches(i);for(const g of u)g.resume(),g.reload()}_updateSources(i){for(const u in this._sourceCaches)this._sourceCaches[u].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const u=this._sourceCaches[i];u.resume(),u.reload()}}_updatePlacement(i,u,g,v,x=!1){let D=!1,S=!1;const A={};for(const R of this._order){const F=this._layers[R];if("symbol"!==F.type)continue;if(!A[F.source]){const j=this._getLayerSourceCache(F);if(!j)continue;A[F.source]=j.getRenderableIds(!0).map(G=>j.getTileByID(G)).sort((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(F,A[F.source],i.center.lng);D=D||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),i.zoom))&&(this.pauseablePlacement=new As(i,this._order,x,u,g,v,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),S=!0),D&&this.pauseablePlacement.placement.setStale()),S||D)for(const R of this._order){const F=this._layers[R];"symbol"===F.type&&this.placement.updateLayerOpacities(F,A[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=x=>{x&&x.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(i,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(i,u,g){return p.makeRequest(u,g)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const u=[];return this._otherSourceCaches[i]&&u.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&u.push(this._symbolSourceCaches[i]),u}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}ri.getSourceType=function(f){return z[f]},ri.setSourceType=function(f,i){z[f]=i},ri.registerForPluginStateChange=p.registerForPluginStateChange;var oc="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",pu="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let bt={},Jo={};bt=qt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Jo=qt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const es=qt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),mi=oc;var al={background:qt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:qt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:qt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:qt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:qt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:qt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:qt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:qt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:qt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:qt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:qt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:qt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:qt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:qt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:qt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:qt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pu),skyboxGradient:qt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pu),skyboxCapture:qt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:qt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function qt(f,i,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),D=f.match(v),S=i.match(v),A=oc.match(v);let R=S?S.concat(D):D;u||(bt.staticUniforms&&(R=bt.staticUniforms.concat(R)),Jo.staticUniforms&&(R=Jo.staticUniforms.concat(R))),R&&(R=R.concat(A));const F={};return{fragmentSource:f=f.replace(g,(L,j,G,X,q)=>(F[q]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${q}\nvarying ${G} ${X} ${q};\n#else\nuniform ${G} ${X} u_${q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${q}\n    ${G} ${X} ${q} = u_${q};\n#endif\n`)),vertexSource:i=i.replace(g,(L,j,G,X,q)=>{const J="float"===X?"vec2":"vec4",H=q.match(/color/)?"color":J;return F[q]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${G} ${J} a_${q};\nvarying ${G} ${X} ${q};\n#else\nuniform ${G} ${X} u_${q};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = a_${q};\n#else\n    ${G} ${X} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = unpack_mix_${H}(a_${q}, u_${q}_t);\n#else\n    ${G} ${X} ${q} = u_${q};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${G} ${J} a_${q};\n#else\nuniform ${G} ${X} u_${q};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${G} ${X} ${q} = a_${q};\n#else\n    ${G} ${X} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${G} ${X} ${q} = unpack_mix_${H}(a_${q}, u_${q}_t);\n#else\n    ${G} ${X} ${q} = u_${q};\n#endif\n`}),staticAttributes:x,staticUniforms:R}}class Gi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,u,g,v,x,D,S,A){this.context=i;let R=this.boundPaintVertexBuffers.length!==v.length;for(let F=0;!R&&F<v.length;F++)this.boundPaintVertexBuffers[F]!==v[F]&&(R=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!R&&this.boundIndexBuffer===x&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===A?(i.bindVertexArrayOES.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),A&&A.bind()):this.freshBind(u,g,v,x,D,S,A)}freshBind(i,u,g,v,x,D,S){let A;const R=i.numAttributes,F=this.context,L=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=S;else{A=F.currentNumAttributes||0;for(let j=R;j<A;j++)L.disableVertexAttribArray(j)}u.enableAttributes(L,i);for(const j of g)j.enableAttributes(L,i);D&&D.enableAttributes(L,i),S&&S.enableAttributes(L,i),u.bind(),u.setVertexAttribPointers(L,i,x);for(const j of g)j.bind(),j.setVertexAttribPointers(L,i,x);D&&(D.bind(),D.setVertexAttribPointers(L,i,x)),v&&v.bind(),S&&(S.bind(),S.setVertexAttribPointers(L,i,x)),F.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ii(f,i){const u=Math.pow(2,i.canonical.z),g=i.canonical.y;return[new p.MercatorCoordinate(0,g/u).toLngLat().lat,new p.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function Ch(f,i,u,g,v,x,D){const S=f.context,A=S.gl,R=u.fbo;if(!R)return;f.prepareDrawTile(i);const F=f.useProgram("hillshade");S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const L=((q,J,H,ee)=>{const re=H.paint.get("hillshade-shadow-color"),Z=H.paint.get("hillshade-highlight-color"),ie=H.paint.get("hillshade-accent-color");let le=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===H.paint.get("hillshade-illumination-anchor")&&(le-=q.transform.angle);const be=!q.options.moving;return{u_matrix:ee||q.transform.calculateProjMatrix(J.tileID.toUnwrapped(),be),u_image:0,u_latrange:ii(0,J.tileID),u_light:[H.paint.get("hillshade-exaggeration"),le],u_shadow:re,u_highlight:Z,u_accent:ie}})(f,u,g,f.terrain?i.projMatrix:null);f.prepareDrawProgram(S,F,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:G,tileBoundsSegments:X}=f.getTileBoundsBuffers(u);F.draw(S,A.TRIANGLES,v,x,D,p.CullFaceMode.disabled,L,g.id,j,G,X)}function sc(f,i,u){if(!i.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(u.stride);const x=u.getPixels();i.demTexture?i.demTexture.update(x,{premultiply:!1}):i.demTexture=new p.Texture(g,x,v.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function oi(f,i,u,g,v,x){const D=f.context,S=D.gl;if(!i.dem)return;const A=i.dem;if(D.activeTexture.set(S.TEXTURE1),sc(f,i,A),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const R=A.dim;D.activeTexture.set(S.TEXTURE0);let F=i.fbo;if(!F){const X=new p.Texture(D,{width:R,height:R,data:null},S.RGBA);X.bind(S.LINEAR,S.CLAMP_TO_EDGE),F=i.fbo=D.createFramebuffer(R,R,!0),F.colorAttachment.set(X.texture)}D.bindFramebuffer.set(F.framebuffer),D.viewport.set([0,0,R,R]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(D,S.TRIANGLES,g,v,x,p.CullFaceMode.disabled,((X,q)=>{const J=q.stride,H=p.create$1();return p.ortho(H,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(H,H,[0,-p.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[J,J],u_zoom:X.overscaledZ,u_unpack:q.unpackVector}})(i.tileID,A),u.id,L,j,G),i.needsHillshadePrepare=!1}const Jt=(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_image0:new p.Uniform1i(f,i.u_image0),u_skirt_height:new p.Uniform1f(f,i.u_skirt_height)}),ll=(f,i)=>({u_matrix:f,u_image0:0,u_skirt_height:i}),ac=new class{constructor(){this.operations={}}newMorphing(f,i,u,g,v){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[f]={startTime:g,phase:0,duration:v,from:i,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const u=this.operations[i];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Th={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function gn(f,i){const u=1<<f.z;return!i&&(0===f.x||f.x===u-1)||0===f.y||f.y===u-1}const lc=f=>({u_matrix:f});function Sh(f,i,u,g,v){if(v>0){const x=p.exported.now(),D=(x-f.timeAdded)/v,S=i?(x-i.timeAdded)/v:-1,A=u.getSource(),R=g.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),L=F&&f.refreshedUponExpiration?1:p.clamp(F?D:1-S,0,1);return f.refreshedUponExpiration&&D>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class fa extends p.SourceCache{constructor(i){const u=U("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new co(We(),null),i.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,u,g){if(i.freezeTileCoverage)return;this.transform=i;const v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,D)=>{if(x[D.key]="",!this._tiles[D.key]){const S=new p.Tile(D,this._source.tileSize*D.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[D.key]=S}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(i){const u=this.proxyCachedFBO[i];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bn extends p.OverscaledTileID{constructor(i,u,g){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class ma extends p.Elevation{constructor(i,u){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,x]=function(A){const R=new p.StructArrayLayout4i8,F=new p.StructArrayLayout3ui6,L=131;R.reserve(17161),F.reserve(33800);const j=p.EXTENT/128,G=p.EXTENT+j/2,X=G+j;for(let J=-j;J<X;J+=j)for(let H=-j;H<X;H+=j){const ee=H<0||H>G||J<0||J>G?24575:0,re=p.clamp(Math.round(H),0,p.EXTENT),Z=p.clamp(Math.round(J),0,p.EXTENT);R.emplaceBack(re+ee,Z,re,Z)}const q=(J,H)=>{const ee=H*L+J;F.emplaceBack(ee+1,ee,ee+L),F.emplaceBack(ee+L,ee+L+1,ee+1)};for(let J=1;J<129;J++)for(let H=1;H<129;H++)q(H,J);return[0,129].forEach(J=>{for(let H=0;H<130;H++)q(H,J),q(J,H)}),[R,F,32768]}(),D=i.context;this.gridBuffer=D.createVertexBuffer(g,p.boundsAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(v),this.gridSegments=p.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fa(u.map),this.orthoMatrix=p.create$1(),p.ortho(this.orthoMatrix,0,p.EXTENT,0,p.EXTENT,0,1);const S=D.gl;this._overlapStencilMode=new p.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,u,g){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const v=i.terrain.properties;this.sourceCache=i._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const x=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.sourceCache.getSource().tileSize/128,S=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(u,D*S,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),u.updateElevation(!g),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(A=>{const R=u.getTileByID(A).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){const F=R.transform.pointCoordinate(R.transform.getCameraPoint()),L=new p.pointGeometry(F.x,F.y);A.sort((j,G)=>{if(G.overscaledZ-j.overscaledZ)return G.overscaledZ-j.overscaledZ;const X=new p.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),q=new p.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),J=L.mult(1<<j.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(X)-J.distSqr(q)})})(v,this.painter),this._previousZoom=g.zoom;const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const A in D){const R=D[A];if(!R.used||(R!==this.sourceCache&&(this._findCoveringTileCache[R.id]={}),this._setupProxiedCoordsForOrtho(R,i[A],x),R.usedForTerrain))continue;const F=i[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=v.map(A=>new bn(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const F=R.tileID.key;F in S||(this._visibleDemTiles.push(R),S[F]=F)}}_assignTerrainTiles(i){this._initializing||i.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const i=this.painter.context,u=i.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(u.TEXTURE1),sc(this.painter,v,x))}}_prepareDemTileUniforms(i,u,g,v){if(!u||null==u.demTexture)return!1;const x=i.tileID.canonical,D=Math.pow(2,u.tileID.canonical.z-x.z),S=v||"";return g[`u_dem_tl${S}`]=[x.x*D%1,x.y*D%1],g[`u_dem_scale${S}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let i=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const x=v.dem.tree.minimums[0];return x>0&&i++,g+x},0);return i?u/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,u=i.gl;i.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(p.DEMData.pack(g,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new p.Texture(i,v,u.RGBA,{premultiply:!1}),x}setupElevationDraw(i,u,g){const v=this.painter.context,x=v.gl,D=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let A=null,R=null,F=1;if(g&&g.morphing&&this._useVertexMorphing){const L=g.morphing.srcDemTile,j=g.morphing.dstDemTile;F=g.morphing.phase,L&&j&&(this._prepareDemTileUniforms(i,L,D,"_prev")&&(R=L),this._prepareDemTileUniforms(i,j,D)&&(A=j))}if(R&&A?(v.activeTexture.set(x.TEXTURE2),A.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),v.activeTexture.set(x.TEXTURE4),R.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),D.u_dem_lerp=F):(A=this.terrainTileForTile[i.tileID.key],v.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(i,A,D)?A.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),g&&g.useDepthForOcclusion&&(v.activeTexture.set(x.TEXTURE3),this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),g&&g.useMeterToDem&&A){const L=(1<<A.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=L}g&&g.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,D)}renderToBackBuffer(i){const u=this.painter,g=this.painter.context;0!==i.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),this.renderingToTexture=!1,function(v,x,D,S,A){const R=v.context,F=R.gl;let L,j;const G=v.options.showTerrainWireframe?2:0,X=(re,Z)=>{if(j===re)return;const ie=[Th[re]];Z&&ie.push(Th[G]),L=v.useProgram("terrainRaster",null,ie),j=re},q=v.colorModeForRenderPass(),J=new p.DepthMode(F.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);ac.update(A);const H=v.transform,ee=6*Math.pow(1.5,22-H.zoom)*x.exaggeration();(G?[!1,!0]:[!1]).forEach(re=>{j=-1;const Z=re?F.LINES:F.TRIANGLES,[ie,le]=re?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Te of S){const Ee=D.getTile(Te),Ve=p.StencilMode.disabled,Ce=x.prevTerrainTileForTile[Te.key],qe=x.terrainTileForTile[Te.key];xe=qe,null!=(be=Ce)&&null!=xe&&be.hasData()&&xe.hasData()&&null!=be.demTexture&&null!=xe.demTexture&&be.tileID.key!==xe.tileID.key&&ac.newMorphing(Te.key,Ce,qe,A,250),R.activeTexture.set(F.TEXTURE0),Ee.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ye=ac.getMorphValuesForProxy(Te.key),He=ye?1:0;let nt;ye&&(nt={morphing:{srcDemTile:ye.from,dstDemTile:ye.to,phase:p.easeCubicInOut(ye.phase)}});const ct=ll(Te.projMatrix,gn(Te.canonical,H.renderWorldCopies)?ee/10:ee);X(He,re),x.setupElevationDraw(Ee,L,nt),v.prepareDrawProgram(R,L,Te.toUnwrapped()),L.draw(R,Z,J,Ve,q,p.CullFaceMode.backCCW,ct,"terrain_raster",x.gridBuffer,ie,le)}var be,xe})}(u,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],D=this._drapedRenderBatches.shift(),S=[],A=u.style.order;let R=0;for(const F of x){const L=v.getTileByID(F.proxyTileKey),j=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][i]:void 0,G=void 0!==j?v.renderCache[j]:this.pool[R++],X=void 0!==j;if(L.texture=G.tex,X&&!G.dirty){S.push(L.tileID);continue}let q;g.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(g.clear({color:p.Color.transparent}),G.dirty=!1);for(let J=D.start;J<=D.end;++J){const H=u.style._layers[A[J]];if(H.isHidden(u.transform.zoom))continue;const ee=u.style._getLayerSourceCache(H),re=ee?this.proxyToSource[F.key][ee.id]:[F];if(!re)continue;const Z=re;g.viewport.set([0,0,G.fb.width,G.fb.height]),q!==(ee?ee.id:null)&&(this._setupStencil(G,re,H,ee),q=ee?ee.id:null),u.renderLayer(u,ee,H,Z)}this.renderedToTile?(G.dirty=!0,S.push(L.tileID)):X||--R,5===R&&(R=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),D.end+1}postRender(){}renderCacheEfficiency(i){const u=i.order.length;if(0===u)return{efficiency:100};let g,v=0,x=0,D=!1;for(let S=0;S<u;++S){const A=i._layers[i.order[S]];this._style.isLayerDraped(A)?(D&&++v,++x):D||(D=!0,g=A.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-v/x),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{i=Math.min(i,u.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const D=x.tileID,S=Math.pow(2,D.overscaledZ),{x:A,y:R}=D.canonical,F=A/S,L=(A+1)/S,j=R/S,G=(R+1)/S;return{minx:F,miny:j,maxx:L,maxy:G,t:x.dem.tree.raycastRoot(F,j,L,G,i,u,g),tile:x}});v.sort((x,D)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const x of v){if(null==x.t)return null;const D=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,i,u,g);if(null!=D)return D}return null}_createFBO(){const i=this.painter.context,u=i.gl,g=this.drapeBufferSize;i.activeTexture.set(u.TEXTURE0);const v=new p.Texture(i,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=i.createFramebuffer(g[0],g[1],!1);return x.colorAttachment.set(v.texture),x.depthAttachment=new br(i,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const u=this._style._layers[i],g=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),x=!!v&&1!==v.t,D=u.hasTransition();return"custom"!==u.type&&!g&&(x||D)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof Ss){i=!0;break}if(i)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!x)continue;const D=g.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][x.id];if(A)for(const R of A){const F=Sh(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,D);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){const i=this._style.order,u=i.length;if(0===u)return;const g=[];let v,x=0,D=this._style._layers[i[x]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++x<u;)D=this._style._layers[i[x]];for(;x<u;++x){const S=this._style._layers[i[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===v&&(v=x):void 0!==v&&(g.push({start:v,end:x-1}),v=void 0))}void 0!==v&&g.push({start:v,end:x-1}),this._drapedRenderBatches=g}_setupRenderCache(i){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const D=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let S=0;S<D.length;++S){const A=Object.values(D[S]);u.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let D=g.length-1;D>=0;D--){const S=g[D];if(u.getTileByID(S.key),void 0!==u.proxyCachedFBO[S.key]){const A=i[S.key],R=this.proxyToSource[S.key];let F=0;for(const L in R){const j=R[L],G=A[L];if(!G||G.length!==j.length||j.some((X,q)=>X!==G[q]||v[L]&&v[L].hasOwnProperty(X.key))){F=-1;break}++F}for(const L in u.proxyCachedFBO[S.key])u.renderCache[u.proxyCachedFBO[S.key][L]].dirty=F<0||F!==Object.values(A).length}}const x=[...this._drapedRenderBatches];x.sort((D,S)=>S.end-S.start-(D.end-D.start));for(const D of x)for(const S of g){if(u.proxyCachedFBO[S.key])continue;let A=u.renderCachePool.pop();void 0===A&&u.renderCache.length<50&&(A=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==A&&(u.proxyCachedFBO[S.key]={},u.proxyCachedFBO[S.key][D.start]=A,u.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(i,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,D=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let S;if(g.isTileClipped())S=u.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(i,u){const g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const D=g.useProgram("clippingMask");for(const S of i){const A=g._tileClippingMaskIDs[S.key]=--u;D.draw(v,x.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,lc(S.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(i){const u=this.painter.transform;if(i.x<0||i.x>u.width||i.y<0||i.y>u.height)return null;const g=[i.x,i.y,1,1];p.transformMat4(g,g,u.pixelMatrixInverse),p.scale$2(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,x=p.mercatorZfromAltitude(1,u.center.lat),D=[v[0],v[1],v[2]/x,0],S=p.subtract([],g.slice(0,3),D);p.normalize(S,S);const A=this.raycast(D,S,this._exaggeration);return null!==A&&A?(p.scaleAndAdd(D,D,S,A),D[3]=D[2],D[2]*=x,D):null}drawDepth(){const i=this.painter,u=i.context,g=this.proxySourceCache,v=Math.ceil(i.width),x=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const D=u.gl,S=u.createFramebuffer(v,x,!0);u.activeTexture.set(D.TEXTURE0);const A=new p.Texture(u,{width:v,height:x,data:null},D.RGBA);A.bind(D.NEAREST,D.CLAMP_TO_EDGE),S.colorAttachment.set(A.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,x);S.depthAttachment.set(R),this._depthFBO=S,this._depthTexture=A}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,x]),function(D,S,A,R){const F=D.context,L=F.gl;F.clear({depth:1});const j=D.useProgram("terrainDepth"),G=new p.DepthMode(L.LESS,p.DepthMode.ReadWrite,D.depthRangeFor3D);for(const X of R){const q=A.getTile(X),J=ll(X.projMatrix,0);S.setupElevationDraw(q,j),j.draw(F,L.TRIANGLES,G,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,J,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,u,g){if(i.getSource()instanceof Y)return this._setupProxiedCoordsForImageSource(i,u,g);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const v=this.proxiedCoords[i.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const A=x[S],R=this._findTileCoveringTileID(A,i);if(R){const F=this._createProxiedId(A,R,g[A.key]&&g[A.key][i.id]);v.push(F),this.proxyToSource[A.key][i.id]=[F]}}let D=!1;for(let S=0;S<u.length;S++){const A=i.getTile(u[S]);if(!A||!A.hasData())continue;const R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){const F=this.proxyToSource[R.tileID.key][i.id],L=this._createProxiedId(R.tileID,A,g[R.tileID.key]&&g[R.tileID.key][i.id]);F?F.splice(F.length-1,0,L):this.proxyToSource[R.tileID.key][i.id]=[L],v.push(L),D=!0}}this._sourceTilesOverlap[i.id]=D}_setupProxiedCoordsForImageSource(i,u,g){if(!i.getSource().loaded())return;const v=this.proxiedCoords[i.id]=[],x=this.proxyCoords,D=i.getSource(),S=new p.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),A=D.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((F,L)=>(F.min.x=Math.min(F.min.x,L.x-S.x),F.min.y=Math.min(F.min.y,L.y-S.y),F.max.x=Math.max(F.max.x,L.x-S.x),F.max.y=Math.max(F.max.y,L.y-S.y),F),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(F,L)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),G=F.canonical.y/(1<<F.canonical.z),X=p.EXTENT/(1<<F.canonical.z),q=L.wrap+L.canonical.x/(1<<L.canonical.z),J=L.canonical.y/(1<<L.canonical.z);return j+X<q+A.min.x||j>q+A.max.x||G+X<J+A.min.y||G>J+A.max.y};for(let F=0;F<x.length;F++){const L=x[F];for(let j=0;j<u.length;j++){const G=i.getTile(u[j]);if(!G||!G.hasData()||R(L,G.tileID))continue;const X=this._createProxiedId(L,G,g[L.key]&&g[L.key][i.id]),q=this.proxyToSource[L.key][i.id];q?q.push(X):this.proxyToSource[L.key][i.id]=[X],v.push(X)}}}_createProxiedId(i,u,g){let v=this.orthoMatrix;if(g){const x=g.find(D=>D.key===u.tileID.key);if(x)return x}if(u.tileID.key!==i.key){const x=i.canonical.z-u.tileID.canonical.z;let D,S,A;v=p.create$1();const R=u.tileID.wrap-i.wrap<<i.overscaledZ;x>0?(D=p.EXTENT>>x,S=D*((u.tileID.canonical.x<<x)-i.canonical.x+R),A=D*((u.tileID.canonical.y<<x)-i.canonical.y)):(D=p.EXTENT<<-x,S=p.EXTENT*(u.tileID.canonical.x-(i.canonical.x+R<<-x)),A=p.EXTENT*(u.tileID.canonical.y-(i.canonical.y<<-x))),p.ortho(v,0,D,0,D,0,1),p.translate(v,v,[S,A,0])}return new bn(u.tileID,i.key,v)}_findTileCoveringTileID(i,u){let g=u.getTile(i);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],x=v[i.key];if(g=x?u.getTileByID(x):null,g&&g.hasData()||null===x)return g;let D=g?g.tileID:i,S=D.overscaledZ;const A=u.getSource().minzoom,R=[];if(!x){const L=u.getSource().maxzoom;if(i.canonical.z>=L){const j=i.canonical.z-L;u.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,u.transform.tileZoom),D=new p.OverscaledTileID(S,i.wrap,L,i.canonical.x>>j,i.canonical.y>>j)):0!==j&&(S=L,D=new p.OverscaledTileID(S,i.wrap,L,i.canonical.x>>j,i.canonical.y>>j))}D.key!==i.key&&(R.push(D.key),g=u.getTile(D))}const F=L=>{R.forEach(j=>{v[j]=L}),R.length=0};for(S-=1;S>=A&&(!g||!g.hasData());S--){g&&F(g.tileID.key);const L=D.calculateScaledKey(S);if(g=u.getTileByID(L),g&&g.hasData())break;const j=v[L];if(null===j)break;void 0===j?R.push(L):g=u.getTileByID(j)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,u){let g=this._tilesDirty[i];g||(g=this._tilesDirty[i]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(u){let g,v,x;const D=new p.StructArrayLayout2ui4,S=131;for(v=1;v<129;v++){for(g=1;g<129;g++)x=v*S+g,D.emplaceBack(x,x+1),D.emplaceBack(x,x+S),D.emplaceBack(x+1,x+S),128===v&&D.emplaceBack(x+S,x+S+1);D.emplaceBack(x+1,x+1+S)}return D}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ga(f){const i=[];for(let u=0;u<f.length;u++){if(null===f[u])continue;const g=f[u].split(" ");i.push(g.pop())}return i}class _a{static cacheKey(i,u,g){let v=`${i}${g?g.cacheKey:""}`;for(const x of u)v+=`/${x}`;return v}constructor(i,u,g,v,x,D){const S=i.gl;this.program=S.createProgram();const A=ga(g.staticAttributes),R=v?v.getBinderAttributes():[],F=A.concat(R),L=g.staticUniforms?ga(g.staticUniforms):[],j=v?v.getBinderUniforms():[],G=L.concat(j),X=[];for(const ie of G)X.indexOf(ie)<0&&X.push(ie);let q=v?v.defines():[];q=q.concat(D.map(ie=>`#define ${ie}`));const J=q.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",mi,es.fragmentSource,Jo.fragmentSource,g.fragmentSource).join("\n"),H=q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",mi,es.vertexSource,Jo.vertexSource,bt.vertexSource,g.vertexSource).join("\n"),ee=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ee,J),S.compileShader(ee),S.attachShader(this.program,ee);const re=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(re,H),S.compileShader(re),S.attachShader(this.program,re),this.attributes={};const Z={};this.numAttributes=F.length;for(let ie=0;ie<this.numAttributes;ie++)F[ie]&&(S.bindAttribLocation(this.program,ie,F[ie]),this.attributes[F[ie]]=ie);S.linkProgram(this.program),S.deleteShader(re),S.deleteShader(ee);for(let ie=0;ie<X.length;ie++){const le=X[ie];if(le&&!Z[le]){const be=S.getUniformLocation(this.program,le);be&&(Z[le]=be)}}var ie,le;this.fixedUniforms=x(i,Z),this.binderUniforms=v?v.getUniforms(i,Z):[],-1!==D.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(ie=i,(le=Z).u_dem),u_dem_prev:new p.Uniform1i(ie,le.u_dem_prev),u_dem_unpack:new p.Uniform4f(ie,le.u_dem_unpack),u_dem_tl:new p.Uniform2f(ie,le.u_dem_tl),u_dem_scale:new p.Uniform1f(ie,le.u_dem_scale),u_dem_tl_prev:new p.Uniform2f(ie,le.u_dem_tl_prev),u_dem_scale_prev:new p.Uniform1f(ie,le.u_dem_scale_prev),u_dem_size:new p.Uniform1f(ie,le.u_dem_size),u_dem_lerp:new p.Uniform1f(ie,le.u_dem_lerp),u_exaggeration:new p.Uniform1f(ie,le.u_exaggeration),u_depth:new p.Uniform1i(ie,le.u_depth),u_depth_size_inv:new p.Uniform2f(ie,le.u_depth_size_inv),u_meter_to_dem:new p.Uniform1f(ie,le.u_meter_to_dem),u_label_plane_matrix_inv:new p.UniformMatrix4f(ie,le.u_label_plane_matrix_inv),u_tile_tl_up:new p.Uniform3f(ie,le.u_tile_tl_up),u_tile_tr_up:new p.Uniform3f(ie,le.u_tile_tr_up),u_tile_br_up:new p.Uniform3f(ie,le.u_tile_br_up),u_tile_bl_up:new p.Uniform3f(ie,le.u_tile_bl_up),u_tile_up_scale:new p.Uniform1f(ie,le.u_tile_up_scale)}),-1!==D.indexOf("FOG")&&(this.fogUniforms=((ie,le)=>({u_fog_matrix:new p.UniformMatrix4f(ie,le.u_fog_matrix),u_fog_range:new p.Uniform2f(ie,le.u_fog_range),u_fog_color:new p.Uniform4f(ie,le.u_fog_color),u_fog_horizon_blend:new p.Uniform1f(ie,le.u_fog_horizon_blend),u_fog_temporal_offset:new p.Uniform1f(ie,le.u_fog_temporal_offset)}))(i,Z))}setTerrainUniformValues(i,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in u)g[v].set(u[v])}}setFogUniformValues(i,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in u)g[v].location&&g[v].set(u[v])}}draw(i,u,g,v,x,D,S,A,R,F,L,j,G,X,q,J){const H=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(g),i.setStencilMode(v),i.setColorMode(x),i.setCullFace(D);for(const re in this.fixedUniforms)this.fixedUniforms[re].set(S[re]);X&&X.setUniforms(i,this.binderUniforms,j,{zoom:G});const ee={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[u];for(const re of L.get()){const Z=re.vaos||(re.vaos={});(Z[A]||(Z[A]=new Gi)).bind(i,this,R,X?X.getPaintVertexBuffers():[],F,re.vertexOffset,q,J),H.drawElements(u,re.primitiveLength*ee,H.UNSIGNED_SHORT,re.primitiveOffset*ee*2)}}}function cl(f,i,u){const g=1/dr(u,1,i.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),x=u.tileSize*Math.pow(2,i.transform.tileZoom)/v,D=x*(u.tileID.canonical.x+u.tileID.wrap*v),S=x*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[D>>16,S>>16],u_pixel_coord_lower:[65535&D,65535&S]}}const qi=(f,i,u,g)=>{const v=i.style.light,x=v.properties.get("position"),D=[x.x,x.y,x.z],S=p.create$2();"viewport"===v.properties.get("anchor")&&(p.fromRotation(S,-i.transform.angle),p.transformMat3(D,D,S));const A=v.properties.get("color");return{u_matrix:f,u_lightpos:D,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+u,u_opacity:g}},ya=(f,i,u,g,v,x,D)=>p.extend(qi(f,i,u,g),cl(x,i,D),{u_height_factor:-Math.pow(2,v.overscaledZ)/D.tileSize/8}),Ih=f=>({u_matrix:f}),pr=(f,i,u,g)=>p.extend(Ih(f),cl(u,i,g)),ul=(f,i)=>({u_matrix:f,u_world:i}),fu=(f,i,u,g,v)=>p.extend(pr(f,i,u,g),{u_world:v}),si=(f,i,u,g)=>{const v=f.transform;let x;return x="map"===g.paint.get("circle-pitch-alignment")?v.calculatePixelsToTileUnitsMatrix(u):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:f.translatePosMatrix(i.projMatrix,u,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:x}},cc=f=>{const i=[];return"map"===f.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},po=(f,i,u)=>{const g=p.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},hl=(f,i,u=1)=>({u_matrix:f,u_color:i,u_overlay:0,u_overlay_scale:u}),uc=(f,i,u,g)=>({u_matrix:f,u_extrude_scale:dr(i,1,u),u_intensity:g}),fr=(f,i,u,g,v,x)=>{const D=f.transform,S=D.calculatePixelsToTileUnitsMatrix(i),A={u_matrix:Hi(f,i,u,v),u_pixels_to_tile_units:S,u_device_pixel_ratio:p.exported.devicePixelRatio,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(ai(u)){const R=ar(i,f.transform);A.u_texsize=i.lineAtlasTexture.size,A.u_scale=[R,g.fromScale,g.toScale],A.u_mix=g.t}return A},wr=(f,i,u,g,v)=>{const x=f.transform,D=ar(i,x);return{u_matrix:Hi(f,i,u,v),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:p.exported.devicePixelRatio,u_image:0,u_scale:[D,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}};function ar(f,i){return 1/dr(f,1,i.tileZoom)}function Hi(f,i,u,g){return f.translatePosMatrix(g||i.tileID.projMatrix,i,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const fo=f=>{const i=[];return ai(f)&&i.push("RENDER_LINE_DASH"),f.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT"),i};function ai(f){const i=f.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const dl=(f,i,u,g,v)=>{return{u_matrix:f,u_tl_parent:i,u_scale_parent:u,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(D=v.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(x=v.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:ts(v.paint.get("raster-hue-rotate"))};var x,D};function ts(f){f*=Math.PI/180;const i=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const va=(f,i,u,g,v,x,D,S,A,R,F,L,j,G)=>{const X=v.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:X.width/X.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:D,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+g,u_texsize:R,u_tile_id:F,u_zoom_transition:L,u_inv_rot_matrix:j,u_merc_center:G,u_texture:0}},pl=(f,i,u,g,v,x,D,S,A,R,F,L,j,G,X)=>{const{cameraToCenterDistance:q,_pitch:J}=v.transform;return p.extend(va(f,i,u,g,v,x,D,S,A,R,L,j,G,X),{u_gamma_scale:g?q*Math.cos(v.terrain?0:J):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+F})},Ps=(f,i,u,g,v,x,D,S,A,R,F,L,j,G)=>p.extend(pl(f,i,u,g,v,x,D,S,!0,A,!0,F,L,j,G),{u_texsize_icon:R,u_texture_icon:1}),Ir=(f,i,u)=>({u_matrix:f,u_opacity:i,u_color:u}),cp=(f,i,u,g,v,x)=>p.extend(function(D,S,A,R){const F=A.imageManager.getPattern(D.from.toString()),L=A.imageManager.getPattern(D.to.toString()),{width:j,height:G}=A.imageManager.getPixelSize(),X=Math.pow(2,R.tileID.overscaledZ),q=R.tileSize*Math.pow(2,A.transform.tileZoom)/X,J=q*(R.tileID.canonical.x+R.tileID.wrap*X),H=q*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[j,G],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/dr(R,1,A.transform.tileZoom),u_pixel_coord_upper:[J>>16,H>>16],u_pixel_coord_lower:[65535&J,65535&H]}}(g,x,u,v),{u_matrix:f,u_opacity:i}),Ai={fillExtrusion:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_lightpos:new p.Uniform3f(f,i.u_lightpos),u_lightintensity:new p.Uniform1f(f,i.u_lightintensity),u_lightcolor:new p.Uniform3f(f,i.u_lightcolor),u_vertical_gradient:new p.Uniform1f(f,i.u_vertical_gradient),u_opacity:new p.Uniform1f(f,i.u_opacity)}),fillExtrusionPattern:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_lightpos:new p.Uniform3f(f,i.u_lightpos),u_lightintensity:new p.Uniform1f(f,i.u_lightintensity),u_lightcolor:new p.Uniform3f(f,i.u_lightcolor),u_vertical_gradient:new p.Uniform1f(f,i.u_vertical_gradient),u_height_factor:new p.Uniform1f(f,i.u_height_factor),u_image:new p.Uniform1i(f,i.u_image),u_texsize:new p.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(f,i.u_scale),u_fade:new p.Uniform1f(f,i.u_fade),u_opacity:new p.Uniform1f(f,i.u_opacity)}),fill:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix)}),fillPattern:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_image:new p.Uniform1i(f,i.u_image),u_texsize:new p.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(f,i.u_scale),u_fade:new p.Uniform1f(f,i.u_fade)}),fillOutline:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_world:new p.Uniform2f(f,i.u_world)}),fillOutlinePattern:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_world:new p.Uniform2f(f,i.u_world),u_image:new p.Uniform1i(f,i.u_image),u_texsize:new p.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new p.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new p.Uniform3f(f,i.u_scale),u_fade:new p.Uniform1f(f,i.u_fade)}),circle:(f,i)=>({u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_extrude_scale:new p.UniformMatrix2f(f,i.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(f,i.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(f,i.u_matrix)}),collisionBox:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_extrude_scale:new p.Uniform2f(f,i.u_extrude_scale)}),collisionCircle:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_inv_matrix:new p.UniformMatrix4f(f,i.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(f,i.u_viewport_size)}),debug:(f,i)=>({u_color:new p.UniformColor(f,i.u_color),u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_overlay:new p.Uniform1i(f,i.u_overlay),u_overlay_scale:new p.Uniform1f(f,i.u_overlay_scale)}),clippingMask:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix)}),heatmap:(f,i)=>({u_extrude_scale:new p.Uniform1f(f,i.u_extrude_scale),u_intensity:new p.Uniform1f(f,i.u_intensity),u_matrix:new p.UniformMatrix4f(f,i.u_matrix)}),heatmapTexture:(f,i)=>({u_image:new p.Uniform1i(f,i.u_image),u_color_ramp:new p.Uniform1i(f,i.u_color_ramp),u_opacity:new p.Uniform1f(f,i.u_opacity)}),hillshade:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_image:new p.Uniform1i(f,i.u_image),u_latrange:new p.Uniform2f(f,i.u_latrange),u_light:new p.Uniform2f(f,i.u_light),u_shadow:new p.UniformColor(f,i.u_shadow),u_highlight:new p.UniformColor(f,i.u_highlight),u_accent:new p.UniformColor(f,i.u_accent)}),hillshadePrepare:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_image:new p.Uniform1i(f,i.u_image),u_dimension:new p.Uniform2f(f,i.u_dimension),u_zoom:new p.Uniform1f(f,i.u_zoom),u_unpack:new p.Uniform4f(f,i.u_unpack)}),line:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_pixels_to_tile_units:new p.UniformMatrix2f(f,i.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(f,i.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(f,i.u_units_to_pixels),u_dash_image:new p.Uniform1i(f,i.u_dash_image),u_gradient_image:new p.Uniform1i(f,i.u_gradient_image),u_image_height:new p.Uniform1f(f,i.u_image_height),u_texsize:new p.Uniform2f(f,i.u_texsize),u_scale:new p.Uniform3f(f,i.u_scale),u_mix:new p.Uniform1f(f,i.u_mix)}),linePattern:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_texsize:new p.Uniform2f(f,i.u_texsize),u_pixels_to_tile_units:new p.UniformMatrix2f(f,i.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(f,i.u_device_pixel_ratio),u_image:new p.Uniform1i(f,i.u_image),u_units_to_pixels:new p.Uniform2f(f,i.u_units_to_pixels),u_scale:new p.Uniform3f(f,i.u_scale),u_fade:new p.Uniform1f(f,i.u_fade)}),raster:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_tl_parent:new p.Uniform2f(f,i.u_tl_parent),u_scale_parent:new p.Uniform1f(f,i.u_scale_parent),u_buffer_scale:new p.Uniform1f(f,i.u_buffer_scale),u_fade_t:new p.Uniform1f(f,i.u_fade_t),u_opacity:new p.Uniform1f(f,i.u_opacity),u_image0:new p.Uniform1i(f,i.u_image0),u_image1:new p.Uniform1i(f,i.u_image1),u_brightness_low:new p.Uniform1f(f,i.u_brightness_low),u_brightness_high:new p.Uniform1f(f,i.u_brightness_high),u_saturation_factor:new p.Uniform1f(f,i.u_saturation_factor),u_contrast_factor:new p.Uniform1f(f,i.u_contrast_factor),u_spin_weights:new p.Uniform3f(f,i.u_spin_weights)}),symbolIcon:(f,i)=>({u_is_size_zoom_constant:new p.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(f,i.u_size_t),u_size:new p.Uniform1f(f,i.u_size),u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(f,i.u_pitch),u_rotate_symbol:new p.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(f,i.u_fade_change),u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new p.Uniform1i(f,i.u_is_text),u_pitch_with_map:new p.Uniform1i(f,i.u_pitch_with_map),u_texsize:new p.Uniform2f(f,i.u_texsize),u_tile_id:new p.Uniform3f(f,i.u_tile_id),u_zoom_transition:new p.Uniform1f(f,i.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(f,i.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(f,i.u_merc_center),u_texture:new p.Uniform1i(f,i.u_texture)}),symbolSDF:(f,i)=>({u_is_size_zoom_constant:new p.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(f,i.u_size_t),u_size:new p.Uniform1f(f,i.u_size),u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(f,i.u_pitch),u_rotate_symbol:new p.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(f,i.u_fade_change),u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new p.Uniform1i(f,i.u_is_text),u_pitch_with_map:new p.Uniform1i(f,i.u_pitch_with_map),u_texsize:new p.Uniform2f(f,i.u_texsize),u_texture:new p.Uniform1i(f,i.u_texture),u_gamma_scale:new p.Uniform1f(f,i.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(f,i.u_device_pixel_ratio),u_tile_id:new p.Uniform3f(f,i.u_tile_id),u_zoom_transition:new p.Uniform1f(f,i.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(f,i.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(f,i.u_merc_center),u_is_halo:new p.Uniform1i(f,i.u_is_halo)}),symbolTextAndIcon:(f,i)=>({u_is_size_zoom_constant:new p.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new p.Uniform1f(f,i.u_size_t),u_size:new p.Uniform1f(f,i.u_size),u_camera_to_center_distance:new p.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new p.Uniform1f(f,i.u_pitch),u_rotate_symbol:new p.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new p.Uniform1f(f,i.u_fade_change),u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new p.Uniform1i(f,i.u_is_text),u_pitch_with_map:new p.Uniform1i(f,i.u_pitch_with_map),u_texsize:new p.Uniform2f(f,i.u_texsize),u_texsize_icon:new p.Uniform2f(f,i.u_texsize_icon),u_texture:new p.Uniform1i(f,i.u_texture),u_texture_icon:new p.Uniform1i(f,i.u_texture_icon),u_gamma_scale:new p.Uniform1f(f,i.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(f,i.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(f,i.u_is_halo)}),background:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_opacity:new p.Uniform1f(f,i.u_opacity),u_color:new p.UniformColor(f,i.u_color)}),backgroundPattern:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_opacity:new p.Uniform1f(f,i.u_opacity),u_image:new p.Uniform1i(f,i.u_image),u_pattern_tl_a:new p.Uniform2f(f,i.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(f,i.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(f,i.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(f,i.u_pattern_br_b),u_texsize:new p.Uniform2f(f,i.u_texsize),u_mix:new p.Uniform1f(f,i.u_mix),u_pattern_size_a:new p.Uniform2f(f,i.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(f,i.u_pattern_size_b),u_scale_a:new p.Uniform1f(f,i.u_scale_a),u_scale_b:new p.Uniform1f(f,i.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(f,i.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(f,i.u_tile_units_to_pixels)}),terrainRaster:Jt,terrainDepth:Jt,skybox:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_sun_direction:new p.Uniform3f(f,i.u_sun_direction),u_cubemap:new p.Uniform1i(f,i.u_cubemap),u_opacity:new p.Uniform1f(f,i.u_opacity),u_temporal_offset:new p.Uniform1f(f,i.u_temporal_offset)}),skyboxGradient:(f,i)=>({u_matrix:new p.UniformMatrix4f(f,i.u_matrix),u_color_ramp:new p.Uniform1i(f,i.u_color_ramp),u_center_direction:new p.Uniform3f(f,i.u_center_direction),u_radius:new p.Uniform1f(f,i.u_radius),u_opacity:new p.Uniform1f(f,i.u_opacity),u_temporal_offset:new p.Uniform1f(f,i.u_temporal_offset)}),skyboxCapture:(f,i)=>({u_matrix_3f:new p.UniformMatrix3f(f,i.u_matrix_3f),u_sun_direction:new p.Uniform3f(f,i.u_sun_direction),u_sun_intensity:new p.Uniform1f(f,i.u_sun_intensity),u_color_tint_r:new p.Uniform4f(f,i.u_color_tint_r),u_color_tint_m:new p.Uniform4f(f,i.u_color_tint_m),u_luminance:new p.Uniform1f(f,i.u_luminance)})};let et;function Rt(f,i,u,g,v,x,D){const S=f.context,A=S.gl,R=f.useProgram("collisionBox"),F=[];let L=0,j=0;for(let re=0;re<g.length;re++){const Z=g[re],ie=i.getTile(Z),le=ie.getBucket(u);if(!le)continue;let be=Z.projMatrix;0===v[0]&&0===v[1]||(be=f.translatePosMatrix(Z.projMatrix,ie,v,x));const xe=D?le.textCollisionBox:le.iconCollisionBox,Te=le.collisionCircleArray;if(Te.length>0){const Ee=p.create$1(),Ve=be;p.mul$1(Ee,le.placementInvProjMatrix,f.transform.glCoordMatrix),p.mul$1(Ee,Ee,le.placementViewportMatrix),F.push({circleArray:Te,circleOffset:j,transform:Ve,invTransform:Ee}),L+=Te.length/4,j=L}xe&&(f.terrain&&f.terrain.setupElevationDraw(ie,R),R.draw(S,A.LINES,p.DepthMode.disabled,p.StencilMode.disabled,f.colorModeForRenderPass(),p.CullFaceMode.disabled,po(be,f.transform,ie),u.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,f.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!D||!F.length)return;const G=f.useProgram("collisionCircle"),X=new p.StructArrayLayout2f1f2i16;X.resize(4*L),X._trim();let q=0;for(const re of F)for(let Z=0;Z<re.circleArray.length/4;Z++){const ie=4*Z,le=re.circleArray[ie+0],be=re.circleArray[ie+1],xe=re.circleArray[ie+2],Te=re.circleArray[ie+3];X.emplace(q++,le,be,xe,Te,0),X.emplace(q++,le,be,xe,Te,1),X.emplace(q++,le,be,xe,Te,2),X.emplace(q++,le,be,xe,Te,3)}(!et||et.length<2*L)&&(et=function(re){const Z=2*re,ie=new p.StructArrayLayout3ui6;ie.resize(Z),ie._trim();for(let le=0;le<Z;le++){const be=6*le;ie.uint16[be+0]=4*le+0,ie.uint16[be+1]=4*le+1,ie.uint16[be+2]=4*le+2,ie.uint16[be+3]=4*le+2,ie.uint16[be+4]=4*le+3,ie.uint16[be+5]=4*le+0}return ie}(L));const J=S.createIndexBuffer(et,!0),H=S.createVertexBuffer(X,p.collisionCircleLayout.members,!0);for(const re of F){const Z={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ee=f.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};G.draw(S,A.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,f.colorModeForRenderPass(),p.CullFaceMode.disabled,Z,u.id,H,J,p.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ee;H.destroy(),J.destroy()}const pn=p.identity(new Float32Array(16));function li(f,i,u,g,v,x){const{horizontalAlign:D,verticalAlign:S}=p.getAnchorAlignment(f),A=-(D-.5)*i,R=-(S-.5)*u,F=p.evaluateVariableOffset(f,g);return new p.pointGeometry((A/v+F[0])*x,(R/v+F[1])*x)}function ns(f,i,u,g,v,x,D,S,A,R,F,L){const j=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,q={};G.clear();for(let J=0;J<j.length;J++){const H=j.get(J),ee=f.allowVerticalPlacement&&!H.placedOrientation,re=H.hidden||!H.crossTileID||ee?null:g[H.crossTileID];if(re){const Z=new p.pointGeometry(H.tileAnchorX,H.tileAnchorY),ie=L(Z),le=Zn(Z,u?S:D,ie),be=Do(x.cameraToCenterDistance,le.signedDistanceFromCamera);let xe=v.evaluateSizeForFeature(f.textSizeData,R,H)*be/p.ONE_EM;u&&(xe*=f.tilePixelRatio/A);const{width:Te,height:Ee,anchor:Ve,textOffset:Ce,textScale:qe}=re,ye=li(Ve,Te,Ee,Ce,qe,xe),He=u?Zn(Z.add(ye),D,ie).point:le.point.add(i?ye.rotate(-x.angle):ye),nt=f.allowVerticalPlacement&&H.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<H.numGlyphs;ct++)p.addDynamicAttributes(G,He,nt);F&&H.associatedIconIndex>=0&&(q[H.associatedIconIndex]={shiftedAnchor:He,angle:nt})}else kt(H.numGlyphs,G)}if(F){X.clear();const J=f.icon.placedSymbolArray;for(let H=0;H<J.length;H++){const ee=J.get(H);if(ee.hidden)kt(ee.numGlyphs,X);else{const re=q[H];if(re)for(let Z=0;Z<ee.numGlyphs;Z++)p.addDynamicAttributes(X,re.shiftedAnchor,re.angle);else kt(ee.numGlyphs,X)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function tr(f,i,u){return u.iconsInText&&i?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ci(f,i,u,g,v,x,D,S,A,R,F,L){const j=f.context,G=j.gl,X=f.transform,q="map"===S,J="map"===A,H=q&&"point"!==u.layout.get("symbol-placement"),ee=q&&!J&&!H,re=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let Z=!1;const ie=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),le=[0,0],be=u.layout.get("text-variable-anchor"),xe=[],Te=[];f.terrain&&J&&Te.push("PITCH_WITH_MAP_TERRAIN"),H&&Te.push("PROJECTED_POS_ON_VIEWPORT");for(const Ee of g){const Ve=i.getTile(Ee),Ce=Ve.getBucket(u);if(!Ce)continue;const qe=v?Ce.text:Ce.icon;if(!qe||!qe.segments.get().length)continue;const ye=qe.programConfigurations.get(u.id),He=v||Ce.sdfIcons,nt=v?Ce.textSizeData:Ce.iconSizeData,ct=J||0!==X.pitch,ft=f.useProgram(tr(He,v,Ce),ye,Te),mt=p.evaluateSizeForZoom(nt,X.zoom),dt=[Ee.canonical.x,Ee.canonical.y,1<<Ee.canonical.z];let lt,vt,Zt,Kn,mr=[0,0],Qn=null;if(v){if(vt=Ve.glyphAtlasTexture,Zt=G.LINEAR,lt=Ve.glyphAtlasTexture.size,Ce.iconsInText){mr=Ve.imageAtlasTexture.size,Qn=Ve.imageAtlasTexture;const Dr="composite"===nt.kind||"camera"===nt.kind;Kn=ct||f.options.rotating||f.options.zooming||Dr?G.LINEAR:G.NEAREST}}else{const Dr=1!==u.layout.get("icon-size").constantOr(0)||Ce.iconsNeedLinear;vt=Ve.imageAtlasTexture,Zt=He||f.options.rotating||f.options.zooming||Dr||ct?G.LINEAR:G.NEAREST,lt=Ve.imageAtlasTexture.size}const qr=f.transform.calculatePixelsToTileUnitsMatrix(Ve),kn=Pt(Ee.projMatrix,J,q,f.transform,qr),Qi=f.terrain&&J&&H?p.invert(new Float32Array(16),kn):pn,vi=Dt(Ee.projMatrix,J,q,f.transform,qr),Sn=be&&Ce.hasTextData(),Nn="none"!==u.layout.get("icon-text-fit")&&Sn&&Ce.hasIconData();if(H){const Dr=X.elevation;ca(Ce,Ee.projMatrix,f,v,kn,vi,J,R,Dr?Ji=>Dr.getAtTileOffset(Ee,Ji.x,Ji.y):null)}const Nt=f.translatePosMatrix(Ee.projMatrix,Ve,x,D),In=H||v&&be||Nn?pn:kn,Er=f.translatePosMatrix(vi,Ve,x,D,!0),ln=He&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Hr;Hr=He?Ce.iconsInText?Ps(nt.kind,mt,ee,J,f,Nt,In,Er,lt,mr,dt,0,f.identityMat,le):pl(nt.kind,mt,ee,J,f,Nt,In,Er,v,lt,!0,dt,0,f.identityMat,le):va(nt.kind,mt,ee,J,f,Nt,In,Er,v,lt,dt,0,f.identityMat,le);const Us={program:ft,buffers:qe,uniformValues:Hr,atlasTexture:vt,atlasTextureIcon:Qn,atlasInterpolation:Zt,atlasInterpolationIcon:Kn,isSDF:He,hasHalo:ln,tile:Ve,labelPlaneMatrixInv:Qi};if(re&&Ce.canOverlap){Z=!0;const Dr=qe.segments.get();for(const Ji of Dr)xe.push({segments:new p.SegmentVector([Ji]),sortKey:Ji.sortKey,state:Us})}else xe.push({segments:qe.segments,sortKey:0,state:Us})}Z&&xe.sort((Ee,Ve)=>Ee.sortKey-Ve.sortKey);for(const Ee of xe){const Ve=Ee.state;if(f.terrain&&f.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),j.activeTexture.set(G.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,G.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(j.activeTexture.set(G.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),Ve.isSDF){const Ce=Ve.uniformValues;Ve.hasHalo&&(Ce.u_is_halo=1,Bn(Ve.buffers,Ee.segments,u,f,Ve.program,ie,F,L,Ce)),Ce.u_is_halo=0}Bn(Ve.buffers,Ee.segments,u,f,Ve.program,ie,F,L,Ve.uniformValues)}}function Bn(f,i,u,g,v,x,D,S,A){const R=g.context;v.draw(R,R.gl.TRIANGLES,x,D,S,p.CullFaceMode.disabled,A,u.id,f.layoutVertexBuffer,f.indexBuffer,i,u.paint,g.transform.zoom,f.programConfigurations.get(u.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Zi(f,i,u,g,v,x,D){const S=f.context.gl,A=u.paint.get("fill-pattern"),R=A&&A.constantOr(1),F=u.getCrossfadeParameters();let L,j,G,X,q;D?(j=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=S.LINES):(j=R?"fillPattern":"fill",L=S.TRIANGLES);for(const J of g){const H=i.getTile(J);if(R&&!H.patternsLoaded())continue;const ee=H.getBucket(u);if(!ee)continue;f.prepareDrawTile(J);const re=ee.programConfigurations.get(u.id),Z=f.useProgram(j,re);R&&(f.context.activeTexture.set(S.TEXTURE0),H.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),re.updatePaintBuffers(F));const ie=A.constantOr(null);if(ie&&H.imageAtlas){const be=H.imageAtlas,xe=be.patternPositions[ie.to.toString()],Te=be.patternPositions[ie.from.toString()];xe&&Te&&re.setConstantPatternPositions(xe,Te)}const le=f.translatePosMatrix(J.projMatrix,H,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(D){X=ee.indexBuffer2,q=ee.segments2;const be=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];G="fillOutlinePattern"===j&&R?fu(le,f,F,H,be):ul(le,be)}else X=ee.indexBuffer,q=ee.segments,G=R?pr(le,f,F,H):Ih(le);f.prepareDrawProgram(f.context,Z,J.toUnwrapped()),Z.draw(f.context,L,v,f.stencilModeForClipping(J),x,p.CullFaceMode.disabled,G,u.id,ee.layoutVertexBuffer,X,q,u.paint,f.transform.zoom,re)}}function gi(f,i,u,g,v,x,D){const S=f.context,A=S.gl,R=u.paint.get("fill-extrusion-pattern"),F=R.constantOr(1),L=u.getCrossfadeParameters(),j=u.paint.get("fill-extrusion-opacity");for(const G of g){const X=i.getTile(G),q=X.getBucket(u);if(!q)continue;const J=q.programConfigurations.get(u.id),H=f.useProgram(F?"fillExtrusionPattern":"fillExtrusion",J);if(f.terrain){const le=f.terrain;if(!q.enableTerrain)continue;if(le.setupElevationDraw(X,H,{useMeterToDem:!0}),At(S,i,G,q,u,le),!q.centroidVertexBuffer){const be=H.attributes.a_centroid_pos;void 0!==be&&A.vertexAttrib2f(be,0,0)}}F&&(f.context.activeTexture.set(A.TEXTURE0),X.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),J.updatePaintBuffers(L));const ee=R.constantOr(null);if(ee&&X.imageAtlas){const le=X.imageAtlas,be=le.patternPositions[ee.to.toString()],xe=le.patternPositions[ee.from.toString()];be&&xe&&J.setConstantPatternPositions(be,xe)}const re=f.translatePosMatrix(G.projMatrix,X,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Z=u.paint.get("fill-extrusion-vertical-gradient"),ie=F?ya(re,f,Z,j,G,L,X):qi(re,f,Z,j);f.prepareDrawProgram(S,H,G.toUnwrapped()),H.draw(S,S.gl.TRIANGLES,v,x,D,p.CullFaceMode.backCCW,ie,u.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,u.paint,f.transform.zoom,J,f.terrain?q.centroidVertexBuffer:null)}}function At(f,i,u,g,v,x){const D=[H=>{let ee=H.canonical.x-1,re=H.wrap;return ee<0&&(ee=(1<<H.canonical.z)-1,re--),new p.OverscaledTileID(H.overscaledZ,re,H.canonical.z,ee,H.canonical.y)},H=>{let ee=H.canonical.x+1,re=H.wrap;return ee===1<<H.canonical.z&&(ee=0,re++),new p.OverscaledTileID(H.overscaledZ,re,H.canonical.z,ee,H.canonical.y)},H=>new p.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(0===H.canonical.y?1<<H.canonical.z:H.canonical.y)-1),H=>new p.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],S=H=>{const ee=i.getSource().maxzoom,re=be=>{const xe=i.getTileByID(be);if(xe&&xe.hasData())return xe.getBucket(v)};let Z,ie,le;return(H.overscaledZ===H.canonical.z||H.overscaledZ>=ee)&&(Z=re(H.key)),H.overscaledZ>=ee&&(ie=re(H.calculateScaledKey(H.overscaledZ+1))),H.overscaledZ>ee&&(le=re(H.calculateScaledKey(H.overscaledZ-1))),Z||ie||le},A=[0,0,0],R=(H,ee)=>(A[0]=Math.min(H.min.y,ee.min.y),A[1]=Math.max(H.max.y,ee.max.y),A[2]=p.EXTENT-ee.min.x>H.max.x?ee.min.x-p.EXTENT:H.max.x,A),F=(H,ee)=>(A[0]=Math.min(H.min.x,ee.min.x),A[1]=Math.max(H.max.x,ee.max.x),A[2]=p.EXTENT-ee.min.y>H.max.y?ee.min.y-p.EXTENT:H.max.y,A),L=[(H,ee)=>R(H,ee),(H,ee)=>R(ee,H),(H,ee)=>F(H,ee),(H,ee)=>F(ee,H)],j=new p.pointGeometry(0,0);let G,X,q;const J=(H,ee,re,Z,ie)=>{const le=[[Z?re:H,Z?H:re,0],[Z?re:ee,Z?ee:re,0]],be=ie<0?p.EXTENT+ie:ie,xe=[Z?be:(H+ee)/2,Z?(H+ee)/2:be,0];return 0===re&&ie<0||0!==re&&ie>0?x.getForTilePoints(q,[xe],!0,X):le.push(xe),x.getForTilePoints(u,le,!0,G),Math.max(le[0][2],le[1][2],xe[2])/x.exaggeration()};for(let H=0;H<4;H++){const ee=g.borders[H];if(0===ee.length&&(g.borderDone[H]=!0),g.borderDone[H])continue;const re=q=D[H](u),Z=S(re);if(!(Z&&Z.enableTerrain&&(X=x.findDEMTileFor(re),X&&X.dem)))continue;if(!G){const xe=x.findDEMTileFor(u);if(!xe||!xe.dem)return;G=xe}const ie=(H<2?1:5)-H,le=Z.borders[ie];let be=0;for(let xe=0;xe<ee.length;xe++){const Te=g.featuresOnBorder[ee[xe]],Ee=Te.borders[H];let Ve;for(;be<le.length&&(Ve=Z.featuresOnBorder[le[be]],!(Ve.borders[ie][1]>Ee[0]+3));)Z.borderDone[ie]||Z.encodeCentroid(void 0,Ve,!1),be++;if(Ve&&be<le.length){const Ce=be;let qe=0;for(;!(Ve.borders[ie][0]>Ee[1]-3)&&(qe++,++be!==le.length);)Ve=Z.featuresOnBorder[le[be]];if(Ve=Z.featuresOnBorder[le[Ce]],Te.intersectsCount()>1||Ve.intersectsCount()>1||1!==qe){1!==qe&&(be=Ce),g.encodeCentroid(void 0,Te,!1),Z.borderDone[ie]||Z.encodeCentroid(void 0,Ve,!1);continue}const ye=L[H](Te,Ve),He=H%2?p.EXTENT-1:0;j.x=J(ye[0],Math.min(p.EXTENT-1,ye[1]),He,H<2,ye[2]),j.y=0,g.encodeCentroid(j,Te,!1),Z.borderDone[ie]||Z.encodeCentroid(j,Ve,!1)}else g.encodeCentroid(void 0,Te,!1)}g.borderDone[H]=g.needsCentroidUpdate=!0,Z.borderDone[ie]||(Z.borderDone[ie]=Z.needsCentroidUpdate=!0)}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const xa=new p.Color(1,0,0,1),Ot=new p.Color(0,1,0,1),ba=new p.Color(0,0,1,1),wa=new p.Color(1,0,1,1),$r=new p.Color(0,1,1,1);function mo(f,i,u,g){ui(f,0,i+u/2,f.transform.width,u,g)}function ks(f,i,u,g){ui(f,i-u/2,0,u,f.transform.height,g)}function ui(f,i,u,g,v,x){const D=f.context,S=D.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*p.exported.devicePixelRatio,u*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio),D.clear({color:x}),S.disable(S.SCISSOR_TEST)}function Cn(f,i,u){const g=f.context,v=g.gl,x=u.projMatrix,D=f.useProgram("debug"),S=i.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(S,D);const A=p.DepthMode.disabled,R=p.StencilMode.disabled,F=f.colorModeForRenderPass(),L="$debug";g.activeTexture.set(v.TEXTURE0),f.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),S._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const j=S._tileDebugBuffer||f.debugBuffer,G=S._tileDebugIndexBuffer||f.debugIndexBuffer,X=S._tileDebugSegments||f.debugSegments;D.draw(g,v.LINE_STRIP,A,R,F,p.CullFaceMode.disabled,hl(x,p.Color.red),L,j,G,X);const q=S.latestRawTileData,J=Math.floor((q&&q.byteLength||0)/1024),H=i.getTile(u).tileSize,ee=512/Math.min(H,512)*(u.overscaledZ/f.transform.zoom)*.5;let re=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(re+=` => ${u.overscaledZ}`),function(Z,ie){Z.initDebugOverlayCanvas();const le=Z.debugOverlayCanvas,be=Z.context.gl,xe=Z.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,le.width,le.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(ie,5,5),xe.strokeText(ie,5,5),Z.debugOverlayTexture.update(le),Z.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(f,`${re} ${J}kb`),D.draw(g,v.TRIANGLES,A,R,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,hl(x,p.Color.transparent,ee),L,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const up=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mu}=up;function nr(f,i,u,g){f.emplaceBack(i,u,g)}class Mr{constructor(i){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,nr(this.vertexArray,-1,-1,1),nr(this.vertexArray,1,-1,1),nr(this.vertexArray,-1,1,1),nr(this.vertexArray,1,1,1),nr(this.vertexArray,-1,-1,-1),nr(this.vertexArray,1,-1,-1),nr(this.vertexArray,-1,1,-1),nr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,mu),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function go(f,i,u,g,v,x){const D=f.gl,S=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),R=i.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:p.fromMat4([],g),u_sun_direction:v,u_sun_intensity:R,u_color_tint_r:[(X=S).r,X.g,X.b,X.a],u_color_tint_m:[(q=A).r,q.g,q.b,q.a],u_luminance:5e-5};var X,q;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+x,i.skyboxTexture,0),u.draw(f,D.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,F,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Rs={symbol:function(f,i,u,g,v){if("translucent"!==f.renderPass)return;const x=p.StencilMode.disabled,D=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(S,A,R,F,L,j,G){const X=A.transform,q="map"===L,J="map"===j;for(const H of S){const ee=F.getTile(H),re=ee.getBucket(R);if(!re||!re.text||!re.text.segments.get().length)continue;const Z=p.evaluateSizeForZoom(re.textSizeData,X.zoom),ie=A.transform.calculatePixelsToTileUnitsMatrix(ee),le=Pt(H.projMatrix,J,q,A.transform,ie),be="none"!==R.layout.get("icon-text-fit")&&re.hasIconData();if(Z){const xe=Math.pow(2,X.zoom-ee.tileID.overscaledZ),Te=X.elevation;ns(re,q,J,G,p.symbolSize,X,le,H.projMatrix,xe,Z,be,Te?Ee=>Te.getAtTileOffset(H,Ee.x,Ee.y):Ee=>0)}}}(g,f,u,i,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&ci(f,i,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),x,D),0!==u.paint.get("text-opacity").constantOr(1)&&ci(f,i,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),x,D),i.map.showCollisionBoxes&&(Rt(f,i,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Rt(f,i,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),D=u.paint.get("circle-stroke-opacity"),S=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===x.constantOr(1)||0===D.constantOr(1)))return;const A=f.context,R=A.gl,F=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),L=p.StencilMode.disabled,j=f.colorModeForRenderPass(),G=[];for(let X=0;X<g.length;X++){const q=g[X],J=i.getTile(q),H=J.getBucket(u);if(!H)continue;const ee=H.programConfigurations.get(u.id),re=cc(u),Z={programConfiguration:ee,program:f.useProgram("circle",ee,re),layoutVertexBuffer:H.layoutVertexBuffer,indexBuffer:H.indexBuffer,uniformValues:si(f,q,J,u),tile:J};if(S){const ie=H.segments.get();for(const le of ie)G.push({segments:new p.SegmentVector([le]),sortKey:le.sortKey,state:Z})}else G.push({segments:H.segments,sortKey:0,state:Z})}S&&G.sort((X,q)=>X.sortKey-q.sortKey);for(const X of G){const{programConfiguration:q,program:J,layoutVertexBuffer:H,indexBuffer:ee,uniformValues:re,tile:Z}=X.state,ie=X.segments;f.terrain&&f.terrain.setupElevationDraw(Z,J,{useDepthForOcclusion:!0}),f.prepareDrawProgram(A,J,Z.tileID.toUnwrapped()),J.draw(A,R.TRIANGLES,F,L,j,p.CullFaceMode.disabled,re,u.id,H,ee,ie,u.paint,f.transform.zoom,q)}},heatmap:function(f,i,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,x=v.gl,D=p.StencilMode.disabled,S=new p.ColorMode([x.ONE,x.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(A,R,F){const L=A.gl;A.activeTexture.set(L.TEXTURE1),A.viewport.set([0,0,R.width/4,R.height/4]);let j=F.heatmapFbo;if(j)L.bindTexture(L.TEXTURE_2D,j.colorAttachment.get()),A.bindFramebuffer.set(j.framebuffer);else{const G=L.createTexture();L.bindTexture(L.TEXTURE_2D,G),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),j=F.heatmapFbo=A.createFramebuffer(R.width/4,R.height/4,!1),function(X,q,J,H){const ee=X.gl;ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,q.width/4,q.height/4,0,ee.RGBA,X.extRenderToTextureHalfFloat?X.extTextureHalfFloat.HALF_FLOAT_OES:ee.UNSIGNED_BYTE,null),H.colorAttachment.set(J)}(A,R,G,j)}})(v,f,u),v.clear({color:p.Color.transparent});for(let A=0;A<g.length;A++){const R=g[A];if(i.hasRenderableParent(R))continue;const F=i.getTile(R),L=F.getBucket(u);if(!L)continue;const j=L.programConfigurations.get(u.id),G=f.useProgram("heatmap",j),{zoom:X}=f.transform;f.terrain&&f.terrain.setupElevationDraw(F,G),f.prepareDrawProgram(v,G,R.toUnwrapped()),G.draw(v,x.TRIANGLES,p.DepthMode.disabled,D,S,p.CullFaceMode.disabled,uc(R.projMatrix,F,X,u.paint.get("heatmap-intensity")),u.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,u.paint,f.transform.zoom,j)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){const D=v.context,S=D.gl,A=x.heatmapFbo;if(!A)return;D.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),D.activeTexture.set(S.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new p.Texture(D,x.colorRamp,S.RGBA)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(D,S.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,u))},line:function(f,i,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(0===v.constantOr(1)||0===x.constantOr(1))return;const D=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),S=f.colorModeForRenderPass(),A=u.paint.get("line-dasharray"),R=A.constantOr(1),F=u.layout.get("line-cap"),L=u.paint.get("line-pattern"),j=L.constantOr(1),G=u.paint.get("line-gradient"),X=u.getCrossfadeParameters(),q=j?"linePattern":"line",J=f.context,H=J.gl;for(const ee of g){const re=i.getTile(ee);if(j&&!re.patternsLoaded())continue;const Z=re.getBucket(u);if(!Z)continue;f.prepareDrawTile(ee);const ie=Z.programConfigurations.get(u.id),le=fo(u),be=f.useProgram(q,ie,le),xe=L.constantOr(null);if(xe&&re.imageAtlas){const qe=re.imageAtlas,ye=qe.patternPositions[xe.to.toString()],He=qe.patternPositions[xe.from.toString()];ye&&He&&ie.setConstantPatternPositions(ye,He)}const Te=A.constantOr(null),Ee=F.constantOr(null);if(!j&&Te&&Ee&&re.lineAtlas){const qe=re.lineAtlas,ye=qe.getDash(Te.to,Ee),He=qe.getDash(Te.from,Ee);ye&&He&&ie.setConstantPatternPositions(ye,He)}const Ve=f.terrain?ee.projMatrix:null,Ce=j?wr(f,re,u,X,Ve):fr(f,re,u,X,Ve,Z.lineClipsArray.length);if(G){const qe=Z.gradients[u.id];let ye=qe.texture;if(u.gradientVersion!==qe.version){let He=256;if(u.stepInterpolant){const nt=i.getSource().maxzoom,ct=ee.canonical.z===nt?Math.ceil(1<<f.transform.maxZoom-ee.canonical.z):1;He=p.clamp(p.nextPowerOfTwo(Z.maxLineLength/p.EXTENT*1024*ct),256,J.maxTextureSize)}qe.gradient=p.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:qe.gradient||void 0,clips:Z.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new p.Texture(J,qe.gradient,H.RGBA),qe.version=u.gradientVersion,ye=qe.texture}J.activeTexture.set(H.TEXTURE1),ye.bind(u.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}R&&(J.activeTexture.set(H.TEXTURE0),re.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),ie.updatePaintBuffers(X)),j&&(J.activeTexture.set(H.TEXTURE0),re.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),ie.updatePaintBuffers(X)),f.prepareDrawProgram(J,be,ee.toUnwrapped()),be.draw(J,H.TRIANGLES,D,f.stencilModeForClipping(ee),S,p.CullFaceMode.disabled,Ce,u.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,u.paint,f.transform.zoom,ie,Z.layoutVertexBuffer2)}},fill:function(f,i,u,g){const v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(0===x.constantOr(1))return;const D=f.colorModeForRenderPass(),S=u.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===v.constantOr(p.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===A){const R=f.depthModeForSublayer(1,"opaque"===f.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Zi(f,i,u,g,R,D,!1)}if("translucent"===f.renderPass&&u.paint.get("fill-antialias")){const R=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Zi(f,i,u,g,R,D,!0)}},"fill-extrusion":function(f,i,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const x=new p.DepthMode(f.context.gl.LEQUAL,p.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))gi(f,i,u,g,x,p.StencilMode.disabled,p.ColorMode.disabled),gi(f,i,u,g,x,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const D=f.colorModeForRenderPass();gi(f,i,u,g,x,p.StencilMode.disabled,D)}}},hillshade:function(f,i,u,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,x=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),D=f.colorModeForRenderPass(),S=f.terrain&&f.terrain.renderingToTexture,[A,R]="translucent"!==f.renderPass||S?[{},g]:f.stencilConfigForOverlap(g);for(const F of R){const L=i.getTile(F);if(L.needsHillshadePrepare&&"offscreen"===f.renderPass)oi(f,L,u,x,p.StencilMode.disabled,D);else if("translucent"===f.renderPass){const j=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(F):A[F.overscaledZ];Ch(f,F,L,u,x,j,D)}}v.viewport.set([0,0,f.width,f.height])},raster:function(f,i,u,g,v,x){if("translucent"!==f.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const D=f.context,S=D.gl,A=i.getSource(),R=f.useProgram("raster"),F=f.colorModeForRenderPass(),L=f.terrain&&f.terrain.renderingToTexture,[j,G]=A instanceof Y||L?[{},g]:f.stencilConfigForOverlap(g),X=G[G.length-1].overscaledZ,q=!f.options.moving;for(const J of G){const H=L?p.DepthMode.disabled:f.depthModeForSublayer(J.overscaledZ-X,1===u.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,S.LESS),ee=J.toUnwrapped(),re=i.getTile(J);if(L&&(!re||!re.hasData()))continue;const Z=L?J.projMatrix:f.transform.calculateProjMatrix(ee,q),ie=f.terrain&&L?f.terrain.stencilModeForRTTOverlap(J):j[J.overscaledZ],le=x?0:u.paint.get("raster-fade-duration");re.registerFadeDuration(le);const be=i.findLoadedParent(J,0),xe=Sh(re,be,i,f.transform,le);let Te,Ee;f.terrain&&f.terrain.prepareDrawTile(J);const Ve="nearest"===u.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;D.activeTexture.set(S.TEXTURE0),re.texture.bind(Ve,S.CLAMP_TO_EDGE),D.activeTexture.set(S.TEXTURE1),be?(be.texture.bind(Ve,S.CLAMP_TO_EDGE),Te=Math.pow(2,be.tileID.overscaledZ-re.tileID.overscaledZ),Ee=[re.tileID.canonical.x*Te%1,re.tileID.canonical.y*Te%1]):re.texture.bind(Ve,S.CLAMP_TO_EDGE);const Ce=dl(Z,Ee||[0,0],Te||1,xe,u);if(f.prepareDrawProgram(D,R,ee),A instanceof Y)R.draw(D,S.TRIANGLES,H,p.StencilMode.disabled,F,p.CullFaceMode.disabled,Ce,u.id,A.boundsBuffer,f.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:ye,tileBoundsSegments:He}=f.getTileBoundsBuffers(re);R.draw(D,S.TRIANGLES,H,ie,F,p.CullFaceMode.disabled,Ce,u.id,qe,ye,He)}}},background:function(f,i,u,g){const v=u.paint.get("background-color"),x=u.paint.get("background-opacity");if(0===x)return;const D=f.context,S=D.gl,A=f.transform,R=A.tileSize,F=u.paint.get("background-pattern");if(f.isPatternMissing(F))return;const L=!F&&1===v.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==L)return;const j=p.StencilMode.disabled,G=f.depthModeForSublayer(0,"opaque"===L?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),X=f.colorModeForRenderPass(),q=f.useProgram(F?"backgroundPattern":"background");let J,H=g;H||(J=f.getBackgroundTiles(),H=Object.values(J).map(re=>re.tileID)),F&&(D.activeTexture.set(S.TEXTURE0),f.imageManager.bind(f.context));const ee=u.getCrossfadeParameters();for(const re of H){const Z=re.toUnwrapped(),ie=g?re.projMatrix:f.transform.calculateProjMatrix(Z);f.prepareDrawTile(re);const le=i?i.getTile(re):J?J[re.key]:new p.Tile(re,R,A.zoom,f),be=F?cp(ie,x,f,F,{tileID:re,tileSize:R},ee):Ir(ie,x,v);f.prepareDrawProgram(D,q,Z);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Te,tileBoundsSegments:Ee}=f.getTileBoundsBuffers(le);q.draw(D,S.TRIANGLES,G,j,X,p.CullFaceMode.disabled,be,u.id,xe,Te,Ee)}},sky:function(f,i,u){const g=f.transform,v="mercator"===g.projection.name?1:p.smoothstep(7,8,g.zoom),x=u.paint.get("sky-opacity")*v;if(0===x)return;const D=f.context,S=u.paint.get("sky-type"),A=new p.DepthMode(D.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===f.renderPass?u.needsSkyboxCapture(f)&&(function(F,L,j,G){const X=F.context,q=X.gl;let J=L.skyboxFbo;if(!J){J=L.skyboxFbo=X.createFramebuffer(32,32,!1),L.skyboxGeometry=new Mr(X),L.skyboxTexture=X.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let Z=0;Z<6;++Z)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(J.framebuffer),X.viewport.set([0,0,32,32]);const H=L.getCenter(F,!0),ee=F.useProgram("skyboxCapture"),re=new Float64Array(16);p.identity(re),p.rotateY(re,re,.5*-Math.PI),go(X,L,ee,re,H,0),p.identity(re),p.rotateY(re,re,.5*Math.PI),go(X,L,ee,re,H,1),p.identity(re),p.rotateX(re,re,.5*-Math.PI),go(X,L,ee,re,H,2),p.identity(re),p.rotateX(re,re,.5*Math.PI),go(X,L,ee,re,H,3),p.identity(re),go(X,L,ee,re,H,4),p.identity(re),p.rotateY(re,re,Math.PI),go(X,L,ee,re,H,5),X.viewport.set([0,0,F.width,F.height])}(f,u),u.markSkyboxValid(f)):"sky"===f.renderPass&&function(F,L,j,G,X){const q=F.context,J=q.gl,H=F.transform,ee=F.useProgram("skybox");q.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,L.skyboxTexture);const re={u_matrix:H.skyboxMatrix,u_sun_direction:L.getCenter(F,!1),u_cubemap:0,u_opacity:G,u_temporal_offset:X};F.prepareDrawProgram(q,ee),ee.draw(q,J.TRIANGLES,j,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,re,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,u,A,x,R):"gradient"===S&&"sky"===f.renderPass&&function(F,L,j,G,X){const q=F.context,J=q.gl,H=F.transform,ee=F.useProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Mr(q)),q.activeTexture.set(J.TEXTURE0);let re=L.colorRampTexture;re||(re=L.colorRampTexture=new p.Texture(q,L.colorRamp,J.RGBA)),re.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Z=(ie=H.skyboxMatrix,le=L.getCenter(F,!1),be=L.paint.get("sky-gradient-radius"),xe=G,Te=X,{u_matrix:ie,u_color_ramp:0,u_center_direction:le,u_radius:p.degToRad(be),u_opacity:xe,u_temporal_offset:Te});var ie,le,be,xe,Te;F.prepareDrawProgram(q,ee),ee.draw(q,J.TRIANGLES,j,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,Z,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,u,A,x,R)},debug:function(f,i,u){for(let g=0;g<u.length;g++)Cn(f,i,u[g])},custom:function(f,i,u){const g=f.context,v=u.implementation;if("mercator"===f.transform.projection.name){if("offscreen"===f.renderPass){const x=v.prerender;x&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),x.call(v,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(p.StencilMode.disabled);const x="3d"===v.renderingMode?new p.DepthMode(f.context.gl.LEQUAL,p.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,p.DepthMode.ReadOnly);g.setDepthMode(x),v.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class fl{constructor(i,u){this.context=new ol(i),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pa,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,u){const g=!!i&&!!i.terrain&&"mercator"===this.transform.projection.name;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ma(this,i));const v=this._terrain;this.transform.elevation=g?v:null,v.update(i,this.transform,u)}_updateFog(i){const u=i.fog;if(!u||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,u){if(this.width=i*p.exported.devicePixelRatio,this.height=u*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const i=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=i.createVertexBuffer(g,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const v=new p.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const x=new p.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(p.EXTENT,0,p.EXTENT,0),x.emplaceBack(0,p.EXTENT,0,p.EXTENT),x.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(x,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const D=new p.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(D);const S=new p.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new p.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=p.create$1();const A=this.context.gl;this.stencilClearMode=new p.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(p.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(i,u.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,lc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,u,g){if(!(u&&this.currentStencilSource!==u.id&&i.isTileClipped()&&g&&g.length))return;this.currentStencilSource=u.id;const v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of g){const A=u.getTile(S),R=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:L,tileBoundsSegments:j}=this.getTileBoundsBuffers(A);D.draw(v,x.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,lc(S.projMatrix),"$clipping",F,L,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new p.StencilMode({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const u=this.context.gl;return new p.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(i){const u=this.context.gl,g=i.sort((D,S)=>S.overscaledZ-D.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const D={};for(let S=0;S<x;S++)D[S+v]=new p.StencilMode({func:u.GEQUAL,mask:255},S+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[D,g]}return[{[v]:p.StencilMode.disabled},g]}colorModeForRenderPass(){const i=this.context.gl;if(this._showOverdrawInspector){const u=1/8;return new p.ColorMode([i.CONSTANT_COLOR,i.ONE],new p.Color(u,u,u,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(i,u,g){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new p.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,u){this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const R in v){const F=v[R];F.used&&F.prepare(this.context)}const x={},D={},S={};for(const R in v){const F=v[R];x[R]=F.getVisibleCoordinates(),D[R]=x[R].slice().reverse(),S[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of g){const F=this.style._layers[R],L=i._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const j=L?D[L.id]:void 0;("custom"===F.type||F.isSky()||j&&j.length)&&this.renderLayer(this,L,F,j)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let A=p.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(A=this.style.fog.properties.get("color")),this.context.clear({color:u.showOverdrawInspector?p.Color.black:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],F=i._getLayerSourceCache(R);if(R.isSky())continue;const L=F?D[F.id]:void 0;this._renderTileClippingMasks(R,F,L),this.renderLayer(this,F,R,L)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],F=i._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?D[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const R=this.style._layers[g[this.currentLayer]],F=i._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=F?("symbol"===R.type?S:D)[F.id]:void 0;this._renderTileClippingMasks(R,F,F?x[F.id]:void 0),this.renderLayer(this,F,R,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;p.values(this.style._layers).forEach(F=>{const L=i._getLayerSourceCache(F);L&&!F.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<L.getSource().maxzoom)&&(R=L)}),R&&this.options.showTileBoundaries&&Rs.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const F=R.transform.padding;mo(R,R.transform.height-(F.top||0),3,xa),mo(R,F.bottom||0,3,Ot),ks(R,F.left||0,3,ba),ks(R,R.transform.width-(F.right||0),3,wa);const L=R.transform.centerPoint;var j,G,X,q;ui(j=R,(G=L.x)-1,(X=R.transform.height-L.y)-10,2,20,q=$r),ui(j,G-10,X-1,20,2,q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%p.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),Rs[g.type](i,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[i.id];g||(g=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const u={};for(const g in i){const v=i[g],x=this.context.extTimerQuery,D=x.getQueryObjectEXT(v.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(v.query),u[g]=D}return u}translatePosMatrix(i,u,g,v,x){if(!g[0]&&!g[1])return i;const D=x?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(D){const R=Math.sin(D),F=Math.cos(D);g=[g[0]*F-g[1]*R,g[0]*R+g[1]*F]}const S=[x?g[0]:dr(u,g[0],this.transform.zoom),x?g[1]:dr(u,g[1],this.transform.zoom),0],A=new Float32Array(16);return p.translate(A,i,S),A}saveTileTexture(i){const u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const u=this.imageManager.getPattern(i.from.toString()),g=this.imageManager.getPattern(i.to.toString());return!u||!g}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!i&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),i&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(i,u,g){this.cache=this.cache||{};const v=g||[],x=this.currentGlobalDefines().concat(v),D=_a.cacheKey(i,x,u);return this.cache[D]||(this.cache[D]=new _a(this.context,i,al[i],u,Ai[i],x)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const x=v.getOpacity(this.transform.pitch);0!==x&&u.setFogUniformValues(i,((D,S,A,R)=>{const F=S.properties.get("color"),L=D.frameCounter/1e3%1,j=[F.r/F.a,F.g/F.a,F.b/F.a,R];return{u_fog_matrix:A?D.transform.calculateFogTileMatrix(A):D.identityMat,u_fog_range:S.getFovAdjustedRange(D.transform._fov),u_fog_color:j,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:L}})(this,v,g,x))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,u=i.createTexture();return i.bindTexture(i.TEXTURE_2D,u),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=i[v.key]||new p.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Ar{constructor(i=0,u=0,g=0,v=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=g,this.right=v}interpolate(i,u,g){return null!=u.top&&null!=i.top&&(this.top=p.number(i.top,u.top,g)),null!=u.bottom&&null!=i.bottom&&(this.bottom=p.number(i.bottom,u.bottom,g)),null!=u.left&&null!=i.left&&(this.left=p.number(i.left,u.left,g)),null!=u.right&&null!=i.right&&(this.right=p.number(i.right,u.right,g)),this}getCenter(i,u){const g=p.clamp((this.left+i-this.right)/2,0,i),v=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.pointGeometry(g,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Ar(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function rs(f,i){return[f[4*i],f[4*i+1],f[4*i+2],f[4*i+3]]}function Wi(f,i,u){f[4*i+0]=u[0],f[4*i+1]=u[1],f[4*i+2]=u[2],f[4*i+3]=u[3]}function hc(f,i){const u=rs(f,3);p.fromQuat(f,i),Wi(f,3,u)}function gu(f,i){Wi(f,3,[i[0],i[1],i[2],1])}function _u(f,i){const u=p.identity$1([]);return p.rotateZ$1(u,u,-i),p.rotateX$1(u,u,-f),u}function Fs(f,i){const u=[f[0],f[1],0],g=[i[0],i[1],0];if(p.length(u)>=1e-15){const D=p.normalize([],u);p.scale(g,D,p.dot(g,D)),i[0]=g[0],i[1]=g[1]}const v=p.cross([],i,f);if(p.len(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return _u(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Mh{constructor(i,u){this.position=i,this.orientation=u}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(u){if(!u)return;const g=Array.isArray(u)?new p.MercatorCoordinate(u[0],u[1],u[2]):u;return g.x=p.wrap(g.x,0,1),g}(i):i}lookAtPoint(i,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(i)):0,v=this.position,x=p.MercatorCoordinate.fromLngLat(i,g),D=[x.x-v.x,x.y-v.y,x.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Fs(D,u)}setPitchBearing(i,u){this.orientation=_u(p.degToRad(i),p.degToRad(-u))}}class ml{constructor(i,u){this._transform=p.identity([]),this._orientation=p.identity$1([]),u&&(this._orientation=u,hc(this._transform,this._orientation)),i&&gu(this._transform,i)}get mercatorPosition(){const i=this.position;return new p.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=rs(this._transform,3);return[i[0],i[1],i[2]]}set position(i){gu(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,hc(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,u){this._orientation=_u(i,u),hc(this._transform,this._orientation)}forward(){const i=rs(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=rs(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=rs(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,u){const g=new Float64Array(16);return p.invert(g,this.getWorldToCamera(i,u)),g}getWorldToCameraPosition(i,u,g){const v=this.position;p.scale(v,v,-i);const x=new Float64Array(16);return p.fromScaling(x,[g,g,g]),p.translate(x,x,v),x[10]*=u,x}getWorldToCamera(i,u){const g=new Float64Array(16),v=new Float64Array(4),x=this.position;return p.conjugate(v,this._orientation),p.scale(x,x,-i),p.fromQuat(g,v),p.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(i,u,g,v){const x=new Float64Array(16);return p.perspective(x,i,u,g,v),x}getDistanceToElevation(i){const u=0===i?0:p.mercatorZfromAltitude(i,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new ml([...this.position],[...this.orientation])}}function yu(f,i){const u=Ah(f),g=function(x,D,S,A,R){const F=new p.LngLat(S.lng-180*Ea,S.lat),L=new p.LngLat(S.lng+180*Ea,S.lat),j=x.project(F.lng,F.lat),G=x.project(L.lng,L.lat),X=-Math.atan2(G.y-j.y,G.x-j.x),q=p.MercatorCoordinate.fromLngLat(S);q.y=p.clamp(q.y,-.999975,.999975);const J=q.toLngLat(),H=x.project(J.lng,J.lat),ee=p.MercatorCoordinate.fromLngLat(J);ee.x+=Ea;const re=ee.toLngLat(),Z=x.project(re.lng,re.lat),ie=hp(Z.x-H.x,Z.y-H.y,X),le=p.MercatorCoordinate.fromLngLat(J);le.y+=Ea;const be=le.toLngLat(),xe=x.project(be.lng,be.lat),Te=hp(xe.x-H.x,xe.y-H.y,X),Ee=Math.abs(ie.x)/Math.abs(Te.y),Ve=p.identity([]);p.rotateZ(Ve,Ve,-X*(1-(R?0:A)));const Ce=p.identity([]);return p.scale$1(Ce,Ce,[1,1-(1-Ee)*A,1]),Ce[4]=-Te.x/Te.y*A,p.rotateZ(Ce,Ce,X),p.multiply(Ce,Ve,Ce),Ce}(f.projection,0,f.center,u,i),v=dc(f);return p.scale$1(g,g,[v,v,1]),g}function dc(f){const i=f.projection,u=Ah(f),g=Da(i,f.center),v=Da(i,p.LngLat.convert(i.center));return Math.pow(2,g*u+(1-u)*v)}function Ah(f){const i=f.projection.range;if(!i)return 0;const u=Math.max(f.width,f.height),g=Math.log(u/1024)/Math.LN2;return p.smoothstep(i[0]+g,i[1]+g,f.zoom)}const Ea=1/4e4;function Da(f,i){const u=p.clamp(i.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=new p.LngLat(i.lng-180*Ea,u),v=new p.LngLat(i.lng+180*Ea,u),x=f.project(g.lng,u),D=f.project(v.lng,u),S=p.MercatorCoordinate.fromLngLat(g),A=p.MercatorCoordinate.fromLngLat(v),R=D.x-x.x,F=D.y-x.y,L=A.x-S.x,j=A.y-S.y,G=Math.sqrt((L*L+j*j)/(R*R+F*F));return Math.log(G)/Math.LN2}function hp(f,i,u){const g=Math.cos(u),v=Math.sin(u);return{x:f*g-i*v,y:f*v+i*g}}class Ph{constructor(i,u,g,v,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=null==g?0:g,this._maxPitch=null==v?60:v,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ar,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ml,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const i=new Ph(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.setProjection(this.getProjection()),i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const u=this.projection?this.getProjection():void 0;return this.projection=p.getProjection(i),!ze(u,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const u=-i*Math.PI/180;var g,v,x,D,S,A,R,F,L,j;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,D=this.angle,S=(x=this.rotationMatrix)[0],A=x[1],R=x[2],F=x[3],L=Math.sin(D),j=Math.cos(D),v[0]=S*j+R*L,v[1]=A*j+F*L,v[2]=S*-L+R*j,v[3]=A*-L+F*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const u=p.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===i?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){const i=this.cameraToCenterDistance/this.worldSize,u=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(u+i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,x=0;for(let D=0;D<u.length;D++){const S=new p.pointGeometry(u[D][0]*this.width,g+u[D][1]*(this.height-g)),A=i.pointCoordinate(S);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);v+=A[3]*R,x+=R}return 0===x?NaN:v/x}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const i=this._cameraZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=p.mercatorZfromAltitude(u,this.center.lat),v=this._mercatorZfromZoom(i),x=this._mercatorZfromZoom(this._maxZoom),D=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let g;g=i.z<this._camera.position[2]?[u.x,u.y,u.z]:[i.x,i.y,i.z];const v=p.length(p.sub([],this._camera.position,g));return p.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let u=!1;if(i.orientation&&!p.exactEquals(i.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(i.orientation)),i.position){const g=[i.position.x,i.position.y,i.position.z];p.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,u=new Mh;return u.position=new p.MercatorCoordinate(i[0],i[1],i[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(i){if(!p.length$1(i))return!1;p.normalize$1(i,i);const u=p.transformQuat([],[0,0,-1],i),g=p.transformQuat([],[0,-1,0],i);if(g[2]<0)return!1;const v=Fs(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=p.clamp(i[2],v/g,v/u),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,g){this._unmodified=!1,this._edgeInsets.interpolate(i,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(i){const u=[new p.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const g=this.pointCoordinate(new p.pointGeometry(0,0)),v=this.pointCoordinate(new p.pointGeometry(this.width,0)),x=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new p.pointGeometry(0,this.height)),S=Math.floor(Math.min(g.x,v.x,x.x,D.x)),A=Math.floor(Math.max(g.x,v.x,x.x,D.x)),R=1;for(let F=S-R;F<=A+R;F++)0!==F&&u.push(new p.UnwrappedTileID(F,i))}return u}coveringTiles(i){let u=this.coveringZoomLevel(i);const g=u,v=this.elevation&&!i.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==i.minzoom&&u<i.minzoom)return[];void 0!==i.maxzoom&&u>i.maxzoom&&(u=i.maxzoom);const D=this.locationCoordinate(this.center),S=1<<u,A=[S*D.x,S*D.y,0],R=Ui.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),F=this.pointCoordinate(this.getCameraPoint()),L=S*p.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),G=[S*F.x,S*F.y,j],X=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&x?u:0,J=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,H=i.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=dc(this),re=ye=>{const He=1/4e4,nt=new p.MercatorCoordinate(ye.x+He,ye.y,ye.z),ct=new p.MercatorCoordinate(ye.x,ye.y+He,ye.z),ft=ye.toLngLat(),mt=nt.toLngLat(),dt=ct.toLngLat(),lt=this.locationCoordinate(ft),vt=this.locationCoordinate(mt),Zt=this.locationCoordinate(dt),Kn=Math.hypot(vt.x-lt.x,vt.y-lt.y),mr=Math.hypot(Zt.x-lt.x,Zt.y-lt.y);return Math.sqrt(Kn*mr)*ee/He},Z=(ye,He,nt,ct,ft,mt)=>{const dt=p.tileTransform({z:ye,x:He,y:nt},this.projection);return new vo([(ct+dt.x/dt.scale)*S,S*(dt.y/dt.scale),ft],[(ct+dt.x2/dt.scale)*S,S*(dt.y2/dt.scale),mt])},ie=ye=>({aabb:Z(0,0,0,ye,H,J),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),le=[];let be=[];const xe=u,Te=i.reparseOverscaled?g:u,Ee=ye=>{if(!this._elevation||!ye.tileID)return;const He=this._elevation.getMinMaxForTile(ye.tileID),nt=ye.aabb;He?(nt.min[2]=He.min,nt.max[2]=He.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(ye.shouldSplit=qe(ye),ye.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},Ve=ye=>ye*ye,Ce=Ve((j-this._centerAltitude)*L),qe=ye=>{if(ye.zoom<q)return!0;if(ye.zoom===xe)return!1;if(null!=ye.shouldSplit)return ye.shouldSplit;const He=ye.aabb.distanceX(G),nt=ye.aabb.distanceY(G);let ct=Ce;v&&(ct=Ve(ye.aabb.distanceZ(G)*L));let ft=1;if(!x&&g<=5){const dt=Math.pow(2,ye.zoom),lt=re(new p.MercatorCoordinate((ye.x+.5)/dt,(ye.y+.5)/dt));ft=lt>.85?1:lt}const mt=He*He+nt*nt+ct;return mt<Ve((1<<xe-ye.zoom)*X*ft*((dt,lt)=>{if(lt*Ve(.707)<dt)return 1;const vt=Math.sqrt(lt/dt);return vt/(1.4144271570014144+(Math.pow(1.1,vt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,Ce),mt))};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)le.push(ie(-ye)),le.push(ie(ye));for(le.push(ie(0));le.length>0;){const ye=le.pop(),He=ye.x,nt=ye.y;let ct=ye.fullyVisible;if(!ct){const ft=ye.aabb.intersects(R);if(0===ft)continue;ct=2===ft}if(ye.zoom!==xe&&qe(ye))for(let ft=0;ft<4;ft++){const mt=(He<<1)+ft%2,dt=(nt<<1)+(ft>>1),lt={aabb:"mercator"===this.projection.name?ye.aabb.quadrant(ft):Z(ye.zoom+1,mt,dt,ye.wrap,0,0),zoom:ye.zoom+1,x:mt,y:dt,wrap:ye.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0};v&&(lt.tileID=new p.OverscaledTileID(ye.zoom+1===xe?Te:ye.zoom+1,ye.wrap,ye.zoom+1,mt,dt),Ee(lt)),le.push(lt)}else{const ft=ye.zoom===xe?Te:ye.zoom;if(i.minzoom&&i.minzoom>ft)continue;const mt=A[0]-(.5+He+(ye.wrap<<ye.zoom))*(1<<u-ye.zoom),dt=A[1]-.5-nt,lt=ye.tileID?ye.tileID:new p.OverscaledTileID(ft,ye.wrap,ye.zoom,He,nt);be.push({tileID:lt,distanceSq:mt*mt+dt*dt})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,He=this.horizonLineFromTop();be=be.filter(nt=>{const ct=[0,0,0,1],ft=[p.EXTENT,p.EXTENT,0,1],mt=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());p.transformMat4(ct,ct,mt),p.transformMat4(ft,ft,mt);const dt=p.getAABBPointSquareDist(ct,ft);if(0===dt)return!0;let lt=!1;const vt=this._elevation;if(vt&&dt>ye&&0!==He){const Zt=this.calculateProjMatrix(nt.tileID.toUnwrapped());let Kn;i.isTerrainDEM||(Kn=vt.getMinMaxForTile(nt.tileID)),Kn||(Kn={min:H,max:J});const mr=p.furthestTileCorner(this.rotation),Qn=[mr[0]*p.EXTENT,mr[1]*p.EXTENT,Kn.max];p.transformMat4$1(Qn,Qn,Zt),lt=(1-Qn[1])*this.height*.5<He}return dt<ye||lt})}return be.sort((ye,He)=>ye.distanceSq-He.distanceSq).map(ye=>ye.tileID)}resize(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const u=p.clamp(i.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=this.projection.project(i.lng,u);return new p.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,u){const g=this.pointCoordinate(u),v=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(i);this.setLocation(new p.MercatorCoordinate(x.x-(g.x-v.x),x.y-(g.y-v.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i){return this._coordinatePoint(this.locationCoordinate(i),!1)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,u){const g=u?p.mercatorZfromAltitude(u,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new p.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,u){const g=null!=u?u:this._centerAltitude,v=[i.x,i.y,0,1],x=[i.x,i.y,1,1];p.transformMat4(v,v,this.pixelMatrixInverse),p.transformMat4(x,x,this.pixelMatrixInverse);const D=x[3];p.scale$2(v,v,1/v[3]),p.scale$2(x,x,1/D);const S=v[2],A=x[2];return{p0:v,p1:x,t:S===A?0:(g-S)/(A-S)}}screenPointToMercatorRay(i){const u=[i.x,i.y,0,1],g=[i.x,i.y,1,1];return p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(g,g,this.pixelMatrixInverse),p.scale$2(u,u,1/u[3]),p.scale$2(g,g,1/g[3]),u[2]=p.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,p.scale$2(u,u,1/this.worldSize),p.scale$2(g,g,1/this.worldSize),new Ti([u[0],u[1],u[2]],p.normalize([],p.sub([],g,u)))}rayIntersectionCoordinate(i){const{p0:u,p1:g,t:v}=i,x=p.mercatorZfromAltitude(u[2],this._center.lat),D=p.mercatorZfromAltitude(g[2],this._center.lat);return new p.MercatorCoordinate(p.number(u[0],g[0],v)/this.worldSize,p.number(u[1],g[1],v)/this.worldSize,p.number(x,D,v))}pointCoordinate(i,u=this._centerAltitude){const g=this.horizonLineFromTop(!1),v=new p.pointGeometry(i.x,Math.max(g,i.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(v,u))}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const u=this.elevation;let g=this.elevation.pointCoordinate(i);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let v=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const D=.02*x,S=i.clone();for(let A=0;A<10&&x-v>D;A++){S.y=p.number(v,x,.66);const R=u.pointCoordinate(S);R?(x=S.y,g=R):v=S.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const u=this.horizonLineFromTop();return i.y<u}}_coordinatePoint(i,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,g+i.toAltitude(),1];return p.transformMat4(v,v,this.pixelMatrix),v[3]>0?new p.pointGeometry(v[0]/v[3],v[1]/v[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,u){const g=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),D=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(g,i),A=this.pointCoordinate(v,i);const R=this.pointCoordinate(x,u),F=this.pointCoordinate(D,u),L=(j,G)=>(G.y-j.y)/(G.x-j.x);return S.y>1&&A.y>=0?S=new p.MercatorCoordinate((1-F.y)/L(F,S)+F.x,1):S.y<0&&A.y<=1&&(S=new p.MercatorCoordinate(-F.y/L(F,S)+F.x,0)),A.y>1&&S.y>=0?A=new p.MercatorCoordinate((1-R.y)/L(R,A)+R.x,1):A.y<0&&S.y<=1&&(A=new p.MercatorCoordinate(-R.y/L(R,A)+R.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(R))}_getBounds3D(){const i=this.elevation,u=i.visibleDemTiles.reduce((g,v)=>{if(v.dem){const x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*i.exaggeration(),u.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return i?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,u){let g,v,x;const D=i.canonical,S=p.identity(new Float64Array(16));if("mercator"===this.projection.name)g=u/this.zoomScale(D.z),v=(D.x+Math.pow(2,D.z)*i.wrap)*g,x=D.y*g;else{const A=p.tileTransform(D,this.projection);g=1,v=A.x+i.wrap*A.scale,x=A.y,p.scale$1(S,S,[g/A.scale,g/A.scale,this.pixelsPerMeter/this.worldSize])}return p.translate(S,S,[v,x,0]),p.scale$1(S,S,[g/p.EXTENT,g/p.EXTENT,1]),S}calculateDistanceTileData(i){const u=i.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=i.canonical,x=1/this.height,D=this.cameraWorldSize/this.zoomScale(v.z),S=(v.x+Math.pow(2,v.z)*i.wrap)*D,A=v.y*D,R=this.point,F=this.angle,L=Math.sin(-F),j=-Math.cos(-F);return g[u]={bearing:[L,j],center:[(R.x-S)*x,(R.y-A)*x],scale:D/p.EXTENT*x},g[u]}calculateFogTileMatrix(i){const u=i.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.calculatePosMatrix(i,this.cameraWorldSize);return p.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(i,u=!1){const g=i.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const x=this.calculatePosMatrix(i,this.worldSize);return p.multiply(x,"mercator"===this.projection.name?u?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,x),v[g]=new Float32Array(x),v[g]}calculatePixelsToTileUnitsMatrix(i){const u=i.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(x,D){const{scale:S}=x.tileTransform,A=S*p.EXTENT/(x.tileSize*Math.pow(2,D.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return R=new Float32Array(4),j=(F=D.inverseAdjustmentMatrix)[1],G=F[2],X=F[3],J=(L=[A,A])[1],R[0]=F[0]*(q=L[0]),R[1]=j*q,R[2]=G*J,R[3]=X*J,R;var R,F,L,j,G,X,q,J}(i,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const u=this._camera.position,g=this._camera.forward();if(u[2]<=0||g[2]>=0)return;const v=p.mercatorZfromAltitude(1,this._center.lat);u[2]/=v,g[2]/=v,p.normalize(g,g);const x=i.raycast(u,g,i.exaggeration());if(x){const D=p.scaleAndAdd([],u,g,x),S=new p.MercatorCoordinate(D[0],D[1],p.mercatorZfromAltitude(D[2],p.latFromMercatorY(D[1]))),A=this._camera.position,R=S.z+p.length([S.x-A[0],S.y-A[1],S.z-A[2]]);this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const u=i.getAtPointOrZero(this._camera.mercatorPosition),g=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),v=p.mercatorZfromAltitude(u,this._center.lat),x=this._camera.position[2]-v;if(x<g){const D=this.locationCoordinate(this._center,this._centerAltitude),S=this._camera.mercatorPosition,A=[D.x-S.x,D.y-S.y,D.z-S.z],R=p.length(A);A[2]-=g-x;const F=p.length(A);if(0===F)return;p.scale(A,A,R/F),this._camera.position=[D.x-A[0],D.y-A[1],D.z-A[2]],this._camera.orientation=Fs(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const L=this.center;return L.lat=p.clamp(L.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(L.lng=p.clamp(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}const i=this._unmodified,{x:u,y:g}=this.point;let v=0,x=u,D=g;const S=this.width/2,A=this.height/2,R=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(g-A<R&&(D=R+A),g+A>F&&(D=F-A),F-R<this.height&&(v=Math.max(v,this.height/(F-R)),D=(F+R)/2),this.maxBounds||!this.renderWorldCopies){const L=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,G=this.worldSize/2-(L+j)/2;x=(u+G+this.worldSize)%this.worldSize-G,x-S<L&&(x=L+S),x+S>j&&(x=j-S),j-L<this.width&&(v=Math.max(v,this.width/(j-L)),x=(j+L)/2)}x===u&&D===g||(this.center=this.unproject(new p.pointGeometry(x,D))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const u=this.pixelsPerMeter;this._updateCameraState();const g=Math.PI/2+this._pitch,v=this.fovAboveCenter,x=this.elevation?this.elevation.getMinElevationBelowMSL()*u:0,D=(this._camera.position[2]*this.worldSize-x)/Math.cos(this._pitch),S=Math.sin(v)*D/Math.sin(p.clamp(Math.PI-g-v,.01,Math.PI-.01)),A=this.point,R=A.x,F=A.y,L=Math.cos(Math.PI/2-this._pitch)*S+D,j=Math.min(1.01*L,D*(1/this._horizonShift)),G=this.height/50,X=this._camera.getWorldToCamera(this.worldSize,u),q=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,G,j);q[8]=2*-i.x/this.width,q[9]=2*i.y/this.height;let J=p.mul$1([],q,X);if("mercator"!==this.projection.name){const Ve=this.locationCoordinate(this.center),Ce=p.identity([]);p.translate(Ce,Ce,[Ve.x*this.worldSize,Ve.y*this.worldSize,0]),p.multiply(Ce,Ce,yu(this)),p.translate(Ce,Ce,[-Ve.x*this.worldSize,-Ve.y*this.worldSize,0]),p.multiply(J,J,Ce),this.inverseAdjustmentMatrix=function(qe){const ye=yu(qe,!0);return ia([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale$1([],J,[this.worldSize,this.worldSize,this.worldSize/u]),this.projMatrix=J,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const H=new Float32Array(16);p.identity(H),p.scale$1(H,H,[1,-1,1]),p.rotateX(H,H,this._pitch),p.rotateZ(H,H,this.angle);const ee=p.perspective(new Float32Array(16),this._fov,this.width/this.height,G,j),re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-i.x/this.width,ee[9]=2*(i.y+re)/this.height,this.skyboxMatrix=p.multiply(H,ee,H);const Z=this.width%2/2,ie=this.height%2/2,le=Math.cos(this.angle),be=Math.sin(this.angle),xe=R-Math.round(R)+le*Z+be*ie,Te=F-Math.round(F)+le*ie+be*Z,Ee=new Float64Array(J);if(p.translate(Ee,Ee,[xe>.5?xe-1:xe,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=Ee,J=p.create$1(),p.scale$1(J,J,[this.width/2,-this.height/2,1]),p.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=p.create$1(),p.scale$1(J,J,[1,-1,1]),p.translate(J,J,[-1,-1,0]),p.scale$1(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},J=p.invert(new Float64Array(16),this.pixelMatrix),!J)throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height,x=[i,i,u];p.scale(x,x,v),p.scale(g,g,-1),p.multiply$1(g,g,x);const D=p.create$1();p.translate(D,D,g),p.scale$1(D,D,x),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,u,v)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const i=this._camera.forward(),u=this.cameraToCenterDistance,g=this.point,v=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-p.mercatorZfromAltitude(this._centerAltitude,this.center.lat),x=this.cameraToCenterDistance/v;this._camera.position=[g.x/this.worldSize-i[0]*u/x,g.y/this.worldSize-i[1]*u/x,p.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-i[2]*u/x]}_translateCameraConstrained(i){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=i[2];let v=1;g>0&&(v=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),S=Math.max((i[2]-x)/Math.cos(g),D),A=this._zoomFromMercatorZ(S);p.scaleAndAdd(i,i,u,S),this._pitch=p.clamp(g,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(v,-Math.PI,Math.PI),this._setZoom(p.clamp(A,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new p.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,u){const g=Math.min(i.x,u.x),v=Math.max(i.x,u.x),x=Math.min(i.y,u.y),D=Math.max(i.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new p.pointGeometry(g,x),new p.pointGeometry(v,D),new p.pointGeometry(g,D),new p.pointGeometry(v,x)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const F of S){const L=this.pointRayIntersection(F);if(L.t<0)return!0;const j=this.rayIntersectionCoordinate(L);if(j.x<A||j.y<0||j.x>R||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,u){const g=p.length(p.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,i))}}function kh(f,i){let u=!1,g=null;const v=()=>{g=null,u&&(f(),g=setTimeout(v,i),u=!1)};return()=>(u=!0,g||v(),g)}class vu{constructor(i){this._hashName=i&&encodeURIComponent(i),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kh(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const u=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),D=Math.round(u.lng*x)/x,S=Math.round(u.lat*x)/x,A=this._map.getBearing(),R=this._map.getPitch();let F="";if(F+=i?`/${D}/${S}/${g}`:`${g}/${S}/${D}`,(A||R)&&(F+="/"+Math.round(10*A)/10),R&&(F+=`/${Math.round(R)}`),this._hashName){const L=this._hashName;let j=!1;const G=p.window.location.hash.slice(1).split("&").map(X=>{const q=X.split("=")[0];return q===L?(j=!0,`${q}=${F}`):X}).filter(X=>X);return j||G.push(`${L}=${F}`),`#${G.join("&")}`}return`#${F}`}_getCurrentHash(){const i=p.window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,i)}}const gl={linearity:.3,easing:p.bezier(0,0,.3,1)},xu=p.extend({deceleration:2500,maxSpeed:1400},gl),pc=p.extend({deceleration:20,maxSpeed:1400},gl),bu=p.extend({deceleration:1e3,maxSpeed:360},gl),Rh=p.extend({deceleration:1e3,maxSpeed:90},gl);class dp{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=p.exported.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const x=_l(u.pan.mag(),g,p.extend({},xu,i||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,Xi(v,x)}if(u.zoom){const x=_l(u.zoom,g,pc);v.zoom=this._map.transform.zoom+x.amount,Xi(v,x)}if(u.bearing){const x=_l(u.bearing,g,bu);v.bearing=this._map.transform.bearing+p.clamp(x.amount,-179,179),Xi(v,x)}if(u.pitch){const x=_l(u.pitch,g,Rh);v.pitch=this._map.transform.pitch+x.amount,Xi(v,x)}if(v.zoom||v.bearing){const x=void 0===u.pinchAround?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),p.extend(v,{noMoveStart:!0})}}function Xi(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function _l(f,i,u){const{maxSpeed:g,linearity:v,deceleration:x}=u,D=p.clamp(f*v/(i/1e3),-g,g),S=Math.abs(D)/(x*v);return{easing:u.easing,duration:1e3*S,amount:D*(S/2)}}class rr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g,v={}){const x=Fe.mousePos(u.getCanvasContainer(),g),D=u.unproject(x);super(i,p.extend({point:x,lngLat:D,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Ca extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g){const v="touchend"===i?g.changedTouches:g.touches,x=Fe.touchPos(u.getCanvasContainer(),v),D=x.map(A=>u.unproject(A)),S=x.reduce((A,R,F,L)=>A.add(R.div(L.length)),new p.pointGeometry(0,0));super(i,{points:x,point:S,lngLats:D,lngLat:u.unproject(S),originalEvent:g}),this._defaultPrevented=!1}}class Ta extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g){super(i,{originalEvent:g}),this._defaultPrevented=!1}}class Fh{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Ta(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new rr(i.type,this._map,i))}mouseup(i){this._map.fire(new rr(i.type,this._map,i))}preclick(i){const u=p.extend({},i);u.type="preclick",this._map.fire(new rr(u.type,this._map,u))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(i),this._map.fire(new rr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new rr(i.type,this._map,i))}mouseover(i){this._map.fire(new rr(i.type,this._map,i))}mouseout(i){this._map.fire(new rr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ca(i.type,this._map,i))}touchmove(i){this._map.fire(new Ca(i.type,this._map,i))}touchend(i){this._map.fire(new Ca(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ca(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wu{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new rr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new rr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eu{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&0===i.button&&(Fe.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=Fe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const x=Math.min(v.x,g.x),D=Math.max(v.x,g.x),S=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(Fe.setTransform(this._box,`translate(${x}px,${S}px)`),this._box.style.width=D-x+"px",this._box.style.height=A-S+"px")})}mouseupWindow(i,u){if(!this._active||0!==i.button)return;const g=this._startPos,v=u;if(this.reset(),Fe.suppressClick(),g.x!==v.x||g.y!==v.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Fe.remove(this._box),this._box=null),Fe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new p.Event(i,{originalEvent:u}))}}function fc(f,i){const u={};for(let g=0;g<f.length;g++)u[f[g].identifier]=i[g];return u}class mc{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=i.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const x=new p.pointGeometry(0,0);for(const D of v)x._add(D);return x.div(v.length)}(u),this.touches=fc(g,u)))}touchmove(i,u,g){if(this.aborted||!this.centroid)return;const v=fc(g,u);for(const x in this.touches){const D=this.touches[x],S=v[x];(!S||S.dist(D)>30)&&(this.aborted=!0)}}touchend(i,u,g){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class gc{constructor(i){this.singleTap=new mc(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,u,g){this.singleTap.touchstart(i,u,g)}touchmove(i,u,g){this.singleTap.touchmove(i,u,g)}touchend(i,u,g){const v=this.singleTap.touchend(i,u,g);if(v){const x=i.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(v)<30;if(x&&D||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Tn{constructor(){this._zoomIn=new gc({numTouches:1,numTaps:2}),this._zoomOut=new gc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,g){this._zoomIn.touchstart(i,u,g),this._zoomOut.touchstart(i,u,g)}touchmove(i,u,g){this._zoomIn.touchmove(i,u,g),this._zoomOut.touchmove(i,u,g)}touchend(i,u,g){const v=this._zoomIn.touchend(i,u,g),x=this._zoomOut.touchend(i,u,g);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(v)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lh={0:1,2:2};class Pi{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,u){return!1}_move(i,u){return{}}mousedown(i,u){if(this._lastPoint)return;const g=Fe.mouseButton(i);this._correctButton(i,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(i,u){const g=this._lastPoint;if(g)if(i.preventDefault(),function(v,x){const D=Lh[x];return void 0===v.buttons||(v.buttons&D)!==D}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(i){this._lastPoint&&Fe.mouseButton(i)===this._eventButton&&(this._moved&&Fe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c extends Pi{mousedown(i,u){super.mousedown(i,u),this._lastPoint&&(this._active=!0)}_correctButton(i,u){return 0===u&&!i.ctrlKey}_move(i,u){return{around:u,panDelta:u.sub(i)}}}class To extends Pi{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const g=.8*(u.x-i.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(i){i.preventDefault()}}class So extends Pi{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const g=-.5*(u.y-i.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(i){i.preventDefault()}}class cm{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(i,u,g){return this._calculateTransform(i,u,g)}touchmove(i,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,u,g)}}touchend(i,u,g){this._calculateTransform(i,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,g){g.length>0&&(this._active=!0);const v=fc(g,u),x=new p.pointGeometry(0,0),D=new p.pointGeometry(0,0);let S=0;for(const R in v){const F=v[R],L=this._touches[R];L&&(x._add(F),D._add(F.sub(L)),S++,v[R]=F)}if(this._touches=v,S<this._minTouches||!D.mag())return;const A=D.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Fn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,u,g){return{}}touchstart(i,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,g){if(!this._firstTwoTouches)return;i.preventDefault();const[v,x]=this._firstTwoTouches,D=yl(g,u,v),S=yl(g,u,x);if(!D||!S)return;const A=this._aroundCenter?null:D.add(S).div(2);return this._move([D,S],A,i)}touchend(i,u,g){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,D=yl(g,u,v),S=yl(g,u,x);D&&S||(this._active&&Fe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yl(f,i,u){for(let g=0;g<f.length;g++)if(f[g].identifier===u)return i[g]}function Oh(f,i){return Math.log(f/i)/Math.LN2}class Xn extends Fn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Oh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Oh(this._distance,g),pinchAround:u}}}function Sa(f,i){return 180*f.angleWith(i)/Math.PI}class Io extends Fn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u){const g=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sa(this._vector,g),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,g=Sa(i,this._startVector);return Math.abs(g)<u}}function Ls(f){return Math.abs(f.y)>Math.abs(f.x)}class _i extends Fn{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,Ls(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,g){const v=i[0].sub(this._lastPoints[0]),x=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&g.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,x,g.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+x.y)/2*-.5}}gestureBeginsVertically(i,u,g){if(void 0!==this._valid)return this._valid;const v=i.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const D=i.y>0==u.y>0;return Ls(i)&&Ls(u)&&D}}const vl={panStep:100,bearingStep:15,pitchStep:10};class tt{constructor(){const i=vl;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,g=0,v=0,x=0,D=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?g=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?g=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),D=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:u?Math.round(A)+u*(i.shiftKey?2:1):A,bearing:S.getBearing()+g*this._bearingStep,pitch:S.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-D*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Os(f){return f*(2-f)}const Gr=4.000244140625;class Ia{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=i.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const g=p.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%Gr==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Fe.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,u=()=>i._terrainEnabled()?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>Gr?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==R&&(R=1/R);const F=u(),L=Math.pow(2,F),j="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*R))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,x=this._easing;let D,S=!1;if("wheel"===this._type&&v&&x){const A=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),R=x(A);D=p.number(v,g,R),A<1?this._frameId||(this._frameId=!0):S=!0}else D=g,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:D-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=p.ease;if(this._prevEase){const g=this._prevEase,v=(p.exported.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),D=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-D*D);u=p.bezier(D,S,.25,1)}return this._prevEase={start:p.exported.now(),duration:i,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!p.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class zs{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,u){return i.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(i.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo{constructor(){this._tap=new gc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,u,g){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(i,u,g))}touchmove(i,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,u,g)}touchend(i,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(i,u,g)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du{constructor(i,u,g){this._el=i,this._mousePan=u,this._touchPan=g}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yc{constructor(i,u,g){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wt{constructor(i,u,g,v){this._el=i,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vc=f=>f.zoom||f.drag||f.pitch||f.rotate;class Bh extends p.Event{}class xc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,u){const g=p.sub([],u,i);this.radius=p.length(g[2]<0?p.div([],g,this.constants):[g[0],g[1],0])}projectRay(i){p.div(i,i,this.constants),p.normalize(i,i),p.mul$2(i,i,this.constants);const u=p.scale([],i,this.radius);if(u[2]>0){const g=p.scale([],[0,0,1],p.dot(u,[0,0,1])),v=p.scale([],p.normalize([],[u[0],u[1],0]),this.radius),x=p.add([],u,p.scale([],p.sub([],p.add([],v,g),u),2));u[0]=x[0],u[1]=x[1]}return u}}function Ma(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class xl{constructor(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dp(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[v,x,D]of this._listeners)Fe.addEventListener(v,x,v===p.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[i,u,g]of this._listeners)Fe.removeEventListener(i,u,i===p.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(i){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new Fh(u,i));const v=u.boxZoom=new Eu(u,i);this._add("boxZoom",v);const x=new Tn,D=new zh;u.doubleClickZoom=new zs(D,x),this._add("tapZoom",x),this._add("clickZoom",D);const S=new Mo;this._add("tapDragZoom",S);const A=u.touchPitch=new _i(u);this._add("touchPitch",A);const R=new To(i),F=new So(i);u.dragRotate=new yc(i,R,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const L=new _c(i),j=new cm(u,i);u.dragPan=new Du(g,L,j),this._add("mousePan",L),this._add("touchPan",j,["touchZoom","touchRotate"]);const G=new Io,X=new Xn;u.touchZoomRotate=new wt(g,X,G,S),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wu(u));const q=u.scrollZoom=new Ia(u,this);this._add("scrollZoom",q,["mousePan"]);const J=u.keyboard=new tt;this._add("keyboard",J);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[H]&&u[H].enable(i[H])}_add(i,u,g){this._handlers.push({handlerName:i,handler:u,allowed:g}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(vc(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,u,g){for(const v in i)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const u=[];for(const g of i)this._el.contains(g.target)&&u.push(g);return u}handleEvent(i,u){this._updatingCamera=!0;const g="renderFrame"===i.type,v=g?void 0:i,x={needsRenderFrame:!1},D={},S={},A=i.touches?this._getMapTouches(i.touches):void 0,R=A?Fe.touchPos(this._el,A):g?void 0:Fe.mousePos(this._el,i);for(const{handlerName:j,handler:G,allowed:X}of this._handlers){if(!G.isEnabled())continue;let q;this._blockedByActive(S,X,j)?G.reset():G[u||i.type]&&(q=G[u||i.type](i,R,A),this.mergeHandlerResult(x,D,q,j,v),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||G.isActive())&&(S[j]=G)}const F={};for(const j in this._previousActiveHandlers)S[j]||(F[j]=v);this._previousActiveHandlers=S,(Object.keys(F).length||Ma(x))&&(this._changes.push([x,D,F]),this._triggerRenderFrame()),(Object.keys(S).length||Ma(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=x;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(i,u,g,v,x){if(!g)return;p.extend(i,g);const D={handlerName:v,originalEvent:g.originalEvent||x};void 0!==g.zoomDelta&&(u.zoom=D),void 0!==g.panDelta&&(u.drag=D),void 0!==g.pitchDelta&&(u.pitch=D),void 0!==g.bearingDelta&&(u.rotate=D)}_applyChanges(){const i={},u={},g={};for(const[v,x,D]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new p.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(i.around=v.around),void 0!==v.aroundCoord&&(i.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),p.extend(u,x),p.extend(g,D);this._updateMapTransform(i,u,g),this._changes=[]}_updateMapTransform(i,u,g){const v=this._map,x=v.transform,D=ee=>[ee.x,ee.y,ee.z];if((ee=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Ma(i)){const ee=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ee!==x.zoom&&this._map._update(!0)}if(!Ma(i))return this._fireEvents(u,g,!0);let{panDelta:S,zoomDelta:A,bearingDelta:R,pitchDelta:F,around:L,aroundCoord:j,pinchAround:G}=i;void 0!==G&&(L=G),(ee=>u.drag&&!this._eventsInProgress.drag)()&&L&&(this._dragOrigin=D(x.pointCoordinate3D(L)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),L=L||v.transform.centerPoint,R&&(x.bearing+=R),F&&(x.pitch+=F),x._updateCameraState();const X=[0,0,0];if(S){const ee=x.screenPointToMercatorRay(L),re=x.screenPointToMercatorRay(L.sub(S)),Z=this._trackingEllipsoid.projectRay(ee.dir),ie=this._trackingEllipsoid.projectRay(re.dir);X[0]=ie[0]-Z[0],X[1]=ie[1]-Z[1]}const q=x.zoom,J=[0,0,0];if(A){const ee=D(j||x.pointCoordinate3D(L)),re={dir:p.normalize([],p.sub([],ee,x._camera.position))},Z=x.screenPointToMercatorRay(x.centerPoint);if(re.dir[2]<0){const ie=p.altitudeFromMercatorZ(ee[2],ee[1]),le=x.rayIntersectionCoordinate(x.pointRayIntersection(x.centerPoint,ie)),be=x.zoomDeltaToMovement(D(le),A)*(Z.dir[2]/re.dir[2]);p.scale(J,re.dir,be)}else if(x._terrainEnabled()){const ie=x.zoomDeltaToMovement(ee,A);p.scale(J,re.dir,ie)}}const H=p.add(X,X,J);x._translateCameraConstrained(H),A&&Math.abs(x.zoom-q)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,g,!0)}_fireEvents(i,u,g){const v=vc(this._eventsInProgress),x=vc(i),D={};for(const F in i){const{originalEvent:L}=i[F];this._eventsInProgress[F]||(D[`${F}start`]=L),this._eventsInProgress[F]=i[F]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in D)this._fireEvent(F,D[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in i){const{originalEvent:L}=i[F];this._fireEvent(F,L)}const S={};let A;for(const F in this._eventsInProgress){const{handlerName:L,originalEvent:j}=this._eventsInProgress[F];this._handlersById[L].isActive()||(delete this._eventsInProgress[F],A=u[L]||j,S[`${F}end`]=A)}for(const F in S)this._fireEvent(F,S[F]);const R=vc(this._eventsInProgress);if(g&&(v||x)&&!R){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;F?(L(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:A})):(this._map.fire(new p.Event("moveend",{originalEvent:A})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new p.Event(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Bh("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Cu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Nh extends p.Evented{constructor(i,u){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=u.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}panBy(i,u,g){return i=p.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,p.extend({offset:i},u),g)}panTo(i,u,g){return this.easeTo(p.extend({center:i},u),g)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,g){return this.easeTo(p.extend({zoom:i},u),g)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,g){return this.easeTo(p.extend({bearing:i},u),g)}resetNorth(i,u){return this.rotateTo(0,p.extend({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}cameraForBounds(i,u){i=p.LngLatBounds.convert(i);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),g,u)}_extendCameraOptions(i){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=p.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const g=i.padding;i.padding={top:g,bottom:g,right:g,left:g}}return i.padding=p.extend(u,i.padding),i}_cameraForBoxAndBearing(i,u,g,v){const x=this._extendCameraOptions(v),D=this.transform,S=D.padding,A=D.project(p.LngLat.convert(i)),R=D.project(p.LngLat.convert(u)),F=A.rotate(-p.degToRad(g)),L=R.rotate(-p.degToRad(g)),j=new p.pointGeometry(Math.max(F.x,L.x),Math.max(F.y,L.y)),G=new p.pointGeometry(Math.min(F.x,L.x),Math.min(F.y,L.y)),X=j.sub(G),q=(D.width-(S.left+S.right+x.padding.left+x.padding.right))/X.x,J=(D.height-(S.top+S.bottom+x.padding.top+x.padding.bottom))/X.y;if(J<0||q<0)return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const H=Math.min(D.scaleZoom(D.scale*Math.min(q,J)),x.maxZoom),ee="number"==typeof x.offset.x?new p.pointGeometry(x.offset.x,x.offset.y):p.pointGeometry.convert(x.offset),re=new p.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(g*Math.PI/180),Z=ee.add(re).mult(D.scale/D.zoomScale(H));return{center:D.unproject(A.add(R).div(2).sub(Z)),zoom:H,bearing:g}}_cameraForBox(i,u,g,v,x){const D=this._extendCameraOptions(x);g=g||0,v=v||0,i=p.LngLat.convert(i),u=p.LngLat.convert(u);const S=this.transform.clone();S.padding=D.padding;const A=this.getFreeCameraOptions(),R=new p.LngLat(.5*(i.lng+u.lng),.5*(i.lat+u.lat)),F=.5*(g+v);if(S._camera.position[2]<p.mercatorZfromAltitude(F,R.lat))return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(R),S.setFreeCameraOptions(A);const L=p.MercatorCoordinate.fromLngLat(i),j=p.MercatorCoordinate.fromLngLat(u),G=S.pointRayIntersection(S.centerPoint,F),X=[(q=S.rayIntersectionCoordinate(G)).x,q.y,q.z];var q;const J=S.screenPointToMercatorRay(S.centerPoint);let H,ee=0;do{const re=Math.floor(S.zoom),Z=1<<re,ie=Math.min(Z*L.x,Z*j.x),le=Math.min(Z*L.y,Z*j.y),be=Math.max(Z*L.x,Z*j.x),xe=Math.max(Z*L.y,Z*j.y),Te=new vo([ie,le,g],[be,xe,v]),Ee=Ui.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,re);if(2!==Te.intersects(Ee)){H&&(S._camera.position=p.scaleAndAdd([],S._camera.position,J.dir,-H),S._updateStateFromCamera());break}const Ve=p.sub([],S._camera.position,X);H=.5*p.length(Ve),S._camera.position=p.scaleAndAdd([],S._camera.position,J.dir,H);try{S._updateStateFromCamera()}catch(Ce){return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ee<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(i,u,g){return this._fitInternal(this.cameraForBounds(i,u),u,g)}_raycastElevationBox(i,u){const g=this.transform.elevation;if(!g)return;const v=new p.pointGeometry(i.x,u.y),x=new p.pointGeometry(u.x,i.y),D=g.pointCoordinate(i);if(!D)return;const S=g.pointCoordinate(u);if(!S)return;const A=g.pointCoordinate(v);if(!A)return;const R=g.pointCoordinate(x);if(!R)return;const F=new p.MercatorCoordinate(D[0],D[1]).toLngLat(),L=new p.MercatorCoordinate(S[0],S[1]).toLngLat(),j=new p.MercatorCoordinate(A[0],A[1]).toLngLat(),G=new p.MercatorCoordinate(R[0],R[1]).toLngLat(),X=Math.min(F.lng,Math.min(L.lng,Math.min(j.lng,G.lng))),q=Math.min(F.lat,Math.min(L.lat,Math.min(j.lat,G.lat))),J=Math.max(F.lng,Math.max(L.lng,Math.max(j.lng,G.lng))),H=Math.max(F.lat,Math.max(L.lat,Math.max(j.lat,G.lat))),ee=Math.min(D[3],Math.min(S[3],Math.min(A[3],R[3]))),re=Math.max(D[3],Math.max(S[3],Math.max(A[3],R[3])));return{minLngLat:new p.LngLat(X,q),maxLngLat:new p.LngLat(J,H),minAltitude:ee,maxAltitude:re}}fitScreenCoordinates(i,u,g,v,x){let D,S,A,R;const F=p.pointGeometry.convert(i),L=p.pointGeometry.convert(u),j=this._raycastElevationBox(F,L);if(j)D=j.minLngLat,S=j.maxLngLat,A=j.minAltitude,R=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(F,L))return this;D=this.transform.pointLocation(F),S=this.transform.pointLocation(L)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(p.pointGeometry.convert(i)),this.transform.pointLocation(p.pointGeometry.convert(u)),g,v):this._cameraForBox(D,S,A,R,v),v,x)}_fitInternal(i,u,g){return i?(delete(u=p.extend(i,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(i,u){this.stop();const g=this.transform;let v=!1,x=!1,D=!1;return"zoom"in i&&g.zoom!==+i.zoom&&(v=!0,g.zoom=+i.zoom),void 0!==i.center&&(g.center=p.LngLat.convert(i.center)),"bearing"in i&&g.bearing!==+i.bearing&&(x=!0,g.bearing=+i.bearing),"pitch"in i&&g.pitch!==+i.pitch&&(D=!0,g.pitch=+i.pitch),null==i.padding||g.isPaddingEqual(i.padding)||(g.padding=i.padding),this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),v&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),x&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),D&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&p.warnOnce(Cu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,u){const g=this.transform;if("mercator"!==g.projection.name)return void p.warnOnce(Cu);this.stop();const v=g.zoom,x=g.pitch,D=g.bearing;g.setFreeCameraOptions(i);const S=v!==g.zoom,A=x!==g.pitch,R=D!==g.bearing;return this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),S&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),R&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),A&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)),this}easeTo(i,u){this._stop(!1,i.easeId),(!1===(i=p.extend({offset:[0,0],duration:500,easing:p.ease},i)).animate||!i.essential&&p.exported.prefersReducedMotion)&&(i.duration=0);const g=this.transform,v=this.getZoom(),x=this.getBearing(),D=this.getPitch(),S=this.getPadding(),A="zoom"in i?+i.zoom:v,R="bearing"in i?this._normalizeBearing(i.bearing,x):x,F="pitch"in i?+i.pitch:D,L="padding"in i?i.padding:g.padding,j=p.pointGeometry.convert(i.offset);let G=g.centerPoint.add(j);const X=g.pointLocation(G),q=p.LngLat.convert(i.center||X);this._normalizeCenter(q);const J=g.project(X),H=g.project(q).sub(J),ee=g.zoomScale(A-v);let re,Z;i.around&&(re=p.LngLat.convert(i.around),Z=g.locationPoint(re));const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==v,this._rotating=this._rotating||x!==R,this._pitching=this._pitching||F!==D,this._padding=!g.isPaddingEqual(L),this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,ie),this._ease(le=>{if(this._zooming&&(g.zoom=p.number(v,A,le)),this._rotating&&(g.bearing=p.number(x,R,le)),this._pitching&&(g.pitch=p.number(D,F,le)),this._padding&&(g.interpolatePadding(S,L,le),G=g.centerPoint.add(j)),re)g.setLocationAtPoint(re,Z);else{const be=g.zoomScale(g.zoom-v),xe=A>v?Math.min(2,ee):Math.max(.5,ee),Te=Math.pow(xe,1-le),Ee=g.unproject(J.add(H.mult(le*Te)).mult(be));g.setLocationAtPoint(g.renderWorldCopies?Ee.wrap():Ee,G)}this._fireMoveEvents(u)},le=>{g.recenterOnTerrain(),this._afterEase(u,le)},i),this}_prepareEase(i,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new p.Event("movestart",i)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new p.Event("move",i)),this._zooming&&this.fire(new p.Event("zoom",i)),this._rotating&&this.fire(new p.Event("rotate",i)),this._pitching&&this.fire(new p.Event("pitch",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",i)),v&&this.fire(new p.Event("rotateend",i)),x&&this.fire(new p.Event("pitchend",i)),this.fire(new p.Event("moveend",i))}flyTo(i,u){if(!i.essential&&p.exported.prefersReducedMotion){const He=p.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,u)}this.stop(),i=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},i);const g=this.transform,v=this.getZoom(),x=this.getBearing(),D=this.getPitch(),S=this.getPadding(),A="zoom"in i?p.clamp(+i.zoom,g.minZoom,g.maxZoom):v,R="bearing"in i?this._normalizeBearing(i.bearing,x):x,F="pitch"in i?+i.pitch:D,L="padding"in i?i.padding:g.padding,j=g.zoomScale(A-v),G=p.pointGeometry.convert(i.offset);let X=g.centerPoint.add(G);const q=g.pointLocation(X),J=p.LngLat.convert(i.center||q);this._normalizeCenter(J);const H=g.project(q),ee=g.project(J).sub(H);let re=i.curve;const Z=Math.max(g.width,g.height),ie=Z/j,le=ee.mag();if("minZoom"in i){const He=p.clamp(Math.min(i.minZoom,v,A),g.minZoom,g.maxZoom),nt=Z/g.zoomScale(He-v);re=Math.sqrt(nt/le*2)}const be=re*re;function xe(He){const nt=(ie*ie-Z*Z+(He?-1:1)*be*be*le*le)/(2*(He?ie:Z)*be*le);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Te(He){return(Math.exp(He)-Math.exp(-He))/2}function Ee(He){return(Math.exp(He)+Math.exp(-He))/2}const Ve=xe(0);let Ce=function(He){return Ee(Ve)/Ee(Ve+re*He)},qe=function(He){return Z*((Ee(Ve)*(Te(nt=Ve+re*He)/Ee(nt))-Te(Ve))/be)/le;var nt},ye=(xe(1)-Ve)/re;if(Math.abs(le)<1e-6||!isFinite(ye)){if(Math.abs(Z-ie)<1e-6)return this.easeTo(i,u);const He=ie<Z?-1:1;ye=Math.abs(Math.log(ie/Z))/re,qe=function(){return 0},Ce=function(nt){return Math.exp(He*re*nt)}}return i.duration="duration"in i?+i.duration:1e3*ye/("screenSpeed"in i?+i.screenSpeed/re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=x!==R,this._pitching=F!==D,this._padding=!g.isPaddingEqual(L),this._prepareEase(u,!1),this._ease(He=>{const nt=He*ye,ct=1/Ce(nt);g.zoom=1===He?A:v+g.scaleZoom(ct),this._rotating&&(g.bearing=p.number(x,R,He)),this._pitching&&(g.pitch=p.number(D,F,He)),this._padding&&(g.interpolatePadding(S,L,He),X=g.centerPoint.add(G));const ft=1===He?J:g.unproject(H.add(ee.mult(qe(nt))).mult(ct));g.setLocationAtPoint(g.renderWorldCopies?ft.wrap():ft,X),g._updateCenterElevation(),this._fireMoveEvents(u)},()=>this._afterEase(u),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}if(!i){const g=this.handlers;g&&g.stop(!1)}return this}_ease(i,u,g){!1===g.animate||0===g.duration?(i(1),u()):(this._easeStart=p.exported.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,u){i=p.wrap(i,-180,180);const g=Math.abs(i-u);return Math.abs(i-360-u)<g&&(i-=360),Math.abs(i+360-u)<g&&(i+=360),i}_normalizeCenter(i){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=i.lng-u.center.lng;i.lng+=g>180?-360:g<-180?360:0}}class Ue{constructor(i={}){this.options=i,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const u=this.options&&this.options.compact;return this._map=i,this._container=Fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Fe.create("button","mapboxgl-ctrl-attrib-button",this._container),Fe.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Fe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){Fe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const g=this._map._getUIString(`AttributionControl.${u}`);i.setAttribute("aria-label",g),i.firstElementChild&&i.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(i){const g=u.reduce((v,x,D)=>(x.value&&(v+=`${x.key}=${x.value}${D<u.length-1?"&":""}`),v),"?");i.href=`${p.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(v=>"string"!=typeof v?"":v)):"string"==typeof this.options.customAttribution&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const x=u[v];if(x.used){const D=x.getSource();D.attribution&&i.indexOf(D.attribution)<0&&i.push(D.attribution)}}i.sort((v,x)=>v.length-x.length),i=i.filter((v,x)=>{for(let D=x+1;D<i.length;D++)if(i[D].indexOf(v)>=0)return!1;return!0});const g=i.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,i.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ht{constructor(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=Fe.create("div","mapboxgl-ctrl");const u=Fe.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Fe.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const u in i){const g=i[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Tu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===i)return void(v.cancelled=!0)}run(i=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Yn(f,i,u){if(f=new p.LngLat(f.lng,f.lat),i){const g=new p.LngLat(f.lng-360,f.lat),v=new p.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),D=u.locationPoint(f).distSqr(i),S=i.x<0||i.y<0||i.x>u.width||i.y>u.height;u.locationPoint(g).distSqr(i)<D&&(S||Math.abs(g.lng-u.center.lng)<x)?f=g:u.locationPoint(v).distSqr(i)<D&&(S||Math.abs(v.lng-u.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-u.center.lng)>180;){const g=u.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ao extends p.Evented{constructor(i,u){if(super(),(i instanceof p.window.HTMLElement||u)&&(i=p.extend({element:i},u)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=p.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Fe.create("div"),this._element.setAttribute("aria-label","Map marker");const v=Fe.createNS("http://www.w3.org/2000/svg","svg"),x=41,D=27;v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height",`${x}px`),v.setAttributeNS(null,"width",`${D}px`),v.setAttributeNS(null,"viewBox",`0 0 ${D} ${x}`);const S=Fe.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const A=Fe.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const R=Fe.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const F=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of F){const Z=Fe.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",re.rx),Z.setAttributeNS(null,"ry",re.ry),R.appendChild(Z)}const L=Fe.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill",this._color);const j=Fe.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),L.appendChild(j);const G=Fe.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const X=Fe.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild(X);const q=Fe.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const J=Fe.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=Fe.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const ee=Fe.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),J.appendChild(H),J.appendChild(ee),A.appendChild(R),A.appendChild(L),A.appendChild(G),A.appendChild(q),A.appendChild(J),v.appendChild(A),v.setAttributeNS(null,"height",x*this._scale+"px"),v.setAttributeNS(null,"width",D*this._scale+"px"),this._element.appendChild(v),this._offset=p.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in bl)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),Fe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=p.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const u=38.1,g=13.5,v=Math.sqrt(Math.pow(g,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-u],"bottom-left":[v,-1*(u-g+v)],"bottom-right":[-v,-1*(u-g+v)],left:[g,-1*(u-g)],right:[-g,-1*(u-g)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const u=i.code,g=i.charCode||i.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(i){const u=i.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const u=this._map.unproject(i);let g=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const D=x.position.toLngLat();g=D.distanceTo(u)<.9*D.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(u))*(g?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const u=this._map.transform;return!!i&&i.x>=0&&i.x<u.width&&i.y>=0&&i.y<u.height}_update(i){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Yn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let u="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?u=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?g="rotateX(0deg)":"map"===this._pitchAlignment&&(g=`rotateX(${this._map.getPitch()}deg)`),i&&"moveend"!==i.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&Fe.setTransform(this._element,`${bl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${u}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,u=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&u._rotate(i.angle),"map"===this._pitchAlignment&&(u.y*=Math.cos(i._pitch)),u}getOffset(){return this._offset}setOffset(i){return this._offset=p.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Yi{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const u=p.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,u,g){this._start=this.getValue(u),this._end=i,this._startTime=u,this._endTime=u+g}}const bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Bs,HTMLElement:pp,ImageBitmap:is}=p.window,wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function os(f){f.parentNode&&f.parentNode.removeChild(f)}const Pr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ki{constructor(i,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new To({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,g&&(this.mousePitch=new So({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Fe.addEventListener(u,"mousedown",this.mousedown),Fe.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Fe.addEventListener(u,"touchmove",this.touchmove),Fe.addEventListener(u,"touchend",this.touchend),Fe.addEventListener(u,"touchcancel",this.reset)}down(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),Fe.disableDrag()}move(i,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(i,u);if(v&&v.bearingDelta&&g.setBearing(g.getBearing()+v.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(i,u);x&&x.pitchDelta&&g.setPitch(g.getPitch()+x.pitchDelta)}}off(){const i=this.element;Fe.removeEventListener(i,"mousedown",this.mousedown),Fe.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),Fe.removeEventListener(i,"touchmove",this.touchmove),Fe.removeEventListener(i,"touchend",this.touchend),Fe.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){Fe.enableDrag(),Fe.removeEventListener(p.window,"mousemove",this.mousemove),Fe.removeEventListener(p.window,"mouseup",this.mouseup)}mousedown(i){this.down(p.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Fe.mousePos(this.element,i)),Fe.addEventListener(p.window,"mousemove",this.mousemove),Fe.addEventListener(p.window,"mouseup",this.mouseup)}mousemove(i){this.move(i,Fe.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Fe.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Fe.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const wc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let yi,ki=0,El=!1;const Ec={maxWidth:100,unit:"metric"};function Su(f,i,u){const g=u&&u.maxWidth||100,v=f._container.getBoundingClientRect().height/2,x=f.unproject([0,v]),D=f.unproject([g,v]),S=x.distanceTo(D);if(u&&"imperial"===u.unit){const A=3.2808*S;A>5280?Aa(i,g,A/5280,f._getUIString("ScaleControl.Miles"),f):Aa(i,g,A,f._getUIString("ScaleControl.Feet"),f)}else u&&"nautical"===u.unit?Aa(i,g,S/1852,f._getUIString("ScaleControl.NauticalMiles"),f):S>=1e3?Aa(i,g,S/1e3,f._getUIString("ScaleControl.Kilometers"),f):Aa(i,g,S,f._getUIString("ScaleControl.Meters"),f)}function Aa(f,i,u,g,v){const x=function(S){const A=Math.pow(10,`${Math.floor(S)}`.length-1);let R=S/A;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(F){const L=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*L)/L}(R),A*R}(u),D=x/u;v._requestDomTask(()=>{f.style.width=i*D+"px",f.innerHTML=`${x}&nbsp;${g}`})}const Iu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ns={version:p.version,supported:Vn,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Nh{constructor(f){if(null!=(f=p.extend({},wl,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ph(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Tu,this._domRenderTaskQueue=new Tu,this._controls=[],this._markers=[],this._mapId=p.uniqueId(),this._locale=p.extend({},bc,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Yi(0),this._requestManager=new p.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=p.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof pp))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new xl(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new vu("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,p.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Ue({customAttribution:f.customAttribution})),this._logoControl=new Ht,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new p.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new p.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(f,i){if(void 0===i&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[i];return-1!==i.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){const[i,u]=this._containerDimensions();if(i===this.transform.width&&u===this.transform.height)return this;this._resizeCanvas(i,u),this.transform.resize(i,u),this.painter.resize(Math.ceil(i),Math.ceil(u));const g=!this._moving;return g&&this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),this.fire(new p.Event("resize",f)),g&&this.fire(new p.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(p.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection()}project(f){return this.transform.locationPoint3D(p.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(p.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,i,u){if("mouseenter"===f||"mouseover"===f){let g=!1;const v=D=>{const S=i.filter(R=>this.getLayer(R)),A=S.length?this.queryRenderedFeatures(D.point,{layers:S}):[];A.length?g||(g=!0,u.call(this,new rr(f,this,D.originalEvent,{features:A}))):g=!1},x=()=>{g=!1};return{layers:new Set(i),listener:u,delegates:{mousemove:v,mouseout:x}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const v=D=>{const S=i.filter(A=>this.getLayer(A));(S.length?this.queryRenderedFeatures(D.point,{layers:S}):[]).length?g=!0:g&&(g=!1,u.call(this,new rr(f,this,D.originalEvent)))},x=D=>{g&&(g=!1,u.call(this,new rr(f,this,D.originalEvent)))};return{layers:new Set(i),listener:u,delegates:{mousemove:v,mouseout:x}}}{const g=v=>{const x=i.filter(S=>this.getLayer(S)),D=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];D.length&&(v.features=D,u.call(this,v),delete v.features)};return{layers:new Set(i),listener:u,delegates:{[f]:g}}}}on(f,i,u){if(void 0===u)return super.on(f,i);Array.isArray(i)||(i=[i]);const g=this._createDelegatedListener(f,i,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,i,u){if(void 0===u)return super.once(f,i);Array.isArray(i)||(i=[i]);const g=this._createDelegatedListener(f,i,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,i,u){if(void 0===u)return super.off(f,i);i=new Set(Array.isArray(i)?i:[i]);const g=(x,D)=>{if(x.size!==D.size)return!1;for(const S of x)if(!D.has(S))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(x=>{for(let D=0;D<x.length;D++){const S=x[D];if(S.listener===u&&g(S.layers,i)){for(const A in S.delegates)this.off(A,S.delegates[A]);return x.splice(D,1),this}}})(v),this}queryRenderedFeatures(f,i){return this.style?(void 0!==i||void 0===f||f instanceof p.pointGeometry||Array.isArray(f)||(i=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(f,i){return this.style.querySourceFeatures(f,i)}queryTerrainElevation(f,i){const u=this.transform.elevation;return u?(i=p.extend({},{exaggerated:!0},i),u.getAtPoint(p.MercatorCoordinate.fromLngLat(f),null,i.exaggerated)):null}setStyle(f,i){return!1!==(i=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(null==i)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new ri(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ri(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,i){if("string"==typeof f){const u=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(u,p.ResourceType.Style);p.getJSON(g,(v,x)=>{v?this.fire(new p.ErrorEvent(v)):x&&this._updateDiff(x,i)})}else"object"==typeof f&&this._updateDiff(f,i)}_updateDiff(f,i){try{this.style.setState(f)&&this._update(!0)}catch(u){p.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")}addSource(f,i){return this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)}isSourceLoaded(f){const i=this.style&&this.style._getSourceCaches(f);if(0!==i.length)return i.every(u=>u.loaded());this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const i in f){const u=f[i]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,i,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,i,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:x,content:D}={}){if(this._lazyInitEmptyStyle(),i instanceof Bs||is&&i instanceof is){const{width:S,height:A,data:R}=p.exported.getImageData(i);this.style.addImage(f,{data:new p.RGBAImage({width:S,height:A},R),pixelRatio:u,stretchX:v,stretchY:x,content:D,sdf:g,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:A,data:R}=i,F=i;this.style.addImage(f,{data:new p.RGBAImage({width:S,height:A},new Uint8Array(R)),pixelRatio:u,stretchX:v,stretchY:x,content:D,sdf:g,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}}updateImage(f,i){const u=this.style.getImage(f);if(!u)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=i instanceof Bs||is&&i instanceof is?p.exported.getImageData(i):i,{width:v,height:x,data:D}=g;return void 0===v||void 0===x?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==u.data.width||x!==u.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(u.data.replace(D,!(i instanceof Bs||is&&i instanceof is)),void this.style.updateImage(f,u))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){p.getImage(this._requestManager.transformRequest(f,p.ResourceType.Image),(u,g)=>{i(u,g instanceof Bs?p.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,i){return this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)}moveLayer(f,i){return this.style.moveLayer(f,i),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,i,u){return this.style.setLayerZoomRange(f,i,u),this._update(!0)}setFilter(f,i,u={}){return this.style.setFilter(f,i,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,i,u,g={}){return this.style.setPaintProperty(f,i,u,g),this._update(!0)}getPaintProperty(f,i){return this.style.getPaintProperty(f,i)}setLayoutProperty(f,i,u,g={}){return this.style.setLayoutProperty(f,i,u,g),this._update(!0)}getLayoutProperty(f,i){return this.style.getLayoutProperty(f,i)}setLight(f,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(f),this.transform):0}setFeatureState(f,i){return this.style.setFeatureState(f,i),this._update()}removeFeatureState(f,i){return this.style.removeFeatureState(f,i),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_containerDimensions(){let f=0,i=0;return this._container&&(f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300),[f,i]}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Fe.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Fe.create("div","mapboxgl-canvas-container",f);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Fe.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions();this._resizeCanvas(u[0],u[1]);const g=this._controlContainer=Fe.create("div","mapboxgl-control-container",f),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{v[x]=Fe.create("div",`mapboxgl-ctrl-${x}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const u=p.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const f=p.extend({},Vn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);i?(p.storeAuthState(i,!0),this.painter=new fl(i,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(i)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;const u=this.painter.context.extTimerQuery,g=p.exported.now();this.listens("gpu-timing-frame")&&(i=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,i));let v=this._updateAverageElevation(g);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;let x=!1;const D=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,F=p.exported.now();this.style.zoomHistory.update(A,F);const L=new p.EvaluationParameters(A,{now:F,fadeDuration:D,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=L.crossFadingFactor();1===j&&j===this._crossFadingFactor||(x=!0,this._crossFadingFactor=j),this.style.update(L)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,D,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:D,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const A=p.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,i),setTimeout(()=>{const R=u.getQueryObjectEXT(i,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(i),this.fire(new p.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(S||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(v=this._updateAverageElevation(g,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,i=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const x=Math.abs(g-v);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===p.AUTH_ERR_MSG||401===f.status)){const i=this.painter.context.gl;p.storeAuthState(i,!1),this._logoControl instanceof Ht&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const D=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,D),D}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(f,i,u){let g=u[1]-u[0];const v=f.length/4;for(let x=0;x<i.length;x++){const D=i[x];let S=0;for(let A=0;A<D.length;A+=4)D[A]===f[A]&&D[A+1]===f[A+1]&&D[A+2]===f[A+2]&&D[A+3]===f[A+3]&&(S+=1);g+=(u[x+2]-u[x+1])*(1-S/v)}return g}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),os(this._canvasContainer),os(this._controlContainer),os(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=p.exported.frame(i=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(i)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,i){p.setCacheLimits(f,i)}get version(){return p.version}},NavigationControl:class{constructor(f){this.options=p.extend({},Pr,f),this._container=Fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),Fe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),Fe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=Fe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),i=f===this._map.getMaxZoom(),u=f===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ki(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Fe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,i){const u=Fe.create("button",f,this._container);return u.type="button",u.addEventListener("click",i),u}_setButtonTitle(f,i){const u=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends p.Evented{constructor(f){super(),this.options=p.extend({},wc,f),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=kh(this._updateMarkerRotation,20)}onAdd(f){var i;return this._map=f,this._container=Fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==yi?i(yi):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(u=>{yi="denied"!==u.state,i(yi)}):(yi=!!p.window.navigator.geolocation,i(yi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Fe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ki=0,El=!1}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),u=f.coords;return i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",f)),this._finish()}}_updateCamera(f){const i=new p.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,g=this._map.getBearing(),v=p.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(u),v,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new p.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.getBoundingClientRect().height/2,i=this._map.unproject([0,f]),u=this._map.unproject([100,f]),g=i.distanceTo(u)/100,v=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&El)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Fe.create("button","mapboxgl-ctrl-geolocate",this._container),Fe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Fe.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Fe.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Fe.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ao({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Fe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ao({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ki--,El=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ki++,ki>1?(f={maximumAge:6e5,timeout:0},El=!0):(f=this.options.positionOptions,El=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&f()}).catch(console.error):f()}_clearWatch(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ue,ScaleControl:class{constructor(f){this.options=p.extend({},Ec,f),p.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Su(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Fe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Su(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof p.window.HTMLElement?this._container=f.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Fe.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Fe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Fe.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(f){super(),this.options=p.extend(Object.create(Iu),f),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Fe.remove(this._content),this._container&&(Fe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=p.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(p.window.document.createTextNode(f))}setHTML(f){const i=p.window.document.createDocumentFragment(),u=p.window.document.createElement("body");let g;for(u.innerHTML=f;g=u.firstChild,g;)i.appendChild(g);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Fe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=Fe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._pos,u=this._container.offsetWidth,g=this._container.offsetHeight;let v;return v=i.y+f.bottom.y<g?["top"]:i.y>this._map.transform.height-g?["bottom"]:[],i.x<u/2?v.push("left"):i.x>this._map.transform.width-u/2&&v.push("right"),0===v.length?"bottom":v.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Fe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Fe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yn(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const i=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),u=function(x){if(x||(x=new p.pointGeometry(0,0)),"number"==typeof x){const D=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new p.pointGeometry(0,0),top:new p.pointGeometry(0,x),"top-left":new p.pointGeometry(D,D),"top-right":new p.pointGeometry(-D,D),bottom:new p.pointGeometry(0,-x),"bottom-left":new p.pointGeometry(D,-D),"bottom-right":new p.pointGeometry(-D,-D),left:new p.pointGeometry(x,0),right:new p.pointGeometry(-x,0)}}if(x instanceof p.pointGeometry||Array.isArray(x)){const D=p.pointGeometry.convert(x);return{center:D,top:D,"top-left":D,"top-right":D,bottom:D,"bottom-left":D,"bottom-right":D,left:D,right:D}}return{center:p.pointGeometry.convert(x.center||[0,0]),top:p.pointGeometry.convert(x.top||[0,0]),"top-left":p.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":p.pointGeometry.convert(x["top-right"]||[0,0]),bottom:p.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":p.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":p.pointGeometry.convert(x["bottom-right"]||[0,0]),left:p.pointGeometry.convert(x.left||[0,0]),right:p.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),g=this._anchor=this._getAnchor(u),v=i.add(u[g]).round();this._map._requestDomTask(()=>{this._container&&g&&Fe.setTransform(this._container,`${bl[g]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Mu);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:Ao,Style:ri,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Mh,Evented:p.Evented,config:p.config,prewarm:function(){We().acquire(ce)},clearPrewarmedResources:function(){const f=Pe;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(ce),Pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(f){p.config.ACCESS_TOKEN=f},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(f){p.config.API_URL=f},get workerCount(){return _e.workerCount},set workerCount(f){_e.workerCount=f},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){p.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){p.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Ns}),Rn}()}},sp=>{sp(sp.s=741)}]);